![](readme.assets/1604286335335-48f389f8-7cae-4afc-8e12-e17f01ee2fc0.png)

[BlakeYaçš„æ–°æŠ€æœ¯å®¶å›­](https://blakeya513.notion.site/195e01c404d380159a17fc2a1cb678e9?v=195e01c404d3803b9ae0000c73eebf46)

# åŸºç¡€

## åŒ…è£…ç±»ï¼š 

åœ¨Javaä¸­ï¼ŒåŒ…è£…ç±»ï¼ˆWrapper Classesï¼‰æ˜¯ä¸€ç»„ç”¨äºå°è£…åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆprimitive data typesï¼‰çš„ç±»ã€‚åŸºæœ¬æ•°æ®ç±»å‹åŒ…æ‹¬ï¼šbyteã€shortã€intã€longã€floatã€doubleã€charå’Œbooleanã€‚å¯¹åº”çš„åŒ…è£…ç±»åˆ†åˆ«ä¸ºï¼šByteã€Shortã€Integerã€Longã€Floatã€Doubleã€Characterå’ŒBooleanã€‚è¿™äº›åŒ…è£…ç±»éƒ½ä½äºjava.langåŒ…ä¸­ã€‚
åŒ…è£…ç±»çš„ä¸»è¦ä½œç”¨æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š

1. å°†åŸºæœ¬æ•°æ®ç±»å‹è½¬æ¢ä¸ºå¯¹è±¡ï¼šåŒ…è£…ç±»å…è®¸å°†åŸºæœ¬æ•°æ®ç±»å‹å°è£…æˆå¯¹è±¡ï¼Œä»¥ä¾¿åœ¨éœ€è¦ä½¿ç”¨å¯¹è±¡çš„åœºåˆï¼Œä¾‹å¦‚é›†åˆï¼ˆå¦‚ArrayListã€HashSetç­‰ï¼‰ä¸­ï¼Œå¯ä»¥å­˜å‚¨åŸºæœ¬æ•°æ®ç±»å‹ã€‚
2. æä¾›å®ç”¨æ–¹æ³•å’Œå¸¸é‡ï¼šåŒ…è£…ç±»ä¸ºåŸºæœ¬æ•°æ®ç±»å‹æä¾›äº†ä¸€äº›å®ç”¨çš„æ–¹æ³•å’Œå¸¸é‡ã€‚ä¾‹å¦‚ï¼ŒIntegerç±»æä¾›äº†parseIntæ–¹æ³•ç”¨äºå°†å­—ç¬¦ä¸²è§£æä¸ºæ•´æ•°ï¼ŒCharacterç±»æä¾›äº†isDigitæ–¹æ³•ç”¨äºæ£€æŸ¥å­—ç¬¦æ˜¯å¦ä¸ºæ•°å­—ã€‚
3. è‡ªåŠ¨è£…ç®±ä¸è‡ªåŠ¨æ‹†ç®±ï¼šä»Java 5å¼€å§‹ï¼ŒåŒ…è£…ç±»æ”¯æŒè‡ªåŠ¨è£…ç®±ï¼ˆAutoboxingï¼‰å’Œè‡ªåŠ¨æ‹†ç®±ï¼ˆUnboxingï¼‰ã€‚è‡ªåŠ¨è£…ç®±æ˜¯æŒ‡å°†åŸºæœ¬æ•°æ®ç±»å‹è‡ªåŠ¨è½¬æ¢ä¸ºå¯¹åº”çš„åŒ…è£…ç±»å¯¹è±¡ï¼Œè€Œè‡ªåŠ¨æ‹†ç®±åˆ™æ˜¯å°†åŒ…è£…ç±»å¯¹è±¡è‡ªåŠ¨è½¬æ¢ä¸ºå¯¹åº”çš„åŸºæœ¬æ•°æ®ç±»å‹ã€‚è¿™ä½¿å¾—åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°åœ¨åŸºæœ¬æ•°æ®ç±»å‹å’ŒåŒ…è£…ç±»ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚
   ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…³äºåŒ…è£…ç±»ã€è‡ªåŠ¨è£…ç®±å’Œè‡ªåŠ¨æ‹†ç®±çš„ç®€å•ç¤ºä¾‹ï¼š

```java
public class WrapperClassExample {
    public static void main(String[] args) {
        // è‡ªåŠ¨è£…ç®±ï¼šå°†åŸºæœ¬æ•°æ®ç±»å‹è½¬æ¢ä¸ºåŒ…è£…ç±»å¯¹è±¡
        Integer iObj = 42; // ç­‰ä»·äºï¼šInteger iObj = Integer.valueOf(42);

        // è‡ªåŠ¨æ‹†ç®±ï¼šå°†åŒ…è£…ç±»å¯¹è±¡è½¬æ¢ä¸ºåŸºæœ¬æ•°æ®ç±»å‹
        int iPrimitive = iObj; // ç­‰ä»·äºï¼šint iPrimitive = iObj.intValue();

        // ä½¿ç”¨åŒ…è£…ç±»æä¾›çš„æ–¹æ³•
        String binaryString = Integer.toBinaryString(iPrimitive);
        System.out.println("The binary representation of " + iPrimitive + " is: " + binaryString);
    }
}
```

æ€»çš„æ¥è¯´ï¼ŒJavaä¸­çš„åŒ…è£…ç±»ç”¨äºå°è£…åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¹¶æä¾›äº†ä¸€äº›å®ç”¨æ–¹æ³•å’Œè‡ªåŠ¨è£…ç®±/æ‹†ç®±çš„åŠŸèƒ½ï¼Œä»¥ä¾¿åœ¨ç¼–å†™ä»£ç æ—¶èƒ½æ›´æ–¹ä¾¿åœ°æ“ä½œåŸºæœ¬æ•°æ®ç±»å‹ã€‚

## StringåŸç†è§£æ

åœ¨Javaä¸­ï¼ŒStringç±»ä»£è¡¨ä¸€ä¸ªä¸å¯å˜çš„å­—ç¬¦åºåˆ—ã€‚è¿™æ„å‘³ç€ä¸€æ—¦Stringå¯¹è±¡è¢«åˆ›å»ºï¼Œå…¶å†…å®¹å°±æ— æ³•è¢«æ”¹å˜ã€‚Stringç±»ä½äºjava.langåŒ…ä¸­ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦æ˜¾å¼åœ°å¯¼å…¥è¯¥ç±»ã€‚ä¸‹é¢æ˜¯å¯¹Stringç±»çš„ä¸€äº›åŸç†è¿›è¡Œè§£æï¼š

1. **ä¸å¯å˜æ€§**ï¼ˆImmutabilityï¼‰ï¼šStringç±»çš„å…³é”®ç‰¹æ€§æ˜¯å…¶ä¸å¯å˜æ€§ã€‚è¿™æœ‰åŠ©äºæé«˜å®‰å…¨æ€§ï¼ˆä¾‹å¦‚ï¼Œå°†å­—ç¬¦ä¸²ç”¨ä½œæ•æ„Ÿä¿¡æ¯ã€å¯†ç ç­‰ï¼‰ï¼Œå¹¶é™ä½åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„åŒæ­¥å¼€é”€ã€‚ä¸å¯å˜æ€§è¿˜æœ‰åŠ©äºæé«˜æ€§èƒ½ï¼Œå› ä¸ºJVMå¯ä»¥åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Constant Poolï¼‰ä¸­å…±äº«ç›¸åŒå†…å®¹çš„Stringå¯¹è±¡ã€‚
2. **å­—ç¬¦ä¸²å¸¸é‡æ± **ï¼ˆString Constant Poolï¼‰ï¼šä¸ºäº†å‡å°‘å†…å­˜å ç”¨ï¼ŒJVMåœ¨å†…å­˜ä¸­ç»´æŠ¤äº†ä¸€ä¸ªç‰¹æ®Šçš„å­˜å‚¨åŒºåŸŸï¼Œç§°ä¸ºå­—ç¬¦ä¸²å¸¸é‡æ± ã€‚å½“æˆ‘ä»¬ä½¿ç”¨åŒå¼•å·ç›´æ¥åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²æ—¶ï¼ŒJVMé¦–å…ˆä¼šæ£€æŸ¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯å¦å­˜åœ¨ç›¸åŒå†…å®¹çš„Stringå¯¹è±¡ã€‚å¦‚æœå­˜åœ¨ï¼ŒJVMå°†è¿”å›è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼›å¦åˆ™ï¼Œå®ƒå°†åœ¨å¸¸é‡æ± ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ã€‚
3. **å­—ç¬¦ä¸²æ‹¼æ¥**ï¼šåœ¨Javaä¸­ï¼Œå¯ä»¥ä½¿ç”¨+è¿ç®—ç¬¦æˆ–StringBuilderï¼ˆæˆ–StringBufferï¼‰ç±»æ¥æ‹¼æ¥å­—ç¬¦ä¸²ã€‚ç”±äºStringå¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œæ¯æ¬¡ä½¿ç”¨+è¿ç®—ç¬¦æ‹¼æ¥å­—ç¬¦ä¸²æ—¶ï¼Œå®é™…ä¸Šä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ï¼Œè¿™å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚å› æ­¤ï¼Œåœ¨éœ€è¦é¢‘ç¹æ‹¼æ¥å­—ç¬¦ä¸²çš„åœºæ™¯ä¸­ï¼Œå»ºè®®ä½¿ç”¨StringBuilderï¼ˆéçº¿ç¨‹å®‰å…¨ï¼‰æˆ–StringBufferï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ç±»ï¼Œå®ƒä»¬æä¾›äº†æ›´é«˜æ•ˆçš„å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œã€‚
4. **Stringç±»çš„æ–¹**æ³•ï¼šStringç±»æä¾›äº†è®¸å¤šç”¨äºæ“ä½œå­—ç¬¦ä¸²çš„å®ç”¨æ–¹æ³•ï¼Œä¾‹å¦‚lengthï¼ˆè·å–å­—ç¬¦ä¸²é•¿åº¦ï¼‰ã€charAtï¼ˆè·å–æŒ‡å®šä½ç½®çš„å­—ç¬¦ï¼‰ã€substringï¼ˆè·å–å­å­—ç¬¦ä¸²ï¼‰ã€indexOfï¼ˆæŸ¥æ‰¾å­—ç¬¦æˆ–å­å­—ç¬¦ä¸²çš„ä½ç½®ï¼‰ã€equalsï¼ˆæ¯”è¾ƒå­—ç¬¦ä¸²å†…å®¹æ˜¯å¦ç›¸ç­‰ï¼‰ç­‰ã€‚
   ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨Stringç±»çš„ä¸€äº›æ–¹æ³•ï¼š

```java
public class StringExample {
    public static void main(String[] args) {
        // åˆ›å»ºå­—ç¬¦ä¸²
        String s1 = "Hello, ";
        String s2 = "world!";

        // å­—ç¬¦ä¸²æ‹¼æ¥
        String s3 = s1 + s2; // ç»“æœä¸º "Hello, world!"

        // è·å–å­—ç¬¦ä¸²é•¿åº¦
        int length = s3.length(); // ç»“æœä¸º 13

        // è·å–æŒ‡å®šä½ç½®çš„å­—ç¬¦
        char ch = s3.charAt(7); // ç»“æœä¸º 'w'

        // è·å–å­å­—ç¬¦ä¸²
        String substring = s3.substring(0, 5); // ç»“æœä¸º "Hello"

        // æ¯”è¾ƒå­—ç¬¦ä¸²å†…å®¹æ˜¯å¦ç›¸ç­‰
        boolean isEqual = s1.equals(s2); // ç»“æœä¸º false

        // è¾“å‡ºç»“æœ
        System.out.println("Concatenated string: " + s3);
        System.out.println("Length: " + length);
        System.out.println("Character at index 7: " + ch);
        System.out.println("Substring: " +
```

## javaä¸­çš„å¼•ç”¨ç±»å‹

ä»¥ä¸‹æ˜¯å››ç§å¼•ç”¨ç±»å‹çš„ç¤ºä¾‹ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„åˆ›å»ºå’Œä½¿ç”¨æ–¹æ³•ï¼š

1. **å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰ï¼š ä¸ä¼šå›æ”¶**
   **å¼ºå¼•ç”¨æ˜¯é»˜è®¤çš„å¼•ç”¨ç±»å‹**ï¼Œåˆ›å»ºæ–¹å¼éå¸¸ç®€å•ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªæ™®é€šçš„å¯¹è±¡å¼•ç”¨å³å¯ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
MyObject obj = new MyObject();
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º obj çš„å¯¹è±¡å¼•ç”¨ï¼Œå®ƒæŒ‡å‘ä¸€ä¸ª MyObject ç±»å‹çš„å®ä¾‹ã€‚ç”±äº obj æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œåªæœ‰å½“æˆ‘ä»¬æ˜¾å¼åœ°å°†å…¶è®¾ä¸º null æ—¶ï¼Œåƒåœ¾å›æ”¶å™¨æ‰ä¼šå›æ”¶ MyObject å®ä¾‹ã€‚

2. **è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰ï¼š å†…å­˜ä¸è¶³æ—¶è¿›è¡Œå°è¯•å›æ”¶**

è½¯å¼•ç”¨é€šå¸¸ç”¨äºå®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ã€‚åœ¨ Java ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ java.lang.ref.SoftReference ç±»åˆ›å»ºè½¯å¼•ç”¨ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
MyObject obj = new MyObject();
SoftReference<MyObject> softRef = new SoftReference<>(obj);
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º softRef çš„è½¯å¼•ç”¨ï¼Œå®ƒæŒ‡å‘ objã€‚å½“ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šå°è¯•å›æ”¶ objï¼Œå¦‚æœå›æ”¶äº† objï¼Œåˆ™ softRef å˜ä¸º nullã€‚

3. **å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰ï¼šåƒåœ¾å›æ”¶æ—¶ä¸ç®¡ç³»ç»Ÿå†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šè¢«å›æ”¶**

å¼±å¼•ç”¨ä¸è½¯å¼•ç”¨ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ç§æ¯”å¼ºå¼•ç”¨æ›´å¼±åŒ–äº†çš„å¼•ç”¨ç±»å‹ã€‚åœ¨ Java ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ java.lang.ref.WeakReference ç±»åˆ›å»ºå¼±å¼•ç”¨ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
MyObject obj = new MyObject();
WeakReference<MyObject> weakRef = new WeakReference<>(obj);
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º weakRef çš„å¼±å¼•ç”¨ï¼Œå®ƒæŒ‡å‘ objã€‚å½“åƒåœ¾å›æ”¶å™¨è¿è¡Œæ—¶ï¼Œä¸ç®¡ç³»ç»Ÿå†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå°è¯•å›æ”¶ objï¼Œå¦‚æœå›æ”¶äº† objï¼Œåˆ™ weakRef å˜ä¸º nullã€‚

4. **è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰ï¼š**

è™šå¼•ç”¨æ˜¯æœ€å¼±åŒ–çš„ä¸€ç§å¼•ç”¨ç±»å‹ã€‚åœ¨ Java ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ java.lang.ref.PhantomReference ç±»åˆ›å»ºè™šå¼•ç”¨ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š

```java
MyObject obj = new MyObject();
ReferenceQueue<MyObject> queue = new ReferenceQueue<>();
PhantomReference<MyObject> phantomRef = new PhantomReference<>(obj, queue);
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º phantomRef çš„è™šå¼•ç”¨ï¼Œå®ƒæŒ‡å‘ objï¼Œå¹¶å°†å…¶æ”¾å…¥ä¸€ä¸ªåä¸º queue çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚å½“ obj è¢«å›æ”¶æ—¶ï¼ŒphantomRef ä¼šè¢«åŠ å…¥ queue é˜Ÿåˆ—ä¸­ã€‚æ³¨æ„ï¼Œ**è™šå¼•ç”¨ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå®ƒé€šå¸¸éœ€è¦å’Œå¼•ç”¨é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨ã€‚**

## å¼‚å¸¸åŠå¼‚å¸¸å¤„ç†

åœ¨Javaä¸­ï¼Œå¼‚å¸¸ï¼ˆExceptionï¼‰æ˜¯ç¨‹åºåœ¨è¿è¡Œæ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜æˆ–é”™è¯¯ã€‚å¼‚å¸¸å¤„ç†æ˜¯ä¸€ç§å¤„ç†è¿è¡Œæ—¶é”™è¯¯çš„æœºåˆ¶ï¼Œä½¿ç¨‹åºèƒ½å¤Ÿåœ¨é‡åˆ°å¼‚å¸¸æ—¶ä»èƒ½æ­£å¸¸æ‰§è¡Œæˆ–ä¼˜é›…åœ°ç»ˆæ­¢ã€‚Javaå¼‚å¸¸å¤„ç†åŸºäºäº”ä¸ªå…³é”®å­—**ï¼štryã€catchã€finallyã€throwå’Œthrowsã€‚**
Javaå¼‚å¸¸ä½“ç³»ä¸»è¦ç”±Throwableç±»åŠå…¶ä¸¤ä¸ªå­ç±»æ„æˆï¼šErrorå’ŒExceptionã€‚Errorè¡¨ç¤ºç³»ç»Ÿçº§çš„é”™è¯¯ï¼Œé€šå¸¸ä¸åº”ç”±ç¨‹åºå¤„ç†ã€‚Exceptionè¡¨ç¤ºç¨‹åºçº§çš„é”™è¯¯ï¼Œå¯ä»¥ç”±ç¨‹åºå¤„ç†ã€‚Javaçš„å¼‚å¸¸åˆ†ä¸ºä¸¤ç±»ï¼š

1. **å—æ£€å¼‚å¸¸**ï¼ˆChecked Exceptionsï¼‰ï¼šè¿™äº›å¼‚å¸¸åœ¨ç¼–è¯‘æ—¶éœ€è¦å¤„ç†ï¼Œå¦åˆ™ç¼–è¯‘å™¨å°†æŠ¥é”™ã€‚å—æ£€å¼‚å¸¸é€šå¸¸ç”±ç¨‹åºé€»è¾‘é”™è¯¯æˆ–å¤–éƒ¨èµ„æºé—®é¢˜å¼•èµ·ï¼Œä¾‹å¦‚I**OExceptionã€SQLException**ç­‰ã€‚è¦å¤„ç†è¿™äº›å¼‚å¸¸ï¼Œéœ€è¦ä½¿ç”¨try-catchè¯­å¥æˆ–é€šè¿‡throwså…³é”®å­—å°†å¼‚å¸¸å‘ä¸ŠæŠ›å‡ºã€‚
2. **éå—æ£€å¼‚å¸¸**ï¼ˆUnchecked Exceptionsï¼‰ï¼šè¿™äº›å¼‚å¸¸åœ¨ç¼–è¯‘æ—¶ä¸éœ€è¦å¤„ç†ã€‚éå—æ£€å¼‚å¸¸é€šå¸¸ç”±ç¼–ç¨‹é”™è¯¯å¼•èµ·ï¼Œä¾‹å¦‚**NullPointerException**ã€**ArrayIndexOutOfBoundsException**ã€**ArithmeticException**ç­‰ã€‚è™½ç„¶å¤„ç†éå—æ£€å¼‚å¸¸ä¸æ˜¯å¼ºåˆ¶çš„ï¼Œä½†åœ¨å¯èƒ½å‡ºç°å¼‚å¸¸çš„æƒ…å†µä¸‹å¤„ç†å®ƒä»¬é€šå¸¸æ˜¯ä¸ªå¥½ä¹ æƒ¯ã€‚
   ä¸‹é¢æ˜¯ä¸€äº›å…³äºJavaå¼‚å¸¸å¤„ç†çš„åŸºæœ¬æ¦‚å¿µï¼š
   â— try-catchï¼šä½¿ç”¨tryå—åŒ…è£¹å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç ã€‚å¦‚æœtryå—ä¸­çš„ä»£ç æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™ç¨‹åºä¼šè·³è½¬åˆ°ä¸è¯¥å¼‚å¸¸ç±»å‹åŒ¹é…çš„catchå—è¿›è¡Œå¤„ç†ã€‚å¯ä»¥ä¸ºä¸€ä¸ªtryå—å®šä¹‰å¤šä¸ªcatchå—ï¼Œä»¥å¤„ç†ä¸åŒç±»å‹çš„å¼‚å¸¸ã€‚
   â— finallyï¼šfinallyå—æ˜¯åœ¨try-catchè¯­å¥åè·Ÿéšçš„ä¸€ä¸ªå¯é€‰éƒ¨åˆ†ï¼Œå…¶ä¸­çš„ä»£ç å§‹ç»ˆä¼šè¢«æ‰§è¡Œï¼Œæ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ã€‚é€šå¸¸åœ¨finallyå—ä¸­è¿›è¡Œèµ„æºçš„æ¸…ç†æ“ä½œï¼Œä¾‹å¦‚å…³é—­æ–‡ä»¶æµã€æ•°æ®åº“è¿æ¥ç­‰ã€‚
   â— throwï¼šä½¿ç”¨throwå…³é”®å­—å¯ä»¥æ˜¾å¼æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚è¿™é€šå¸¸ç”¨äºåœ¨æ£€æµ‹åˆ°é”™è¯¯æ¡ä»¶æ—¶æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ã€‚
   â— throwsï¼šåœ¨æ–¹æ³•ç­¾åä¸­ä½¿ç”¨throwså…³é”®å­—å£°æ˜å¯èƒ½æŠ›å‡ºçš„å—æ£€å¼‚å¸¸ã€‚è¿™æ„å‘³ç€è°ƒç”¨è¯¥æ–¹æ³•çš„ä»£ç éœ€è¦å¤„ç†è¿™äº›å¼‚å¸¸ï¼Œæˆ–è€…ç»§ç»­å°†å®ƒä»¬å‘ä¸ŠæŠ›å‡ºã€‚
   ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„Javaå¼‚å¸¸å¤„ç†ç¤ºä¾‹ï¼š

```java
public class ExceptionHandlingExample {
    public static void main(String[] args) {
        try {
            int result = divide(10, 0);
            System.out.println("Result: " + result);
        } catch (ArithmeticException e) {
            System.out.println("Error: Division by zero");
        } finally {
            System.out.println("This will always be executed.");
        }
    }

    public static int divide(int a, int b) throws ArithmeticException {
        if (b == 0) {
            throw new ArithmeticException("Division by zero is not allowed");
        }
        return a / b;
    }
}
```

## JDK8æ—¥æœŸå’Œæ—¶é—´

åœ¨JDK 8ä¸­ï¼ŒJavaå¼•å…¥äº†ä¸€ä¸ªå…¨æ–°çš„æ—¥æœŸå’Œæ—¶é—´åº“ï¼Œè¯¥åº“ä½äºjava.timeåŒ…ä¸­ã€‚è¿™ä¸ªæ–°åº“çš„è®¾è®¡çµæ„Ÿæ¥è‡ªäºJoda-Timeåº“ï¼Œè§£å†³äº†Javaæ—©æœŸç‰ˆæœ¬ä¸­çš„java.util.Dateå’Œjava.util.Calendarç±»å­˜åœ¨çš„é—®é¢˜ï¼Œæä¾›äº†æ›´åŠ ç®€æ´ã€æ˜“ç”¨ä¸”çº¿ç¨‹å®‰å…¨çš„æ—¥æœŸå’Œæ—¶é—´å¤„ç†åŠŸèƒ½ã€‚
ä»¥ä¸‹æ˜¯java.timeåŒ…ä¸­çš„ä¸€äº›ä¸»è¦ç±»ï¼š

1. LocalDateï¼šè¡¨ç¤ºä¸å¸¦æ—¶åŒºçš„æ—¥æœŸï¼ˆå¹´ã€æœˆã€æ—¥ï¼‰ï¼Œä¾‹å¦‚ï¼š2023-04-12ã€‚
2. LocalTimeï¼šè¡¨ç¤ºä¸å¸¦æ—¶åŒºçš„æ—¶é—´ï¼ˆæ—¶ã€åˆ†ã€ç§’ã€çº³ç§’ï¼‰ï¼Œä¾‹å¦‚ï¼š14:30:15.123456789ã€‚
3. LocalDateTimeï¼šè¡¨ç¤ºä¸å¸¦æ—¶åŒºçš„æ—¥æœŸå’Œæ—¶é—´ï¼Œç»“åˆäº†LocalDateå’ŒLocalTimeã€‚
4. Instantï¼šè¡¨ç¤ºæ—¶é—´æˆ³ï¼Œå³ä»1970å¹´1æœˆ1æ—¥ï¼ˆUTCï¼‰å¼€å§‹çš„çº³ç§’æ•°ã€‚å®ƒé€šå¸¸ç”¨äºè®°å½•äº‹ä»¶å‘ç”Ÿçš„ç²¾ç¡®æ—¶é—´ã€‚
5. ZonedDateTimeï¼šè¡¨ç¤ºå¸¦æ—¶åŒºçš„æ—¥æœŸå’Œæ—¶é—´ã€‚å®ƒåŒ…å«äº†ä¸€ä¸ªLocalDateTimeå’Œä¸€ä¸ªæ—¶åŒºä¿¡æ¯ï¼ˆZoneIdï¼‰ã€‚
6. Periodï¼šè¡¨ç¤ºä¸¤ä¸ªLocalDateä¹‹é—´çš„æ—¶é—´æ®µï¼Œä»¥å¹´ã€æœˆã€æ—¥ä¸ºå•ä½ã€‚
7. Durationï¼šè¡¨ç¤ºä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹é—´çš„æ—¶é—´é—´éš”ï¼Œä»¥ç§’å’Œçº³ç§’ä¸ºå•ä½ã€‚
8. ZoneIdï¼šè¡¨ç¤ºæ—¶åŒºçš„æ ‡è¯†ç¬¦ï¼Œä¾‹å¦‚ï¼šEurope/Parisã€Asia/Shanghaiç­‰ã€‚
9. DateTimeFormatterï¼šç”¨äºæ ¼å¼åŒ–å’Œè§£ææ—¥æœŸå’Œæ—¶é—´çš„ç±»ã€‚
   ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨JDK 8ä¸­çš„æ—¥æœŸå’Œæ—¶é—´åº“ï¼š

```java
package org.example;

import java.time.Duration;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.LocalTime;
import java.time.format.DateTimeFormatter;

public class Main {
    public static void main(String[] args) {
        // è·å–å½“å‰æ—¥æœŸ
        LocalDate currentDate = LocalDate.now();
        System.out.println("Current date: " + currentDate); //2023-04-12

        // è·å–å½“å‰æ—¶é—´
        LocalTime currentTime = LocalTime.now();
        System.out.println("Current time: " + currentTime); //15:41:54.919

        // è·å–å½“å‰æ—¥æœŸå’Œæ—¶é—´
        LocalDateTime currentDateTime = LocalDateTime.now();
        System.out.println("Current date and time: " + currentDateTime);//2023-04-12T15:41:54.919

        // æ ¼å¼åŒ–æ—¥æœŸå’Œæ—¶é—´
        DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");
        String formattedDateTime = currentDateTime.format(formatter);
        System.out.println("Formatted date and time: " + formattedDateTime); //2023-04-12 15:41:54

        // è§£ææ—¥æœŸå’Œæ—¶é—´
        LocalDateTime parsedDateTime = LocalDateTime.parse("2023-04-12 14:30:15", formatter);
        System.out.println("Parsed date and time: " + parsedDateTime);// 2023-04-12T14:30:15

        // è®¡ç®—æ—¶é—´é—´éš”
        Duration duration = Duration.between(parsedDateTime, currentDateTime);
        System.out.println("Duration in seconds: " + duration.getSeconds());//4299
    }
}
```

## Javaæ•°ç»„æ’åº â­ï¸

Java 8åŠä¹‹åçš„ç‰ˆæœ¬åœ¨æ•°ç»„å¤„ç†å’Œæ’åºæ–¹é¢å¹¶æ²¡æœ‰å¼•å…¥æ–°çš„æ•°æ®ç»“æ„ï¼Œä½†å®ƒå¼•å…¥äº†ä¸€äº›æ–°ç‰¹æ€§ï¼Œå¦‚Lambdaè¡¨è¾¾å¼å’ŒStream APIï¼Œå¯ä»¥è®©æˆ‘ä»¬æ›´ç®€æ´ã€é«˜æ•ˆåœ°å¤„ç†æ•°ç»„å’Œæ’åºæ“ä½œã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨Java 8çš„Stream APIå¤„ç†æ•°ç»„å’Œè¿›è¡Œæ’åºï¼š

```java
import java.util.Arrays;
import java.util.Comparator;
import java.util.stream.Collectors;

public class ArraySortingExample {
    public static void main(String[] args) {
        Integer[] numbers = {5, 3, 8, 1, 6, 4, 7, 2};

        // ä½¿ç”¨Lambdaè¡¨è¾¾å¼è¿›è¡Œè‡ªç„¶æ’åºï¼ˆå‡åºï¼‰
        Integer[] sortedAscending = Arrays.stream(numbers)
                .sorted()
                .toArray(Integer[]::new);
        
        // è¾“å‡ºï¼š Ascending order: [1, 2, 3, 4, 5, 6, 7, 8]
        System.out.println("Ascending order: " + Arrays.toString(sortedAscending));

        
        // ä½¿ç”¨Lambdaè¡¨è¾¾å¼è¿›è¡Œé™åºæ’åº
        Integer[] sortedDescending = Arrays.stream(numbers)
                .sorted(Comparator.reverseOrder())
                .toArray(Integer[]::new);
        // è¾“å‡ºï¼š Descending order: [8, 7, 6, 5, 4, 3, 2, 1]
        System.out.println("Descending order: " + Arrays.toString(sortedDescending));

        // å¯¹å­—ç¬¦ä¸²æ•°ç»„è¿›è¡Œæ’åº
        String[] names = {"John", "Alice", "Zoe", "Bob", "Marry", "Tom"};
        String[] sortedNames = Arrays.stream(names)
                .sorted()
                .toArray(String[]::new);
        // Sorted names: [Alice, Bob, John, Marry, Tom, Zoe]
        System.out.println("Sorted names: " + Arrays.toString(sortedNames));

        // ä½¿ç”¨è‡ªå®šä¹‰æ’åºè§„åˆ™ï¼ˆå¦‚å­—ç¬¦ä¸²é•¿åº¦ï¼‰
        String[] sortedByLength = Arrays.stream(names)
                .sorted(Comparator.comparingInt(String::length).reversed())
                .toArray(String[]::new);
        // Sorted by length: [Alice, Marry, John, Zoe, Bob, Tom]
        System.out.println("Sorted by length: " + Arrays.toString(sortedByLength));
    }
}

```

## Java8 Streamæµ

## é”ğŸ”

:::info
Javaä¸­çš„é”ä¸»è¦ç”¨äºç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ•°æ®åŒæ­¥å’Œä¿è¯çº¿ç¨‹å®‰å…¨ã€‚Javaä¸­çš„é”å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š

1. **äº’æ–¥é”ï¼ˆMutexï¼‰**ï¼šäº’æ–¥é”æ˜¯ä¸€ç§ç‹¬å é”ï¼ŒåŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ã€‚åœ¨Javaä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå†…ç½®é”ï¼ˆç§°ä¸ºç›‘è§†å™¨é”ï¼Œmonitor lockï¼‰ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸€ä¸ªä½¿ç”¨synchronizedå…³é”®å­—ä¿®é¥°çš„æ–¹æ³•æˆ–ä»£ç å—æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨è·å–è¯¥å¯¹è±¡çš„å†…ç½®é”ã€‚å…¶ä»–è¯•å›¾è®¿é—®è¯¥æ–¹æ³•æˆ–ä»£ç å—çš„çº¿ç¨‹å°†è¢«é˜»å¡ï¼Œç›´åˆ°æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”ã€‚
2. åå‘é”ï¼ˆBiased Lockingï¼‰ï¼šåå‘é”æ˜¯ä¸€ç§è½»é‡çº§é”çš„ä¼˜åŒ–æ‰‹æ®µï¼Œå®ƒçš„ä¸»è¦ç›®çš„æ˜¯æ¶ˆé™¤æ— ç«äº‰æƒ…å†µä¸‹çš„é”æ“ä½œã€‚åå‘é”é»˜è®¤æ˜¯å¯ç”¨çš„ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°ä¸€ä¸ªåå‘é”æ—¶ï¼Œè¯¥çº¿ç¨‹ä¼šåœ¨å¯¹è±¡å¤´çš„æ ‡è®°å­—æ®µä¸­è®°å½•è‡ªå·±çš„çº¿ç¨‹IDã€‚å¦‚æœåŒä¸€çº¿ç¨‹å†æ¬¡å°è¯•è·å–è¯¥åå‘é”ï¼Œå®ƒå°†ç›´æ¥é€šè¿‡æ¯”è¾ƒçº¿ç¨‹IDæ¥åˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€çº¿ç¨‹ï¼Œä»è€Œé¿å…äº†é”çš„äº‰ç”¨ã€‚å¦‚æœæœ‰å…¶ä»–çº¿ç¨‹è¯•å›¾è·å–è¯¥é”ï¼Œåå‘é”ä¼šå‡çº§ä¸ºè½»é‡çº§é”ã€‚
3. è½»é‡çº§é”ï¼ˆLightweight Lockingï¼‰ï¼šè½»é‡çº§é”æ˜¯ä¸€ç§è‡ªæ—‹é”ï¼Œå®ƒä¸»è¦ç”¨äºå¤„ç†ç«äº‰ä¸æ¿€çƒˆçš„æƒ…å†µã€‚å½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–é”æ—¶ï¼Œå¦‚æœé”æœªè¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™å½“å‰çº¿ç¨‹å°†è·å–è¯¥é”å¹¶ç»§ç»­æ‰§è¡Œã€‚å¦‚æœé”å·²è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œå½“å‰çº¿ç¨‹ä¼šè¿›å…¥è‡ªæ—‹çŠ¶æ€ï¼Œå°è¯•å¤šæ¬¡è·å–é”ï¼Œä»¥å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚ç„¶è€Œï¼Œå¦‚æœç»è¿‡å¤šæ¬¡è‡ªæ—‹ä»æ— æ³•è·å¾—é”ï¼Œè½»é‡çº§é”å°†ä¼šå‡çº§ä¸ºé‡é‡çº§é”ã€‚
4. é‡é‡çº§é”ï¼ˆHeavyweight Lockingï¼‰ï¼šé‡é‡çº§é”æ˜¯ä¸€ç§ç‹¬å é”ï¼Œå½“è½»é‡çº§é”æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ï¼Œä¼šå‡çº§ä¸ºé‡é‡çº§é”ã€‚é‡é‡çº§é”ä¼šå¯¼è‡´ç«äº‰é”çš„çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè¿™æ¶‰åŠåˆ°æ“ä½œç³»ç»Ÿå±‚é¢çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå› æ­¤æˆæœ¬ç›¸å¯¹è¾ƒé«˜ã€‚åœ¨Javaä¸­ï¼Œé‡é‡çº§é”å¯¹åº”äºæ“ä½œç³»ç»Ÿçš„å†…æ ¸çº§äº’æ–¥é‡ï¼ˆMutexï¼‰ã€‚
5. è¯»å†™é”ï¼ˆReadWriteLockï¼‰ï¼šè¯»å†™é”å…è®¸å¤šä¸ªè¯»çº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºï¼Œè€Œå¯¹äºå†™çº¿ç¨‹åˆ™æ˜¯ç‹¬å è®¿é—®ã€‚è¿™æ ·å¯ä»¥æé«˜åœ¨å¤šè¯»å°‘å†™çš„åœºæ™¯ä¸‹çš„æ€§èƒ½ã€‚
   :::

## é¢å‘å¯¹è±¡çš„6å¤§åŸåˆ™å’Œ1ä¸ªæ³•åˆ™

ä»¥ä¸‹æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„6å¤§åŸåˆ™å’Œ1ä¸ªæ³•åˆ™ï¼Œä»¥è¡¨æ ¼å½¢å¼å±•ç¤ºï¼š

| **åºå·** | **åŸåˆ™/æ³•åˆ™**             | **ç®€è¿°**                                                     |
| -------- | ------------------------- | ------------------------------------------------------------ |
| 1        | å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰       | ä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªåŸå› å¼•èµ·å˜åŒ–ï¼Œå³ä¸€ä¸ªç±»åº”è¯¥åªè´Ÿè´£ä¸€é¡¹èŒè´£ã€‚ |
| 2        | å¼€é—­åŸåˆ™ï¼ˆOCPï¼‰           | è½¯ä»¶å®ä½“ï¼ˆç±»ã€æ¨¡å—ã€å‡½æ•°ç­‰ï¼‰åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­ã€‚è¿™æ„å‘³ç€åœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„åŸºç¡€ä¸Šæ·»åŠ æ–°åŠŸèƒ½ã€‚ |
| 3        | é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLSPï¼‰       | å­ç±»åº”è¯¥èƒ½å¤Ÿæ›¿æ¢å…¶çˆ¶ç±»ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨çˆ¶ç±»çš„åœ°æ–¹ä¸ä¼šå‡ºç°ä»»ä½•é—®é¢˜ã€‚ |
| 4        | æ¥å£éš”ç¦»åŸåˆ™ï¼ˆISPï¼‰       | ç±»ä¹‹é—´çš„ä¾èµ–å…³ç³»åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šï¼Œä¸åº”è¯¥å¼ºè¿«å®ç°ä¸éœ€è¦çš„æ¥å£ã€‚ |
| 5        | ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰       | é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¨¡å—ï¼Œå®ƒä»¬éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚æŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºå…·ä½“å®ç°ï¼Œå…·ä½“å®ç°åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚ |
| 6        | åˆæˆ/èšåˆå¤ç”¨åŸåˆ™ï¼ˆCARPï¼‰ | å°½é‡ä½¿ç”¨åˆæˆ/èšåˆçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿å…³ç³»è¾¾åˆ°å¤ç”¨çš„ç›®çš„ã€‚  |
| 7        | è®¾è®¡æ¨¡å¼ï¼ˆ1æ³•åˆ™ï¼‰         | è®¾è®¡æ¨¡å¼æ˜¯ä¸€ç§ç”¨äºè§£å†³åœ¨è½¯ä»¶è®¾è®¡ä¸­å¸¸è§é—®é¢˜çš„æœ€ä½³å®è·µã€‚é€šè¿‡ä½¿ç”¨è®¾è®¡æ¨¡å¼ï¼Œå¯ä»¥æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯è¯»æ€§å’Œå¯æ‰©å±•æ€§ã€‚ |

# ç±»

## æŠ½è±¡ç±»

åœ¨Javaä¸­ï¼Œ**æŠ½è±¡ç±»æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»ï¼Œå®ƒä¸èƒ½è¢«å®ä¾‹åŒ–**ï¼Œè€Œæ˜¯ç”¨äºä½œä¸ºå…¶ä»–ç±»çš„çˆ¶ç±»ï¼Œä¸ºå®ƒä»¬æä¾›ä¸€äº›é€šç”¨çš„è¡Œä¸ºå’Œç‰¹å¾ã€‚æŠ½è±¡ç±»é€šè¿‡ä½¿ç”¨å…³é”®å­—**abstract**æ¥å£°æ˜ï¼Œå…¶ä¸­å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•å’ŒéæŠ½è±¡æ–¹æ³•ã€‚æŠ½è±¡æ–¹æ³•æ˜¯æ²¡æœ‰å®ç°çš„æ–¹æ³•ï¼Œéœ€è¦ç”±å­ç±»æ¥å®ç°ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»çš„ç¤ºä¾‹ï¼š

```java
public abstract class Shape {
    protected int x;
    protected int y;

    public Shape(int x, int y) {
        this.x = x;
        this.y = y;
    }

    public abstract double getArea();

    public abstract double getPerimeter();

    public void move(int deltaX, int deltaY) {
        x += deltaX;
        y += deltaY;
    }
}

```

è¿™ä¸ªæŠ½è±¡ç±»å®šä¹‰äº†ä¸€ä¸ªå½¢çŠ¶ï¼ˆShapeï¼‰ç±»ï¼Œå®ƒåŒ…å«äº†ä¸¤ä¸ªåæ ‡å±æ€§xå’Œyï¼Œä»¥åŠä¸‰ä¸ªæ–¹æ³•ï¼šgetAreaã€getPerimeterå’Œmoveã€‚å…¶ä¸­getAreaå’ŒgetPerimeteræ˜¯æŠ½è±¡æ–¹æ³•ï¼Œéœ€è¦ç”±å­ç±»æ¥å®ç°ï¼›moveæ–¹æ³•æ˜¯éæŠ½è±¡æ–¹æ³•ï¼Œå·²ç»æä¾›äº†é»˜è®¤çš„å®ç°ã€‚ç”±äºShapeç±»æ˜¯æŠ½è±¡ç±»ï¼Œå› æ­¤ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œè€Œæ˜¯éœ€è¦ç”±å­ç±»æ¥æ‰©å±•å®ƒï¼Œå¹¶å®ç°æŠ½è±¡æ–¹æ³•ã€‚

```java
public class Rectangle extends Shape {
    private int width;
    private int height;

    public Rectangle(int x, int y, int width, int height) {
        super(x, y);
        this.width = width;
        this.height = height;
    }

    @Override
    public double getArea() {
        return width * height;
    }

    @Override
    public double getPerimeter() {
        return 2 * (width + height);
    }
}

```

è¿™ä¸ªå­ç±»æ‰©å±•äº†Shapeç±»ï¼Œå¹¶å®ç°äº†getAreaå’ŒgetPerimeteræ–¹æ³•ï¼Œè®¡ç®—çŸ©å½¢çš„é¢ç§¯å’Œå‘¨é•¿ã€‚
æŠ½è±¡ç±»åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­æ‰®æ¼”äº†é‡è¦çš„è§’è‰²ï¼Œå®ƒå¯ä»¥ä¸ºå­ç±»æä¾›é€šç”¨çš„å±æ€§å’Œæ–¹æ³•ï¼Œå¹¶ä¸”é€šè¿‡å¼ºåˆ¶å­ç±»å®ç°æŠ½è±¡æ–¹æ³•ï¼Œå¯ä»¥å¼ºåˆ¶å®ç°ç±»å…·æœ‰ç‰¹å®šçš„è¡Œä¸ºå’Œç‰¹å¾ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŠ½è±¡ç±»æ¥å®šä¹‰æ¡†æ¶ã€æ¥å£å’ŒåŸºæœ¬ç±»åº“ã€‚

## æšä¸¾ç±»

**åœ¨Javaä¸­ï¼Œæšä¸¾ç±»æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»ï¼Œç”¨äºè¡¨ç¤ºä¸€ç»„å›ºå®šçš„å¸¸é‡å€¼**ã€‚æšä¸¾ç±»å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæšä¸¾å¸¸é‡ï¼Œæ¯ä¸ªæšä¸¾å¸¸é‡éƒ½æ˜¯è¯¥ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚æšä¸¾å¸¸é‡é€šå¸¸ç”¨å…¨å¤§å†™å­—æ¯è¡¨ç¤ºï¼Œç”¨é€—å·åˆ†éš”ï¼Œç±»ä¼¼äºå¸¸é‡çš„å®šä¹‰ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªæšä¸¾ç±»çš„ç¤ºä¾‹ï¼š

```java
public enum DayOfWeek {
    MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY;
}

```

è¿™ä¸ªæšä¸¾ç±»å®šä¹‰äº†ä¸€ç»„æ˜ŸæœŸå‡ çš„æšä¸¾å¸¸é‡ã€‚**è¿™äº›å¸¸é‡éƒ½æ˜¯DayOfWeekç±»çš„å®ä¾‹**ï¼Œå¯ä»¥é€šè¿‡DayOfWeek.MONDAYã€DayOfWeek.TUESDAYç­‰æ–¹å¼æ¥è®¿é—®ã€‚
æšä¸¾ç±»å¯ä»¥åŒ…å«æ„é€ æ–¹æ³•ã€æˆå‘˜å˜é‡å’Œæ–¹æ³•ç­‰ã€‚æšä¸¾ç±»ä¸­çš„æ¯ä¸ªæšä¸¾å¸¸é‡éƒ½æ˜¯è¯¥ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œå› æ­¤å¯ä»¥ç»™æ¯ä¸ªæšä¸¾å¸¸é‡æŒ‡å®šä¸åŒçš„æ„é€ å‚æ•°å’Œæˆå‘˜å˜é‡ã€‚åŒæ—¶ï¼Œæšä¸¾ç±»ä¸­çš„æ–¹æ³•å¯ä»¥ä¸ºæ¯ä¸ªæšä¸¾å¸¸é‡æä¾›ä¸åŒçš„è¡Œä¸ºã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ‰©å±•DayOfWeekæšä¸¾ç±»çš„ç¤ºä¾‹ï¼š

```java
public enum DayOfWeek {
    MONDAY("æ˜ŸæœŸä¸€", 1),
    TUESDAY("æ˜ŸæœŸäºŒ", 2),
    WEDNESDAY("æ˜ŸæœŸä¸‰", 3),
    THURSDAY("æ˜ŸæœŸå››", 4),
    FRIDAY("æ˜ŸæœŸäº”", 5),
    SATURDAY("æ˜ŸæœŸå…­", 6),
    SUNDAY("æ˜ŸæœŸæ—¥", 7);

    private String name;
    private int value;

    private DayOfWeek(String name, int value) {
        this.name = name;
        this.value = value;
    }

    public String getName() {
        return name;
    }

    public int getValue() {
        return value;
    }

    public boolean isWeekend() {
        return this == SATURDAY || this == SUNDAY;
    }
}

```

## æˆå‘˜å†…éƒ¨ç±»

åœ¨Javaä¸­ï¼Œæˆå‘˜å†…éƒ¨ç±»æ˜¯å®šä¹‰åœ¨ä¸€ä¸ªç±»å†…éƒ¨çš„ç±»ï¼Œå®ƒå¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡å’Œæ–¹æ³•ï¼ŒåŒ…æ‹¬ç§æœ‰æˆå‘˜ã€‚æˆå‘˜å†…éƒ¨ç±»ä¹Ÿå¯ä»¥å®šä¹‰æˆå‘˜å˜é‡ã€æˆå‘˜æ–¹æ³•å’Œæ„é€ æ–¹æ³•ç­‰ï¼Œå®ƒä»¬çš„è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥æ˜¯publicã€protectedã€é»˜è®¤æˆ–privateã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªæˆå‘˜å†…éƒ¨ç±»çš„ç¤ºä¾‹ï¼š

```java
public class OuterClass {
    private int x;

    public class InnerClass {
        public void foo() {
            x = 10; // è®¿é—®å¤–éƒ¨ç±»çš„æˆå‘˜å˜é‡
            System.out.println("x = " + x);
        }
    }

    public void bar() {
        InnerClass inner = new InnerClass(); // åˆ›å»ºå†…éƒ¨ç±»å¯¹è±¡
        inner.foo(); // è°ƒç”¨å†…éƒ¨ç±»çš„æ–¹æ³•
    }
}

```

è¿™ä¸ªç¤ºä¾‹å®šä¹‰äº†ä¸€ä¸ªOuterClassç±»å’Œä¸€ä¸ªInnerClasså†…éƒ¨ç±»ã€‚InnerClasså†…éƒ¨ç±»è®¿é—®äº†OuterClassç±»çš„æˆå‘˜å˜é‡xï¼Œå¹¶æä¾›äº†ä¸€ä¸ªfooæ–¹æ³•æ¥å¯¹xè¿›è¡Œæ“ä½œã€‚OuterClassç±»çš„baræ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªInnerClasså¯¹è±¡ï¼Œå¹¶è°ƒç”¨äº†å®ƒçš„fooæ–¹æ³•ã€‚
**ä½¿ç”¨åœºæ™¯**

> ä¾‹å¦‚ï¼Œå½“æŸä¸ªç±»éœ€è¦ä½¿ç”¨å¦ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•ï¼Œå¹¶ä¸”è¿™äº›æˆå‘˜å˜é‡å’Œæ–¹æ³•éœ€è¦ä¿æŠ¤ä¸è¢«å…¶ä»–ç±»è®¿é—®æ—¶ï¼Œå¯ä»¥å°†è¿™äº›æˆå‘˜å˜é‡å’Œæ–¹æ³•å®šä¹‰åœ¨å¦ä¸€ä¸ªç±»ä¸­ï¼Œæˆä¸ºå…¶æˆå‘˜å†…éƒ¨ç±»ã€‚æ­¤å¤–ï¼Œæˆå‘˜å†…éƒ¨ç±»è¿˜å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„ç§æœ‰æˆå‘˜ï¼Œä»è€Œå®ç°äº†å°è£…å’Œéšè—çš„æ•ˆæœã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆå‘˜å†…éƒ¨ç±»æ˜¯ä¾èµ–äºå¤–éƒ¨ç±»è€Œå­˜åœ¨çš„ï¼Œå› æ­¤åœ¨åˆ›å»ºInnerClasså¯¹è±¡ä¹‹å‰ï¼Œå¿…é¡»å…ˆåˆ›å»ºä¸€ä¸ªOuterClasså¯¹è±¡ã€‚

### ç¼ºé™·ï¼šä¼šå¯¼è‡´å†…å­˜æ³„æ¼

æ¡ˆä¾‹ï¼š ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨æˆå‘˜å†…éƒ¨ç±»å¯¼è‡´**å†…å­˜æ³„æ¼çš„ä¾‹å­**ï¼š

```java
public class OuterClass {
    private List<String> data;

    public OuterClass() {
        data = new ArrayList<>();
    }

    public void add(String value) {
        data.add(value);
        // åˆ›å»ºä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå†…éƒ¨ç±»ä¸­æŒç»­æŒæœ‰å¤–éƒ¨ç±»å¯¹è±¡ï¼Œå¯¼è‡´ç¨‹åºæ— æ³•ä¸­æ–­ï¼Œé€ æˆå†…å­˜æ³„æ¼
        InnerClass inner = new InnerClass();
    }

    private class InnerClass {
        public InnerClass() {
            // æ¨¡æ‹Ÿå†…éƒ¨ç±»æŒç»­å¼•ç”¨å¤–éƒ¨ç±»å®ä¾‹çš„åœºæ™¯
            new Thread(() -> {
                while (true) {
                    try {
                        Thread.sleep(1000);
                        System.out.println(data);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    System.out.println(data.size());
                }
            }).start();
        }
    }
}

```

InnerClassæ˜¯ä¸€ä¸ªæˆå‘˜å†…éƒ¨ç±»ï¼Œå®ƒæŒç»­å¼•ç”¨äº†OuterClasså®ä¾‹ä¸­çš„dataæˆå‘˜å˜é‡ã€‚åœ¨InnerClassçš„æ„é€ å‡½æ•°ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¹¶æŒç»­åœ°æ‰“å°dataçš„é•¿åº¦ï¼Œä»è€Œå¯¼è‡´äº†å¯¹OuterClasså®ä¾‹çš„æŒç»­å¼•ç”¨ã€‚å› æ­¤ï¼Œå¦‚æœåœ¨ä½¿ç”¨OuterClasså®ä¾‹ä¹‹åï¼Œæ²¡æœ‰æ‰‹åŠ¨é‡Šæ”¾InnerClasså®ä¾‹ï¼Œå°±ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼ã€‚
ä¸ºäº†é¿å…è¿™ç§å†…å­˜æ³„æ¼ï¼Œ**å¯ä»¥åœ¨addæ–¹æ³•ä¸­ä¿å­˜InnerClasså®ä¾‹çš„å¼•ç”¨ï¼Œå¹¶åœ¨ä½¿ç”¨å®Œä¹‹åæ‰‹åŠ¨é‡Šæ”¾**ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```java
public class OuterClass {
    private List<String> data;

    public OuterClass() {
        data = new ArrayList<>();
    }

    public void add(String value) {
        data.add(value);
        InnerClass inner = new InnerClass();
        // ä½¿ç”¨å®Œä¹‹åæ‰‹åŠ¨é‡Šæ”¾InnerClasså®ä¾‹
        inner.release();
    }

    private class InnerClass {
        private volatile boolean released = false;

        public InnerClass() {
            new Thread(() -> {
                // éœ€è¦é€šè¿‡å˜é‡æ§åˆ¶ç¨‹åºï¼Œä¸èƒ½è®©æ— é™è¿è¡Œä¸‹æœŸ
                while (!released) {
                    try {
                        Thread.sleep(1000);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    System.out.println(data.size());
                }
            }).start();
        }
    	//è¿”å›trueï¼Œç”¨æ¥ç»ˆæ­¢å†…éƒ¨ç±»
        public void release() {
            released = true;
        }
    }
}

```

åœ¨è¿™ä¸ªä¿®æ”¹åçš„ä¾‹å­ä¸­ï¼ŒInnerClasså¢åŠ äº†ä¸€ä¸ªreleaseæ–¹æ³•ï¼Œç”¨äºé‡Šæ”¾å¯¹OuterClasså®ä¾‹çš„å¼•ç”¨ã€‚åœ¨addæ–¹æ³•ä¸­ï¼Œä½¿ç”¨å®ŒInnerClasså®ä¾‹åï¼Œè°ƒç”¨releaseæ–¹æ³•è¿›è¡Œé‡Šæ”¾ã€‚è¿™æ ·å°±èƒ½å¤Ÿé¿å…æˆå‘˜å†…éƒ¨ç±»æŒç»­å¼•ç”¨å¤–éƒ¨ç±»å®ä¾‹å¯¼è‡´çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚

## é™æ€æˆå‘˜å†…éƒ¨ç±»

åœ¨Javaä¸­ï¼Œé™æ€æˆå‘˜å†…éƒ¨ç±»æ˜¯å®šä¹‰åœ¨ä¸€ä¸ªç±»å†…éƒ¨ï¼Œå¹¶ä¸”ä½¿ç”¨staticå…³é”®å­—ä¿®é¥°çš„ç±»ã€‚ä¸éé™æ€æˆå‘˜å†…éƒ¨ç±»ä¸åŒçš„æ˜¯ï¼Œé™æ€æˆå‘˜å†…éƒ¨ç±»ä¸ä¾èµ–äºå¤–éƒ¨ç±»çš„å®ä¾‹ï¼Œå› æ­¤å¯ä»¥ç›´æ¥é€šè¿‡å¤–éƒ¨ç±»åæ¥è®¿é—®å®ƒçš„é™æ€æˆå‘˜å’Œæ–¹æ³•ï¼Œè€Œä¸éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªå¤–éƒ¨ç±»çš„å®ä¾‹ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªé™æ€æˆå‘˜å†…éƒ¨ç±»çš„ç¤ºä¾‹ï¼š

```java
public class OuterClass {
    private static int x;

    public static class InnerClass {
        public void foo() {
            x = 10; // è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜å˜é‡
            System.out.println("x = " + x);
        }
    }

    public static void bar() {
        InnerClass inner = new InnerClass(); // åˆ›å»ºé™æ€å†…éƒ¨ç±»å¯¹è±¡
        inner.foo(); // è°ƒç”¨é™æ€å†…éƒ¨ç±»çš„æ–¹æ³•
    }
}
```

è¿™ä¸ªç¤ºä¾‹å®šä¹‰äº†ä¸€ä¸ªOuterClassç±»å’Œä¸€ä¸ªInnerClassé™æ€æˆå‘˜å†…éƒ¨ç±»ã€‚InnerClasså†…éƒ¨ç±»è®¿é—®äº†OuterClassç±»çš„é™æ€æˆå‘˜å˜é‡xï¼Œå¹¶æä¾›äº†ä¸€ä¸ªfooæ–¹æ³•æ¥å¯¹xè¿›è¡Œæ“ä½œã€‚OuterClassç±»çš„baræ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªInnerClasså¯¹è±¡ï¼Œå¹¶è°ƒç”¨äº†å®ƒçš„fooæ–¹æ³•ã€‚
**ä¸éé™æ€æˆå‘˜å†…éƒ¨ç±»ç›¸æ¯”ï¼Œé™æ€æˆå‘˜å†…éƒ¨ç±»çš„ä½¿ç”¨åœºæ™¯æ›´ä¸ºå¹¿æ³›ã€‚ä¾‹å¦‚ï¼Œåœ¨æŸä¸ªç±»ä¸­éœ€è¦å®šä¹‰ä¸€ä¸ªè¾…åŠ©ç±»ï¼Œå¹¶ä¸”è¿™ä¸ªè¾…åŠ©ç±»ä¸éœ€è¦è®¿é—®å¤–éƒ¨ç±»çš„å®ä¾‹å˜é‡æˆ–æ–¹æ³•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨é™æ€æˆå‘˜å†…éƒ¨ç±»æ¥å®ç°ã€‚æ­¤å¤–ï¼Œé™æ€æˆå‘˜å†…éƒ¨ç±»è¿˜å¯ä»¥é˜²æ­¢å¤–éƒ¨ç±»çš„å®ä¾‹è¢«æŒæœ‰ï¼Œä»è€Œé¿å…ä¸€äº›æ½œåœ¨çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚**

## å±€éƒ¨å†…éƒ¨ç±»

åœ¨Javaä¸­ï¼Œå±€éƒ¨å†…éƒ¨ç±»æ˜¯å®šä¹‰åœ¨ä¸€ä¸ªæ–¹æ³•æˆ–ä»£ç å—å†…éƒ¨çš„ç±»ã€‚ä¸æˆå‘˜å†…éƒ¨ç±»ä¸åŒçš„æ˜¯ï¼Œå±€éƒ¨å†…éƒ¨ç±»åªèƒ½åœ¨å®šä¹‰å®ƒçš„æ–¹æ³•æˆ–ä»£ç å—ä¸­è¢«è®¿é—®ï¼Œæ— æ³•åœ¨å¤–éƒ¨ç±»çš„å…¶ä»–æ–¹æ³•ä¸­è®¿é—®ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªå±€éƒ¨å†…éƒ¨ç±»çš„ç¤ºä¾‹ï¼š

```java
public class OuterClass {
    public void foo() {
        int x = 10;

        class InnerClass {
            public void bar() {
                System.out.println("x = " + x);
            }
        }

        InnerClass inner = new InnerClass(); // åˆ›å»ºå±€éƒ¨å†…éƒ¨ç±»å¯¹è±¡
        inner.bar(); // è°ƒç”¨å±€éƒ¨å†…éƒ¨ç±»çš„æ–¹æ³•
    }
}
```

è¿™ä¸ªç¤ºä¾‹å®šä¹‰äº†ä¸€ä¸ªOuterClassç±»å’Œä¸€ä¸ªfooæ–¹æ³•ã€‚fooæ–¹æ³•å®šä¹‰äº†ä¸€ä¸ªå±€éƒ¨å˜é‡xï¼Œå¹¶ä¸”åœ¨æ–¹æ³•å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªInnerClasså±€éƒ¨å†…éƒ¨ç±»ã€‚InnerClasså±€éƒ¨å†…éƒ¨ç±»è®¿é—®äº†fooæ–¹æ³•ä¸­çš„xå˜é‡ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªbaræ–¹æ³•æ¥å¯¹xè¿›è¡Œæ“ä½œã€‚fooæ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªInnerClasså¯¹è±¡ï¼Œå¹¶è°ƒç”¨äº†å®ƒçš„baræ–¹æ³•ã€‚
å±€éƒ¨å†…éƒ¨ç±»é€šå¸¸ç”¨äºéœ€è¦è®¿é—®å±€éƒ¨å˜é‡æˆ–å‚æ•°çš„åœºæ™¯ã€‚ç”±äºå±€éƒ¨å†…éƒ¨ç±»åªèƒ½åœ¨å®šä¹‰å®ƒçš„æ–¹æ³•æˆ–ä»£ç å—ä¸­è¢«è®¿é—®ï¼Œå› æ­¤å®ƒå¯ä»¥è®¿é—®è¯¥æ–¹æ³•æˆ–ä»£ç å—ä¸­çš„æ‰€æœ‰å˜é‡å’Œå‚æ•°ï¼ŒåŒ…æ‹¬finalç±»å‹çš„å˜é‡å’Œå‚æ•°ã€‚æ­¤å¤–ï¼Œå±€éƒ¨å†…éƒ¨ç±»è¿˜å¯ä»¥å®ç°æŸäº›æ¥å£æˆ–ç»§æ‰¿æŸä¸ªç±»ï¼Œå¹¶é‡å†™å®ƒä»¬çš„æ–¹æ³•ï¼Œä»è€Œæä¾›ä¸€äº›ç‰¹å®šçš„åŠŸèƒ½ã€‚

## åŒ¿åå†…éƒ¨ç±»

åœ¨Javaä¸­ï¼ŒåŒ¿åå†…éƒ¨ç±»æ˜¯ä¸€ç§ç‰¹æ®Šçš„å±€éƒ¨å†…éƒ¨ç±»ï¼Œå®ƒæ²¡æœ‰åç§°ï¼Œç›´æ¥åœ¨åˆ›å»ºå¯¹è±¡çš„è¯­å¥ä¸­å®šä¹‰ã€‚åŒ¿åå†…éƒ¨ç±»é€šå¸¸ç”¨äºåˆ›å»ºå®ç°æŸä¸ªæ¥å£æˆ–ç»§æ‰¿æŸä¸ªç±»çš„å¯¹è±¡ï¼Œä»¥æä¾›ä¸€äº›ç‰¹å®šçš„åŠŸèƒ½ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»çš„ç¤ºä¾‹ï¼š

```java
public class OuterClass {
    public void foo() {
        Runnable r = new Runnable() {
            public void run() {
                System.out.println("Hello, world!");
            }
        };

        new Thread(r).start(); // åˆ›å»ºçº¿ç¨‹å¹¶å¯åŠ¨
    }
}
```

è¿™ä¸ªç¤ºä¾‹å®šä¹‰äº†ä¸€ä¸ªOuterClassç±»å’Œä¸€ä¸ªfooæ–¹æ³•ã€‚fooæ–¹æ³•å®šä¹‰äº†ä¸€ä¸ªRunnableç±»å‹çš„å˜é‡rï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»æ¥åˆ›å»ºå®ƒçš„å®ä¾‹ã€‚åŒ¿åå†…éƒ¨ç±»å®ç°äº†runæ–¹æ³•ï¼Œå¹¶åœ¨å…¶ä¸­è¾“å‡ºä¸€æ¡æ¶ˆæ¯ã€‚fooæ–¹æ³•è¿˜åˆ›å»ºäº†ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¹¶å°†rä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ƒï¼Œä»è€Œå¯åŠ¨äº†è¿™ä¸ªçº¿ç¨‹ã€‚
åŒ¿åå†…éƒ¨ç±»çš„è¯­æ³•æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒç›´æ¥åœ¨åˆ›å»ºå¯¹è±¡çš„è¯­å¥ä¸­å®šä¹‰ç±»çš„å®ç°ã€‚ç”±äºåŒ¿åå†…éƒ¨ç±»æ²¡æœ‰åç§°ï¼Œå› æ­¤ä¹Ÿæ— æ³•ç›´æ¥åˆ›å»ºå®ƒçš„å¯¹è±¡ï¼Œå¿…é¡»å€ŸåŠ©äºæŸä¸ªæ¥å£æˆ–æŠ½è±¡ç±»æ¥åˆ›å»ºå®ä¾‹ã€‚
åŒ¿åå†…éƒ¨ç±»é€šå¸¸ç”¨äºåªéœ€è¦ä¸´æ—¶ä½¿ç”¨ä¸€æ¬¡çš„åœºæ™¯ï¼Œä¾‹å¦‚åˆ›å»ºæŸä¸ªäº‹ä»¶ç›‘å¬å™¨ã€å›è°ƒå‡½æ•°ç­‰ã€‚ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»å¯ä»¥å‡å°‘ä»£ç é‡ï¼Œæé«˜å¯è¯»æ€§ï¼Œå¹¶ä¸”æ— éœ€ä¸ºç±»èµ·ä¸€ä¸ªåç§°ã€‚

## æ·±å…‹éš†â­ï¸

åœ¨Javaä¸­ï¼Œæ·±å…‹éš†æ˜¯ä¸€ç§å¤åˆ¶å¯¹è±¡çš„æ–¹å¼ï¼Œæ–°å¯¹è±¡ä¸åŸå§‹å¯¹è±¡æ‹¥æœ‰ç›¸åŒçš„å±æ€§å€¼ï¼Œ**ä½†æ˜¯æ–°å¯¹è±¡ä¸­çš„å¼•ç”¨ç±»å‹å±æ€§ä¸åŸå§‹å¯¹è±¡ä¸­çš„å¼•ç”¨ç±»å‹å±æ€§æŒ‡å‘ä¸åŒçš„å¯¹è±¡ã€‚æ·±å…‹éš†é€šå¸¸éœ€è¦é€šè¿‡é€’å½’å®ç°ï¼Œå¯¹æ‰€æœ‰å¼•ç”¨ç±»å‹å±æ€§è¿›è¡Œæ·±å±‚å¤åˆ¶ã€‚**
ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ·±å…‹éš†çš„ç¤ºä¾‹ï¼š

```java
public class Person implements Cloneable {
    private String name;
    private Address address;

    public Person(String name, Address address) {
        this.name = name;
        this.address = address;
    }

    public String getName() {
        return name;
    }

    public Address getAddress() {
        return address;
    }

    @Override
    public Person clone() throws CloneNotSupportedException {
        Person clone = (Person) super.clone();
        clone.address = address.clone();
        return clone;
    }
}

public class Address implements Cloneable {
    private String city;

    public Address(String city) {
        this.city = city;
    }

    public String getCity() {
        return city;
    }

    @Override
    public Address clone() throws CloneNotSupportedException {
        return (Address) super.clone();
    }
}

public class Main {
    public static void main(String[] args) throws CloneNotSupportedException {
        // æ·±å…‹éš†
        Address address = new Address("Shanghai");
        Person person1 = new Person("Tom", address);
        Person person2 = person1.clone();

        // person1å’Œperson2çš„Addresså¯¹è±¡ä¸åŒ
        System.out.println(person1.getAddress() == person2.getAddress()); // false
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒPersonå’ŒAddressç±»éƒ½å®ç°äº†Cloneableæ¥å£ï¼Œå¹¶é‡å†™äº†cloneæ–¹æ³•ï¼Œä»è€Œå®ç°äº†æ·±å…‹éš†ã€‚åœ¨Personçš„cloneæ–¹æ³•ä¸­ï¼Œé™¤äº†è°ƒç”¨super.cloneæ–¹æ³•å¤–ï¼Œè¿˜å¯¹addresså±æ€§è¿›è¡Œäº†æ·±å±‚å¤åˆ¶ã€‚åœ¨Addressçš„cloneæ–¹æ³•ä¸­ï¼Œåªéœ€è¦è°ƒç”¨super.cloneæ–¹æ³•å³å¯ã€‚
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºå¼•ç”¨ç±»å‹å±æ€§çš„æ·±å±‚å¤åˆ¶ï¼Œéœ€è¦ç¡®ä¿è¯¥å¼•ç”¨ç±»å‹ä¹Ÿå®ç°äº†Cloneableæ¥å£å¹¶é‡å†™äº†cloneæ–¹æ³•ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°å…‹éš†å¤±è´¥çš„æƒ…å†µã€‚æ­¤å¤–ï¼Œæ·±å…‹éš†å¯èƒ½ä¼šæ¯”è¾ƒè€—è´¹æ—¶é—´å’Œç©ºé—´ï¼Œå› æ­¤éœ€è¦æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ä½¿ç”¨æµ…å…‹éš†è¿˜æ˜¯æ·±å…‹éš†ã€‚

## æµ…å…‹éš† â­ï¸

åœ¨Javaä¸­ï¼Œæµ…å…‹éš†æ˜¯ä¸€ç§å¤åˆ¶å¯¹è±¡çš„æ–¹å¼ï¼Œæ–°å¯¹è±¡ä¸åŸå§‹å¯¹è±¡å…±äº«åŒä¸€ä»½æ•°æ®(åªæ˜¯å¯¹è±¡è‡ªå·±æ˜¯ä¸¤ä¸ªå®ä¾‹ï¼Œä½†æ˜¯ä»–ä»¬çš„å†…éƒ¨æ•°æ®æ˜¯ä¸€ä»½)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ**æ–°å¯¹è±¡ä¸­çš„å¼•ç”¨ç±»å‹å±æ€§ä¸åŸå§‹å¯¹è±¡ä¸­çš„å¼•ç”¨ç±»å‹å±æ€§æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚æµ…å…‹éš†å¯ä»¥é€šè¿‡å®ç°Cloneableæ¥å£å¹¶é‡å†™cloneæ–¹æ³•æ¥å®ç°ã€‚**
ä»¥ä¸‹æ˜¯ä¸€ä¸ªæµ…å…‹éš†çš„ç¤ºä¾‹ï¼š

```java
public class Person implements Cloneable {
    private String name;
    private Address address;

    public Person(String name, Address address) {
        this.name = name;
        this.address = address;
    }

    public String getName() {
        return name;
    }

    public Address getAddress() {
        return address;
    }

    @Override
    public Person clone() throws CloneNotSupportedException {
        return (Person) super.clone();
    }
}

public class Address {
    private String city;

    public Address(String city) {
        this.city = city;
    }

    public String getCity() {
        return city;
    }
}

public class Main {
    public static void main(String[] args) throws CloneNotSupportedException {
        Address address = new Address("Shanghai");
        Person person1 = new Person("Tom", address);

        // æµ…å…‹éš†
        Person person2 = person1.clone();

        // person1å’Œperson2å…±äº«åŒä¸€ä¸ªAddresså¯¹è±¡
        System.out.println(person1.getAddress() == person2.getAddress()); // true
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒPersonç±»åŒ…å«ä¸€ä¸ªStringç±»å‹çš„nameå±æ€§å’Œä¸€ä¸ªAddressç±»å‹çš„addresså±æ€§ã€‚Addressç±»åªåŒ…å«ä¸€ä¸ªStringç±»å‹çš„cityå±æ€§ã€‚Personç±»å®ç°äº†Cloneableæ¥å£å¹¶é‡å†™äº†cloneæ–¹æ³•ï¼Œä»è€Œå®ç°äº†æµ…å…‹éš†ã€‚Mainç±»ä¸­åˆ›å»ºäº†ä¸€ä¸ªPersonå¯¹è±¡person1å’Œä¸€ä¸ªå¯¹person1è¿›è¡Œæµ…å…‹éš†çš„å¯¹è±¡person2ã€‚ç”±äºæµ…å…‹éš†ä¼šå…±äº«åŒä¸€ä»½æ•°æ®ï¼Œå› æ­¤person1å’Œperson2çš„addresså±æ€§æŒ‡å‘åŒä¸€ä¸ªAddresså¯¹è±¡ã€‚
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæµ…å…‹éš†å¯èƒ½ä¼šå‡ºç°å¯¹è±¡çŠ¶æ€å…±äº«çš„é—®é¢˜ï¼Œå³æ–°å¯¹è±¡ä¸åŸå§‹å¯¹è±¡å…±äº«åŒä¸€ä»½æ•°æ®ï¼Œå½“æ–°å¯¹è±¡çš„å±æ€§å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒåŸå§‹å¯¹è±¡çš„å±æ€§ä¹Ÿä¼šéšä¹‹æ”¹å˜ã€‚æ­¤å¤–ï¼Œå¯¹äºå¼•ç”¨ç±»å‹å±æ€§çš„å¤åˆ¶ï¼Œæµ…å…‹éš†åªä¼šå¤åˆ¶å®ƒçš„å¼•ç”¨ï¼Œè€Œä¸ä¼šå¤åˆ¶å®ƒæ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œ**å› æ­¤å¦‚æœéœ€è¦é¿å…çŠ¶æ€å…±äº«çš„é—®é¢˜ï¼Œéœ€è¦ä½¿ç”¨æ·±å…‹éš†ã€‚**

## åºåˆ—åŒ–

åœ¨Javaä¸­ï¼Œåºåˆ—åŒ–æ˜¯å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµçš„è¿‡ç¨‹ï¼Œé€šå¸¸ç”¨äºå°†å¯¹è±¡ä¿å­˜åˆ°æ–‡ä»¶æˆ–åœ¨ç½‘ç»œä¸Šä¼ è¾“ã€‚ååºåˆ—åŒ–æ˜¯å°†å­—èŠ‚æµè½¬æ¢å›å¯¹è±¡çš„è¿‡ç¨‹ã€‚
Javaæä¾›äº†ä¸€ä¸ªSerializableæ¥å£ï¼Œå®ç°è¯¥æ¥å£çš„ç±»å¯ä»¥è¢«åºåˆ—åŒ–ã€‚å½“ä¸€ä¸ªå¯¹è±¡è¢«åºåˆ—åŒ–æ—¶ï¼ŒJavaä¼šå°†å…¶æ‰€æœ‰éé™æ€æˆå‘˜å˜é‡è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œå¹¶å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶æˆ–å†…å­˜ä¸­ã€‚ååºåˆ—åŒ–æ—¶ï¼ŒJavaä¼šä»å­—èŠ‚æµä¸­è¯»å–æ•°æ®ï¼Œå¹¶å°†å…¶è¿˜åŸä¸ºåŸæ¥çš„å¯¹è±¡ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªåºåˆ—åŒ–çš„ç¤ºä¾‹ï¼š

```java
import java.io.*;

public class Person implements Serializable {
    private String name;
    private int age;

    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public String getName() {
        return name;
    }

    public int getAge() {
        return age;
    }

    public static void main(String[] args) throws IOException, ClassNotFoundException {
        // åºåˆ—åŒ–
        Person person = new Person("Tom", 20);
        ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream("person.txt"));
        out.writeObject(person);
        out.close();

        // ååºåˆ—åŒ–
        ObjectInputStream in = new ObjectInputStream(new FileInputStream("person.txt"));
        Person person2 = (Person) in.readObject();
        in.close();

        System.out.println(person2.getName()); // Tom
        System.out.println(person2.getAge()); // 20
    }
}

```

> åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒPersonç±»å®ç°äº†Serializableæ¥å£ï¼Œå¹¶å®šä¹‰äº†ä¸¤ä¸ªå±æ€§nameå’Œageã€‚åœ¨mainæ–¹æ³•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªPersonå¯¹è±¡personå¹¶å°†å…¶åºåˆ—åŒ–åˆ°æ–‡ä»¶person.txtä¸­ã€‚ç„¶åé€šè¿‡ObjectInputStreamå¯¹è±¡ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®å¹¶ååºåˆ—åŒ–ä¸ºä¸€ä¸ªæ–°çš„Personå¯¹è±¡person2ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¢«åºåˆ—åŒ–çš„ç±»çš„æ‰€æœ‰éé™æ€æˆå‘˜å˜é‡éƒ½å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ã€‚å¦‚æœè¢«åºåˆ—åŒ–çš„ç±»ä¸­åŒ…å«äº†ä¸å¯åºåˆ—åŒ–çš„æˆå‘˜å˜é‡ï¼ŒJavaä¼šæŠ›å‡ºNotSerializableExceptionå¼‚å¸¸ã€‚æ­¤å¤–ï¼Œåºåˆ—åŒ–æ“ä½œä¹Ÿå¯èƒ½ä¼šé¢ä¸´ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ï¼Œå³åºåˆ—åŒ–çš„ç±»çš„ç‰ˆæœ¬ä¸ååºåˆ—åŒ–çš„ç±»çš„ç‰ˆæœ¬ä¸å…¼å®¹ï¼Œå¯èƒ½å¯¼è‡´ååºåˆ—åŒ–å¤±è´¥ã€‚ä¸ºäº†é¿å…è¿™ç§é—®é¢˜ï¼Œå¯ä»¥åœ¨åºåˆ—åŒ–ç±»ä¸­å®šä¹‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œç”¨äºæ ‡è¯†ç±»çš„ç‰ˆæœ¬ï¼Œå¦‚æœç‰ˆæœ¬ä¸å…¼å®¹ï¼ŒJavaä¼šæŠ›å‡ºInvalidClassExceptionå¼‚å¸¸ã€‚

# é›†åˆ

Javaä¸­çš„é›†åˆæ˜¯ä¸€ç»„ç›¸åŒç±»å‹çš„å¯¹è±¡ï¼Œå¯ä»¥åŠ¨æ€åœ°å¢åŠ æˆ–åˆ é™¤å…ƒç´ ã€‚Javaä¸­æä¾›äº†ä¸€äº›å®ç°äº†ä¸åŒæ•°æ®ç»“æ„çš„é›†åˆç±»ï¼Œä¾‹å¦‚Listã€Setã€Queueå’ŒMapç­‰ã€‚

## Vectorï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰

**Vectoræ˜¯Javaä¸­çš„ä¸€ç§åŠ¨æ€æ•°ç»„ï¼Œä¸ArrayListç±»ä¼¼**ï¼Œ**ä½†æ˜¯Vectoræ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ”¯æŒå¤šçº¿ç¨‹å¹¶å‘è®¿é—®**ã€‚Vectorå®ç°äº†Listæ¥å£ï¼Œå¯ä»¥ä½¿ç”¨Listä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç´¢å¼•è®¿é—®å…ƒç´ ã€‚
Vectoræ˜¯Javaæ—©æœŸç‰ˆæœ¬ä¸­çš„ä¸€ä¸ªç±»ï¼Œå·²è¢«ArrayListå–ä»£ï¼Œä½†ç”±äºå®ƒçš„çº¿ç¨‹å®‰å…¨æ€§ï¼Œä»ç„¶å¯ä»¥åœ¨æŸäº›åœºæ™¯ä¸‹ä½¿ç”¨ã€‚Vectorä½¿ç”¨äº†åŒæ­¥æœºåˆ¶æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå› æ­¤åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªVectorå¯¹è±¡æ—¶ï¼Œä¼šä¾æ¬¡æ‰§è¡Œï¼Œçº¿ç¨‹ä¹‹é—´äº’ä¸å¹²æ‰°ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨Vectorçš„ç¤ºä¾‹ï¼š

```java
import java.util.Vector;

public class Main {
    public static void main(String[] args) {
        Vector<String> vector = new Vector<>();
        vector.add("apple");
        vector.add("banana");
        vector.add("orange");
        System.out.println(vector); // [apple, banana, orange]

        // è·å–æŒ‡å®šä½ç½®çš„å…ƒç´ 
        String element = vector.get(1);
        System.out.println(element); // banana

        // åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ 
        vector.remove(0);
        System.out.println(vector); // [banana, orange]

        // è·å–å…ƒç´ çš„ä¸ªæ•°
        int size = vector.size();
        System.out.println(size); // 2
    }
}

```

## ArrayListï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ â­ï¸

**ArrayListæ˜¯Javaä¸­çš„ä¸€ç§åŠ¨æ€æ•°ç»„,éçº¿ç¨‹å®‰å…¨çš„**ï¼Œå®ƒå¯ä»¥åŠ¨æ€åœ°å¢åŠ æˆ–åˆ é™¤å…ƒç´ ï¼Œä¸ä¼ ç»Ÿçš„æ•°ç»„ç›¸æ¯”ï¼Œå…·æœ‰æ›´é«˜çš„çµæ´»æ€§å’Œä¾¿åˆ©æ€§ã€‚ArrayListå®ç°äº†Listæ¥å£ï¼Œå¯ä»¥ä½¿ç”¨Listä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç´¢å¼•è®¿é—®å…ƒç´ ã€‚
ArrayListå†…éƒ¨é‡‡ç”¨æ•°ç»„å®ç°ï¼Œæ•°ç»„çš„é•¿åº¦å¯ä»¥åŠ¨æ€å¢åŠ æˆ–å‡å°‘ã€‚å½“æ·»åŠ å…ƒç´ æ—¶ï¼Œå¦‚æœæ•°ç»„å·²ç»æ»¡äº†ï¼Œåˆ™ä¼šè‡ªåŠ¨æ‰©å®¹ã€‚å½“åˆ é™¤å…ƒç´ æ—¶ï¼Œå¦‚æœæ•°ç»„çš„ç©ºé—²ç©ºé—´è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œåˆ™ä¼šè‡ªåŠ¨ç¼©å®¹ï¼Œä»¥å‡å°‘å†…å­˜ä½¿ç”¨ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ArrayListçš„ç¤ºä¾‹ï¼š

```java
import java.util.ArrayList;

public class Main {
    public static void main(String[] args) {
        ArrayList<String> list = new ArrayList<>();
        list.add("apple");
        list.add("banana");
        list.add("orange");
        System.out.println(list); // [apple, banana, orange]

        // è·å–æŒ‡å®šä½ç½®çš„å…ƒç´ 
        String element = list.get(1);
        System.out.println(element); // banana

        // åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ 
        list.remove(0);
        System.out.println(list); // [banana, orange]

        // è·å–å…ƒç´ çš„ä¸ªæ•°
        int size = list.size();
        System.out.println(size); // 2
    }
}

```

è¦æƒ³ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„è¯ï¼šæ¨ä»‹ä½¿ç”¨ï¼š `**List list = Collections.synchronizedList(new ArrayList(...));**`

## HashSet(çº¿ç¨‹ä¸å®‰å…¨)ã€TreeSetï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰

HashSetå’ŒTreeSetéƒ½æ˜¯Javaä¸­çš„é›†åˆç±»ï¼Œéƒ½å®ç°äº†Setæ¥å£ï¼Œä½†å®ƒä»¬çš„å®ç°æ–¹å¼ä¸åŒã€‚
HashSetä½¿ç”¨**å“ˆå¸Œè¡¨å®ç°**ï¼Œå¯ä»¥**å¿«é€ŸæŸ¥æ‰¾å…ƒç´ **ï¼Œä½†æ˜¯**æ— æ³•ä¿è¯å…ƒç´ çš„é¡ºåºï¼Œå†…éƒ¨ä½¿ç”¨çš„æ˜¯HashMapå­˜å‚¨ï¼Œè¿™ä¸ªHashMapçš„keyå°±æ˜¯è¦å­˜å‚¨çš„å€¼ï¼Œvalueæ˜¯é»˜è®¤æˆå‘˜å˜é‡final Objectå¯¹è±¡**ã€‚HashSetä¸å…è®¸æœ‰é‡å¤å…ƒç´ ï¼Œå¦‚æœè¯•å›¾æ·»åŠ é‡å¤å…ƒç´ ï¼Œæ·»åŠ æ“ä½œä¼šè¿”å›falseã€‚HashSetæ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œé€šå¸¸ç”¨äºå­˜å‚¨éœ€è¦**å¿«é€ŸæŸ¥æ‰¾**çš„å…ƒç´ ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨HashSetçš„ç¤ºä¾‹ï¼š

```java
import java.util.HashSet;
import java.util.Set;

public class Main {
    public static void main(String[] args) {
        Set<String> set = new HashSet<>();
        set.add("apple");
        set.add("banana");
        set.add("orange");
        System.out.println(set); // [banana, orange, apple]

        // åˆ é™¤æŒ‡å®šå…ƒç´ 
        set.remove("apple");
        System.out.println(set); // [banana, orange]

        // åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨
        boolean contains = set.contains("banana");
        System.out.println(contains); // true

        // è·å–å…ƒç´ çš„ä¸ªæ•°
        int size = set.size();
        System.out.println(size); // 2
    }
}

```

```java
 Set s = Collections.synchronizedSet(new HashSet(...))
```

TreeSetä½¿ç”¨**æ ‘å½¢ç»“æ„**å®ç°ï¼Œç»§æ‰¿è‡ªSortSetï¼Œå¯ä»¥**è‡ªåŠ¨å°†å…ƒç´ æŒ‰ç…§æ’åºè§„åˆ™æ’åº**ã€‚TreeSetä¸å…è®¸æœ‰é‡å¤å…ƒç´ ï¼Œå¦‚æœè¯•å›¾æ·»åŠ é‡å¤å…ƒç´ ï¼Œæ·»åŠ æ“ä½œä¼šè¿”å›falseã€‚TreeSeté€šå¸¸ç”¨äºéœ€è¦**æ’åº**çš„åœºæ™¯ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨TreeSetçš„ç¤ºä¾‹ï¼š

```java
import java.util.Set;
import java.util.TreeSet;

public class Main {
    public static void main(String[] args) {
        Set<String> set = new TreeSet<>();
        set.add("banana");
        set.add("orange");
        set.add("apple");
        System.out.println(set); // [apple, banana, orange] æ˜¯é»˜è®¤æ­£åº

        // åˆ é™¤æŒ‡å®šå…ƒç´ 
        set.remove("apple");
        System.out.println(set); // [banana, orange]

        // åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨
        boolean contains = set.contains("banana");
        System.out.println(contains); // true

        // è·å–å…ƒç´ çš„ä¸ªæ•°
        int size = set.size();
        System.out.println(size); // 2
    }
}

```

å€’åºçš„ä¾‹å­ï¼š

```java
import java.util.Comparator;
import java.util.Set;
import java.util.TreeSet;

public class Main {
    public static void main(String[] args) {
        Set<String> set = new TreeSet<>(new Comparator<String>() {
            @Override
            public int compare(String o1, String o2) {
                return o2.compareTo(o1); // å€’åºæ’åˆ—
            }
        });
        set.add("apple");
        set.add("banana");
        set.add("orange");
        System.out.println(set); // [orange, banana, apple]
    }
}

```

**çº¿ç¨‹å®‰å…¨çš„ä¾‹å­**
**TreeSet æ˜¯ä¸€ç§éçº¿ç¨‹å®‰å…¨çš„é›†åˆ**ï¼Œå› æ­¤å¦‚æœéœ€è¦åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œéœ€è¦ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ TreeSet å®ç°ç±» **ConcurrentSkipListSet**ã€‚ConcurrentSkipListSet å®ç°äº† SortedSet æ¥å£ï¼Œæ˜¯ä¸€ä¸ªåŸºäºè·³è¡¨ï¼ˆSkipListï¼‰å®ç°çš„çº¿ç¨‹å®‰å…¨æœ‰åºé›†åˆï¼Œå¯ä»¥æ”¯æŒå¹¶å‘è¯»å†™æ“ä½œã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ ConcurrentSkipListSet çš„ç¤ºä¾‹ä»£ç ï¼š

```java
import java.util.concurrent.ConcurrentSkipListSet;

public class Main {
    public static void main(String[] args) {
        ConcurrentSkipListSet<Integer> set = new ConcurrentSkipListSet<>();
        set.add(3);
        set.add(1);
        set.add(4);
        set.add(2);

        for (Integer i : set) {
            System.out.println(i);
        }
    }
}
```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª ConcurrentSkipListSet å¯¹è±¡ï¼Œå¹¶é€šè¿‡ add æ–¹æ³•å‘é›†åˆä¸­æ·»åŠ å…ƒç´ ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ for-each å¾ªç¯éå†é›†åˆä¸­çš„å…ƒç´ ï¼Œå¹¶è¾“å‡ºæ¯ä¸ªå…ƒç´ çš„å€¼ã€‚ç”±äº ConcurrentSkipListSet æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤å¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œè€Œä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

## LinkedHashSetï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰

LinkedHashSetæ˜¯Javaä¸­çš„ä¸€ç§é›†åˆç±»ï¼Œå®ƒæ˜¯HashSetçš„å­ç±»ï¼Œå…·æœ‰HashSetçš„æ‰€æœ‰ç‰¹æ€§ï¼ŒåŒæ—¶è¿˜**ä¿ç•™äº†å…ƒç´ æ’å…¥çš„é¡ºåº**ã€‚**LinkedHashSeté€šè¿‡é“¾è¡¨æ¥ç»´æŠ¤å…ƒç´ çš„æ’å…¥é¡ºåºï¼Œå› æ­¤å¯ä»¥ä¿è¯å…ƒç´ çš„é¡ºåºä¸æ’å…¥é¡ºåºä¸€è‡´ã€‚**
ä¸HashSetä¸€æ ·ï¼ŒLinkedHashSetä¹Ÿä¸å…è®¸æœ‰é‡å¤å…ƒç´ ã€‚å½“è¯•å›¾å‘LinkedHashSetä¸­æ·»åŠ ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å…ƒç´ æ—¶ï¼Œæ·»åŠ æ“ä½œä¼šè¿”å›falseï¼Œå…ƒç´ ä¸ä¼šè¢«æ·»åŠ ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨LinkedHashSetçš„ç¤ºä¾‹ï¼š

```java
import java.util.LinkedHashSet;
import java.util.Set;

public class Main {
    public static void main(String[] args) {
        Set<String> set = new LinkedHashSet<>();
        set.add("banana");
        set.add("apple");
        set.add("orange");
        System.out.println(set); // [banana,apple, orange] è¾“å‡ºä¸è¾“å…¥ä¸€è‡´

        // åˆ é™¤æŒ‡å®šå…ƒç´ 
        set.remove("apple");
        System.out.println(set); // [banana, orange]

        // åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨
        boolean contains = set.contains("banana");
        System.out.println(contains); // true

        // è·å–å…ƒç´ çš„ä¸ªæ•°
        int size = set.size();
        System.out.println(size); // 2
    }
}
```

> åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªLinkedHashSetå¯¹è±¡ï¼Œç„¶åé€šè¿‡addæ–¹æ³•æ·»åŠ å…ƒç´ ï¼Œç”±äºLinkedHashSetä¼šä¿ç•™å…ƒç´ çš„æ’å…¥é¡ºåºï¼Œå› æ­¤è¾“å‡ºç»“æœä¸æ·»åŠ é¡ºåºä¸€è‡´ã€‚å…¶ä»–çš„æ“ä½œå’ŒHashSetç±»ä¼¼ã€‚

## HashMapï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰  â­ï¸

HashMapæ˜¯Javaä¸­çš„ä¸€ç§æ˜ å°„è¡¨ï¼ˆMapï¼‰ç»“æ„ï¼Œå¯ä»¥å°†é”®æ˜ å°„åˆ°å€¼ä¸Šã€‚HashMapé€šè¿‡å“ˆå¸Œè¡¨æ¥å®ç°ï¼Œå®ƒå¯ä»¥åŠ¨æ€åœ°å¢åŠ æˆ–åˆ é™¤å…ƒç´ ï¼ŒåŒæ—¶å¯ä»¥é€šè¿‡é”®å¿«é€ŸæŸ¥æ‰¾å…ƒç´ ã€‚
åœ¨Java 1.7ä¸­ï¼ŒHashMapå†…éƒ¨æ˜¯ç”±ä¸€ä¸ªæ•°ç»„å’Œé“¾è¡¨ç»„æˆçš„ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ç§°ä¸ºæ¡¶ï¼ˆbucketï¼‰ï¼Œæ¯ä¸ªæ¡¶ä¸­å­˜å‚¨äº†ä¸€ä¸ªé“¾è¡¨ã€‚å½“æ·»åŠ ä¸€ä¸ªæ–°å…ƒç´ æ—¶ï¼Œé¦–å…ˆä¼šæ ¹æ®å…ƒç´ çš„å“ˆå¸Œå€¼ç¡®å®šå…ƒç´ åº”è¯¥è¢«æ”¾åˆ°å“ªä¸ªæ¡¶ä¸­ï¼Œç„¶åå°†è¯¥å…ƒç´ æ·»åŠ åˆ°å¯¹åº”çš„é“¾è¡¨ä¸­ã€‚å½“éœ€è¦æŸ¥æ‰¾å…ƒç´ æ—¶ï¼Œé¦–å…ˆæ ¹æ®é”®çš„å“ˆå¸Œå€¼æ‰¾åˆ°å¯¹åº”çš„æ¡¶ï¼Œç„¶åéå†è¯¥æ¡¶ä¸­çš„é“¾è¡¨ï¼ŒæŸ¥æ‰¾å¯¹åº”çš„é”®å€¼å¯¹ã€‚
åœ¨Java 1.8ä¸­ï¼ŒHashMapå†…éƒ¨ç»“æ„æœ‰äº†ä¸€äº›æ”¹è¿›ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸¤ç‚¹ï¼š

1. å½“é“¾è¡¨ä¸­çš„å…ƒç´ æ•°é‡è¶…è¿‡ä¸€å®šé˜ˆå€¼æ—¶ï¼Œä¼šå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚çº¢é»‘æ ‘å¯ä»¥æé«˜æŸ¥æ‰¾æ•ˆç‡ï¼Œå¹¶ä¸”å¯ä»¥ä¿è¯æŸ¥æ‰¾æ—¶é—´çš„ä¸Šé™ä¸ºO(log n)ï¼Œä»è€Œé¿å…é“¾è¡¨é€€åŒ–ä¸ºçº¿æ€§æŸ¥æ‰¾çš„æƒ…å†µã€‚
2. å½“HashMapä¸­çš„å…ƒç´ æ•°é‡è¶…è¿‡ä¸€å®šé˜ˆå€¼æ—¶ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œæ‰©å®¹ã€‚æ‰©å®¹ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå¹¶å°†åŸæ•°ç»„ä¸­çš„å…ƒç´ é‡æ–°åˆ†é…åˆ°æ–°æ•°ç»„ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦è¿›è¡Œå“ˆå¸Œè®¡ç®—å’Œå…ƒç´ å¤åˆ¶ï¼Œå› æ­¤ä¼šæ¶ˆè€—ä¸€å®šçš„æ—¶é—´å’Œç©ºé—´ã€‚æ‰©å®¹çš„é˜ˆå€¼ç”±è´Ÿè½½å› å­ï¼ˆload factorï¼‰æ§åˆ¶ï¼Œé»˜è®¤å€¼ä¸º0.75ï¼Œè¡¨ç¤ºåœ¨HashMapä¸­å­˜å‚¨çš„å…ƒç´ æ•°é‡è¶…è¿‡å®¹é‡çš„75%æ—¶ä¼šè§¦å‘æ‰©å®¹ã€‚
3. éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ**åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒHashMapæ˜¯ä¸å®‰å…¨çš„ï¼Œ**éœ€è¦ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»æˆ–è€…å¯¹HashMapè¿›è¡ŒåŒæ­¥å¤„ç†ã€‚
   ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨HashMapçš„ç¤ºä¾‹ï¼š

```java
import java.util.HashMap;
import java.util.Map;

public class Main {
    public static void main(String[] args) {
        Map<String, Integer> map = new HashMap<>();
        map.put("apple", 1);
        map.put("banana", 2);
        map.put("orange", 3);
        System.out.println(map); // {orange=3, apple=1, banana=2}

        // åˆ é™¤æŒ‡å®šé”®å€¼å¯¹
        map.remove("apple");
        System.out.println(map); // {orange=3, banana=2}

        // è·å–æŒ‡å®šé”®çš„å€¼
        int value = map.get("banana");
        System.out.println(value); // 2

        // åˆ¤æ–­æŒ‡å®šé”®æ˜¯å¦å­˜åœ¨
        boolean contains = map.containsKey("orange");
        System.out.println(contains); // true

        // è·å–é”®å€¼å¯¹çš„ä¸ªæ•°
        int size = map.size();
        System.out.println(size); // 2
    }
}
```

> åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªHashMapå¯¹è±¡ï¼Œç„¶åé€šè¿‡putæ–¹æ³•æ·»åŠ é”®å€¼å¯¹ï¼Œä½¿ç”¨removeæ–¹æ³•åˆ é™¤æŒ‡å®šé”®å€¼å¯¹ï¼Œä½¿ç”¨getæ–¹æ³•è·å–æŒ‡å®šé”®çš„å€¼ï¼Œä½¿ç”¨containsKeyæ–¹æ³•åˆ¤æ–­æŒ‡å®šé”®æ˜¯å¦å­˜åœ¨ï¼Œä½¿ç”¨sizeæ–¹æ³•è·å–é”®å€¼å¯¹çš„ä¸ªæ•°ã€‚

## TreeMapï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Œæœ‰åºï¼‰

TreeMapæ˜¯Javaä¸­çš„ä¸€ç§æ˜ å°„è¡¨ï¼ˆMapï¼‰ç»“æ„ï¼Œå¯ä»¥å°†é”®æ˜ å°„åˆ°å€¼ä¸Šã€‚TreeMapé€šè¿‡çº¢é»‘æ ‘æ¥å®ç°ï¼Œå®ƒå¯ä»¥åŠ¨æ€åœ°å¢åŠ æˆ–åˆ é™¤å…ƒç´ ï¼ŒåŒæ—¶å¯ä»¥é€šè¿‡é”®å¿«é€ŸæŸ¥æ‰¾å…ƒç´ ã€‚**TreeMapä¸HashMapç›¸æ¯”ï¼Œå®ƒå¯ä»¥ä¿è¯å…ƒç´ çš„æœ‰åºæ€§ï¼Œå³æŒ‰ç…§é”®çš„è‡ªç„¶é¡ºåºæˆ–è€…è‡ªå®šä¹‰çš„æ¯”è¾ƒå™¨è¿›è¡Œæ’åºã€‚**
åœ¨Javaä¸­ï¼ŒTreeMapå†…éƒ¨çš„çº¢é»‘æ ‘ç»“æ„å¯ä»¥ä¿è¯æ’å…¥ã€æŸ¥æ‰¾ã€åˆ é™¤ç­‰æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(log n)ï¼Œå› æ­¤æ€§èƒ½è¾ƒä¸ºç¨³å®šã€‚ä¸HashMapç›¸æ¯”ï¼ŒTreeMapåœ¨æ’å…¥å’Œåˆ é™¤å…ƒç´ æ—¶éœ€è¦è¿›è¡Œçº¢é»‘æ ‘çš„å¹³è¡¡æ“ä½œï¼Œå› æ­¤æ€§èƒ½ç•¥é€ŠäºHashMapï¼Œä½†æ˜¯å®ƒå¯ä»¥æä¾›æœ‰åºçš„éå†åŠŸèƒ½ï¼Œé€‚ç”¨äºéœ€è¦æœ‰åºéå†çš„åœºæ™¯ã€‚
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ**åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒTreeMapæ˜¯ä¸å®‰å…¨çš„ï¼Œ**éœ€è¦ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»æˆ–è€…å¯¹TreeMapè¿›è¡ŒåŒæ­¥å¤„ç†ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨TreeMapçš„ç¤ºä¾‹ï¼š

```java
import java.util.Map;
import java.util.TreeMap;

public class Main {
    public static void main(String[] args) {
        Map<String, Integer> map = new TreeMap<>();
        map.put("apple", 1);
        map.put("banana", 2);
        map.put("orange", 3);
        System.out.println(map); // {apple=1, banana=2, orange=3}

        // åˆ é™¤æŒ‡å®šé”®å€¼å¯¹
        map.remove("apple");
        System.out.println(map); // {banana=2, orange=3}

        // è·å–æŒ‡å®šé”®çš„å€¼
        int value = map.get("banana");
        System.out.println(value); // 2

        // åˆ¤æ–­æŒ‡å®šé”®æ˜¯å¦å­˜åœ¨
        boolean contains = map.containsKey("orange");
        System.out.println(contains); // true

        // è·å–é”®å€¼å¯¹çš„ä¸ªæ•°
        int size = map.size();
        System.out.println(size); // 2
    }
}
```

> åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªTreeMapå¯¹è±¡ï¼Œç„¶åé€šè¿‡putæ–¹æ³•æ·»åŠ é”®å€¼å¯¹ï¼Œä½¿ç”¨removeæ–¹æ³•åˆ é™¤æŒ‡å®šé”®å€¼å¯¹ï¼Œä½¿ç”¨getæ–¹æ³•è·å–æŒ‡å®šé”®çš„å€¼ï¼Œä½¿ç”¨containsKeyæ–¹æ³•åˆ¤æ–­æŒ‡å®šé”®æ˜¯å¦å­˜åœ¨ï¼Œä½¿ç”¨sizeæ–¹æ³•è·å–é”®å€¼å¯¹çš„ä¸ªæ•°ã€‚**ç”±äºTreeMapä¼šæ ¹æ®é”®çš„è‡ªç„¶é¡ºåºæˆ–è€…è‡ªå®šä¹‰çš„æ¯”è¾ƒå™¨è¿›è¡Œæ’åºï¼Œå› æ­¤è¾“å‡ºç»“æœæ˜¯æœ‰åºçš„ã€‚**

## Hash table

Hashè¡¨ï¼ˆHash tableï¼‰ï¼Œä¹Ÿç§°ä¸ºæ•£åˆ—è¡¨ï¼Œæ˜¯ä¸€ç§**åŸºäºHashç®—æ³•**å®ç°çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥ç”¨äº**å¿«é€Ÿå­˜å‚¨å’ŒæŸ¥æ‰¾æ•°æ®**ã€‚Hashè¡¨çš„ç‰¹ç‚¹æ˜¯å°†æ•°æ®å…ƒç´ çš„å…³é”®å­—é€šè¿‡Hashå‡½æ•°æ˜ å°„åˆ°ä¸€å®šèŒƒå›´å†…çš„æ•´æ•°å€¼ï¼ˆä¹Ÿç§°ä¸ºå“ˆå¸Œå€¼ï¼‰ï¼Œç„¶åå°†è¿™äº›å€¼ä½œä¸ºæ•°æ®å…ƒç´ çš„ç´¢å¼•å­˜å‚¨åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚
åœ¨Javaä¸­ï¼Œ**HashMapå’ŒHashSetå°±æ˜¯åŸºäºHash tableå®ç°çš„**ã€‚å½“å‘HashMapæˆ–HashSetä¸­æ·»åŠ å…ƒç´ æ—¶ï¼Œé¦–å…ˆä¼šæ ¹æ®å…ƒç´ çš„å“ˆå¸Œå€¼è®¡ç®—å‡ºå…ƒç´ åº”è¯¥å­˜å‚¨åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼Œç„¶åå°†å…ƒç´ å­˜å‚¨åˆ°è¯¥ä½ç½®ä¸Šã€‚å½“éœ€è¦æŸ¥æ‰¾å…ƒç´ æ—¶ï¼ŒåŒæ ·ä¼šæ ¹æ®å…ƒç´ çš„å“ˆå¸Œå€¼æ‰¾åˆ°å¯¹åº”çš„æ•°ç»„ä½ç½®ï¼Œç„¶ååœ¨è¯¥ä½ç½®ä¸ŠæŸ¥æ‰¾å…ƒç´ ã€‚
**Hash tableçš„ä¼˜ç‚¹æ˜¯å¯ä»¥æä¾›O(1)çš„æ—¶é—´å¤æ‚åº¦è¿›è¡Œæ•°æ®å­˜å‚¨å’ŒæŸ¥æ‰¾æ“ä½œ**ã€‚ä½†æ˜¯åœ¨æ•°æ®å…ƒç´ çš„å“ˆå¸Œå€¼ç›¸åŒæ—¶ï¼Œä¸åŒçš„å…ƒç´ å¯èƒ½ä¼šè¢«å­˜å‚¨åœ¨åŒä¸€ä¸ªæ•°ç»„ä½ç½®ä¸Šï¼Œè¿™å°±äº§ç”Ÿäº†å“ˆå¸Œå†²çªã€‚ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªï¼ŒHashè¡¨ä¸€èˆ¬é‡‡ç”¨é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘ç­‰æ•°æ®ç»“æ„æ¥å­˜å‚¨ç›¸åŒå“ˆå¸Œå€¼çš„å…ƒç´ ï¼Œä»è€Œä¿è¯æ•°æ®å…ƒç´ çš„æ­£ç¡®æ€§å’Œæ•ˆç‡ã€‚
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨**å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒHashè¡¨æ˜¯ä¸å®‰å…¨çš„**ï¼Œéœ€è¦ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»æˆ–è€…å¯¹Hashè¡¨è¿›è¡ŒåŒæ­¥å¤„ç†ã€‚

## æ•°æ®ç»“æ„åŠå“ˆå¸Œå†²çª â­ï¸

æ•°æ®ç»“æ„æ˜¯æŒ‡ç»„ç»‡å’Œç®¡ç†æ•°æ®çš„æ–¹å¼ï¼ŒåŒ…æ‹¬å„ç§æ•°æ®ç±»å‹ã€æ•°æ®å…³ç³»å’Œæ“ä½œç­‰ã€‚å¸¸è§çš„æ•°æ®ç»“æ„æœ‰**æ•°ç»„ã€é“¾è¡¨ã€æ ‘ã€å›¾ç­‰ã€‚**
å“ˆå¸Œå†²çªæ˜¯æŒ‡åœ¨Hashè¡¨ä¸­ï¼Œä¸åŒçš„æ•°æ®å…ƒç´ è®¡ç®—å‡ºçš„å“ˆå¸Œå€¼ç›¸åŒçš„æƒ…å†µã€‚å½“å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œä¸åŒçš„æ•°æ®å…ƒç´ å¯èƒ½ä¼šè¢«å­˜å‚¨åœ¨åŒä¸€ä¸ªæ•°ç»„ä½ç½®ä¸Šï¼Œä»è€Œå¯¼è‡´æ•°æ®å…ƒç´ çš„ä¸¢å¤±æˆ–è€…é”™è¯¯ã€‚
ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªï¼ŒHashè¡¨ä¸€èˆ¬é‡‡ç”¨é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘ç­‰æ•°æ®ç»“æ„æ¥å­˜å‚¨ç›¸åŒå“ˆå¸Œå€¼çš„å…ƒç´ ã€‚åœ¨Javaä¸­ï¼ŒHashMapå’ŒHashSetéƒ½é‡‡ç”¨äº†è¿™ç§æ–¹æ³•æ¥å¤„ç†å“ˆå¸Œå†²çªã€‚å½“å“ˆå¸Œè¡¨ä¸­å­˜åœ¨å¤šä¸ªæ•°æ®å…ƒç´ å“ˆå¸Œå€¼ç›¸åŒçš„æƒ…å†µæ—¶ï¼Œè¿™äº›æ•°æ®å…ƒç´ ä¼šè¢«å­˜å‚¨åœ¨åŒä¸€ä¸ªæ•°ç»„ä½ç½®ä¸Šï¼Œå¹¶ç»„æˆä¸€ä¸ªé“¾è¡¨æˆ–è€…çº¢é»‘æ ‘ã€‚å½“éœ€è¦æŸ¥æ‰¾å…ƒç´ æ—¶ï¼Œé¦–å…ˆä¼šæ ¹æ®å…ƒç´ çš„å“ˆå¸Œå€¼æ‰¾åˆ°å¯¹åº”çš„æ•°ç»„ä½ç½®ï¼Œç„¶ååœ¨è¯¥ä½ç½®ä¸Šéå†é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘ï¼ŒæŸ¥æ‰¾å¯¹åº”çš„å…ƒç´ ã€‚
**ä¸ºäº†é¿å…å“ˆå¸Œå†²çªçš„å‘ç”Ÿï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½ï¼š**

1. é€‰æ‹©åˆé€‚çš„å“ˆå¸Œå‡½æ•°ï¼šå“ˆå¸Œå‡½æ•°çš„å¥½åå†³å®šäº†å“ˆå¸Œè¡¨çš„è´¨é‡ã€‚ä¸€ä¸ªå¥½çš„å“ˆå¸Œå‡½æ•°åº”è¯¥å…·æœ‰å‡åŒ€æ€§ã€æ•£åˆ—æ€§å’Œé«˜æ•ˆæ€§ç­‰ç‰¹ç‚¹ï¼Œèƒ½å¤Ÿä½¿å¾—å“ˆå¸Œå€¼åˆ†å¸ƒå‡åŒ€ï¼Œå°½é‡é¿å…å†²çªçš„å‘ç”Ÿã€‚
2. è°ƒæ•´å“ˆå¸Œè¡¨çš„å®¹é‡ï¼šå½“å“ˆå¸Œè¡¨ä¸­å…ƒç´ çš„æ•°é‡è¿‡å¤šæ—¶ï¼Œå®¹æ˜“å‘ç”Ÿå“ˆå¸Œå†²çªã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥è°ƒæ•´å“ˆå¸Œè¡¨çš„å®¹é‡ï¼Œè®©å“ˆå¸Œè¡¨èƒ½å¤Ÿå®¹çº³æ›´å¤šçš„å…ƒç´ ã€‚åœ¨Javaä¸­ï¼ŒHashMapå’ŒHashSetçš„å®¹é‡å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°æˆ–è€…resizeæ–¹æ³•è¿›è¡Œè°ƒæ•´ã€‚
3. é“¾è¡¨å’Œçº¢é»‘æ ‘çš„æ€§èƒ½ä¼˜åŒ–ï¼šå½“å“ˆå¸Œè¡¨ä¸­å­˜åœ¨å¤§é‡ç›¸åŒå“ˆå¸Œå€¼çš„å…ƒç´ æ—¶ï¼Œé“¾è¡¨æˆ–çº¢é»‘æ ‘çš„æ€§èƒ½å¯èƒ½ä¼šå—åˆ°å½±å“ã€‚ä¸ºäº†æé«˜æ€§èƒ½ï¼Œå¯ä»¥é‡‡å–ä¸€äº›ä¼˜åŒ–æªæ–½ï¼Œä¾‹å¦‚åœ¨é“¾è¡¨ä¸­ä½¿ç”¨å°¾æ’æ³•ã€ä½¿ç”¨çº¢é»‘æ ‘è¿›è¡Œå…ƒç´ å­˜å‚¨ç­‰ã€‚

## æ³›å‹

æ³›å‹æ˜¯Javaè¯­è¨€ä¸­çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå¯ä»¥å®ç°ä»£ç çš„ç±»å‹å®‰å…¨å’Œä»£ç é‡ç”¨ã€‚å®ƒå¯ä»¥è®©æˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶å°±èƒ½å‘ç°ç±»å‹é”™è¯¯ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶æ‰æŠ›å‡ºå¼‚å¸¸ã€‚æ³›å‹è¿˜å¯ä»¥è®©æˆ‘ä»¬ç¼–å†™æ›´åŠ é€šç”¨çš„ä»£ç ï¼Œå‡å°‘ä»£ç çš„é‡å¤å’Œå†—ä½™ã€‚
åœ¨Javaä¸­ï¼Œæ³›å‹å¯ä»¥åº”ç”¨äºç±»ã€æ¥å£ã€æ–¹æ³•ç­‰ã€‚é€šè¿‡ä½¿ç”¨æ³›å‹ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå¯ä»¥æ“ä½œä¸åŒç±»å‹çš„å¯¹è±¡çš„ç±»ã€æ¥å£æˆ–æ–¹æ³•ã€‚åœ¨æ³›å‹ä¸­ï¼Œä½¿ç”¨ä¸€ä¸ªå ä½ç¬¦æ¥ä»£è¡¨ç±»å‹å‚æ•°ï¼Œæ¯”å¦‚ä½¿ç”¨â€œTâ€è¡¨ç¤ºæ³›å‹ç±»å‹ã€‚
æ³›å‹çš„ä¼˜ç‚¹ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ï¼š

1. ç±»å‹å®‰å…¨ï¼šä½¿ç”¨æ³›å‹å¯ä»¥è®©æˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶å°±èƒ½å‘ç°ç±»å‹é”™è¯¯ï¼Œä»è€Œå‡å°‘ç¨‹åºè¿è¡Œæ—¶å‡ºç°å¼‚å¸¸çš„å¯èƒ½æ€§ã€‚
2. ä»£ç é‡ç”¨ï¼šä½¿ç”¨æ³›å‹å¯ä»¥è®©æˆ‘ä»¬ç¼–å†™æ›´åŠ é€šç”¨çš„ä»£ç ï¼Œå¯ä»¥åœ¨ä¸åŒçš„åœºæ™¯ä¸­é‡å¤ä½¿ç”¨ã€‚
3. ç¨‹åºæ€§èƒ½ï¼šä½¿ç”¨æ³›å‹å¯ä»¥é¿å…è¿›è¡Œç±»å‹è½¬æ¢ï¼Œä»è€Œæé«˜ç¨‹åºçš„æ€§èƒ½ã€‚

æ³›å‹çš„åº”ç”¨éå¸¸å¹¿æ³›ï¼ŒåŒ…æ‹¬é›†åˆæ¡†æ¶ã€ç½‘ç»œç¼–ç¨‹ã€åå°„ã€æ³¨è§£ç­‰ã€‚åœ¨é›†åˆæ¡†æ¶ä¸­ï¼Œæ³›å‹å¯ä»¥è®©æˆ‘ä»¬å®šä¹‰ä¸åŒç±»å‹çš„é›†åˆå¯¹è±¡ï¼Œæ¯”å¦‚ArrayListã€HashMap<Integer, String>ç­‰ï¼Œä»è€Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œæ³›å‹å¯ä»¥ç”¨äºå®šä¹‰ç½‘ç»œæ•°æ®åŒ…çš„ç±»å‹ï¼Œä»è€Œæ–¹ä¾¿åœ°å¯¹æ•°æ®åŒ…è¿›è¡Œè§£æå’Œå¤„ç†ã€‚åœ¨åå°„ä¸­ï¼Œæ³›å‹å¯ä»¥ç”¨äºè·å–å’Œæ“ä½œç±»çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è·å–æ³›å‹ç±»å‹ã€è°ƒç”¨æ³›å‹æ–¹æ³•ç­‰ã€‚åœ¨æ³¨è§£ä¸­ï¼Œæ³›å‹å¯ä»¥ç”¨äºå®šä¹‰æ³¨è§£çš„å±æ€§ç±»å‹ï¼Œä»è€Œä½¿æ³¨è§£æ›´åŠ é€šç”¨ã€‚
ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ³›å‹ä½¿ç”¨åœºæ™¯åŠå¯¹åº”çš„ä»£ç ç¤ºä¾‹ï¼š

1. é›†åˆç±»ä¸­çš„æ³›å‹ï¼š

```java
List<String> list = new ArrayList<>();
list.add("Hello");
list.add("World");
for (String s : list) {
    System.out.println(s);
}
```

2. æ³›å‹æ–¹æ³•ï¼š

```java
public static <T> void printArray(T[] array) {
    for (T element : array) {
        System.out.println(element);
    }
}

Integer[] intArray = { 1, 2, 3, 4, 5 };
String[] stringArray = { "Hello", "World" };
printArray(intArray);
printArray(stringArray);
```

> åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªæ³›å‹æ–¹æ³•printArrayï¼Œè¯¥æ–¹æ³•å¯ä»¥æ¥æ”¶ä»»æ„ç±»å‹çš„æ•°ç»„ï¼Œå¹¶å°†æ•°ç»„ä¸­çš„å…ƒç´ æ‰“å°å‡ºæ¥ã€‚åœ¨æ–¹æ³•å®šä¹‰ä¸­ä½¿ç”¨äº†ç±»å‹å‚æ•°Tï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•å¯ä»¥æ“ä½œä»»æ„ç±»å‹çš„æ•°ç»„ã€‚

3. è‡ªå®šä¹‰æ³›å‹ç±»ï¼š

```java
public class Box<T> {
    private T data;

    public Box(T data) {
        this.data = data;
    }

    public T getData() {
        return data;
    }

    public void setData(T data) {
        this.data = data;
    }
}

Box<String> box = new Box<>("Hello World");
System.out.println(box.getData());
```

> åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªæ³›å‹ç±»Boxï¼Œè¯¥ç±»å¯ä»¥åŒ…å«ä»»æ„ç±»å‹çš„æ•°æ®ï¼Œå¹¶æä¾›äº†ç›¸åº”çš„æ–¹æ³•è¿›è¡Œæ“ä½œã€‚åœ¨ç±»å®šä¹‰ä¸­ä½¿ç”¨äº†ç±»å‹å‚æ•°Tï¼Œè¡¨ç¤ºè¯¥ç±»å¯ä»¥åŒ…å«ä»»æ„ç±»å‹çš„æ•°æ®ã€‚åœ¨åˆ›å»ºå¯¹è±¡æ—¶ï¼ŒæŒ‡å®šäº†Boxçš„æ³›å‹ç±»å‹ä¸ºStringï¼Œè¡¨ç¤ºè¯¥Boxå¯¹è±¡åªèƒ½åŒ…å«Stringç±»å‹çš„æ•°æ®ã€‚

è¿™äº›ç¤ºä¾‹åªæ˜¯æ³›å‹çš„åº”ç”¨åœºæ™¯ä¹‹ä¸€ï¼Œå®é™…ä¸Šæ³›å‹è¿˜å¯ä»¥åº”ç”¨äºå¾ˆå¤šå…¶ä»–çš„åœºæ™¯ä¸­ã€‚é€šè¿‡ä½¿ç”¨æ³›å‹ï¼Œå¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå‡å°‘ç±»å‹è½¬æ¢å’Œç±»å‹é”™è¯¯ï¼Œä»è€Œä½¿ä»£ç æ›´åŠ å¥å£®å’Œé«˜æ•ˆã€‚

## è¿­ä»£å™¨ â­ï¸

è¿­ä»£å™¨ï¼ˆIteratorï¼‰æ˜¯Javaé›†åˆæ¡†æ¶ä¸­çš„ä¸€ä¸ªæ¥å£ï¼Œç”¨äº**éå†é›†åˆä¸­çš„å…ƒç´ **ã€‚é€šè¿‡è¿­ä»£å™¨ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä¸€å®šçš„é¡ºåºä¾æ¬¡è®¿é—®é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚è¿­ä»£å™¨æä¾›äº†ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼æ¥è®¿é—®ä¸åŒç±»å‹çš„é›†åˆå¯¹è±¡ï¼Œä½¿å¾—é›†åˆæ¡†æ¶æ›´åŠ çµæ´»å’Œæ˜“ç”¨ã€‚
åœ¨Javaä¸­ï¼Œè¿­ä»£å™¨é€šè¿‡Iteratoræ¥å£è¿›è¡Œå®šä¹‰ï¼Œè¯¥æ¥å£ä¸­åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š

1. hasNext()ï¼šåˆ¤æ–­é›†åˆä¸­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚
2. next()ï¼šè¿”å›é›†åˆä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚
3. remove()ï¼šä»é›†åˆä¸­ç§»é™¤æœ€è¿‘è¿”å›çš„å…ƒç´ ã€‚

ä½¿ç”¨è¿­ä»£å™¨éå†é›†åˆå¯¹è±¡çš„ä»£ç å¦‚ä¸‹ï¼š

```java
List<String> list = new ArrayList<>();
list.add("Hello");
list.add("World");
Iterator<String> it = list.iterator();
while (it.hasNext()) {
    String s = it.next();
    System.out.println(s);
}

```

**ä¼˜ç‚¹ï¼š**
æ˜¯å¯ä»¥è®©æˆ‘ä»¬åœ¨éå†é›†åˆå¯¹è±¡æ—¶ï¼Œä¸éœ€è¦äº†è§£é›†åˆçš„å…·ä½“å®ç°ï¼Œåªéœ€è¦é€šè¿‡è¿­ä»£å™¨æä¾›çš„æ–¹æ³•å³å¯è®¿é—®é›†åˆä¸­çš„å…ƒç´ ã€‚åŒæ—¶ï¼Œè¿­ä»£å™¨è¿˜å¯ä»¥æ”¯æŒåœ¨éå†é›†åˆæ—¶è¿›è¡Œå…ƒç´ çš„åˆ é™¤æ“ä½œï¼Œä»è€Œæé«˜äº†é›†åˆçš„çµæ´»æ€§ã€‚
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ**åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨è¿­ä»£å™¨å¯èƒ½ä¼šäº§ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜**ï¼Œéœ€è¦è¿›è¡Œé€‚å½“çš„åŒæ­¥å¤„ç†æˆ–è€…ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»ã€‚

## [çº¿ç¨‹å®‰å…¨çš„é›†åˆ â­ï¸](#OHoCk)

**Javaä¸­æä¾›äº†è®¸å¤šçº¿ç¨‹å®‰å…¨çš„é›†åˆç±»åœ¨java.util.concurrentåŒ…ä¸‹é¢**ï¼Œå®ƒä»¬å¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å®‰å…¨åœ°ä½¿ç”¨ï¼Œé¿å…äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ä¸‹é¢æ˜¯å¸¸ç”¨çš„çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»ï¼š

> 1. ConcurrentHashMapï¼šçº¿ç¨‹å®‰å…¨çš„HashMapå®ç°ï¼Œé€‚ç”¨äºé«˜å¹¶å‘çš„æƒ…å†µã€‚
> 2. CopyOnWriteArrayListï¼šçº¿ç¨‹å®‰å…¨çš„Listå®ç°ï¼Œé€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯åœ¨å†™æ“ä½œæ—¶ï¼Œä¼šå¤åˆ¶ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå¯¹è¯¥æ•°ç»„è¿›è¡Œä¿®æ”¹ï¼Œä»è€Œé¿å…äº†è¯»å†™ä¹‹é—´çš„å†²çªã€‚
> 3. CopyOnWriteArraySetï¼šçº¿ç¨‹å®‰å…¨çš„Setå®ç°ï¼Œå†…éƒ¨ä½¿ç”¨CopyOnWriteArrayListå®ç°ï¼Œå…·æœ‰å’ŒCopyOnWriteArrayListç±»ä¼¼çš„ç‰¹ç‚¹ã€‚
> 4. ConcurrentLinkedQueueï¼šçº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—å®ç°ï¼Œé€‚ç”¨äºé«˜å¹¶å‘çš„æƒ…å†µã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯åŸºäºé“¾è¡¨å®ç°ï¼Œæ”¯æŒé«˜æ•ˆçš„å¹¶å‘è®¿é—®ã€‚
> 5. LinkedBlockingQueueï¼šçº¿ç¨‹å®‰å…¨çš„é˜»å¡é˜Ÿåˆ—å®ç°ï¼Œé€‚ç”¨äºç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ã€‚
> 6. ConcurrentSkipListMapï¼šçº¿ç¨‹å®‰å…¨çš„æœ‰åºMapå®ç°ï¼Œé€‚ç”¨äºé«˜å¹¶å‘çš„æƒ…å†µã€‚

é™¤äº†ä¸Šè¿°é›†åˆç±»ï¼ŒJavaè¿˜æä¾›äº†ä¸€äº›çº¿ç¨‹å®‰å…¨çš„å·¥å…·ç±»ï¼Œæ¯”å¦‚**CountDownLatch**ã€Semaphoreã€CyclicBarrierç­‰ï¼Œè¿™äº›ç±»å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°å®ç°çº¿ç¨‹å®‰å…¨çš„æ“ä½œã€‚éœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„çº¿ç¨‹å®‰å…¨é›†åˆç±»æˆ–å·¥å…·ç±»ã€‚

### ConcurrentHashMapæ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨çš„

ConcurrentHashMapæ˜¯Javaä¸­å¹¶å‘ç¼–ç¨‹ä¸­å¸¸ç”¨çš„çº¿ç¨‹å®‰å…¨å®¹å™¨ï¼Œå®ƒåœ¨å®ç°çº¿ç¨‹å®‰å…¨çš„è¿‡ç¨‹ä¸­ï¼Œé‡‡ç”¨äº†å¤šç§ä¼˜åŒ–æ‰‹æ®µã€‚

> 1. åˆ†æ®µé”è®¾è®¡
>    ConcurrentHashMapå†…éƒ¨é‡‡ç”¨äº†åˆ†æ®µé”çš„è®¾è®¡ï¼Œå°†æ•´ä¸ªmapåˆ†æˆäº†ä¸€ç³»åˆ—çš„æ®µï¼ˆSegmentï¼‰ï¼Œæ¯ä¸ªæ®µéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å“ˆå¸Œè¡¨ï¼Œæ¯ä¸ªæ®µéƒ½åªè¢«ä¸€æŠŠé”æ‰€ä¿æŠ¤ã€‚è¿™æ ·å°±å¯ä»¥å°†å¤šä¸ªçº¿ç¨‹çš„è®¿é—®å¹¶å‘åŒ–ï¼Œåªéœ€è¦é”å®šåŒä¸€æ®µä¸­çš„æ•°æ®ï¼Œè€Œä¸éœ€è¦é”å®šæ•´ä¸ªmapã€‚
> 2. CASæ“ä½œ
>    ConcurrentHashMapä½¿ç”¨äº†CASæ“ä½œï¼ˆCompare And Swapï¼‰ï¼Œåœ¨æ·»åŠ æˆ–è€…åˆ é™¤å…ƒç´ æ—¶ï¼Œå…ˆæ¯”è¾ƒkeyçš„hashå€¼ï¼Œå¦‚æœç›¸åŒå†ä½¿ç”¨CASæ“ä½œå°è¯•åŠ å…¥æˆ–åˆ é™¤å…ƒç´ ã€‚è¿™æ ·å°±å¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¿è¯å…ƒç´ çš„ä¸€è‡´æ€§ï¼ŒåŒæ—¶é¿å…äº†ä¸å¿…è¦çš„é”ç«äº‰ã€‚
> 3. volatileä¿®é¥°
>    ConcurrentHashMapå†…éƒ¨ä½¿ç”¨äº†volatileä¿®é¥°çš„æˆå‘˜å˜é‡ï¼Œä¿è¯äº†å¤šçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ã€‚
> 4. é”åˆ†ç¦»æŠ€æœ¯
>    ConcurrentHashMapå†…éƒ¨é‡‡ç”¨äº†é”åˆ†ç¦»æŠ€æœ¯ï¼Œå°†è¯»å†™æ“ä½œåˆ†ç¦»åˆ°ä¸åŒçš„é”ä¸Šï¼Œè¯»æ“ä½œä¸éœ€è¦é”å®šï¼Œæé«˜äº†å¹¶å‘è¯»å–çš„æ€§èƒ½ã€‚
>    ç»¼ä¸Šæ‰€è¿°ï¼ŒConcurrentHashMapé€šè¿‡åˆ†æ®µé”è®¾è®¡ã€CASæ“ä½œã€volatileä¿®é¥°å’Œé”åˆ†ç¦»æŠ€æœ¯ç­‰å¤šç§ä¼˜åŒ–æ‰‹æ®µï¼Œå®ç°äº†é«˜æ•ˆçš„çº¿ç¨‹å®‰å…¨ã€‚åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œä½¿ç”¨ConcurrentHashMapèƒ½å¤Ÿæœ‰æ•ˆåœ°æé«˜ç¨‹åºçš„å¹¶å‘æ€§èƒ½ã€‚

## é˜»å¡é˜Ÿåˆ— â­ï¸

é˜»å¡é˜Ÿåˆ—ï¼ˆBlocking Queueï¼‰æ˜¯Javaä¸­çš„ä¸€ä¸ª**å¹¶å‘é›†åˆ**ç±»ï¼Œå®ƒæ”¯æŒåœ¨é˜Ÿåˆ—ä¸ºç©ºæˆ–é˜Ÿåˆ—å·²æ»¡æ—¶é˜»å¡çº¿ç¨‹çš„æ“ä½œã€‚é˜»å¡é˜Ÿåˆ—åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥å¾ˆå¥½åœ°è§£å†³ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹çš„é—®é¢˜ã€‚
é˜»å¡é˜Ÿåˆ—çš„**ç‰¹ç‚¹**æ˜¯ï¼Œ**å½“é˜Ÿåˆ—å·²æ»¡æ—¶ï¼Œç”Ÿäº§è€…çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰ç©ºé—²ä½ç½®ï¼›å½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰æ–°çš„å…ƒç´ **ã€‚è¿™æ ·å°±å¯ä»¥å¾ˆå¥½åœ°æ§åˆ¶ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„é€Ÿåº¦ï¼Œä»è€Œé¿å…äº†ç”Ÿäº§è€…è¿‡å¿«æˆ–æ¶ˆè´¹è€…è¿‡æ…¢å¯¼è‡´çš„é—®é¢˜ã€‚
Javaä¸­æä¾›äº†å¤šç§é˜»å¡é˜Ÿåˆ—çš„å®ç°ï¼ŒåŒ…æ‹¬ï¼š

1. ArrayBlockingQueueï¼šåŸºäºæ•°ç»„å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚
2. LinkedBlockingQueueï¼šåŸºäºé“¾è¡¨å®ç°çš„å¯é€‰æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚
3. PriorityBlockingQueueï¼šåŸºäºä¼˜å…ˆçº§å †å®ç°çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚
4. SynchronousQueueï¼šæ²¡æœ‰å®¹é‡çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…ç›¸åº”çš„åˆ é™¤æ“ä½œï¼Œåä¹‹äº¦ç„¶ã€‚

é˜»å¡é˜Ÿåˆ—çš„åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼Œæ¯”å¦‚ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ã€çº¿ç¨‹æ± ã€äº‹ä»¶é©±åŠ¨ç­‰ã€‚åœ¨ä½¿ç”¨é˜»å¡é˜Ÿåˆ—æ—¶ï¼Œéœ€è¦æ³¨æ„é€‰æ‹©åˆé€‚çš„é˜Ÿåˆ—å®ç°ï¼Œæ ¹æ®ä¸šåŠ¡åœºæ™¯åˆç†é…ç½®é˜Ÿåˆ—çš„å¤§å°å’Œé˜»å¡ç­–ç•¥ï¼Œä»¥ä¿è¯ç¨‹åºçš„æ­£ç¡®æ€§å’Œæ€§èƒ½ã€‚åŒæ—¶ï¼Œåœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„ä»£ç ä¸­ï¼Œéœ€è¦æ­£ç¡®åœ°å¤„ç†é˜»å¡å¼‚å¸¸å’Œä¸­æ–­å¼‚å¸¸ï¼Œä»¥é¿å…çº¿ç¨‹é˜»å¡æˆ–æ„å¤–é€€å‡ºã€‚
**ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ç¤ºä¾‹**
ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨é˜»å¡é˜Ÿåˆ—çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ç¤ºä¾‹ï¼Œå…¶ä¸­ä½¿ç”¨äº†Javaä¸­çš„LinkedBlockingQueueå®ç°é˜»å¡é˜Ÿåˆ—ï¼š

```java
import java.util.concurrent.BlockingQueue;
import java.util.concurrent.LinkedBlockingQueue;

public class BlockingQueueExample {
    private static final int QUEUE_SIZE = 10;
    private static final int PRODUCER_COUNT = 5;
    private static final int CONSUMER_COUNT = 3;

    public static void main(String[] args) {
        // åˆ›å»ºé˜»å¡é˜Ÿåˆ—
        BlockingQueue<Integer> queue = new LinkedBlockingQueue<>(QUEUE_SIZE);

        // åˆ›å»ºç”Ÿäº§è€…çº¿ç¨‹
        for (int i = 1; i <= PRODUCER_COUNT; i++) {
            Thread producerThread = new Thread(() -> {
                try {
                    int value = 0;
                    while (true) {
                        // ç”Ÿäº§å…ƒç´ å¹¶å°†å…¶æ”¾å…¥é˜Ÿåˆ—
                        queue.put(value);
                        System.out.println("Producer " + Thread.currentThread().getId() + " produced " + value);
                        value++;
                    }
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            });
            producerThread.start();
        }

        // åˆ›å»ºæ¶ˆè´¹è€…çº¿ç¨‹
        for (int i = 1; i <= CONSUMER_COUNT; i++) {
            Thread consumerThread = new Thread(() -> {
                try {
                    while (true) {
                        // ä»é˜Ÿåˆ—ä¸­å–å‡ºå…ƒç´ å¹¶è¿›è¡Œæ¶ˆè´¹
                        int value = queue.take();
                        System.out.println("Consumer " + Thread.currentThread().getId() + " consumed " + value);
                    }
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            });
            consumerThread.start();
        }
    }
}
//è¿™ä¸ªç¨‹åºæ²¡æœ‰ç»ˆæ­¢çš„åœ°æ–¹ï¼Œä¼šæ— çº¿æ‰§è¡Œä¸‹å»ã€‚
```

> åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªå¤§å°ä¸º10çš„é˜»å¡é˜Ÿåˆ—ï¼Œç„¶ååˆ›å»ºäº†5ä¸ªç”Ÿäº§è€…çº¿ç¨‹å’Œ3ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ï¼Œåˆ†åˆ«å‘é˜Ÿåˆ—ä¸­ç”Ÿäº§å…ƒç´ å’Œä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹å…ƒç´ ã€‚åœ¨ç”Ÿäº§è€…çº¿ç¨‹ä¸­ï¼Œä½¿ç”¨äº†LinkedBlockingQueueçš„putæ–¹æ³•å°†ç”Ÿäº§çš„å…ƒç´ æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™è¯¥æ–¹æ³•ä¼šé˜»å¡çº¿ç¨‹ï¼›åœ¨æ¶ˆè´¹è€…çº¿ç¨‹ä¸­ï¼Œä½¿ç”¨äº†LinkedBlockingQueueçš„takeæ–¹æ³•ä»é˜Ÿåˆ—ä¸­å–å‡ºå…ƒç´ è¿›è¡Œæ¶ˆè´¹ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¯¥æ–¹æ³•ä¼šé˜»å¡çº¿ç¨‹ã€‚è¿™æ ·å°±å®ç°äº†ä¸€ä¸ªç®€å•çš„é˜»å¡é˜Ÿåˆ—çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ã€‚

## å»¶è¿Ÿé˜Ÿåˆ—â­ï¸

å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆDelay Queueï¼‰æ˜¯Javaä¸­çš„ä¸€ä¸ªå¹¶å‘é›†åˆç±»ï¼Œå®ƒå¯ä»¥å®ç°åœ¨æŒ‡å®šæ—¶é—´åè·å–å…ƒç´ çš„åŠŸèƒ½ã€‚å»¶è¿Ÿé˜Ÿåˆ—åœ¨ä¸€äº›åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚**å®šæ—¶ä»»åŠ¡è°ƒåº¦ã€ç¼“å­˜è¿‡æœŸæ¸…ç†**ç­‰ã€‚
**å»¶è¿Ÿé˜Ÿåˆ—çš„å…ƒç´ éœ€è¦å®ç°Delayedæ¥å£**ï¼Œè¯¥æ¥å£åŒ…å«ä¸¤ä¸ªæ–¹æ³•ï¼š

1. long getDelay(TimeUnit unit)ï¼šè¿”å›å…ƒç´ å‰©ä½™çš„å»¶è¿Ÿæ—¶é—´ï¼Œä»¥ç»™å®šçš„æ—¶é—´å•ä½è¡¨ç¤ºã€‚
2. int compareTo(Delayed other)ï¼šæ¯”è¾ƒå…ƒç´ çš„å»¶è¿Ÿæ—¶é—´ï¼Œå¦‚æœå½“å‰å…ƒç´ çš„å»¶è¿Ÿæ—¶é—´å°äºotherå…ƒç´ çš„å»¶è¿Ÿæ—¶é—´ï¼Œåˆ™è¿”å›è´Ÿæ•´æ•°ï¼Œå¦‚æœå½“å‰å…ƒç´ çš„å»¶è¿Ÿæ—¶é—´å¤§äºotherå…ƒç´ çš„å»¶è¿Ÿæ—¶é—´ï¼Œåˆ™è¿”å›æ­£æ•´æ•°ï¼Œå¦‚æœç›¸ç­‰åˆ™è¿”å›0ã€‚

Javaä¸­æä¾›äº†ä¸€ä¸ªåŸºäºPriorityQueueå®ç°çš„DelayQueueï¼Œå®ƒæ”¯æŒæŒ‰ç…§å…ƒç´ çš„å»¶è¿Ÿæ—¶é—´è¿›è¡Œæ’åºï¼Œå¯ä»¥æ–¹ä¾¿è·å–å»¶è¿Ÿæ—¶é—´æœ€çŸ­çš„å…ƒç´ ã€‚
ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨å»¶è¿Ÿé˜Ÿåˆ—çš„ç¤ºä¾‹ï¼š

```java
import java.util.concurrent.DelayQueue;
import java.util.concurrent.Delayed;
import java.util.concurrent.TimeUnit;

public class DelayQueueExample {
    public static void main(String[] args) throws InterruptedException {
        // åˆ›å»ºå»¶è¿Ÿé˜Ÿåˆ—
        DelayQueue<DelayedElement> queue = new DelayQueue<>();

        // æ·»åŠ å…ƒç´ åˆ°é˜Ÿåˆ—ä¸­
        queue.put(new DelayedElement("Task 1", 5, TimeUnit.SECONDS));
        queue.put(new DelayedElement("Task 2", 10, TimeUnit.SECONDS));
        queue.put(new DelayedElement("Task 3", 15, TimeUnit.SECONDS));

        // ä»é˜Ÿåˆ—ä¸­å–å‡ºå…ƒç´ è¿›è¡Œå¤„ç†
        while (!queue.isEmpty()) {
            //æŒ‰ç…§å…ƒç´ çš„è¿‡æœŸæ—¶é—´æ’åºï¼Œå¹¶å–å‡ºå»¶è¿Ÿæ—¶é—´æœ€çŸ­çš„å…ƒç´ è¿›è¡Œå¤„ç†
            DelayedElement element = queue.take();
            System.out.println("Process " + element.getName() + " at " + System.currentTimeMillis());
        }
    }
}

// å®ç°Delayedæ¥å£çš„å…ƒç´ ç±»
class DelayedElement implements Delayed {
    private String name;
    private long delay;
    private long expire;

    public DelayedElement(String name, long delay, TimeUnit unit) {
        this.name = name;
        this.delay = TimeUnit.MILLISECONDS.convert(delay, unit);
        this.expire = System.currentTimeMillis() + this.delay;
    }

    public String getName() {
        return name;
    }

    @Override
    public long getDelay(TimeUnit unit) {
        return unit.convert(expire - System.currentTimeMillis(), TimeUnit.MILLISECONDS);
    }

    @Override
    public int compareTo(Delayed o) {
        return Long.compare(this.expire, ((DelayedElement) o).expire);
    }
}

```

> åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªDelayQueueï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ äº†ä¸‰ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«è¡¨ç¤ºéœ€è¦å»¶è¿Ÿ5ç§’ã€10ç§’å’Œ15ç§’æ‰§è¡Œçš„ä»»åŠ¡ã€‚åœ¨æ¯ä¸ªå…ƒç´ çš„æ„é€ å‡½æ•°ä¸­ï¼Œé€šè¿‡TimeUnitå°†å»¶è¿Ÿæ—¶é—´è½¬æ¢ä¸ºæ¯«ç§’ï¼Œå¹¶è®¡ç®—å‡ºè¯¥å…ƒç´ çš„è¿‡æœŸæ—¶é—´ã€‚åœ¨DelayQueueçš„takeæ–¹æ³•ä¸­ï¼Œä¼šè‡ªåŠ¨æŒ‰ç…§å…ƒç´ çš„è¿‡æœŸæ—¶é—´æ’åºï¼Œå¹¶å–å‡ºå»¶è¿Ÿæ—¶é—´æœ€çŸ­çš„å…ƒç´ è¿›è¡Œå¤„ç†ã€‚è¿™æ ·å°±å®ç°äº†ä¸€ä¸ªç®€å•çš„å»¶è¿Ÿé˜Ÿåˆ—çš„ç¤ºä¾‹ã€‚

# å¸¸ç”¨ç®—æ³•

## å†’æ³¡æ’åº

å†’æ³¡æ’åºï¼ˆBubble Sortï¼‰æ˜¯ä¸€ç§ç®€å•çš„æ’åºç®—æ³•ï¼Œå®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯ä»æœªæ’åºçš„æ•°æ®ä¸­æ‰¾å‡ºæœ€å¤§ï¼ˆæˆ–æœ€å°ï¼‰çš„å…ƒç´ ï¼Œç„¶åå°†å…¶æ”¾åˆ°å·²æ’åºçš„æ•°æ®çš„æœ«å°¾ï¼ˆæˆ–å¼€å¤´ï¼‰ï¼Œç„¶åç»§ç»­ä»æœªæ’åºçš„æ•°æ®ä¸­æ‰¾å‡ºæœ€å¤§ï¼ˆæˆ–æœ€å°ï¼‰çš„å…ƒç´ ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½å·²æ’åºå®Œæˆã€‚
å†’æ³¡æ’åºçš„æ—¶é—´**å¤æ‚åº¦ä¸ºO(n^2)**ï¼Œå…¶ä¸­nä¸ºå¾…æ’åºæ•°æ®çš„æ•°é‡ï¼Œå› æ­¤**å¯¹äºå¤§é‡æ•°æ®çš„æ’åºæ—¶ï¼Œä¸é€‚åˆä½¿ç”¨å†’æ³¡æ’åº**ã€‚
ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å†’æ³¡æ’åºçš„å®ç°ç¤ºä¾‹

```java
public class BubbleSortExample {
    public static void bubbleSort(int[] arr) {
        if (arr == null || arr.length < 2) {
            return;
        }
        for (int i = 0; i < arr.length - 1; i++) {
            for (int j = 0; j < arr.length - 1 - i; j++) {
                if (arr[j] > arr[j + 1]) {
                    int temp = arr[j];
                    arr[j] = arr[j + 1];
                    arr[j + 1] = temp;
                }
            }
        }
    }

    public static void main(String[] args) {
        int[] arr = {3, 5, 1, 4, 2};
        bubbleSort(arr);
        System.out.println(Arrays.toString(arr)); // [1, 2, 3, 4, 5]
    }
}

```

> åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªbubbleSortæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªæ•´å‹æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå®ç°å†’æ³¡æ’åºçš„åŠŸèƒ½ã€‚åœ¨æ–¹æ³•ä¸­ï¼Œä½¿ç”¨äº†ä¸¤å±‚å¾ªç¯ï¼Œç¬¬ä¸€å±‚å¾ªç¯æ§åˆ¶æ’åºçš„è¶Ÿæ•°ï¼Œç¬¬äºŒå±‚å¾ªç¯æ§åˆ¶æ¯è¶Ÿæ’åºä¸­å…ƒç´ çš„æ¯”è¾ƒå’Œäº¤æ¢ã€‚åœ¨æ¯è¶Ÿæ’åºä¸­ï¼Œå¦‚æœç›¸é‚»ä¸¤ä¸ªå…ƒç´ çš„å¤§å°å…³ç³»ä¸æ­£ç¡®ï¼Œåˆ™äº¤æ¢å®ƒä»¬çš„ä½ç½®ï¼Œç›´åˆ°æœ¬è¶Ÿæ’åºç»“æŸã€‚æœ€ç»ˆï¼Œæ•´ä¸ªæ•°ç»„å°±å®Œæˆäº†æ’åºã€‚åœ¨mainæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•è¯¥æ’åºç®—æ³•çš„æ­£ç¡®æ€§ã€‚

## å¿«é€Ÿæ’åº

å¿«é€Ÿæ’åºï¼ˆQuick Sortï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„æ’åºç®—æ³•ï¼Œå®ƒçš„**åŸºæœ¬æ€æƒ³**æ˜¯é€šè¿‡ä¸€æ¬¡æ’åºå°†å¾…æ’åºæ•°æ®åˆ†å‰²æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†çš„æ‰€æœ‰å…ƒç´ éƒ½æ¯”å¦ä¸€éƒ¨åˆ†çš„æ‰€æœ‰å…ƒç´ å°ï¼Œç„¶åå†åˆ†åˆ«å¯¹è¿™ä¸¤éƒ¨åˆ†è¿›è¡Œæ’åºï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½å·²æ’åºå®Œæˆã€‚
**å‡ ä¸ªä¾‹å­ï¼š**
![](readme.assets/1681657196333-4e23dddf-46c4-4db1-af1d-a4b85d98d477.jpeg)
å¿«é€Ÿæ’åºçš„æ—¶é—´**å¤æ‚åº¦ä¸ºO(nlogn)**ï¼Œå…¶ä¸­nä¸ºå¾…æ’åºæ•°æ®çš„æ•°é‡ï¼Œå®ƒæ˜¯ä¸€ç§æ¯”è¾ƒé«˜æ•ˆçš„æ’åºç®—æ³•ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å¿«é€Ÿæ’åºçš„å®ç°ç¤ºä¾‹ï¼š

```java
public class QuickSortExample {

    /**
     * å¿«é€Ÿæ’åºç®—æ³•å®ç°
     *
     * @param arr   å¾…æ’åºçš„æ•°ç»„
     * @param left  æ•°ç»„å·¦è¾¹ç•Œ
     * @param right æ•°ç»„å³è¾¹ç•Œ
     */
    public static void quickSort(int[] arr, int left, int right) {
        // é€’å½’ç»ˆæ­¢æ¡ä»¶ï¼Œå½“å·¦å³æŒ‡é’ˆç›¸é‡æˆ–è€…å·¦æŒ‡é’ˆå¤§äºå³æŒ‡é’ˆæ—¶ï¼Œè¿”å›
        if (left >= right) {
            return;
        }
        // å¯¹æ•°ç»„è¿›è¡Œåˆ†åŒºï¼Œå¾—åˆ°åŸºå‡†ç‚¹ä½ç½®
        int pivot = partition(arr, left, right);
        // åˆ†æ²»å¤„ç†å·¦åŠéƒ¨åˆ†
        quickSort(arr, left, pivot - 1);
        // åˆ†æ²»å¤„ç†å³åŠéƒ¨åˆ†
        quickSort(arr, pivot + 1, right);
    }

    /**
     * å¯¹æ•°ç»„è¿›è¡Œåˆ†åŒº
     *
     * @param arr   å¾…åˆ†åŒºçš„æ•°ç»„
     * @param left  æ•°ç»„å·¦è¾¹ç•Œ
     * @param right æ•°ç»„å³è¾¹ç•Œ
     * @return è¿”å›åŸºå‡†ç‚¹çš„ä½ç½®
     */
    public static int partition(int[] arr, int left, int right) {
        // é€‰æ‹©æ•°ç»„å·¦è¾¹ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºåŸºå‡†ç‚¹
        int pivot = arr[left];
        while (left < right) {
            // ä»å³è¾¹å¼€å§‹æ‰¾åˆ°ç¬¬ä¸€ä¸ªå°äºåŸºå‡†ç‚¹çš„å…ƒç´ 
            while (left < right && arr[right] >= pivot) {
                right--;
            }
            // å°†æ‰¾åˆ°çš„å°äºåŸºå‡†ç‚¹çš„å…ƒç´ ç§»åŠ¨åˆ°å·¦è¾¹
            arr[left] = arr[right];
            // ä»å·¦è¾¹å¼€å§‹æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºåŸºå‡†ç‚¹çš„å…ƒç´ 
            while (left < right && arr[left] <= pivot) {
                left++;
            }
            // å°†æ‰¾åˆ°çš„å¤§äºåŸºå‡†ç‚¹çš„å…ƒç´ ç§»åŠ¨åˆ°å³è¾¹
            arr[right] = arr[left];
        }
        // å°†åŸºå‡†ç‚¹æ”¾åˆ°æ•°ç»„çš„æ­£ç¡®ä½ç½®ä¸Š
        arr[left] = pivot;
        // è¿”å›åŸºå‡†ç‚¹çš„ä½ç½®
        return left;
    }

    public static void main(String[] args) {
        int[] arr = {3, 5, 1, 4, 2};
        // å¯¹æ•°ç»„è¿›è¡Œå¿«é€Ÿæ’åº
        quickSort(arr, 0, arr.length - 1);
        // è¾“å‡ºæ’åºåçš„æ•°ç»„
        System.out.println(Arrays.toString(arr)); // [1, 2, 3, 4, 5]
    }
}

```

> åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªquickSortæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªæ•´å‹æ•°ç»„å’Œå·¦å³ä¸¤ä¸ªæŒ‡é’ˆä½œä¸ºå‚æ•°ï¼Œå®ç°å¿«é€Ÿæ’åºçš„åŠŸèƒ½ã€‚åœ¨æ–¹æ³•ä¸­ï¼Œä½¿ç”¨äº†é€’å½’çš„æ–¹å¼å¯¹æ•°ç»„è¿›è¡Œæ’åºï¼Œæ¯æ¬¡é€‰æ‹©ä¸€ä¸ªåŸºå‡†å…ƒç´ ï¼Œå°†æ•°ç»„ä¸­å°äºè¯¥å…ƒç´ çš„å…ƒç´ æ”¾åœ¨å…¶å·¦ä¾§ï¼Œå°†å¤§äºè¯¥å…ƒç´ çš„å…ƒç´ æ”¾åœ¨å…¶å³ä¾§ï¼Œå¹¶è¿”å›è¯¥åŸºå‡†å…ƒç´ çš„ä½ç½®ã€‚ç„¶åï¼Œå†å¯¹åŸºå‡†å…ƒç´ çš„å·¦ä¾§å’Œå³ä¾§ä¸¤ä¸ªéƒ¨åˆ†è¿›è¡Œé€’å½’æ’åºï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½å·²æ’åºå®Œæˆã€‚åœ¨partitionæ–¹æ³•ä¸­ï¼Œä½¿ç”¨äº†å·¦å³æŒ‡é’ˆçš„æ–¹å¼å¯¹æ•°ç»„è¿›è¡Œåˆ’åˆ†ï¼Œç›´åˆ°å·¦å³æŒ‡é’ˆç›¸é‡ã€‚æœ€ç»ˆï¼Œæ•´ä¸ªæ•°ç»„å°±å®Œæˆäº†æ’åºã€‚åœ¨mainæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•è¯¥æ’åºç®—æ³•çš„æ­£ç¡®æ€§ã€‚

## äºŒåˆ†æ³•

äºŒåˆ†æ³•ï¼ˆBinary Searchï¼‰ï¼Œä¹Ÿç§°æŠ˜åŠæœç´¢ï¼Œæ˜¯ä¸€ç§å¸¸ç”¨çš„æŸ¥æ‰¾ç®—æ³•ï¼Œå®ƒçš„**åŸºæœ¬æ€æƒ³**æ˜¯å°†æœ‰åºæ•°ç»„ä¸æ–­åœ°åˆ†æˆä¸¤åŠï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡å…ƒç´ ä¸ºæ­¢ã€‚
äºŒåˆ†æ³•çš„**æ—¶é—´å¤æ‚åº¦ä¸ºO(log n)**ï¼Œå…¶ä¸­nä¸ºæ•°ç»„çš„é•¿åº¦ï¼Œå®ƒæ˜¯ä¸€ç§**æ¯”è¾ƒé«˜æ•ˆçš„æŸ¥æ‰¾ç®—æ³•**ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„äºŒåˆ†æ³•çš„å®ç°ç¤ºä¾‹ï¼š

```java
public class BinarySearchExample {
    // äºŒåˆ†æŸ¥æ‰¾å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªæœ‰åºæ•°ç»„å’Œä¸€ä¸ªç›®æ ‡å€¼
    public static int binarySearch(int[] arr, int target) {
        // ç‰¹åˆ¤ï¼šå¦‚æœæ•°ç»„ä¸ºç©ºï¼Œåˆ™è¿”å› -1
        if (arr == null || arr.length == 0) {
            return -1;
        }
        // åˆå§‹åŒ–å·¦å³æŒ‡é’ˆ
        int left = 0;
        int right = arr.length - 1;
        // å½“å·¦æŒ‡é’ˆå°äºç­‰äºå³æŒ‡é’ˆæ—¶ï¼Œè¿›è¡Œå¾ªç¯æŸ¥æ‰¾
        while (left <= right) {
            // è®¡ç®—ä¸­é—´å€¼çš„ä¸‹æ ‡
            int mid = (left + right) / 2;
            // å¦‚æœä¸­é—´å€¼ç­‰äºç›®æ ‡å€¼ï¼Œç›´æ¥è¿”å›ä¸‹æ ‡
            if (arr[mid] == target) {
                return mid;
            // å¦‚æœä¸­é—´å€¼å°äºç›®æ ‡å€¼ï¼Œåˆ™ç›®æ ‡å€¼åœ¨å³åŠéƒ¨åˆ†ï¼Œå°†å·¦æŒ‡é’ˆç§»åŠ¨åˆ°ä¸­é—´å€¼çš„å³è¾¹ä¸€ä½
            } else if (arr[mid] < target) {
                left = mid + 1;
            // å¦‚æœä¸­é—´å€¼å¤§äºç›®æ ‡å€¼ï¼Œåˆ™ç›®æ ‡å€¼åœ¨å·¦åŠéƒ¨åˆ†ï¼Œå°†å³æŒ‡é’ˆç§»åŠ¨åˆ°ä¸­é—´å€¼çš„å·¦è¾¹ä¸€ä½
            } else {
                right = mid - 1;
            }
        }
        // å¦‚æœå¾ªç¯ç»“æŸä»æœªæ‰¾åˆ°ç›®æ ‡å€¼ï¼Œè¿”å› -1
        return -1;
    }

    public static void main(String[] args) {
        int[] arr = {1, 2, 3, 4, 5};
        int target = 3;
        int index = binarySearch(arr, target);
        System.out.println(index); // 2
    }
}

```

> åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªbinarySearchæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªæœ‰åºæ•´å‹æ•°ç»„å’Œç›®æ ‡å…ƒç´ ä½œä¸ºå‚æ•°ï¼Œå®ç°äºŒåˆ†æŸ¥æ‰¾çš„åŠŸèƒ½ã€‚åœ¨æ–¹æ³•ä¸­ï¼Œä½¿ç”¨äº†å·¦å³æŒ‡é’ˆå’Œä¸­é—´æŒ‡é’ˆçš„æ–¹å¼è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œæ¯æ¬¡å°†æ•°ç»„ä¸æ–­åœ°åˆ†æˆä¸¤åŠï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡å…ƒç´ ä¸ºæ­¢ã€‚åœ¨mainæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•è¯¥æŸ¥æ‰¾ç®—æ³•çš„æ­£ç¡®æ€§ã€‚

## é€‰æ‹©æ’åº

é€‰æ‹©æ’åºï¼ˆSelection Sortï¼‰æ˜¯ä¸€ç§ç®€å•çš„æ’åºç®—æ³•ï¼Œå®ƒçš„**åŸºæœ¬æ€æƒ³**æ˜¯åœ¨å¾…æ’åºæ•°æ®ä¸­é€‰æ‹©æœ€å°ï¼ˆæˆ–æœ€å¤§ï¼‰çš„å…ƒç´ ï¼Œå°†å…¶æ”¾åˆ°å·²æ’åºçš„æ•°æ®çš„æœ«å°¾ï¼ˆæˆ–å¼€å¤´ï¼‰ï¼Œç„¶åç»§ç»­ä»æœªæ’åºçš„æ•°æ®ä¸­é€‰æ‹©æœ€å°ï¼ˆæˆ–æœ€å¤§ï¼‰çš„å…ƒç´ ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½å·²æ’åºå®Œæˆã€‚
é€‰æ‹©æ’åºçš„æ—¶é—´**å¤æ‚åº¦ä¸ºO(n^2)**ï¼Œå…¶ä¸­nä¸ºå¾…æ’åºæ•°æ®çš„æ•°é‡ï¼Œå› æ­¤**å¯¹äºå¤§é‡æ•°æ®çš„æ’åºæ—¶ï¼Œä¸é€‚åˆä½¿ç”¨é€‰æ‹©æ’åº**ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„é€‰æ‹©æ’åºçš„å®ç°ç¤ºä¾‹ï¼š

```java
package org.example;

import java.util.Arrays;

/**
 * é€‰æ‹©æ’åºç¤ºä¾‹
 */
public class SelectionSortExample {

    /**
     * é€‰æ‹©æ’åºç®—æ³•
     *
     * @param arr å¾…æ’åºæ•°ç»„
     */
    public static void selectionSort(int[] arr) {
        // å¦‚æœæ•°ç»„ä¸ºnullæˆ–é•¿åº¦å°äº2ï¼Œä¸éœ€è¦æ’åº
        if (arr == null || arr.length < 2) {
            return;
        }
        // å¤–å±‚å¾ªç¯æ§åˆ¶æ¯æ¬¡é€‰æ‹©çš„èµ·å§‹ä½ç½®ï¼Œä»0å¼€å§‹åˆ°length-1
        for (int i = 0; i < arr.length - 1; i++) {
            int minIndex = i; // å‡è®¾å½“å‰ä½ç½®çš„å…ƒç´ æ˜¯æœ€å°çš„
            // å†…å±‚å¾ªç¯æ‰¾åˆ°å½“å‰ä½ç½®ä¹‹åæœ€å°çš„å…ƒç´ 
            for (int j = i + 1; j < arr.length; j++) {
                if (arr[j] < arr[minIndex]) {
                    minIndex = j; // æ›´æ–°æœ€å°å…ƒç´ çš„ä¸‹æ ‡
                }
            }
            // å¦‚æœå½“å‰ä½ç½®ä¸æ˜¯æœ€å°å…ƒç´ çš„ä½ç½®ï¼Œåˆ™äº¤æ¢å½“å‰ä½ç½®å’Œæœ€å°ä½ç½®çš„å…ƒç´ 
            if (minIndex != i) {
                int temp = arr[i];
                arr[i] = arr[minIndex];
                arr[minIndex] = temp;
            }
        }
    }

    public static void main(String[] args) {
        int[] arr = {3, 5, 1, 4, 2};
        selectionSort(arr);
        System.out.println(Arrays.toString(arr)); // [1, 2, 3, 4, 5]
    }
}
```

> åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªselectionSortæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªæ•´å‹æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå®ç°é€‰æ‹©æ’åºçš„åŠŸèƒ½ã€‚åœ¨æ–¹æ³•ä¸­ï¼Œä½¿ç”¨äº†ä¸¤å±‚å¾ªç¯ï¼Œç¬¬ä¸€å±‚å¾ªç¯æ§åˆ¶æ’åºçš„è¶Ÿæ•°ï¼Œç¬¬äºŒå±‚å¾ªç¯æ§åˆ¶æ¯è¶Ÿæ’åºä¸­æ‰¾åˆ°æœ€å°å…ƒç´ çš„ä½ç½®ï¼Œç„¶åå°†è¯¥å…ƒç´ å’Œæœ¬è¶Ÿæ’åºçš„ç¬¬ä¸€ä¸ªå…ƒç´ è¿›è¡Œäº¤æ¢ã€‚æœ€ç»ˆï¼Œæ•´ä¸ªæ•°ç»„å°±å®Œæˆäº†æ’åºã€‚åœ¨mainæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•è¯¥æ’åºç®—æ³•çš„æ­£ç¡®æ€§ã€‚

## æ’å…¥æ’åº

æ’å…¥æ’åºï¼ˆInsertion Sortï¼‰æ˜¯ä¸€ç§ç®€å•çš„æ’åºç®—æ³•ï¼Œå®ƒçš„**åŸºæœ¬æ€æƒ³**æ˜¯å°†å¾…æ’åºæ•°æ®åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œå·²æ’åºå’Œæœªæ’åºï¼Œæ¯æ¬¡å°†æœªæ’åºçš„æ•°æ®æ’å…¥åˆ°å·²æ’åºçš„æ•°æ®ä¸­çš„æ­£ç¡®ä½ç½®ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½å·²æ’åºå®Œæˆã€‚
æ’å…¥æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n^2)ï¼Œå…¶ä¸­nä¸ºå¾…æ’åºæ•°æ®çš„æ•°é‡ï¼Œå› æ­¤å¯¹äºå¤§é‡æ•°æ®çš„æ’åºæ—¶ï¼Œä¸é€‚åˆä½¿ç”¨æ’å…¥æ’åºã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ’å…¥æ’åºçš„å®ç°ç¤ºä¾‹ï¼š

```java
/**
 * æ’å…¥æ’åºç®—æ³•
 *
 * @param arr å¾…æ’åºçš„æ•°ç»„
 */
public static void insertionSort(int[] arr) {
    if (arr == null || arr.length < 2) {
        return;
    }
    // ä»æ•°ç»„ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹ï¼Œå°†å…ƒç´ æ’å…¥åˆ°å‰é¢å·²æ’åºåºåˆ—ä¸­çš„åˆé€‚ä½ç½®
    for (int i = 1; i < arr.length; i++) {
        int j = i;
        // å°†å…ƒç´ ä¸å·²æ’åºåºåˆ—ä¸­çš„å…ƒç´ ä»åå¾€å‰ä¾æ¬¡æ¯”è¾ƒï¼Œæ‰¾åˆ°åˆé€‚çš„ä½ç½®æ’å…¥
        while (j > 0 && arr[j] < arr[j - 1]) {
            int temp = arr[j];
            arr[j] = arr[j - 1];
            arr[j - 1] = temp;
            j--;
        }
    }
}

public static void main(String[] args) {
    int[] arr = {3, 5, 1, 4, 2};
    insertionSort(arr);
    System.out.println(Arrays.toString(arr)); // [1, 2, 3, 4, 5]
}

```

> åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªinsertionSortæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªæ•´å‹æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå®ç°æ’å…¥æ’åºçš„åŠŸèƒ½ã€‚åœ¨æ–¹æ³•ä¸­ï¼Œä½¿ç”¨äº†ä¸¤å±‚å¾ªç¯ï¼Œç¬¬ä¸€å±‚å¾ªç¯æ§åˆ¶æ¯æ¬¡å¾…æ’åºçš„å…ƒç´ ï¼Œç¬¬äºŒå±‚å¾ªç¯æ§åˆ¶å°†è¯¥å…ƒç´ æ’å…¥åˆ°å·²æ’åºçš„æ•°æ®ä¸­çš„æ­£ç¡®ä½ç½®ã€‚æœ€ç»ˆï¼Œæ•´ä¸ªæ•°ç»„å°±å®Œæˆäº†æ’åºã€‚åœ¨mainæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•è¯¥æ’åºç®—æ³•çš„æ­£ç¡®æ€§ã€‚

## å½’å¹¶æ’åº

å½’å¹¶æ’åºï¼ˆMerge Sortï¼‰æ˜¯ä¸€ç§**åˆ†æ²»æ€æƒ³çš„æ’åºç®—æ³•**ï¼Œå®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯å°†å¾…æ’åºæ•°æ®åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«è¿›è¡Œæ’åºï¼Œç„¶åå°†æ’åºåçš„ä¸¤ä¸ªéƒ¨åˆ†åˆå¹¶æˆä¸€ä¸ªæœ‰åºåºåˆ—ã€‚
å½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n log n)ï¼Œå…¶ä¸­nä¸ºå¾…æ’åºæ•°æ®çš„æ•°é‡ï¼Œå®ƒæ˜¯ä¸€ç§**æ¯”è¾ƒé«˜æ•ˆçš„æ’åºç®—æ³•**ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å½’å¹¶æ’åºçš„å®ç°ç¤ºä¾‹ï¼š

```java
public class MergeSortExample {
    // å½’å¹¶æ’åºä¸»æ–¹æ³•
    public static void mergeSort(int[] arr) {
        // å¦‚æœæ•°ç»„ä¸ºç©ºæˆ–åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œä¸éœ€è¦æ’åº
        if (arr == null || arr.length < 2) {
            return;
        }
        mergeSort(arr, 0, arr.length - 1);
    }

    // ä½¿ç”¨é€’å½’è¿›è¡Œå½’å¹¶æ’åº
    private static void mergeSort(int[] arr, int left, int right) {
        // å½“å·¦è¾¹ç•Œå¤§äºç­‰äºå³è¾¹ç•Œæ—¶ï¼Œè¯´æ˜å·²ç»å®Œæˆæ’åº
        if (left >= right) {
            return;
        }
        int mid = (left + right) / 2;
        mergeSort(arr, left, mid);
        mergeSort(arr, mid + 1, right);
        merge(arr, left, mid, right);
    }

    // åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„
    private static void merge(int[] arr, int left, int mid, int right) {
        int[] temp = new int[right - left + 1]; // åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ•°ç»„ç”¨äºå­˜æ”¾åˆå¹¶ç»“æœ
        int i = left;
        int j = mid + 1;
        int k = 0;

        // å°†è¾ƒå°çš„å…ƒç´ ä¾æ¬¡æ”¾å…¥ä¸´æ—¶æ•°ç»„
        while (i <= mid && j <= right) {
            if (arr[i] < arr[j]) {
                temp[k++] = arr[i++];
            } else {
                temp[k++] = arr[j++];
            }
        }

        // å°†å·¦åŠè¾¹å‰©ä½™å…ƒç´ æ”¾å…¥ä¸´æ—¶æ•°ç»„
        while (i <= mid) {
            temp[k++] = arr[i++];
        }

        // å°†å³åŠè¾¹å‰©ä½™å…ƒç´ æ”¾å…¥ä¸´æ—¶æ•°ç»„
        while (j <= right) {
            temp[k++] = arr[j++];
        }

        // å°†ä¸´æ—¶æ•°ç»„ä¸­çš„å…ƒç´ å¤åˆ¶å›åŸæ•°ç»„
        System.arraycopy(temp, 0, arr, left, temp.length);
    }

    // ä¸»å‡½æ•°ï¼Œæµ‹è¯•å½’å¹¶æ’åº
    public static void main(String[] args) {
        int[] arr = {3, 5, 1, 4, 2};
        mergeSort(arr);
        System.out.println(Arrays.toString(arr)); // [1, 2, 3, 4, 5]
    }
}

```

> åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªmergeSortæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªæ•´å‹æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå®ç°å½’å¹¶æ’åºçš„åŠŸèƒ½ã€‚åœ¨æ–¹æ³•ä¸­ï¼Œä½¿ç”¨äº†åˆ†æ²»æ€æƒ³ï¼Œå°†å¾…æ’åºæ•°æ®åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œç„¶åé€’å½’åœ°å¯¹æ¯ä¸ªéƒ¨åˆ†è¿›è¡Œæ’åºï¼Œæœ€ç»ˆå°†æ’åºåçš„ä¸¤ä¸ªéƒ¨åˆ†åˆå¹¶æˆä¸€ä¸ªæœ‰åºåºåˆ—ã€‚åœ¨mergeæ–¹æ³•ä¸­ï¼Œå®ç°äº†å°†ä¸¤ä¸ªå·²æ’åºçš„éƒ¨åˆ†åˆå¹¶çš„é€»è¾‘ã€‚æœ€ç»ˆï¼Œæ•´ä¸ªæ•°ç»„å°±å®Œæˆäº†æ’åºã€‚åœ¨mainæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•è¯¥æ’åºç®—æ³•çš„æ­£ç¡®æ€§ã€‚

### å½’å¹¶æ’åºè¯¦è§£

å½’å¹¶æ’åºï¼ˆMerge Sortï¼‰æ˜¯ä¸€ç§ç»å…¸çš„åˆ†æ²»ç®—æ³•ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†å¤§é—®é¢˜æ‹†åˆ†æˆå°é—®é¢˜è¿›è¡Œè§£å†³ï¼Œç„¶åå†å°†å°é—®é¢˜çš„è§£åˆå¹¶æˆå¤§é—®é¢˜çš„è§£ã€‚å½’å¹¶æ’åºçš„è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼šåˆ†æ²»ï¼ˆDivideï¼‰å’Œåˆå¹¶ï¼ˆMergeï¼‰ã€‚

1. åˆ†æ²»ï¼šå°†ä¸€ä¸ªå¾…æ’åºçš„æ•°ç»„ä¸æ–­åœ°ä¸€åˆ†ä¸ºäºŒï¼Œç›´åˆ°æ¯ä¸ªå­æ•°ç»„åªåŒ…å«ä¸€ä¸ªå…ƒç´ ã€‚è¿™æ ·å°±å°†åŸé—®é¢˜åˆ†è§£æˆäº†å¤šä¸ªè§„æ¨¡æ›´å°çš„å­é—®é¢˜ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªå­æ•°ç»„éƒ½æ˜¯æœ‰åºçš„ï¼Œå› ä¸ºå®ƒä»¬åªæœ‰ä¸€ä¸ªå…ƒç´ ã€‚
2. åˆå¹¶ï¼šå°†ç›¸é‚»çš„æœ‰åºå­æ•°ç»„åˆå¹¶æˆä¸€ä¸ªæœ‰åºæ•°ç»„ã€‚åˆå¹¶è¿‡ç¨‹ä»æœ€å°çš„å­æ•°ç»„å¼€å§‹ï¼Œé€æ­¥å‘ä¸Šåˆå¹¶ï¼Œç›´åˆ°æœ€åå¾—åˆ°ä¸€ä¸ªå®Œå…¨æœ‰åºçš„æ•°ç»„ã€‚
   ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜å½’å¹¶æ’åºçš„è¿‡ç¨‹ï¼š
   **ç»™å®šæ•°ç»„ï¼š[8, 4, 5, 3, 7, 6, 1, 2]**
3. åˆ†æ²»ï¼š

```
åˆ†è§£æ­¥éª¤ï¼š
[8, 4, 5, 3, 7, 6, 1, 2]
[8, 4, 5, 3]   [7, 6, 1, 2]
[8, 4]   [5, 3]   [7, 6]   [1, 2]
[8] [4]   [5] [3]   [7] [6]   [1] [2]
```

2. åˆå¹¶ï¼š

```
[4, 8]   [3, 5]   [6, 7]   [1, 2]
[3, 4, 5, 8]   [1, 2, 6, 7]
[1, 2, 3, 4, 5, 6, 7, 8]
```

é¦–å…ˆï¼Œæ•°ç»„è¢«åˆ†è§£æˆæ›´å°çš„å­æ•°ç»„ï¼Œç›´åˆ°æ¯ä¸ªå­æ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´ ã€‚ç„¶åï¼Œç›¸é‚»çš„å­æ•°ç»„è¢«åˆå¹¶æˆæœ‰åºçš„å­æ•°ç»„ï¼Œè¿™ä¸ªè¿‡ç¨‹åå¤è¿›è¡Œï¼Œç›´åˆ°å¾—åˆ°ä¸€ä¸ªå®Œå…¨æœ‰åºçš„æ•°ç»„ã€‚
ä¸‹é¢æ˜¯ä¸€ä¸ªå½’å¹¶æ’åºçš„æµç¨‹å›¾ï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´ç›´è§‚åœ°ç†è§£ç®—æ³•è¿‡ç¨‹ï¼š
![](readme.assets/1681394778377-a8a6066b-bf25-40e3-9315-0ff7b07e8dd6.jpeg)

## å †æ’åº

å †æ’åºï¼ˆHeap Sortï¼‰æ˜¯ä¸€ç§åŸºäºå †æ•°æ®ç»“æ„çš„æ’åºç®—æ³•ï¼Œå®ƒçš„**åŸºæœ¬æ€æƒ³**æ˜¯å°†å¾…æ’åºæ•°æ®æ„å»ºæˆä¸€ä¸ªå †ï¼Œç„¶åå°†å †çš„æ ¹èŠ‚ç‚¹ï¼ˆæœ€å¤§æˆ–æœ€å°å…ƒç´ ï¼‰äº¤æ¢åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œå¹¶å°†å †çš„å¤§å°å‡å°1ï¼Œç„¶åé‡æ–°æ„å»ºå †ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½å·²æ’åºå®Œæˆã€‚
å †æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n log n)ï¼Œå…¶ä¸­nä¸ºå¾…æ’åºæ•°æ®çš„æ•°é‡ï¼Œå®ƒæ˜¯ä¸€ç§**æ¯”è¾ƒé«˜æ•ˆ**çš„æ’åºç®—æ³•ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å †æ’åºçš„å®ç°ç¤ºä¾‹ï¼š

```java
public class HeapSortExample {
    public static void heapSort(int[] arr) {
        if (arr == null || arr.length < 2) {
            return;
        }
        int n = arr.length;
        for (int i = n / 2 - 1; i >= 0; i--) {
            heapify(arr, n, i);
        }
        for (int i = n - 1; i > 0; i--) {
            int temp = arr[0];
            arr[0] = arr[i];
            arr[i] = temp;
            heapify(arr, i, 0);
        }
    }

    private static void heapify(int[] arr, int n, int i) {
        int largest = i;
        int left = 2 * i + 1;
        int right = 2 * i + 2;
        if (left < n && arr[left] > arr[largest]) {
            largest = left;
        }
        if (right < n && arr[right] > arr[largest]) {
            largest = right;
        }
        if (largest != i) {
            int temp = arr[i];
            arr[i] = arr[largest];
            arr[largest] = temp;
            heapify(arr, n, largest);
        }
    }

    public static void main(String[] args) {
        int[] arr = {3, 5, 1, 4, 2};
        heapSort(arr);
        System.out.println(Arrays.toString(arr)); // [1, 2, 3, 4, 5]
    }
}

```

> åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªheapSortæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªæ•´å‹æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå®ç°å †æ’åºçš„åŠŸèƒ½ã€‚åœ¨æ–¹æ³•ä¸­ï¼Œä½¿ç”¨äº†å †æ•°æ®ç»“æ„ï¼Œé¦–å…ˆå°†å¾…æ’åºæ•°æ®æ„å»ºæˆä¸€ä¸ªå †ï¼Œç„¶åå°†å †çš„æ ¹èŠ‚ç‚¹ï¼ˆæœ€å¤§æˆ–æœ€å°å…ƒç´ ï¼‰äº¤æ¢åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œå¹¶å°†å †çš„å¤§å°å‡å°1ï¼Œç„¶åé‡æ–°æ„å»ºå †ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½å·²æ’åºå®Œæˆã€‚åœ¨heapifyæ–¹æ³•ä¸­ï¼Œå®ç°äº†å°†å †é‡æ–°æ„å»ºçš„é€»è¾‘ã€‚æœ€ç»ˆï¼Œæ•´ä¸ªæ•°ç»„å°±å®Œæˆäº†æ’åºã€‚åœ¨mainæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•è¯¥æ’åºç®—æ³•çš„æ­£ç¡®æ€§ã€‚

## åŸºæ•°æ’åº

åŸºæ•°æ’åºï¼ˆRadix Sortï¼‰æ˜¯ä¸€ç§éæ¯”è¾ƒæ’åºç®—æ³•ï¼Œå®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯å°†å¾…æ’åºæ•°æ®æŒ‰ç…§æ¯ä¸€ä½çš„å¤§å°è¿›è¡Œæ’åºï¼Œä»ä½ä½åˆ°é«˜ä½ï¼Œæœ€ç»ˆå®Œæˆæ’åºã€‚

åŸºæ•°æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(k * n)ï¼Œå…¶ä¸­nä¸ºå¾…æ’åºæ•°æ®çš„æ•°é‡ï¼Œkä¸ºæœ€å¤§çš„æ•°å­—ä½æ•°ï¼Œå› æ­¤å¯¹äºæ•°å­—è¾ƒå¤§çš„æ•°æ®æ’åºæ—¶ï¼Œæ•ˆç‡ä¼šå—åˆ°å½±å“ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„åŸºæ•°æ’åºçš„å®ç°ç¤ºä¾‹ï¼š

```java
public class RadixSortExample {
    // åŸºæ•°æ’åºä¸»æ–¹æ³•
    public static void radixSort(int[] arr) {
        if (arr == null || arr.length < 2) {
            return;
        }
        // è·å–æ•°ç»„ä¸­çš„æœ€å¤§å€¼
        int max = getMax(arr);

        // ä»ä¸ªä½å¼€å§‹ï¼Œå¯¹æ¯ä¸€ä½è¿›è¡Œè®¡æ•°æ’åº
        for (int exp = 1; max / exp > 0; exp *= 10) {
            countSort(arr, exp);
        }
    }

    // è·å–æ•°ç»„ä¸­çš„æœ€å¤§å€¼
    private static int getMax(int[] arr) {
        int max = arr[0];
        for (int i = 1; i < arr.length; i++) {
            if (arr[i] > max) {
                max = arr[i];
            }
        }
        return max;
    }

    // å¯¹æŒ‡å®šä½æ•°çš„å…ƒç´ è¿›è¡Œè®¡æ•°æ’åº
    private static void countSort(int[] arr, int exp) {
        int[] count = new int[10]; // è®¡æ•°æ•°ç»„ï¼Œå­˜æ”¾æ¯ä¸ªä½æ•°ä¸Š 0-9 çš„è®¡æ•°
        int[] output = new int[arr.length]; // è¾“å‡ºæ•°ç»„ï¼Œå­˜æ”¾æ’åºåçš„ç»“æœ

        // è®¡ç®—æ¯ä¸ªä½æ•°ä¸Š 0-9 çš„è®¡æ•°
        for (int i = 0; i < arr.length; i++) {
            count[(arr[i] / exp) % 10]++;
        }

        // å¯¹è®¡æ•°æ•°ç»„è¿›è¡Œç´¯åŠ ï¼Œå¾—åˆ°æ¯ä¸ªå…ƒç´ åœ¨è¾“å‡ºæ•°ç»„ä¸­çš„ç»“æŸä½ç½®
        for (int i = 1; i < 10; i++) {
            count[i] += count[i - 1];
        }

        // æŒ‰ç…§è®¡æ•°æ•°ç»„ä¸­çš„ä½ç½®ä¿¡æ¯å°†åŸæ•°ç»„å…ƒç´ æ”¾å…¥è¾“å‡ºæ•°ç»„ï¼Œä¿è¯æ’åºçš„ç¨³å®šæ€§
        for (int i = arr.length - 1; i >= 0; i--) {
            output[count[(arr[i] / exp) % 10] - 1] = arr[i];
            count[(arr[i] / exp) % 10]--;
        }

        // å°†è¾“å‡ºæ•°ç»„å¤åˆ¶å›åŸæ•°ç»„
        for (int i = 0; i < arr.length; i++) {
            arr[i] = output[i];
        }
    }

    // ä¸»å‡½æ•°ï¼Œæµ‹è¯•åŸºæ•°æ’åº
    public static void main(String[] args) {
        int[] arr = {3, 5, 1, 4, 2};
        radixSort(arr);
        System.out.println(Arrays.toString(arr)); // [1, 2, 3, 4, 5]
    }
}

```

> åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªradixSortæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªæ•´å‹æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå®ç°åŸºæ•°æ’åºçš„åŠŸèƒ½ã€‚åœ¨æ–¹æ³•ä¸­ï¼Œä½¿ç”¨äº†è®¡æ•°æ’åºï¼ˆCounting Sortï¼‰ï¼Œå°†å¾…æ’åºæ•°æ®æŒ‰ç…§æ¯ä¸€ä½çš„å¤§å°è¿›è¡Œæ’åºï¼Œä»ä½ä½åˆ°é«˜ä½ï¼Œæœ€ç»ˆå®Œæˆæ’åºã€‚åœ¨countSortæ–¹æ³•ä¸­ï¼Œå®ç°äº†è®¡æ•°æ’åºçš„é€»è¾‘ã€‚æœ€ç»ˆï¼Œæ•´ä¸ªæ•°ç»„å°±å®Œæˆäº†æ’åºã€‚åœ¨mainæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•è¯¥æ’åºç®—æ³•çš„æ­£ç¡®æ€§ã€‚

# å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼

## Springä¸­ä½¿ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼

Springæ¡†æ¶ä¸­ä½¿ç”¨äº†å¾ˆå¤šè®¾è®¡æ¨¡å¼ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼š

1. å•ä¾‹æ¨¡å¼ï¼šSpringæ¡†æ¶ä¸­çš„Beané»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®æˆéå•ä¾‹çš„ã€‚ä½¿ç”¨å•ä¾‹æ¨¡å¼å¯ä»¥ä¿è¯å…¨å±€åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼ŒèŠ‚çº¦ç³»ç»Ÿèµ„æºã€‚
2. å·¥å‚æ¨¡å¼ï¼šSpringæ¡†æ¶ä¸­çš„BeanFactoryå°±æ˜¯ä¸€ç§å·¥å‚æ¨¡å¼ï¼Œå®ƒå¯ä»¥æ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯åŠ¨æ€åˆ›å»ºå¯¹è±¡ã€‚
3. ä»£ç†æ¨¡å¼ï¼šSpringæ¡†æ¶ä¸­ä½¿ç”¨äº†ä»£ç†æ¨¡å¼æ¥å®ç°AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰ï¼Œé€šè¿‡ä»£ç†å¯¹è±¡å®ç°å¯¹åŸæœ‰å¯¹è±¡çš„å¢å¼ºã€‚
4. è§‚å¯Ÿè€…æ¨¡å¼ï¼šSpringæ¡†æ¶ä¸­çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹å°±æ˜¯ä¸€ç§è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡è§‚å¯Ÿè€…æ¨¡å¼å®ç°Beanä¹‹é—´çš„è§£è€¦ã€‚
5. æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼šSpringæ¡†æ¶ä¸­çš„JdbcTemplateå°±æ˜¯ä¸€ç§æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥è®¿é—®æ•°æ®åº“ï¼Œè€Œä¸”å¯ä»¥é¿å…ä¸€äº›å¸¸è§çš„é”™è¯¯ã€‚
6. é€‚é…å™¨æ¨¡å¼ï¼šSpringæ¡†æ¶ä¸­çš„é€‚é…å™¨æ¨¡å¼ä¸»è¦æ˜¯ç”¨åœ¨Spring MVCä¸­çš„æ§åˆ¶å™¨å¤„ç†å™¨é€‚é…å™¨ï¼Œå°†ä¸åŒçš„è¯·æ±‚è½¬åŒ–ä¸ºç»Ÿä¸€çš„å¤„ç†æ–¹æ³•ï¼Œä»è€Œå®ç°ç»Ÿä¸€çš„è¯·æ±‚å¤„ç†æµç¨‹ã€‚
7. ç­–ç•¥æ¨¡å¼ï¼šSpringæ¡†æ¶ä¸­çš„BeanPostProcessorå°±æ˜¯ä¸€ç§ç­–ç•¥æ¨¡å¼ï¼Œå¯ä»¥åœ¨Beanåˆå§‹åŒ–å‰åè¿›è¡Œå¤„ç†ï¼Œæä¾›äº†ä¸€ç§çµæ´»çš„æ‰©å±•æœºåˆ¶ã€‚
   é™¤æ­¤ä¹‹å¤–ï¼ŒSpringæ¡†æ¶è¿˜ä½¿ç”¨äº†å¾ˆå¤šå…¶ä»–çš„è®¾è®¡æ¨¡å¼ï¼Œå¦‚å»ºé€ è€…æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ã€è¿­ä»£å™¨æ¨¡å¼ã€äº«å…ƒæ¨¡å¼ç­‰ç­‰ã€‚è¿™äº›è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨ï¼Œä½¿å¾—Springæ¡†æ¶å…·æœ‰äº†è‰¯å¥½çš„å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼Œä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥æ›´åŠ æ–¹ä¾¿åœ°å¼€å‘å’Œç»´æŠ¤åº”ç”¨ç¨‹åºã€‚

## å•ä¾‹æ¨¡å¼

å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªå…¨å±€çš„è®¿é—®ç‚¹ã€‚åœ¨Javaä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥å®ç°å•ä¾‹æ¨¡å¼ï¼š

1. é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼

```java
public class Singleton {
    private static Singleton instance = new Singleton();
    private Singleton() {}
    public static Singleton getInstance() {
        return instance;
    }
}
```

> åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒSingletonç±»åªæœ‰ä¸€ä¸ªç§æœ‰çš„æ„é€ æ–¹æ³•ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªé™æ€å˜é‡instanceæ¥ä¿å­˜å”¯ä¸€çš„å®ä¾‹ã€‚åœ¨getInstanceæ–¹æ³•ä¸­ï¼Œè¿”å›è¯¥å®ä¾‹ã€‚ç”±äºè¯¥å®ä¾‹æ˜¯åœ¨ç±»åŠ è½½æ—¶å°±åˆ›å»ºçš„ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºé¥¿æ±‰å¼å•ä¾‹æ¨¡å¼ã€‚

2. æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼

```java
public class Singleton {
    private static Singleton instance;
    private Singleton() {}
    public static synchronized Singleton getInstance() {
        if (instance == null) {
            instance = new Singleton();
        }
        return instance;
    }
}
```

> åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨ä¸€ä¸ªé™æ€å˜é‡instanceæ¥ä¿å­˜å”¯ä¸€çš„å®ä¾‹ï¼Œä½†æ˜¯è¯¥å®ä¾‹æ˜¯åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨getInstanceæ–¹æ³•æ—¶æ‰ä¼šåˆ›å»ºã€‚ç”±äºè¯¥å®ä¾‹æ˜¯åœ¨éœ€è¦æ—¶æ‰åˆ›å»ºçš„ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºæ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œéœ€è¦å¯¹getInstanceæ–¹æ³•è¿›è¡ŒåŒæ­¥ï¼Œä»¥é¿å…åˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚


3. åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡å¼

```java
public class Singleton {
    // ä½¿ç”¨ volatile å…³é”®å­—ä¿®é¥°çš„ Singleton å®ä¾‹ï¼Œç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å¯è§æ€§
    private static volatile Singleton instance;

    // ç§æœ‰çš„æ„é€ æ–¹æ³•ï¼Œé˜²æ­¢å¤–éƒ¨å®ä¾‹åŒ–
    private Singleton() {}

    // è·å– Singleton å®ä¾‹çš„æ–¹æ³•
    public static Singleton getInstance() {
        // åŒé‡æ£€æŸ¥é”å®šï¼ˆDouble-Checked Lockingï¼‰ï¼Œç¬¬ä¸€æ¬¡æ£€æŸ¥ instance æ˜¯å¦ä¸º null
        if (instance == null) {
            // åŒæ­¥é”å®š Singleton ç±»
            synchronized (Singleton.class) {
                // ç¬¬äºŒæ¬¡æ£€æŸ¥ instance æ˜¯å¦ä¸º null
                if (instance == null) {
                    // åˆ›å»º Singleton å®ä¾‹
                    instance = new Singleton();
                }
            }
        }
        // è¿”å› Singleton å®ä¾‹
        return instance;
    }
}

```

> **å…³äº volatile å…³é”®å­—çš„è§£é‡Šï¼š**
> volatile æ˜¯ä¸€ä¸ª Java å…³é”®å­—ï¼Œç”¨äºä¿®é¥°å˜é‡ã€‚åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå®ƒå¯ä»¥ç¡®ä¿è¢« volatile ä¿®é¥°çš„å˜é‡åœ¨æ‰€æœ‰çº¿ç¨‹ä¸­æ˜¯å¯è§çš„ï¼Œå³æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥çœ‹åˆ°å…±äº«å†…å­˜ä¸­çš„æœ€æ–°å€¼ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢æŒ‡ä»¤é‡æ’åºå¯¼è‡´çš„é—®é¢˜ï¼Œä½¿å¾—åŒé‡æ£€æŸ¥é”å®šæœºåˆ¶èƒ½å¤Ÿæ­£ç¡®å·¥ä½œã€‚
> **ä¸ºä»€ä¹ˆé”æ²¡æœ‰æ”¾ç½®åœ¨ public static Singleton getInstance() æ–¹æ³•ä¸Šï¼š**
> å°†é”ç›´æ¥æ”¾ç½®åœ¨ getInstance() æ–¹æ³•ä¸Šä¼šå¯¼è‡´æ¯æ¬¡è°ƒç”¨è¯¥æ–¹æ³•æ—¶éƒ½éœ€è¦è·å–é”ã€‚åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œè¿™ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºæ¯æ¬¡è®¿é—®éƒ½éœ€è¦è·å–é”ï¼Œè¿™å°†é™ä½ç¨‹åºæ‰§è¡Œæ•ˆç‡ã€‚è€ŒåŒé‡æ£€æŸ¥é”å®šæœºåˆ¶å¯ä»¥ç¡®ä¿åªæœ‰åœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºå®ä¾‹æ—¶æ‰éœ€è¦è·å–é”ï¼Œåç»­è®¿é—®æ—¶ä¸éœ€è¦è·å–é”ï¼Œä»è€Œ**æé«˜äº†ç¨‹åºæ‰§è¡Œæ•ˆç‡**ã€‚
> åŒé‡æ£€æŸ¥é”å®šï¼ˆDouble-Checked Lockingï¼‰çš„**ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å‡å°‘åŒæ­¥å¼€é”€**ï¼Œä½¿å¾—åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹èƒ½å¤Ÿé«˜æ•ˆåœ°è®¿é—® Singleton å®ä¾‹ã€‚åœ¨è¿™ç§æœºåˆ¶ä¸‹ï¼Œåªæœ‰å½“å®ä¾‹å°šæœªåˆ›å»ºæ—¶æ‰éœ€è¦åŒæ­¥ï¼Œè¿™æ ·å¯ä»¥**é¿å…æ¯æ¬¡è·å–å®ä¾‹æ—¶éƒ½éœ€è¦åŒæ­¥**ã€‚

## å·¥å‚æ¨¡å¼

å·¥å‚æ¨¡å¼æ˜¯ä¸€ç§å¸¸ç”¨çš„åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥å°†å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹æŠ½è±¡å‡ºæ¥ï¼Œä»è€Œä½¿å¾—å®¢æˆ·ç«¯æ— éœ€å…³å¿ƒå¯¹è±¡çš„å…·ä½“å®ç°ã€‚
åœ¨Javaä¸­ï¼Œå·¥å‚æ¨¡å¼é€šå¸¸æœ‰ä¸‰ç§å®ç°æ–¹å¼ï¼šç®€å•å·¥å‚æ¨¡å¼ã€å·¥å‚æ–¹æ³•æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼ã€‚
ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•å·¥å‚æ¨¡å¼çš„ç¤ºä¾‹ä»£ç ï¼š

```java
// å®šä¹‰ä¸€ä¸ªæŠ½è±¡äº§å“æ¥å£
interface Product {
    void operation();
}

// å®šä¹‰å…·ä½“äº§å“ç±»
class ConcreteProductA implements Product {
    @Override
    public void operation() {
        System.out.println("ConcreteProductA.operation()");
    }
}

// å®šä¹‰å…·ä½“äº§å“ç±»
class ConcreteProductB implements Product {
    @Override
    public void operation() {
        System.out.println("ConcreteProductB.operation()");
    }
}

// å®šä¹‰å·¥å‚ç±»
class Factory {
    public static Product createProduct(String type) {
        if (type.equals("A")) {
            return new ConcreteProductA();
        } else if (type.equals("B")) {
            return new ConcreteProductB();
        } else {
            return null;
        }
    }
}

// æµ‹è¯•ä»£ç 
public class Main {
    public static void main(String[] args) {
        // åˆ›å»ºäº§å“A
        Product productA = Factory.createProduct("A");
        productA.operation();

        // åˆ›å»ºäº§å“B
        Product productB = Factory.createProduct("B");
        productB.operation();
    }
}

```

> åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡äº§å“æ¥å£Productï¼Œä»¥åŠä¸¤ä¸ªå…·ä½“äº§å“ç±»ConcreteProductAå’ŒConcreteProductBã€‚åœ¨Factoryå·¥å‚ç±»ä¸­ï¼Œæä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³•createProductï¼Œè¯¥æ–¹æ³•æ ¹æ®ä¼ å…¥çš„å‚æ•°typeæ¥åˆ›å»ºä¸åŒçš„äº§å“å®ä¾‹ã€‚åœ¨æµ‹è¯•ä»£ç ä¸­ï¼Œé€šè¿‡è°ƒç”¨å·¥å‚ç±»çš„createProductæ–¹æ³•æ¥åˆ›å»ºäº§å“å®ä¾‹ï¼Œå¹¶è°ƒç”¨äº§å“çš„operationæ–¹æ³•ã€‚

å·¥å‚æ¨¡å¼çš„**ä¼˜ç‚¹åœ¨äºå¯ä»¥å°†å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹å°è£…èµ·æ¥ï¼Œä»è€Œä½¿å¾—å®¢æˆ·ç«¯æ— éœ€å…³å¿ƒå¯¹è±¡çš„å…·ä½“å®ç°**ã€‚åŒæ—¶ï¼Œç”±äºå·¥å‚ç±»æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç±»ï¼Œå› æ­¤å¯ä»¥æ›´å¥½åœ°å®ç°ä»£ç çš„é‡ç”¨å’Œç»´æŠ¤ã€‚
å¸¸è§çš„å·¥å‚æ¨¡å¼è¿˜åŒ…æ‹¬å·¥å‚æ–¹æ³•æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼æ˜¯å°†å·¥å‚ç±»æŠ½è±¡å‡ºæ¥ï¼Œä½¿å¾—ä¸åŒçš„äº§å“ç±»æœ‰ä¸åŒçš„å·¥å‚ç±»æ¥åˆ›å»ºï¼Œä»è€Œæ›´å¥½åœ°å®ç°ä»£ç çš„æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯å°†å·¥å‚ç±»æŠ½è±¡å‡ºæ¥ï¼Œä½¿å¾—ä¸åŒçš„äº§å“æ—æœ‰ä¸åŒçš„å·¥å‚ç±»æ¥åˆ›å»ºï¼Œä»è€Œæ›´å¥½åœ°å®ç°ä»£ç çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## æŠ½è±¡å·¥å‚

æŠ½è±¡å·¥å‚æ˜¯ä¸€ç§å¸¸ç”¨çš„åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥å°†ä¸€ç»„ç›¸å…³çš„äº§å“æ—è¿›è¡ŒæŠ½è±¡å’Œå°è£…ï¼Œä½¿å¾—å®¢æˆ·ç«¯æ— éœ€å…³å¿ƒå¯¹è±¡çš„å…·ä½“å®ç°ï¼Œä»è€Œæé«˜ä»£ç çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚
ä¸‹é¢æ˜¯ä¸€ä¸ªæŠ½è±¡å·¥å‚æ¨¡å¼çš„ç¤ºä¾‹ä»£ç ï¼š

```java
// å®šä¹‰ä¸€ä¸ªæŠ½è±¡äº§å“æ¥å£
interface ProductA {
    void operationA();
}

// å®šä¹‰å…·ä½“äº§å“ç±»
class ConcreteProductA1 implements ProductA {
    @Override
    public void operationA() {
        System.out.println("ConcreteProductA1.operationA()");
    }
}

// å®šä¹‰å…·ä½“äº§å“ç±»
class ConcreteProductA2 implements ProductA {
    @Override
    public void operationA() {
        System.out.println("ConcreteProductA2.operationA()");
    }
}

// å®šä¹‰ä¸€ä¸ªæŠ½è±¡äº§å“æ¥å£
interface ProductB {
    void operationB();
}

// å®šä¹‰å…·ä½“äº§å“ç±»
class ConcreteProductB1 implements ProductB {
    @Override
    public void operationB() {
        System.out.println("ConcreteProductB1.operationB()");
    }
}

// å®šä¹‰å…·ä½“äº§å“ç±»
class ConcreteProductB2 implements ProductB {
    @Override
    public void operationB() {
        System.out.println("ConcreteProductB2.operationB()");
    }
}

// å®šä¹‰æŠ½è±¡å·¥å‚æ¥å£
interface AbstractFactory {
    ProductA createProductA();
    ProductB createProductB();
}

// å®šä¹‰å…·ä½“å·¥å‚ç±»
class ConcreteFactory1 implements AbstractFactory {
    @Override
    public ProductA createProductA() {
        return new ConcreteProductA1();
    }

    @Override
    public ProductB createProductB() {
        return new ConcreteProductB1();
    }
}

// å®šä¹‰å…·ä½“å·¥å‚ç±»
class ConcreteFactory2 implements AbstractFactory {
    @Override
    public ProductA createProductA() {
        return new ConcreteProductA2();
    }

    @Override
    public ProductB createProductB() {
        return new ConcreteProductB2();
    }
}

// æµ‹è¯•ä»£ç 
public class Main {
    public static void main(String[] args) {
        // åˆ›å»ºå·¥å‚1
        AbstractFactory factory1 = new ConcreteFactory1();
        ProductA productA1 = factory1.createProductA();
        productA1.operationA();
        ProductB productB1 = factory1.createProductB();
        productB1.operationB();

        // åˆ›å»ºå·¥å‚2
        AbstractFactory factory2 = new ConcreteFactory2();
        ProductA productA2 = factory2.createProductA();
        productA2.operationA();
        ProductB productB2 = factory2.createProductB();
        productB2.operationB();
    }
}

```

> åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå®šä¹‰äº†ä¸¤ä¸ªæŠ½è±¡äº§å“æ¥å£ProductAå’ŒProductBï¼Œä»¥åŠå››ä¸ªå…·ä½“äº§å“ç±»ConcreteProductA1ã€ConcreteProductA2ã€ConcreteProductB1å’ŒConcreteProductB2ã€‚åœ¨AbstractFactoryæŠ½è±¡å·¥å‚æ¥å£ä¸­ï¼Œå®šä¹‰äº†åˆ›å»ºä¸åŒäº§å“æ—çš„æ–¹æ³•createProductAå’ŒcreateProductBã€‚åœ¨å…·ä½“å·¥å‚ç±»ConcreteFactory1å’ŒConcreteFactory2ä¸­ï¼Œå®ç°äº†æŠ½è±¡å·¥å‚æ¥å£ä¸­çš„æ–¹æ³•ï¼Œåˆ†åˆ«åˆ›å»ºä¸åŒçš„äº§å“æ—ã€‚åœ¨æµ‹è¯•ä»£ç ä¸­ï¼Œé€šè¿‡åˆ›å»ºä¸åŒçš„å·¥å‚ç±»æ¥åˆ›å»ºä¸åŒçš„äº§å“å®ä¾‹ï¼Œå¹¶è°ƒç”¨äº§å“çš„operationã€‚

## åŸå‹æ¨¡å¼

åŸå‹æ¨¡å¼ï¼ˆPrototype Patternï¼‰æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥ç”¨æ¥åˆ›å»ºå¯¹è±¡çš„å…‹éš†ï¼Œè€Œæ— éœ€é€šè¿‡newæ“ä½œç¬¦æ˜¾å¼åœ°è°ƒç”¨æ„é€ å‡½æ•°æ¥åˆ›å»ºå¯¹è±¡ã€‚åœ¨åŸå‹æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªåŸå‹å¯¹è±¡ï¼Œç„¶åé€šè¿‡å…‹éš†è¯¥åŸå‹å¯¹è±¡æ¥åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚è¿™ç§æ–¹å¼å¯ä»¥**æœ‰æ•ˆåœ°é™ä½å¯¹è±¡çš„åˆ›å»ºæˆæœ¬ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚**
ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Javaä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨åŸå‹æ¨¡å¼åˆ›å»ºå¯¹è±¡çš„å…‹éš†ï¼š

```java
// å®šä¹‰ä¸€ä¸ªåŸå‹æ¥å£
interface Prototype {
    public Prototype clone();  // å…‹éš†æ–¹æ³•
}

// å®ç°ä¸€ä¸ªå…·ä½“çš„åŸå‹ç±»
class ConcretePrototype implements Prototype {
    private String name;  // å¯¹è±¡åç§°

    public ConcretePrototype(String name) {
        this.name = name;
    }

    // å®ç°å…‹éš†æ–¹æ³•
    public Prototype clone() {
        return new ConcretePrototype(name);
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class Client {
    public static void main(String[] args) {
        ConcretePrototype prototype = new ConcretePrototype("Prototype 1");  // åˆ›å»ºåŸå‹å¯¹è±¡
        ConcretePrototype clone1 = (ConcretePrototype)prototype.clone();  // å…‹éš†åŸå‹å¯¹è±¡
        System.out.println("Clone 1 name: " + clone1.getName());  // è¾“å‡ºå…‹éš†å¯¹è±¡çš„åç§°

        ConcretePrototype clone2 = (ConcretePrototype)prototype.clone();  // å†æ¬¡å…‹éš†åŸå‹å¯¹è±¡
        clone2.setName("Prototype 2");  // ä¿®æ”¹å…‹éš†å¯¹è±¡çš„åç§°
        System.out.println("Clone 2 name: " + clone2.getName());  // è¾“å‡ºå…‹éš†å¯¹è±¡çš„åç§°
        System.out.println(prototype.equals(clone1));  //false
        System.out.println(clone1.equals(clone2));  //false
    }
}

```

> åŸå‹æ¨¡å¼å¯ä»¥å¸®åŠ©æˆ‘ä»¬é€šè¿‡å¤åˆ¶å·²æœ‰å¯¹è±¡æ¥åˆ›å»ºæ–°å¯¹è±¡ï¼Œä»è€Œå‡å°‘å¯¹è±¡çš„åˆ›å»ºæˆæœ¬ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚åŒæ—¶ï¼ŒåŸå‹æ¨¡å¼ä¹Ÿå¯ä»¥é¿å…ç”±äºnewæ“ä½œç¬¦è€Œå¼•å…¥çš„ä¸å¿…è¦çš„å¤æ‚æ€§å’Œé”™è¯¯ã€‚

## è§‚å¯Ÿè€…æ¨¡å¼

è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä¹Ÿå«åš**å‘å¸ƒ-è®¢é˜…ï¼ˆPublish-Subscribeï¼‰æ¨¡å¼**ã€‚å®ƒå®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬ä¸€ä¸ªä¸»é¢˜å¯¹è±¡ï¼Œå½“ä¸»é¢˜å¯¹è±¡çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„è§‚å¯Ÿè€…å¯¹è±¡éƒ½ä¼šå¾—åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Javaç¤ºä¾‹ï¼Œå®ç°äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼š

```java
package org.æ¶‰åŠæ¨¡å¼;

import java.util.ArrayList;
import java.util.List;

// ä¸»é¢˜æ¥å£ï¼Œå®šä¹‰äº†æ³¨å†Œã€ç§»é™¤å’Œé€šçŸ¥è§‚å¯Ÿè€…çš„æ–¹æ³•
interface Subject {
    void registerObserver(Observer observer);

    void removeObserver(Observer observer);

    void notifyObservers();
}

// å…·ä½“ä¸»é¢˜ç±»ï¼Œå®ç°äº†ä¸»é¢˜æ¥å£
class ConcreteSubject implements Subject {
    private List<Observer> observers = new ArrayList<>();
    private int state;

    public void setState(int state) {
        this.state = state;
        notifyObservers();
    }

    public int getState() {
        return state;
    }

    public void registerObserver(Observer observer) {
        observers.add(observer);
    }

    public void removeObserver(Observer observer) {
        observers.remove(observer);
    }

    public void notifyObservers() {
        for (Observer observer : observers) {
            observer.update();
        }
    }
}

// è§‚å¯Ÿè€…æ¥å£ï¼Œå®šä¹‰äº†æ›´æ–°æ–¹æ³•
interface Observer {
    void update();
}

// å…·ä½“è§‚å¯Ÿè€…ç±»ï¼Œå®ç°äº†è§‚å¯Ÿè€…æ¥å£
class ConcreteObserver implements Observer {
    private int state;
    private ConcreteSubject subject;

    public ConcreteObserver(ConcreteSubject subject) {
        this.subject = subject;
        subject.registerObserver(this);
    }

    public void update() {
        state = subject.getState();
        System.out.println("Observer update, state = " + state);
    }
}

// æµ‹è¯•ç±»
public class ObserverPatternDemo {
    public static void main(String[] args) {
        ConcreteSubject subject = new ConcreteSubject();
        ConcreteObserver observer1 = new ConcreteObserver(subject);
        ConcreteObserver observer2 = new ConcreteObserver(subject);

        subject.setState(1);// Observer update, state = 1 Observer update, state = 1
        subject.setState(2); //Observer update, state = 2 Observer update, state = 2

        subject.removeObserver(observer1);

        subject.setState(3);  // Observer update, state = 3
    }
}

```

> åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªä¸»é¢˜æ¥å£Subjectï¼Œå…¶ä¸­åŒ…å«äº†æ³¨å†Œã€ç§»é™¤å’Œé€šçŸ¥è§‚å¯Ÿè€…çš„æ–¹æ³•ã€‚å…·ä½“ä¸»é¢˜ç±»ConcreteSubjectå®ç°äº†ä¸»é¢˜æ¥å£ï¼Œå¹¶ç»´æŠ¤äº†ä¸€ä¸ªè§‚å¯Ÿè€…åˆ—è¡¨ï¼Œå½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…æ›´æ–°ã€‚

**å¸¸ç”¨çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ï¼š**
å¯¹è±¡é—´å­˜åœ¨ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€æ”¹å˜ä¼šå½±å“å…¶å®ƒå¤šä¸ªå¯¹è±¡ã€‚
åœ¨ç°æœ‰çš„å¼€æºæ¡†æ¶Springä¸­ï¼Œè§‚å¯Ÿè€…æ¨¡å¼ä¹Ÿè¢«å¹¿æ³›åº”ç”¨ã€‚ä¾‹å¦‚ï¼ŒSpringæ¡†æ¶ä¸­çš„äº‹ä»¶æœºåˆ¶å°±æ˜¯ä¸€ç§è§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°ã€‚
Springæ¡†æ¶ä¸­çš„äº‹ä»¶æœºåˆ¶åŒ…æ‹¬ä¸‰ä¸ªè§’è‰²ï¼š**äº‹ä»¶ï¼ˆEventï¼‰ã€äº‹ä»¶å‘å¸ƒè€…ï¼ˆPublisherï¼‰å’Œäº‹ä»¶ç›‘å¬è€…ï¼ˆListenerï¼‰**ã€‚äº‹ä»¶æ˜¯ä¸€ä¸ªæ™®é€šçš„POJOå¯¹è±¡ï¼Œå®ƒåŒ…å«äº†äº‹ä»¶ç›¸å…³çš„ä¿¡æ¯ã€‚äº‹ä»¶å‘å¸ƒè€…æ˜¯ä¸€ä¸ªç±»ï¼Œå®ƒè´Ÿè´£åˆ›å»ºäº‹ä»¶å¯¹è±¡ï¼Œå¹¶å°†äº‹ä»¶å‘å¸ƒç»™å¯¹åº”çš„äº‹ä»¶ç›‘å¬è€…ã€‚äº‹ä»¶ç›‘å¬è€…æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒå®šä¹‰äº†äº‹ä»¶å¤„ç†æ–¹æ³•ã€‚

**ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Javaç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å¦‚ä½•åœ¨Springæ¡†æ¶ä¸­ä½¿ç”¨äº‹ä»¶æœºåˆ¶ï¼š**

```java
import org.springframework.context.ApplicationEvent;
import org.springframework.context.ApplicationListener;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.event.EventListener;
import org.springframework.context.event.EventListenerFactory;
import org.springframework.context.event.SimpleApplicationEventMulticaster;

// è‡ªå®šä¹‰äº‹ä»¶ç±»
class MyEvent extends ApplicationEvent {
    private String message;

    public MyEvent(Object source, String message) {
        super(source);
        this.message = message;
    }

    public String getMessage() {
        return message;
    }
}

// äº‹ä»¶ç›‘å¬å™¨æ¥å£
interface MyEventListener extends ApplicationListener<MyEvent> {
}

// äº‹ä»¶ç›‘å¬å™¨å®ç°ç±»
class MyEventListenerImpl implements MyEventListener {
    public void onApplicationEvent(MyEvent event) {
        System.out.println("MyEventListenerImpl: " + event.getMessage());
    }
}

// é…ç½®ç±»ï¼Œç”¨äºæ³¨å†Œäº‹ä»¶ç›‘å¬å™¨
@Configuration
class AppConfig {
    @Bean
    public MyEventListener myEventListener() {
        return new MyEventListenerImpl();
    }
}

// æµ‹è¯•ç±»
public class ObserverPatternDemo {
    public static void main(String[] args) {
        AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(AppConfig.class);
        context.publishEvent(new MyEvent(new ObserverPatternDemo(), "Hello, world!")); //MyEventListenerImpl: Hello, world!
    }
}

```

åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ç±»**MyEvent**ï¼Œå®ƒç»§æ‰¿è‡ªSpringæ¡†æ¶çš„**ApplicationEvent**ç±»ã€‚æˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨æ¥å£**MyEventListener**å’Œä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨å®ç°ç±»**MyEventListenerImpl**ï¼Œåœ¨**MyEventListenerImpl**ä¸­å®ç°äº†äº‹ä»¶å¤„ç†æ–¹æ³•**onApplicationEvent**ã€‚
åœ¨é…ç½®ç±»**AppConfig**ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨**@Bean**æ³¨è§£æ³¨å†Œäº†äº‹ä»¶ç›‘å¬å™¨**MyEventListenerImpl**ã€‚
åœ¨æµ‹è¯•ç±»**ObserverPatternDemo**ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª**AnnotationConfigApplicationContext**å¯¹è±¡ï¼Œå¹¶æŒ‡å®šäº†é…ç½®ç±»**AppConfig**ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨**context.publishEvent()**æ–¹æ³•å‘å¸ƒä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶å¯¹è±¡**MyEvent**ï¼Œæœ€åäº‹ä»¶ç›‘å¬å™¨ä¼šè‡ªåŠ¨æ¥æ”¶åˆ°äº‹ä»¶å¹¶è¿›è¡Œå¤„ç†ã€‚
æ€»ä¹‹ï¼Œè§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ„å»ºä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå¹¶å®ç°å¯¹è±¡é—´çš„æ¾è€¦åˆã€‚åœ¨ç°æœ‰çš„å¼€æºæ¡†æ¶ä¸­ï¼Œè§‚å¯Ÿè€…æ¨¡å¼è¢«å¹¿æ³›åº”ç”¨ï¼Œä¾‹å¦‚Springæ¡†æ¶ä¸­çš„äº‹ä»¶æœºåˆ¶å°±æ˜¯ä¸€ç§è§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°ã€‚

## ä»£ç†æ¨¡å¼

ä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒé€šè¿‡ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹åŸå§‹å¯¹è±¡çš„è®¿é—®ï¼Œå¯ä»¥åœ¨è®¿é—®åŸå§‹å¯¹è±¡å‰åå¢åŠ ä¸€äº›é¢å¤–çš„å¤„ç†é€»è¾‘ï¼Œä»è€Œå®ç°ä¸€äº›ç‰¹å®šçš„åŠŸèƒ½ã€‚
ä»£ç†æ¨¡å¼åŒ…æ‹¬ä¸‰ä¸ªè§’è‰²ï¼š**æŠ½è±¡ä¸»é¢˜ï¼ˆSubjectï¼‰ã€å…·ä½“ä¸»é¢˜ï¼ˆReal Subjectï¼‰å’Œä»£ç†ï¼ˆProxyï¼‰**ã€‚æŠ½è±¡ä¸»é¢˜å®šä¹‰äº†å…·ä½“ä¸»é¢˜å’Œä»£ç†çš„å…¬å…±æ¥å£ï¼Œå…·ä½“ä¸»é¢˜å®ç°äº†æŠ½è±¡ä¸»é¢˜æ¥å£ï¼Œä»£ç†ä¹Ÿå®ç°äº†æŠ½è±¡ä¸»é¢˜æ¥å£ï¼ŒåŒæ—¶ç»´æŠ¤äº†ä¸€ä¸ªæŒ‡å‘å…·ä½“ä¸»é¢˜çš„å¼•ç”¨ã€‚
ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Javaç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†ä»£ç†æ¨¡å¼çš„å®ç°ï¼š

```java
// æŠ½è±¡ä¸»é¢˜æ¥å£
interface Subject {
    void request();
}

// å…·ä½“ä¸»é¢˜ç±»
class RealSubject implements Subject {
    public void request() {
        System.out.println("RealSubject request.");
    }
}

// ä»£ç†ç±»
class Proxy implements Subject {
    private RealSubject realSubject;

    public void request() {
        if (realSubject == null) {
            realSubject = new RealSubject();
        }
    	//çœŸå®çš„æ–¹æ³•è°ƒç”¨ä¹‹å‰
        preRequest();

        realSubject.request();
    	//çœŸå®çš„æ–¹æ³•è°ƒç”¨ä¹‹å
        postRequest();
    }

    private void preRequest() {
        System.out.println("Proxy preRequest.");
    }

    private void postRequest() {
        System.out.println("Proxy postRequest.");
    }
}

// æµ‹è¯•ç±»
public class ProxyPatternDemo {
    public static void main(String[] args) {
        Proxy proxy = new Proxy();
        proxy.request();
    }
}

```

> åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡ä¸»é¢˜æ¥å£Subjectï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ä¸ªè¯·æ±‚æ–¹æ³•requestã€‚å…·ä½“ä¸»é¢˜ç±»RealSubjectå®ç°äº†æŠ½è±¡ä¸»é¢˜æ¥å£ï¼Œå¹¶å®ç°äº†å…·ä½“çš„è¯·æ±‚æ–¹æ³•é€»è¾‘ã€‚ä»£ç†ç±»Proxyä¹Ÿå®ç°äº†æŠ½è±¡ä¸»é¢˜æ¥å£ï¼ŒåŒæ—¶ç»´æŠ¤äº†ä¸€ä¸ªæŒ‡å‘å…·ä½“ä¸»é¢˜å¯¹è±¡çš„å¼•ç”¨ã€‚åœ¨ä»£ç†ç±»çš„è¯·æ±‚æ–¹æ³•requestä¸­ï¼Œæˆ‘ä»¬åœ¨è®¿é—®å…·ä½“ä¸»é¢˜å¯¹è±¡å‰åå¢åŠ äº†é¢å¤–çš„å¤„ç†é€»è¾‘ï¼Œå¹¶è°ƒç”¨å…·ä½“ä¸»é¢˜å¯¹è±¡çš„è¯·æ±‚æ–¹æ³•ã€‚

**å¸¸ç”¨çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ï¼š**

- è¿œç¨‹ä»£ç†ï¼šä¸ºä¸åŒåœ°å€ç©ºé—´ä¸­çš„å¯¹è±¡æä¾›ä¸€ä¸ªæœ¬åœ°ä»£ç†ï¼Œä»¥ä¾¿äºè®¿é—®è¿œç¨‹å¯¹è±¡ã€‚
- è™šæ‹Ÿä»£ç†ï¼šæ ¹æ®éœ€è¦åˆ›å»ºå¼€é”€å¾ˆå¤§çš„å¯¹è±¡ï¼Œæ¯”å¦‚å›¾ç‰‡æˆ–è€…æ–‡ä»¶ç­‰ï¼Œé€šè¿‡è™šæ‹Ÿä»£ç†æ¥å»¶è¿Ÿå¯¹è±¡çš„åˆ›å»ºã€‚
- å®‰å…¨ä»£ç†ï¼šæ§åˆ¶å¯¹å¯¹è±¡çš„è®¿é—®æƒé™ã€‚
- æ™ºèƒ½æŒ‡å¼•ï¼šåœ¨è®¿é—®å¯¹è±¡æ—¶æ·»åŠ é¢å¤–çš„é€»è¾‘ï¼Œæ¯”å¦‚ç¼“å­˜å¯¹è±¡ç­‰ã€‚

åœ¨ç°æœ‰çš„å¼€æºæ¡†æ¶ä¸­ï¼Œä»£ç†æ¨¡å¼ä¹Ÿè¢«å¹¿æ³›åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œ**Springæ¡†æ¶ä¸­çš„AOP**ï¼ˆAspect-Oriented Programmingï¼‰å°±æ˜¯ä¸€ç§ä»£ç†æ¨¡å¼çš„å®ç°ã€‚Springæ¡†æ¶ä¸­çš„AOPæ˜¯é€šè¿‡åŠ¨æ€ä»£ç†æ¥å®ç°çš„ï¼Œå®ƒå¯ä»¥åœ¨è®¿é—®æ–¹æ³•å‰åè‡ªåŠ¨æ·»åŠ é¢å¤–çš„å¤„ç†é€»è¾‘ï¼Œæ¯”å¦‚äº‹åŠ¡å¤„ç†ã€æ—¥å¿—è®°å½•

## è¿­ä»£å™¨æ¨¡å¼

è¿­ä»£å™¨æ¨¡å¼ï¼ˆIterator Patternï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥æä¾›**ä¸€ç§é¡ºåºè®¿é—®èšåˆå¯¹è±¡ï¼ˆAggregateï¼‰ä¸­å„ä¸ªå…ƒç´ çš„æ–¹æ³•ï¼Œè€Œåˆä¸æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤º**ã€‚è¿­ä»£å™¨æ¨¡å¼åŒ…å«**ä¸¤ä¸ªè§’è‰²**ï¼š**è¿­ä»£å™¨**ï¼ˆIteratorï¼‰å’Œ**èšåˆå¯¹è±¡**ï¼ˆAggregateï¼‰ã€‚è¿­ä»£å™¨å®šä¹‰äº†è®¿é—®å’Œéå†å…ƒç´ çš„æ¥å£ï¼Œè€Œèšåˆå¯¹è±¡å®šä¹‰äº†åˆ›å»ºè¿­ä»£å™¨å¯¹è±¡çš„æ¥å£ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Javaç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†è¿­ä»£å™¨æ¨¡å¼çš„å®ç°ï¼š

```java
// æŠ½è±¡è¿­ä»£å™¨æ¥å£
interface Iterator {
    boolean hasNext(); // æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ 
    Object next(); // è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ 
}

// å…·ä½“è¿­ä»£å™¨ç±»
class ConcreteIterator implements Iterator {
    private Object[] items; // è¿­ä»£çš„æ•°ç»„
    private int position; // è¿­ä»£å™¨çš„å½“å‰ä½ç½®

    public ConcreteIterator(Object[] items) {
        this.items = items;
        position = 0;
    }

    public boolean hasNext() {
        return position < items.length;
    }

    public Object next() {
        Object item = items[position];
        position++;
        return item;
    }
}

// æŠ½è±¡èšåˆå¯¹è±¡æ¥å£
interface Aggregate {
    Iterator createIterator(); // åˆ›å»ºè¿­ä»£å™¨
}

// å…·ä½“èšåˆå¯¹è±¡ç±»
class ConcreteAggregate implements Aggregate {
    private Object[] items; // èšåˆå¯¹è±¡çš„å†…éƒ¨æ•°ç»„

    public ConcreteAggregate(Object[] items) {
        this.items = items;
    }

    public Iterator createIterator() {
        return new ConcreteIterator(items); // åˆ›å»ºå…·ä½“è¿­ä»£å™¨å¯¹è±¡
    }
}

// æµ‹è¯•ç±»
public class IteratorPatternDemo {
    public static void main(String[] args) {
        Object[] items = {"A", "B", "C", "D"}; // èšåˆå¯¹è±¡çš„å†…éƒ¨æ•°ç»„
        Aggregate aggregate = new ConcreteAggregate(items); // åˆ›å»ºå…·ä½“èšåˆå¯¹è±¡
        Iterator iterator = aggregate.createIterator(); // åˆ›å»ºå…·ä½“è¿­ä»£å™¨å¯¹è±¡
        while (iterator.hasNext()) { // éå†èšåˆå¯¹è±¡ä¸­çš„å…ƒç´ 
            Object item = iterator.next();
            System.out.println(item);
        }
    }
}

```

> åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡è¿­ä»£å™¨æ¥å£Iteratorå’Œä¸€ä¸ªå…·ä½“è¿­ä»£å™¨ç±»ConcreteIteratorï¼Œå…·ä½“è¿­ä»£å™¨ç±»å®ç°äº†è¿­ä»£å™¨æ¥å£ä¸­çš„æ–¹æ³•ã€‚æŠ½è±¡èšåˆå¯¹è±¡æ¥å£Aggregateå®šä¹‰äº†åˆ›å»ºè¿­ä»£å™¨å¯¹è±¡çš„æ¥å£ï¼Œå…·ä½“èšåˆå¯¹è±¡ç±»ConcreteAggregateå®ç°äº†èšåˆå¯¹è±¡æ¥å£ï¼Œå¹¶å®ç°äº†åˆ›å»ºè¿­ä»£å™¨å¯¹è±¡çš„æ–¹æ³•ã€‚


åœ¨æµ‹è¯•ç±»IteratorPatternDemoä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«å¤šä¸ªå…ƒç´ çš„æ•°ç»„itemsï¼Œå°†å…¶ä½œä¸ºå‚æ•°åˆ›å»ºä¸€ä¸ªå…·ä½“èšåˆå¯¹è±¡ç±»çš„å®ä¾‹ï¼Œå¹¶è°ƒç”¨å…¶createIterator()æ–¹æ³•åˆ›å»ºä¸€ä¸ªå…·ä½“è¿­ä»£å™¨å¯¹è±¡ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨è¿­ä»£å™¨å¯¹è±¡æ¥éå†èšåˆå¯¹è±¡ä¸­çš„å…ƒç´ ï¼Œå¹¶è¾“å‡ºæ¯ä¸ªå…ƒç´ çš„å€¼ã€‚

è¿­ä»£å™¨æ¨¡å¼çš„**ä¸»è¦ä½œç”¨**æ˜¯å°†èšåˆå¯¹è±¡ä¸å…¶éå†ç®—æ³•åˆ†ç¦»å¼€æ¥ï¼Œä½¿å¾—èšåˆå¯¹è±¡å’Œéå†ç®—æ³•å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚åŒæ—¶è¿­ä»£å™¨æ¨¡å¼è¿˜å¯ä»¥éšè—èšåˆå¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºï¼Œä»è€Œç®€åŒ–äº†èšåˆå¯¹è±¡çš„æ¥å£è®¾è®¡ã€‚è¿­ä»£å™¨æ¨¡å¼åœ¨Javaä¸­è¢«å¹¿æ³›åº”ç”¨ï¼Œåœ¨Javaä¸­çš„é›†åˆæ¡†æ¶ä¸­ï¼ŒIteratorå°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨çš„å®ç°ã€‚

## é€‚é…å™¨æ¨¡å¼

é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·ç«¯å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œä»è€Œè®©åŸæœ¬ä¸å…¼å®¹çš„ç±»èƒ½å¤ŸååŒå·¥ä½œã€‚é€‚é…å™¨æ¨¡å¼åŒ…å«**ä¸‰ä¸ªè§’è‰²**ï¼š**ç›®æ ‡æ¥å£ï¼ˆTarget**ï¼‰ã€**é€‚é…å™¨**ï¼ˆAdapterï¼‰å’Œ**è¢«é€‚é…è€…ï¼ˆAdapteeï¼‰**ã€‚å…¶ä¸­ï¼Œç›®æ ‡æ¥å£å®šä¹‰äº†å®¢æˆ·ç«¯æ‰€æœŸæœ›çš„æ¥å£ï¼Œé€‚é…å™¨å®ç°äº†ç›®æ ‡æ¥å£ï¼Œå¹¶æŒæœ‰ä¸€ä¸ªè¢«é€‚é…è€…çš„å¼•ç”¨ï¼Œè€Œè¢«é€‚é…è€…æ˜¯åŸæœ¬ä¸å…¼å®¹çš„ç±»ï¼Œå®ƒéœ€è¦è¢«é€‚é…å™¨è¿›è¡Œè½¬æ¢ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Javaç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†é€‚é…å™¨æ¨¡å¼çš„å®ç°ï¼š

```java
// ç›®æ ‡æ¥å£
interface Target {
    void request(); // å®¢æˆ·ç«¯å¸Œæœ›è°ƒç”¨çš„æ¥å£æ–¹æ³•
}

// è¢«é€‚é…è€…ç±»
class Adaptee {
    public void specificRequest() {
        System.out.println("Specific request."); // è¢«é€‚é…è€…ç±»çš„å…·ä½“æ–¹æ³•
    }
}

// é€‚é…å™¨ç±»
class Adapter implements Target {
    private Adaptee adaptee; // æŒæœ‰è¢«é€‚é…è€…ç±»çš„å¼•ç”¨

    public Adapter(Adaptee adaptee) {
        this.adaptee = adaptee;
    }

    public void request() {
        adaptee.specificRequest(); // è°ƒç”¨è¢«é€‚é…è€…ç±»çš„æ–¹æ³•ï¼Œå®ç°ç›®æ ‡æ¥å£ä¸­çš„æ–¹æ³•
    }
}

// æµ‹è¯•ç±»
public class AdapterPatternDemo {
    public static void main(String[] args) {
        Adaptee adaptee = new Adaptee(); // åˆ›å»ºè¢«é€‚é…è€…ç±»çš„å®ä¾‹
        Target target = new Adapter(adaptee); // åˆ›å»ºé€‚é…å™¨ç±»çš„å®ä¾‹ï¼Œå¹¶å°†è¢«é€‚é…è€…ç±»çš„å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ç»™é€‚é…å™¨ç±»çš„æ„é€ å‡½æ•°
        target.request(); // è°ƒç”¨ç›®æ ‡æ¥å£ä¸­çš„æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡é€‚é…å™¨ç±»è°ƒç”¨è¢«é€‚é…è€…ç±»ä¸­çš„æ–¹æ³•
    }
}

```

> åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç›®æ ‡æ¥å£Targetï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå®¢æˆ·ç«¯æ‰€æœŸæœ›çš„æ–¹æ³•request()ã€‚ç„¶åæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè¢«é€‚é…è€…ç±»Adapteeï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå…·ä½“çš„æ–¹æ³•specificRequest()ã€‚æ¥ç€æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªé€‚é…å™¨ç±»Adapterï¼Œå®ç°äº†ç›®æ ‡æ¥å£ä¸­çš„æ–¹æ³•ï¼Œå¹¶æŒæœ‰ä¸€ä¸ªè¢«é€‚é…è€…ç±»çš„å¼•ç”¨ï¼Œåœ¨é€‚é…å™¨ç±»çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨è¢«é€‚é…è€…ç±»ä¸­çš„æ–¹æ³•æ¥å®ç°ç›®æ ‡æ¥å£ä¸­çš„æ–¹æ³•ã€‚


> åœ¨æµ‹è¯•ç±»AdapterPatternDemoä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè¢«é€‚é…è€…ç±»çš„å®ä¾‹å’Œä¸€ä¸ªé€‚é…å™¨ç±»çš„å®ä¾‹ï¼Œå¹¶å°†è¢«é€‚é…è€…ç±»çš„å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ç»™é€‚é…å™¨ç±»çš„æ„é€ å‡½æ•°ã€‚ç„¶åæˆ‘ä»¬è°ƒç”¨é€‚é…å™¨ç±»çš„æ–¹æ³•æ¥æ‰§è¡Œç›®æ ‡æ¥å£ä¸­çš„æ–¹æ³•ã€‚


é€‚é…å™¨æ¨¡å¼çš„**ä¸»è¦ä½œç”¨**æ˜¯å°†ä¸å…¼å®¹çš„æ¥å£è¿›è¡Œè½¬æ¢ï¼Œä½¿å¾—åŸæœ¬ä¸å…¼å®¹çš„ç±»å¯ä»¥ååŒå·¥ä½œã€‚é€‚é…å™¨æ¨¡å¼å¸¸ç”¨äºä¸¤ä¸ªç³»ç»Ÿé—´çš„æ¥å£è½¬æ¢ï¼Œæˆ–è€…ä¸€ä¸ªç³»ç»Ÿä¸­ä½¿ç”¨çš„ç±»åº“ä¸å…¼å®¹çš„æƒ…å†µä¸‹ã€‚åœ¨Javaä¸­ï¼Œå¸¸è§çš„**ä½¿ç”¨åœºæ™¯**æ˜¯åœ¨é›†åˆç±»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Collectionsç±»ä¸­çš„æ–¹æ³•æ¥å¯¹æ•°ç»„è¿›è¡Œæ’åºã€æŸ¥æ‰¾ã€åè½¬ç­‰æ“ä½œï¼Œè¿™å°±æ˜¯é€šè¿‡é€‚é…å™¨æ¨¡å¼å®ç°çš„ã€‚

### è‡ªå·±å¯¹é€‚é…å™¨æ¨¡å¼çš„ç†è§£

**é—®ï¼š**

> é‚£å°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä¸ºäº†åœ¨ç¬¬ä¸‰æ–¹æ¥å£çš„åŠŸèƒ½åŸºç¡€ä¸Šè¿›è¡Œæ·»åŠ é¢å¤–çš„åŠŸèƒ½æˆ–è€…æ•°æ®ç±»å‹è½¬æ¢ï¼Œæˆ‘ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç„¶åæ¥å£å®ç°ä¸­è°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£ï¼Œå¹¶ä¸”åœ¨è°ƒç”¨ä¹‹å‰åŠä¹‹ååšä¸€äº›è‡ªå®šä¹‰åŠŸèƒ½ã€‚è¿™ä¸ªè¿‡ç¨‹å®é™…ä¸Šå°±æ˜¯ä½¿ç”¨äº†é€‚é…å™¨æ¨¡å¼ï¼Ÿå¯¹å§ï¼Ÿ ä½†æ˜¯æ€ä¹ˆæœ‰ç§ä»£ç†æ¨¡å¼çš„æ„Ÿè§‰ï¼Œåœ¨è°ƒç”¨çœŸå®å¯¹è±¡å‰åæ·»åŠ è‡ªå®šä¹‰åŠŸèƒ½

**ç­”ï¼š**

> æ˜¯çš„ï¼Œä½ è¯´å¾—æ²¡é”™ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ç¬¬ä¸‰æ–¹æ¥å£çš„åŠŸèƒ½åŸºç¡€ä¸Šè¿›è¡Œæ·»åŠ é¢å¤–çš„åŠŸèƒ½æˆ–è€…æ•°æ®ç±»å‹è½¬æ¢ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œå¹¶åœ¨è¯¥æ¥å£çš„å®ç°ä¸­è°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£ï¼ŒåŒæ—¶åœ¨è°ƒç”¨ä¹‹å‰åŠä¹‹åæ·»åŠ ä¸€äº›è‡ªå®šä¹‰åŠŸèƒ½ã€‚è¿™ç§æ–¹å¼å®é™…ä¸Šä¹Ÿæ˜¯ä½¿ç”¨äº†é€‚é…å™¨æ¨¡å¼ï¼Œå®ƒå¯ä»¥å°†ä¸å…¼å®¹çš„æ¥å£è¿›è¡Œè½¬æ¢ï¼Œå¹¶åœ¨è½¬æ¢çš„è¿‡ç¨‹ä¸­æ·»åŠ è‡ªå®šä¹‰åŠŸèƒ½ã€‚



**é€‚é…å™¨æ¨¡å¼ä¸ä»£ç†æ¨¡å¼çš„åŒºåˆ«ï¼š**

> é€‚é…å™¨æ¨¡å¼ä¸ä»£ç†æ¨¡å¼çš„ç¡®æœ‰äº›ç›¸ä¼¼ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸ºäº†åœ¨è°ƒç”¨ä¸€ä¸ªå¯¹è±¡ä¹‹å‰æˆ–ä¹‹åæ·»åŠ è‡ªå®šä¹‰åŠŸèƒ½ã€‚ä½†æ˜¯ä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äºé€‚é…å™¨æ¨¡å¼çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å°†ä¸€ä¸ªä¸å…¼å®¹çš„æ¥å£è½¬æ¢æˆå¦ä¸€ä¸ªæ¥å£ï¼Œä½¿å¾—åŸæœ¬ä¸å…¼å®¹çš„ç±»èƒ½å¤ŸååŒå·¥ä½œï¼Œè€Œä»£ç†æ¨¡å¼çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å¯¹æŸä¸ªå¯¹è±¡è¿›è¡Œæ§åˆ¶ï¼Œä»è€Œå®ç°å¯¹åŸå¯¹è±¡çš„è®¿é—®æ§åˆ¶ã€å®‰å…¨æ§åˆ¶ã€è¿œç¨‹è®¿é—®ç­‰åŠŸèƒ½ã€‚
>
> å› æ­¤ï¼Œè™½ç„¶é€‚é…å™¨æ¨¡å¼å’Œä»£ç†æ¨¡å¼æœ‰äº›ç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒä»¬çš„åº”ç”¨åœºæ™¯æ˜¯ä¸åŒçš„ã€‚**é€‚é…å™¨æ¨¡å¼é€‚ç”¨äºéœ€è¦å°†ä¸å…¼å®¹çš„æ¥å£è¿›è¡Œè½¬æ¢çš„åœºæ™¯**ï¼Œ**è€Œä»£ç†æ¨¡å¼é€‚ç”¨äºéœ€è¦å¯¹æŸä¸ªå¯¹è±¡è¿›è¡Œæ§åˆ¶çš„åœºæ™¯ã€‚**

## æ¨¡æ¿æ–¹æ³•æ¨¡å¼

æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒçš„ä¸»è¦æ€æƒ³æ˜¯å°†ç®—æ³•çš„æ¡†æ¶å®šä¹‰åœ¨ä¸€ä¸ªæŠ½è±¡ç±»ä¸­ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤çš„å…·ä½“å®ç°äº¤ç”±å­ç±»å»å®Œæˆã€‚è¿™æ ·ä¸€æ¥ï¼Œåœ¨ä¸æ”¹å˜ç®—æ³•æ•´ä½“æ¶æ„çš„æƒ…å†µä¸‹ï¼Œå­ç±»å¯ä»¥è‡ªç”±åœ°å®ç°å…¶ä¸­çš„ä¸€äº›å…·ä½“æ­¥éª¤ã€‚

æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒæ˜¯æŠ½è±¡ç±»ä¸­çš„æ¨¡æ¿æ–¹æ³•ã€‚æ¨¡æ¿æ–¹æ³•å®šä¹‰äº†ç®—æ³•çš„æ¡†æ¶ï¼Œå®ƒé€šå¸¸æ˜¯ä¸€ä¸ªå…·ä½“æ–¹æ³•ï¼Œå®ƒåœ¨å…¶ä¸­å®šä¹‰äº†ç®—æ³•çš„æ­¥éª¤ï¼ŒåŒæ—¶è°ƒç”¨äº†ä¸€äº›æŠ½è±¡æ–¹æ³•ã€‚è¿™äº›æŠ½è±¡æ–¹æ³•ç”±å­ç±»æ¥å®ç°ï¼Œå®ƒä»¬æ˜¯ç®—æ³•ä¸­çš„å…·ä½“æ­¥éª¤ã€‚åœ¨æ¨¡æ¿æ–¹æ³•ä¸­ï¼Œå­ç±»å¯ä»¥è‡ªç”±åœ°å®ç°å…¶ä¸­çš„æŸäº›æ­¥éª¤ï¼ŒåŒæ—¶ä¿ç•™äº†ç®—æ³•çš„æ•´ä½“æ¶æ„ï¼Œä½¿å¾—ç®—æ³•æ›´åŠ çµæ´»å’Œå¯æ‰©å±•ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„ç¤ºä¾‹ä»£ç ï¼š

```java
abstract class AbstractClass {
    // æ¨¡æ¿æ–¹æ³•
    public void templateMethod() {
        step1();
        step2();
        step3();
    }

    // å…·ä½“æ–¹æ³•1ï¼š ä¸€èˆ¬ä¸éœ€è¦å­ç±»é‡æ–°ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šè®¾ç½®ä¸ºprotected
    public void step1() {
        System.out.println("AbstractClass.step1");
    }

    // å…·ä½“æ–¹æ³•2
    public void step2() {
        System.out.println("AbstractClass.step2");
    }

    // æŠ½è±¡æ–¹æ³•3
    public abstract void step3();
}

class ConcreteClass extends AbstractClass {
    // å®ç°æŠ½è±¡æ–¹æ³•3
    public void step3() {
        System.out.println("ConcreteClass.step3");
    }
}

public class TemplateMethodDemo {
    public static void main(String[] args) {
        AbstractClass obj = new ConcreteClass();
        obj.templateMethod();
    }
}

```

åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒæŠ½è±¡ç±» AbstractClass ä¸­å®šä¹‰äº†ä¸€ä¸ªæ¨¡æ¿æ–¹æ³• templateMethod()ï¼Œè¯¥æ–¹æ³•åŒ…å«äº†ç®—æ³•çš„æ¡†æ¶ã€‚å…¶ä¸­è°ƒç”¨äº†ä¸‰ä¸ªå…·ä½“æ–¹æ³• step1()ã€step2() å’ŒæŠ½è±¡æ–¹æ³• step3()ã€‚å…·ä½“æ–¹æ³• step1() å’Œ step2() çš„å®ç°å·²ç»åœ¨æŠ½è±¡ç±»ä¸­ç»™å‡ºäº†ï¼Œè€Œ step3() çš„å®ç°åˆ™äº¤ç”±å­ç±»å»å®Œæˆã€‚

å­ç±» ConcreteClass ç»§æ‰¿è‡ª AbstractClassï¼Œå¹¶å®ç°äº†æŠ½è±¡æ–¹æ³• step3()ã€‚åœ¨ä¸»å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å®ä¾‹åŒ–äº† ConcreteClass å¯¹è±¡ï¼Œå¹¶è°ƒç”¨äº†å…¶æ¨¡æ¿æ–¹æ³• templateMethod()ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œä¼šä¾æ¬¡è°ƒç”¨ step1()ã€step2() å’Œ step3()ï¼Œå…¶ä¸­ step1() å’Œ step2() çš„å®ç°æ˜¯åœ¨æŠ½è±¡ç±»ä¸­å®šä¹‰çš„ï¼Œè€Œ step3() çš„å…·ä½“å®ç°åˆ™ç”±å­ç±» ConcreteClass æä¾›ã€‚

> æ€»ä¹‹ï¼Œæ¨¡æ¿æ–¹æ³•æ¨¡å¼é€šè¿‡åœ¨æŠ½è±¡ç±»ä¸­å®šä¹‰ç®—æ³•çš„æ¡†æ¶ï¼Œå¹¶å°†å…¶ä¸­ä¸€äº›å…·ä½“æ­¥éª¤äº¤ç”±å­ç±»æ¥å®ç°ï¼Œä½¿å¾—ç®—æ³•æ›´åŠ çµæ´»å’Œå¯æ‰©å±•ã€‚è¯¥æ¨¡å¼å¯ä»¥æœ‰æ•ˆåœ°å¤ç”¨ä»£ç ï¼ŒåŒæ—¶ä¹Ÿæ–¹ä¾¿äº†ä»£ç çš„ç»´æŠ¤å’Œæ‰©å±•ã€‚


### è¿™ä¸ªæ¨¡æ¿æ–¹æ³•ä¸­ï¼Œå­ç±»å¯ä»¥é‡æ–°çˆ¶ç±»ä¸­çš„step1ä¸stept2 å—ï¼Ÿ

åœ¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸­ï¼Œå­ç±»å¯ä»¥é‡å†™æŠ½è±¡ç±»ä¸­çš„å…·ä½“æ–¹æ³•ï¼ˆå¦‚ step1() å’Œ step2()ï¼‰ï¼Œä½†æ˜¯ä¸€èˆ¬**ä¸å»ºè®®è¿™æ ·åš**ã€‚å› ä¸ºè¿™æ ·åšå¯èƒ½ä¼šç ´åç®—æ³•çš„æ•´ä½“æ¶æ„ï¼Œä»è€Œå¯¼è‡´ç®—æ³•ä¸å†å¯æ§ã€‚

## ç­–ç•¥æ¨¡å¼

ç­–ç•¥æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ”¹å˜å¯¹è±¡çš„è¡Œä¸ºã€‚ç­–ç•¥æ¨¡å¼å°†ç®—æ³•çš„å®šä¹‰ä¸å®ç°åˆ†ç¦»å¼€æ¥ï¼Œä½¿å¾—å®ƒä»¬å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ã€‚è¯¥æ¨¡å¼å®šä¹‰äº†ä¸€ç³»åˆ—ç®—æ³•ï¼Œæ¯ä¸ªç®—æ³•éƒ½å°è£…åœ¨ä¸€ä¸ªç‹¬ç«‹çš„ç±»ä¸­ï¼Œå¹¶ä¸”è¿™äº›ç®—æ³•ä¹‹é—´å¯ä»¥äº’ç›¸æ›¿æ¢ã€‚

åœ¨ç­–ç•¥æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å°†ç®—æ³•å°è£…åœ¨ä¸€ä¸ªæ¥å£ä¸­ï¼Œå¹¶å®šä¹‰å¤šä¸ªå®ç°è¯¥æ¥å£çš„å…·ä½“ç­–ç•¥ç±»ã€‚ç„¶åï¼Œå°†è¿™äº›ç­–ç•¥ç±»ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œåœ¨ä¸Šä¸‹æ–‡å¯¹è±¡ä¸­æ ¹æ®éœ€è¦é€‰æ‹©ä¸åŒçš„ç­–ç•¥ç±»æ¥æ‰§è¡Œç›¸åº”çš„ç®—æ³•ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç­–ç•¥æ¨¡å¼çš„ç¤ºä¾‹ä»£ç ï¼š

```java
// å®šä¹‰ç­–ç•¥æ¥å£
interface Strategy {
    void execute();  // å®šä¹‰ç®—æ³•çš„æŠ½è±¡æ–¹æ³•
}

// å®šä¹‰å…·ä½“ç­–ç•¥ç±»A
class ConcreteStrategyA implements Strategy {
    public void execute() {
        System.out.println("ConcreteStrategyA.execute");  // å®ç°ç®—æ³•çš„å…·ä½“æ­¥éª¤
    }
}

// å®šä¹‰å…·ä½“ç­–ç•¥ç±»B
class ConcreteStrategyB implements Strategy {
    public void execute() {
        System.out.println("ConcreteStrategyB.execute");  // å®ç°ç®—æ³•çš„å…·ä½“æ­¥éª¤
    }
}

// å®šä¹‰ä¸Šä¸‹æ–‡ç±»
class Context {
    private Strategy strategy;  // æŒæœ‰ç­–ç•¥æ¥å£ç±»å‹çš„æˆå‘˜å˜é‡

    public Context(Strategy strategy) {
        this.strategy = strategy;  // åœ¨æ„é€ å‡½æ•°ä¸­ä¼ å…¥å…·ä½“çš„ç­–ç•¥å¯¹è±¡
    }

    public void setStrategy(Strategy strategy) {
        this.strategy = strategy;  // è®¾ç½®å…·ä½“çš„ç­–ç•¥å¯¹è±¡
    }

    public void executeStrategy() {
        strategy.execute();  // è°ƒç”¨ç­–ç•¥å¯¹è±¡çš„ç®—æ³•
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class StrategyPatternDemo {
    public static void main(String[] args) {
        // åˆ›å»ºä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¹¶å°†å…·ä½“ç­–ç•¥ç±»Aä¼ å…¥å…¶ä¸­
        Context context = new Context(new ConcreteStrategyA());
        context.executeStrategy();  // è°ƒç”¨ä¸Šä¸‹æ–‡å¯¹è±¡çš„executeStrategy()æ–¹æ³•ï¼Œæ‰§è¡Œç­–ç•¥å¯¹è±¡Açš„ç®—æ³•

        // åˆ‡æ¢ç­–ç•¥å¯¹è±¡ä¸ºå…·ä½“ç­–ç•¥ç±»B
        context.setStrategy(new ConcreteStrategyB());
        context.executeStrategy();  // è°ƒç”¨ä¸Šä¸‹æ–‡å¯¹è±¡çš„executeStrategy()æ–¹æ³•ï¼Œæ‰§è¡Œç­–ç•¥å¯¹è±¡Bçš„ç®—æ³•
    }
}

```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†æ³¨é‡Šæ¥è§£é‡Šæ¯ä¸ªç±»å’Œæ–¹æ³•çš„ä½œç”¨ã€‚å…¶ä¸­ï¼ŒStrategy æ¥å£å®šä¹‰äº†ç®—æ³•çš„æŠ½è±¡æ–¹æ³• execute()ï¼ŒConcreteStrategyA å’Œ ConcreteStrategyB ç±»åˆ†åˆ«å®ç°äº†è¯¥æ¥å£çš„å…·ä½“ç®—æ³•ï¼ŒContext ç±»åˆ™æŒæœ‰ä¸€ä¸ªç­–ç•¥æ¥å£ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œå®ƒå¯ä»¥æ‰§è¡Œä¼ å…¥çš„å…·ä½“ç­–ç•¥å¯¹è±¡çš„ç®—æ³•ï¼Œå¹¶ä¸”å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ”¹å˜ç­–ç•¥å¯¹è±¡ã€‚

> åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¹¶å°†å…·ä½“ç­–ç•¥ç±» ConcreteStrategyA ä¼ é€’ç»™å®ƒã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨äº†ä¸Šä¸‹æ–‡å¯¹è±¡çš„ executeStrategy() æ–¹æ³•æ¥æ‰§è¡Œç›¸åº”çš„ç®—æ³•ã€‚æ¥ç€ï¼Œæˆ‘ä»¬è°ƒç”¨äº† setStrategy() æ–¹æ³•ï¼Œå°†å…·ä½“ç­–ç•¥ç±» ConcreteStrategyB ä¼ é€’ç»™ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¹¶å†æ¬¡è°ƒç”¨ executeStrategy() æ–¹æ³•æ¥æ‰§è¡Œç›¸åº”çš„ç®—æ³•ã€‚
>
> æ€»ä¹‹ï¼Œç­–ç•¥æ¨¡å¼å…è®¸åœ¨**è¿è¡Œæ—¶åŠ¨æ€åœ°æ”¹å˜å¯¹è±¡çš„è¡Œä¸ºã€‚**å®ƒå°†ç®—æ³•çš„å®šä¹‰ä¸å®ç°åˆ†ç¦»å¼€æ¥ï¼Œä½¿å¾—å®ƒä»¬å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ã€‚


# çº¿ç¨‹

## çº¿ç¨‹çš„åŸºæœ¬æ¦‚å¿µï¼šâ­ï¸

> çº¿ç¨‹æ˜¯ç¨‹åºæ‰§è¡Œçš„æœ€å°å•å…ƒï¼Œå®ƒæ˜¯åœ¨è¿›ç¨‹å†…éƒ¨ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæ§åˆ¶æµã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹å…±äº«è¿›ç¨‹çš„èµ„æºï¼Œå¦‚å†…å­˜ç©ºé—´ã€æ–‡ä»¶æè¿°ç¬¦ç­‰ã€‚çº¿ç¨‹çš„å¹¶å‘æ‰§è¡Œå¯ä»¥æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ï¼Œä½¿ç¨‹åºèƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨ã€‚
> ä¸‹é¢æ˜¯ä¸€äº›çº¿ç¨‹çš„åŸºç¡€æ¦‚å¿µï¼š
>
> 1. **çº¿ç¨‹ï¼ˆThreadï¼‰**ï¼š çº¿ç¨‹æ˜¯ç¨‹åºä¸­ç‹¬ç«‹æ‰§è¡Œçš„ä¸€ä¸ªæ§åˆ¶æµï¼Œå®ƒç”±ç¨‹åºè®¡æ•°å™¨ã€æ ˆå’Œå¯„å­˜å™¨ç­‰ç»„æˆã€‚çº¿ç¨‹è¿è¡Œåœ¨è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå…±äº«è¿›ç¨‹çš„èµ„æºã€‚çº¿ç¨‹å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œä»è€Œæé«˜ç¨‹åºçš„æ€§èƒ½ã€‚
> 2. **å¤šçº¿ç¨‹**ï¼ˆMultithreadingï¼‰ï¼š å¤šçº¿ç¨‹æ˜¯æŒ‡åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­åŒæ—¶è¿è¡Œå¤šä¸ªçº¿ç¨‹ã€‚é€šè¿‡å¤šçº¿ç¨‹ï¼Œç¨‹åºå¯ä»¥åœ¨åŒä¸€æ—¶é—´æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„èµ„æºåˆ©ç”¨ç‡å’Œç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚
> 3. **å¹¶å‘**ï¼ˆConcurrencyï¼‰ï¼š å¹¶å‘æ˜¯æŒ‡åœ¨åŒä¸€æ—¶é—´é—´éš”å†…ï¼Œå¤šä¸ªä»»åŠ¡è¢«ï¼ˆçœ‹ä¼¼ï¼‰åŒæ—¶æ‰§è¡Œã€‚å¹¶å‘å¯ä»¥æ˜¯åœ¨å•æ ¸å¤„ç†å™¨ä¸Šé€šè¿‡åˆ‡æ¢ä¸Šä¸‹æ–‡å®ç°çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨å¤šæ ¸å¤„ç†å™¨ä¸Šé€šè¿‡åŒæ—¶æ‰§è¡Œå¤šä¸ªçº¿ç¨‹å®ç°çš„ã€‚
> 4. **å¹¶è¡Œ**ï¼ˆParallelismï¼‰ï¼š å¹¶è¡Œæ˜¯æŒ‡åœ¨åŒä¸€æ—¶åˆ»ï¼Œå¤šä¸ªä»»åŠ¡è¢«çœŸæ­£åŒæ—¶æ‰§è¡Œã€‚å¹¶è¡Œé€šå¸¸å‘ç”Ÿåœ¨å¤šæ ¸å¤„ç†å™¨æˆ–å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šï¼Œæ¯ä¸ªæ ¸æˆ–å¤„ç†å™¨å¯ä»¥åŒæ—¶æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ã€‚
> 5. **çº¿ç¨‹å®‰å…¨**ï¼ˆThread-safeï¼‰ï¼š çº¿ç¨‹å®‰å…¨æ˜¯æŒ‡ä¸€ä¸ªæ–¹æ³•ã€ç±»æˆ–æ•°æ®ç»“æ„åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹èƒ½æ­£ç¡®åœ°æ‰§è¡Œå’Œç»´æŠ¤å…¶çŠ¶æ€ï¼Œä¸ä¼šå› ä¸ºå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®è€Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´æˆ–ç¨‹åºå¼‚å¸¸ã€‚
> 6. **çº¿ç¨‹åŒæ­¥ï¼ˆ**Thread synchronizationï¼‰ï¼š çº¿ç¨‹åŒæ­¥æ˜¯æŒ‡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯¹å…±äº«èµ„æºçš„è®¿é—®è¿›è¡Œåè°ƒå’Œæ§åˆ¶ï¼Œä»¥ç¡®ä¿å…±äº«èµ„æºåœ¨ä»»ä½•æ—¶åˆ»åªè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œé˜²æ­¢æ•°æ®ä¸ä¸€è‡´æˆ–ç¨‹åºå¼‚å¸¸ã€‚

## Javaä¸­çš„çº¿ç¨‹æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š

1. Javaä¸­çš„çº¿ç¨‹æ˜¯**è½»é‡çº§**çš„ï¼Œåˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„å¼€é”€ç›¸å¯¹è¾ƒå°ï¼›
2. Javaä¸­çš„çº¿ç¨‹**ç”±æ“ä½œç³»ç»Ÿå†…æ ¸æ¥è°ƒåº¦**ï¼Œå³ä½¿æŸä¸ªçº¿ç¨‹é˜»å¡äº†ï¼Œä¹Ÿä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„æ‰§è¡Œï¼›
3. Javaä¸­çš„çº¿ç¨‹æ˜¯**æŠ¢å å¼**çš„ï¼Œå³å½“å‰è¿è¡Œçš„çº¿ç¨‹ä¼šè¢«å¼ºåˆ¶æš‚åœï¼Œè®©å…¶ä»–çº¿ç¨‹è¿è¡Œï¼›
4. Javaä¸­çš„çº¿ç¨‹æ˜¯**å¯é‡å…¥**çš„ï¼ŒåŒä¸€çº¿ç¨‹å¯ä»¥å¤šæ¬¡è°ƒç”¨è‡ªå·±çš„æ–¹æ³•ï¼Œä¸ä¼šå‡ºç°æ­»é”ç­‰é—®é¢˜ã€‚

## çº¿ç¨‹çš„çš„åˆ›å»ºäºä½¿ç”¨æ–¹å¼ â­ï¸

â— ç»§æ‰¿Threadç±»åˆ›å»ºçº¿ç¨‹
â— å®ç°Runnableæ¥å£åˆ›å»ºçº¿ç¨‹
â— å®ç°Callableæ¥å£ä¸Futureç»“åˆåˆ›å»ºæœ‰è¿”å›å€¼çš„çº¿ç¨‹
â— ä½¿ç”¨çº¿ç¨‹æ± ï¼ˆExecutorServiceã€ThreadPoolExecutorç­‰ï¼‰

```java
package org.thread;

import javax.management.relation.RelationNotFoundException;
import java.util.concurrent.Callable;
import java.util.concurrent.FutureTask;

//ç»§æ‰¿Threadç±»åˆ›å»ºçº¿ç¨‹
public class MyThread extends Thread {
    public void run() {
        for (int i = 1; i <= 5; i++) {
            System.out.println(Thread.currentThread().getName() + ":" + i);
        }
    }
}

// å®ç°Runnableæ¥å£åˆ›å»ºçº¿ç¨‹
class MyRunable implements Runnable{

    @Override
    public void run() {
        for (int i = 1; i <= 5; i++) {
            System.out.println("===="+Thread.currentThread().getName() + ":" + i);
        }
    }
}

//å®ç°Callableæ¥å£ä¸Futureç»“åˆåˆ›å»ºæœ‰è¿”å›å€¼çš„çº¿ç¨‹
class MyCallable implements Callable<String> {

    @Override
    public String call() throws Exception {
        for (int i = 1; i <= 5; i++) {
            System.out.println("******"+Thread.currentThread().getName() + ":" + i);
        }
        return "hello blake";
    }
}

 class Test {
    public static void main(String[] args) throws Exception {
        
        MyThread t = new MyThread();
        t.start();

        MyRunable runable = new MyRunable();
        new Thread(runable).start();

        // ä½¿ç”¨Callableè¿›è¡Œ
        MyCallable myCallable = new MyCallable();
        FutureTask<String> futureTask = new FutureTask<>(myCallable);
        new Thread(futureTask).start();
        System.out.println(futureTask.get()); //hello blake
    }
}

```

## çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ â­ï¸

> 1. æ–°å»ºï¼ˆNewï¼‰ï¼šæƒ³è±¡ä¸€ä¸ªåˆšå‡ºç”Ÿçš„å©´å„¿ï¼Œå®ƒè¿˜æ²¡æœ‰å¼€å§‹ä¸å…¶ä»–äººäº’åŠ¨ã€‚è¿™å°±ç±»ä¼¼äºä¸€ä¸ªæ–°åˆ›å»ºçš„çº¿ç¨‹å¯¹è±¡ã€‚
> 2. å°±ç»ªï¼ˆRunnableï¼‰ï¼šç°åœ¨ï¼Œå©´å„¿é•¿å¤§äº†ä¸€ç‚¹ï¼Œå‡†å¤‡å¥½ä¸å…¶ä»–å­©å­ä¸€èµ·ç©è€ã€‚å®ƒå¤„äºç­‰å¾…è¢«é€‰ä¸­å»ç©çš„çŠ¶æ€ã€‚è¿™å°±åƒä¸€ä¸ªè°ƒç”¨äº†start()æ–¹æ³•çš„çº¿ç¨‹ï¼Œç­‰å¾…æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºã€‚
> 3. è¿è¡Œï¼ˆRunningï¼‰ï¼šå­©å­è¢«é€‰ä¸­ä¸å…¶ä»–å­©å­ä¸€èµ·ç©è€ï¼Œè¿™å°±ç±»ä¼¼äºçº¿ç¨‹è¢«è°ƒåº¦å™¨é€‰ä¸­å¹¶å¼€å§‹æ‰§è¡Œä»»åŠ¡ã€‚
> 4. é˜»å¡ï¼ˆBlockedï¼‰ï¼šåœ¨ç©è€è¿‡ç¨‹ä¸­ï¼Œå­©å­å¯èƒ½å› ä¸ºéœ€è¦ç­‰å¾…å…¶ä»–å­©å­åˆ†äº«ç©å…·è€Œæš‚æ—¶åœæ­¢ç©è€ã€‚è¿™å°±åƒçº¿ç¨‹åœ¨ç­‰å¾…æŸäº›èµ„æºã€é”æˆ–I/Oæ“ä½œçš„è¿‡ç¨‹ä¸­è¢«é˜»å¡ã€‚
> 5. æ­»äº¡ï¼ˆTerminatedï¼‰ï¼šå­©å­ä»¬ç©è€çš„æ—¶é—´ç»“æŸäº†ï¼Œå›å®¶ä¼‘æ¯ã€‚è¿™å°±åƒçº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡æˆ–è€…å› ä¸ºå¼‚å¸¸è€Œç»ˆæ­¢ï¼Œè¿›å…¥æ­»äº¡çŠ¶æ€ã€‚
>
> åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œå¯èƒ½è¿˜ä¼šé‡åˆ°å…¶ä»–çš„çº¿ç¨‹çŠ¶æ€ï¼Œä¾‹å¦‚ï¼š
>
> - ç­‰å¾…ï¼ˆWaitingï¼‰ï¼šçº¿ç¨‹åœ¨ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œç‰¹å®šæ“ä½œï¼ˆä¾‹å¦‚è°ƒç”¨æŸä¸ªæ–¹æ³•æˆ–ç­‰å¾…æŸä¸ªæ¡ä»¶å˜ä¸ºçœŸï¼‰ã€‚
> - è®¡æ—¶ç­‰å¾…ï¼ˆTimed Waitingï¼‰ï¼šçº¿ç¨‹åœ¨ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œç‰¹å®šæ“ä½œï¼Œä½†ä¼šåœ¨æŒ‡å®šæ—¶é—´åè‡ªåŠ¨ç»§ç»­æ‰§è¡Œã€‚
>
> è¿™äº›çŠ¶æ€åœ¨å®é™…ç¼–ç¨‹ä¸­éƒ½å±äºé˜»å¡çŠ¶æ€çš„ä¸€ç§ã€‚

## çº¿ç¨‹åŒæ­¥å’Œé”ï¼š â­ï¸

### synchronizedï¼š

synchronizedå…³é”®å­—æ˜¯Javaä¸­æä¾›çš„ä¸€ç§å†…ç½®çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶ã€‚å®ƒç”¨äºç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯¹å…±äº«èµ„æºçš„è®¿é—®æ˜¯äº’æ–¥çš„ï¼Œé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºè€Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´æˆ–ç¨‹åºå¼‚å¸¸ã€‚synchronizedå¯ä»¥ä¿®é¥°æ–¹æ³•å’Œä»£ç å—ã€‚

> æƒ³è±¡ä¸€ä¸‹ï¼Œæœ‰ä¸€ä¸ªæˆ¿é—´é‡Œæœ‰ä¸€æŠŠæ¤…å­ï¼ˆå…±äº«èµ„æºï¼‰ã€‚ç°åœ¨æœ‰å¾ˆå¤šäººï¼ˆçº¿ç¨‹ï¼‰æƒ³åè¿™æŠŠæ¤…å­ï¼Œä½†æ˜¯ä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªäººåã€‚ä¸ºäº†é¿å…å‘ç”Ÿäº‰æŠ¢ï¼Œæˆ‘ä»¬ç»™é—¨ä¸ŠåŠ äº†ä¸€æŠŠé”ï¼ˆsynchronizedå…³é”®å­—ï¼‰ã€‚è¿™æ ·ï¼Œæ¯æ¬¡åªæœ‰æ‹¿åˆ°é’¥åŒ™ï¼ˆè·å¾—é”ï¼‰çš„äººæ‰èƒ½è¿›å…¥æˆ¿é—´ï¼ˆæ‰§è¡Œä»£ç ï¼‰åæ¤…å­ã€‚

ä»¥ä¸‹æ˜¯synchronizedçš„ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼š

1. åŒæ­¥æ–¹æ³• ï¼š å½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¿™ä¸ªåŒæ­¥æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè·å–åˆ°è¿™ä¸ªæ–¹æ³•æ‰€å±å¯¹è±¡çš„é”ã€‚å…¶ä»–çº¿ç¨‹åœ¨è¯•å›¾è®¿é—®è¯¥æ–¹æ³•æ—¶ï¼Œå¦‚æœé”å·²ç»è¢«å ç”¨ï¼Œå®ƒä»¬å°±å¿…é¡»ç­‰å¾…é”è¢«é‡Šæ”¾ã€‚

```java
public synchronized void method() {
    // åŒæ­¥ä»£ç 
}

```

2. åŒæ­¥ä»£ç å—

```java
public void method() {
    synchronized (this) {
        // åŒæ­¥ä»£ç 
    }
}
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªå¯¹æ–¹æ³•å†…éƒ¨çš„ä¸€éƒ¨åˆ†ä»£ç è¿›è¡ŒåŒæ­¥ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒæ­¥ä»£ç å—æ—¶ï¼Œå®ƒéœ€è¦è·å–æŒ‡å®šå¯¹è±¡çš„é”ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨thisä½œä¸ºé”å¯¹è±¡ï¼Œè¡¨ç¤ºå½“å‰å®ä¾‹ã€‚å…¶ä»–çº¿ç¨‹åœ¨è¯•å›¾è¿›å…¥åŒæ­¥ä»£ç å—æ—¶ï¼Œå¦‚æœé”å·²ç»è¢«å ç”¨ï¼Œå®ƒä»¬ä¹Ÿå¿…é¡»ç­‰å¾…é”è¢«é‡Šæ”¾ã€‚

> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œsynchronizedçš„ä½¿ç”¨å¯èƒ½ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Œä»è€Œé™ä½ç¨‹åºçš„æ€§èƒ½ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨synchronizedæ—¶ï¼Œåº”å°½é‡å‡å°åŒæ­¥èŒƒå›´ï¼Œé¿å…é•¿æ—¶é—´å ç”¨é”ã€‚

### é›†ç¾¤ç¯å¢ƒä¸‹ï¼šsynchronizedä»¥åŠçº¿ç¨‹å®‰å…¨çš„å·¥å…·ç±»è¿˜æœ‰å¿…è¦å—ï¼Ÿ

> åœ¨åœ¨é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œç”±äºæ¯ä¸ªèŠ‚ç‚¹éƒ½è¿è¡Œåœ¨ä¸åŒçš„JVMä¸­ï¼Œå®ƒä»¬ä¹‹é—´æ— æ³•å…±äº«å†…å­˜ï¼Œå› æ­¤ä½¿ç”¨synchronizedå…³é”®å­—è¿›è¡Œçº¿ç¨‹åŒæ­¥æ˜¯æ— æ•ˆçš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ éœ€è¦è€ƒè™‘å…¶ä»–çš„åˆ†å¸ƒå¼åŒæ­¥æ–¹æ¡ˆæ¥ç¡®ä¿åœ¨æ•´ä¸ªé›†ç¾¤ä¸­çš„æ•°æ®ä¸€è‡´æ€§ã€‚[https://www.yuque.com/blake-a5uo7/ypqb2i/wg0vfa#Fdwwm](#Fdwwm)

:::warning
**é›†ç¾¤éƒ¨ç½²ç¯å¢ƒä¸‹ä»£ç ä¸­çº¿ç¨‹å®‰å…¨å·¥å…·ç±»åŠsynchronizedæ˜¯å¦è¿˜æœ‰å¿…è¦ä½¿ç”¨ï¼Ÿ**
åœ¨åˆæœŸç³»ç»Ÿè®¾è®¡å’Œç¼–ç è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨synchronizedå’Œçº¿ç¨‹å®‰å…¨çš„å·¥å…·ç±»ï¼ˆå¦‚ConcurrentHashMapï¼‰ä¾ç„¶æ˜¯æœ‰å¿…è¦çš„ã€‚å› ä¸ºå³ä½¿ä½ çš„ç³»ç»Ÿæœ€ç»ˆå¯èƒ½ä¼šæ‰©å±•åˆ°é›†ç¾¤ç¯å¢ƒï¼Œè¿™äº›çº¿ç¨‹å®‰å…¨çš„å·¥å…·ç±»å’ŒåŒæ­¥æœºåˆ¶ä»ç„¶åœ¨å•ä¸ªèŠ‚ç‚¹å†…éƒ¨ä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§å’Œçº¿ç¨‹å®‰å…¨ã€‚
åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¤šçº¿ç¨‹ç¨‹åºé€šå¸¸ä¼šå¹¶å‘è®¿é—®å…±äº«èµ„æºï¼Œä¸ºäº†é¿å…æ•°æ®ä¸ä¸€è‡´å’Œç¨‹åºå¼‚å¸¸ï¼Œéœ€è¦ä½¿ç”¨é€‚å½“çš„åŒæ­¥æœºåˆ¶ã€‚synchronizedå’ŒConcurrentHashMapç­‰çº¿ç¨‹å®‰å…¨çš„å·¥å…·ç±»å¯ä»¥å¸®åŠ©ä½ åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šå®ç°è¿™æ ·çš„åŒæ­¥ã€‚
å½“ç„¶ï¼Œåœ¨ç³»ç»Ÿé€æ¸å‘å±•ä¸ºé›†ç¾¤ç¯å¢ƒæ—¶ï¼Œä½ éœ€è¦è€ƒè™‘ä½¿ç”¨å…¶ä»–çš„åˆ†å¸ƒå¼åŒæ­¥æ–¹æ¡ˆæ¥ç¡®ä¿æ•´ä¸ªé›†ç¾¤ä¸­çš„æ•°æ®ä¸€è‡´æ€§ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€åœ¨å•èŠ‚ç‚¹å†…éƒ¨ï¼Œä¸å†éœ€è¦ä½¿ç”¨synchronizedå’Œçº¿ç¨‹å®‰å…¨çš„å·¥å…·ç±»ã€‚å®é™…ä¸Šï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œä½ é€šå¸¸éœ€è¦åŒæ—¶ç¡®ä¿å•èŠ‚ç‚¹å†…éƒ¨çš„çº¿ç¨‹å®‰å…¨å’Œæ•´ä¸ªé›†ç¾¤é—´çš„æ•°æ®ä¸€è‡´æ€§ã€‚
å› æ­¤ï¼Œåœ¨ç³»ç»Ÿè®¾è®¡å’Œç¼–ç é˜¶æ®µï¼Œä½¿ç”¨synchronizedå’Œçº¿ç¨‹å®‰å…¨çš„å·¥å…·ç±»æ˜¯æœ‰å¿…è¦çš„ã€‚åŒæ—¶ï¼Œéšç€ç³»ç»Ÿæ‰©å±•åˆ°é›†ç¾¤ç¯å¢ƒï¼Œä½ éœ€è¦å…³æ³¨åˆ†å¸ƒå¼åŒæ­¥æ–¹æ¡ˆï¼Œå¹¶åœ¨åˆé€‚çš„åœºæ™¯ä¸­è¿›è¡Œç»“åˆä½¿ç”¨ã€‚
:::

### Lockæ¥å£åŠå…¶å®ç°ç±»ï¼ˆå¦‚ReentrantLockï¼‰

> Lockæ¥å£æ˜¯Javaæä¾›çš„ä¸€ç§æ˜¾ç¤ºé”æœºåˆ¶ï¼Œå®ƒå…è®¸ä½ åœ¨ä»£ç ä¸­è¿›è¡Œæ›´çµæ´»çš„é”æ§åˆ¶ã€‚ReentrantLockæ˜¯Lockæ¥å£çš„ä¸€ä¸ªå®ç°ç±»ï¼Œ**å®ƒå…·æœ‰å¯é‡å…¥ç‰¹æ€§ï¼Œå³ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å–åŒä¸€æŠŠé”ã€‚**
> **ä¸¾ä¾‹:**
> å‡è®¾ä½ æœ‰ä¸€ä¸ªæˆ¿é—´ï¼ˆå…±äº«èµ„æºï¼‰ï¼Œä½ æƒ³è¦ç¡®ä¿åœ¨åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªäººï¼ˆçº¿ç¨‹ï¼‰è¿›å…¥ã€‚synchronizedå…³é”®å­—å°±åƒæ˜¯æˆ¿é—´é—¨ä¸Šçš„ä¸€ä¸ªè‡ªåŠ¨é”ï¼Œè€ŒLockæ¥å£å’ŒReentrantLockç±»å°±åƒæ˜¯ä¸€æŠŠæ‰‹åŠ¨é”ã€‚ä½¿ç”¨è‡ªåŠ¨é”æ—¶ï¼Œå½“æœ‰äººè¿›å…¥æˆ¿é—´æ—¶ï¼Œé—¨ä¼šè‡ªåŠ¨ä¸Šé”ï¼Œå½“ä»–ç¦»å¼€æ—¶ï¼Œé—¨ä¼šè‡ªåŠ¨è§£é”ã€‚è€Œä½¿ç”¨æ‰‹åŠ¨é”æ—¶ï¼Œä½ **éœ€è¦è‡ªå·±ä¸Šé”å’Œè§£é”**ã€‚
> [https://www.yuque.com/blake-a5uo7/ypqb2i/wg0vfa#Co52h](#Co52h)


ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ReentrantLockçš„ç¤ºä¾‹ï¼š

```java
import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantLock;

public class MyResource {
    private final Lock lock = new ReentrantLock();

    public void method() {
        lock.lock(); // ä¸Šé”
        try {
            // è®¿é—®å…±äº«èµ„æºçš„ä»£ç 
        } finally {
            lock.unlock(); // è§£é”
        }
    }
}

```

> **ReentrantLockä¸synchronizedçš„å¼‚åŒç‚¹ï¼š**
>
> 1. **ç›¸åŒç‚¹ï¼š**
>    â—‹ éƒ½å¯ä»¥ç”¨äºå®ç°çº¿ç¨‹é—´çš„åŒæ­¥ï¼Œç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºï¼Œé˜²æ­¢æ•°æ®ä¸ä¸€è‡´æˆ–ç¨‹åºå¼‚å¸¸ã€‚
> 2. **ä¸åŒç‚¹ï¼š
>    
>    **â—‹ synchronizedæ˜¯Javaå†…ç½®çš„åŒæ­¥æœºåˆ¶ï¼Œå®ƒæ˜¯éšå¼é”ï¼Œä½¿ç”¨èµ·æ¥æ›´ç®€å•ã€‚ReentrantLockæ˜¯æ˜¾å¼é”ï¼Œéœ€è¦æ‰‹åŠ¨ä¸Šé”å’Œè§£é”ï¼Œä½¿ç”¨èµ·æ¥æ›´çµæ´»ã€‚
>    â—‹ ReentrantLockæä¾›äº†æ›´å¤šçš„åŠŸèƒ½ï¼Œå¦‚å¯ä¸­æ–­é”ã€å¯è®¾ç½®è¶…æ—¶è·å–é”ã€å¯è®¾ç½®å…¬å¹³é”ç­‰ã€‚è€Œsynchronizedä¸å…·å¤‡è¿™äº›åŠŸèƒ½ã€‚
>    â—‹ synchronizedåœ¨é”é‡Šæ”¾åï¼Œç­‰å¾…ä¸­çš„çº¿ç¨‹æ˜¯éšæœºè·å¾—é”çš„ã€‚**è€ŒReentrantLockå¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é”ï¼ŒæŒ‰ç…§çº¿ç¨‹ç­‰å¾…çš„é¡ºåºåˆ†é…é”ï¼Œé™ä½çº¿ç¨‹é¥¥é¥¿çš„å¯èƒ½æ€§ã€‚**
>    â—‹ ReentrantLockå¯ä»¥ä¸Conditionå¯¹è±¡ç»“åˆä½¿ç”¨ï¼Œå®ç°æ›´ç²¾ç»†çš„çº¿ç¨‹é—´é€šä¿¡ï¼Œè€Œsynchronizedåªèƒ½é…åˆwait()ã€notify()å’ŒnotifyAll()æ–¹æ³•è¿›è¡Œçº¿ç¨‹é—´é€šä¿¡ã€‚
>    æ€»ä¹‹ï¼ŒReentrantLockä¸synchronizedåœ¨åŠŸèƒ½ä¸Šæœ‰ä¸€å®šçš„åŒºåˆ«ï¼ŒReentrantLockæä¾›äº†æ›´å¤šçš„åŠŸèƒ½å’Œçµæ´»æ€§ã€‚åœ¨é€‰æ‹©ä½¿ç”¨å“ªç§é”æœºåˆ¶æ—¶ï¼Œåº”æ ¹æ®å®é™…éœ€æ±‚å’Œåœºæ™¯æ¥åˆ¤æ–­ã€‚å¦‚æœå¯¹é”æ§åˆ¶çš„éœ€æ±‚æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥ä½¿ç”¨synchronizedï¼›å¦‚æœéœ€è¦æ›´å¤šçš„åŠŸèƒ½å’Œçµæ´»æ€§ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ReentrantLockã€‚


### synchroinzedä¸ReentrantLock(reï¼šå¯é‡å¤çš„ï¼Œentrant:å…¥ï¼ŒLockï¼šé”)çš„åŒºåˆ«

**æ€»ç»“ä¸€ä¸‹synchronizedä¸ReentrantLockçš„åº•å±‚å®ç°åŸç†ï¼š**

> **synchronized**æ˜¯åŸºäºJVMå±‚é¢çš„å†…ç½®é”ï¼Œå…¶åº•å±‚å®ç°åŸç†åŒ…æ‹¬Javaå¯¹è±¡å¤´ï¼ˆObject Headerï¼‰å’Œmonitorenter/monitorexitå­—èŠ‚ç æŒ‡ä»¤ã€‚JVMé€šè¿‡æ“ä½œå¯¹è±¡å¤´çš„Mark Wordå’Œä½¿ç”¨monitorenter/monitorexitæŒ‡ä»¤æ¥å®ç°çº¿ç¨‹åŒæ­¥ã€‚

> **ReentrantLock**æ˜¯åŸºäºJavaçš„AbstractQueuedSynchronizerï¼ˆç®€ç§°**AQS**ï¼‰æ¡†æ¶å®ç°çš„ã€‚AQSæä¾›äº†åŸºäº**FIFO**é˜Ÿåˆ—çš„ç­‰å¾…é˜Ÿåˆ—å’Œä¸€äº›ç”¨äºæ“ä½œåŒæ­¥çŠ¶æ€çš„æ–¹æ³•ã€‚ReentrantLocké€šè¿‡ç»§æ‰¿AQSå¹¶å®ç°å…¶æ–¹æ³•æ¥å®ç°çº¿ç¨‹åŒæ­¥ã€‚

:::warning
å¦å¤–ï¼Œè™½ç„¶synchronizedå’ŒReentrantLockéƒ½å¯ä»¥å®ç°çº¿ç¨‹åŒæ­¥ï¼Œä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼ŒReentrantLockå…·æœ‰æ›´å¤šçš„åŠŸèƒ½å’Œçµæ´»æ€§ã€‚ä¾‹å¦‚ï¼ŒReentrantLockæ”¯æŒå¯ä¸­æ–­çš„é”è·å–ã€å…¬å¹³å’Œéå…¬å¹³é”ç­–ç•¥ã€å¯é‡å…¥é”ã€æ¡ä»¶å˜é‡ç­‰ã€‚å› æ­¤ï¼Œåœ¨éœ€è¦æ›´å¤æ‚çš„åŒæ­¥éœ€æ±‚æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ReentrantLockã€‚ç„¶è€Œï¼Œå¦‚æœåŒæ­¥éœ€æ±‚è¾ƒç®€å•ï¼Œä½¿ç”¨synchronizedå…³é”®å­—å¾€å¾€æ›´åŠ ç®€æ´å’Œé«˜æ•ˆã€‚
:::

### ä¿¡å·é‡ï¼ˆSamaphoreï¼‰è¿›è¡ŒåŒæ­¥

> **Semaphoreï¼ˆä¿¡å·é‡ï¼‰æ˜¯ä¸€ç§ç”¨äºç®¡ç†å¹¶å‘è®¿é—®å…±äº«èµ„æºçš„å·¥å…·**ã€‚å¯ä»¥å°†å…¶çœ‹ä½œä¸€ä¸ªè®¡æ•°å™¨ï¼Œè¡¨ç¤ºæœ‰å¤šå°‘ä¸ªèµ„æºå¯ä»¥åŒæ—¶è¢«è®¿é—®ã€‚å½“ä¸€ä¸ªçº¿ç¨‹æƒ³è¦è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œéœ€è¦å…ˆä»Semaphoreè·å–ä¸€ä¸ªè®¸å¯ã€‚å¦‚æœSemaphoreä¸­æœ‰å¯ç”¨è®¸å¯ï¼Œè®¡æ•°å™¨å‡ä¸€ï¼Œçº¿ç¨‹å°±å¯ä»¥è®¿é—®å…±äº«èµ„æºï¼›å¦‚æœæ²¡æœ‰å¯ç”¨è®¸å¯ï¼Œçº¿ç¨‹éœ€è¦ç­‰å¾…ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹é‡Šæ”¾è®¸å¯ã€‚

> **ä¸¾ä¾‹ï¼š**
> å‡è®¾æœ‰ä¸€ä¸ªåœè½¦åœºï¼Œæ‹¥æœ‰Nä¸ªè½¦ä½ï¼ˆå…±äº«èµ„æºï¼‰ï¼Œæˆ‘ä»¬æƒ³è¦é™åˆ¶åœ¨åŒä¸€æ—¶é—´åªèƒ½æœ‰Nè¾†è½¦è¿›å…¥åœè½¦åœºã€‚Semaphoreå°±åƒæ˜¯ä¸€ä¸ªåœè½¦åœºç®¡ç†å‘˜ï¼Œç®¡ç†ç€Nä¸ªè½¦ä½çš„è®¸å¯è¯ã€‚æ¯å½“æœ‰è½¦è¿›å…¥åœè½¦åœºï¼Œéœ€è¦å…ˆä»ç®¡ç†å‘˜é‚£é‡Œæ‹¿åˆ°ä¸€ä¸ªè®¸å¯è¯ï¼Œå¦‚æœè®¸å¯è¯ä¸º0(å…±äº«èµ„æºå…¨éƒ¨è¢«å ç”¨)ï¼Œçº¿ç¨‹å°†é˜»å¡ç›´åˆ°æœ‰å…¶ä»–çº¿ç¨‹é‡Šæ”¾è®¸å¯è¯ã€‚å½“è½¦ç¦»å¼€æ—¶ï¼Œéœ€è¦å½’è¿˜è®¸å¯è¯ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨Semaphoreçš„ç®€å•ç¤ºä¾‹ï¼š

```java
import java.util.concurrent.Semaphore;

public class ParkingLot {
    private final Semaphore semaphore;

    public ParkingLot(int permits) {
        semaphore = new Semaphore(permits); // åˆå§‹åŒ–è®¸å¯è¯æ•°é‡
    }

    public void park() {
        try {
            semaphore.acquire(); // è·å–è®¸å¯è¯
            // è®¿é—®å…±äº«èµ„æºï¼ˆå¦‚åœè½¦ï¼‰çš„ä»£ç 
            Thread.sleep(2000); // å‡è®¾åœè½¦è¿‡ç¨‹éœ€è¦2ç§’é’Ÿ
        } catch (InterruptedException e) {
            e.printStackTrace();
        } finally {
            semaphore.release(); // é‡Šæ”¾è®¸å¯è¯
        }
    }
}

```

> ä½¿ç”¨Semaphoreï¼Œä½ å¯ä»¥å®ç°å¤šç§åŒæ­¥åœºæ™¯ï¼Œå¦‚é™åˆ¶èµ„æºè®¿é—®æ•°é‡ã€å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ç­‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ**ä¸synchronizedå’ŒReentrantLockç­‰é”æœºåˆ¶ä¸åŒï¼ŒSemaphoreä¸»è¦ç”¨äºæ§åˆ¶èµ„æºè®¿é—®çš„å¹¶å‘æ•°é‡ï¼Œè€Œä¸æ˜¯å®ç°äº’æ–¥è®¿é—®ã€‚**

### ä½¿ç”¨CountDownLatchè¿›è¡ŒåŒæ­¥ â­ï¸

> CountDownLatchæ˜¯Javaæä¾›çš„ä¸€ç§åŒæ­¥å·¥å…·ç±»ï¼Œå®ƒå…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆä¸€ç³»åˆ—æ“ä½œã€‚CountDownLatchåŒ…å«ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå½“è®¡æ•°å™¨å€¼å‡è‡³0æ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹å°†è¢«å”¤é†’ç»§ç»­æ‰§è¡Œã€‚
> **ä¸¾ä¾‹ï¼š**
> æƒ³è±¡æœ‰ä¸€ä¸ªè·‘æ­¥æ¯”èµ›ï¼Œè£åˆ¤éœ€è¦ç­‰å¾…æ‰€æœ‰è¿åŠ¨å‘˜éƒ½åˆ°è¾¾ç»ˆç‚¹åæ‰èƒ½å®£å¸ƒæ¯”èµ›ç»“æŸã€‚CountDownLatchå°±åƒæ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œè®°å½•ç€å°šæœªåˆ°è¾¾ç»ˆç‚¹çš„è¿åŠ¨å‘˜æ•°é‡ã€‚æ¯å½“æœ‰ä¸€ä¸ªè¿åŠ¨å‘˜åˆ°è¾¾ç»ˆç‚¹ï¼Œè®¡æ•°å™¨å‡ä¸€ã€‚å½“æ‰€æœ‰è¿åŠ¨å‘˜éƒ½åˆ°è¾¾ç»ˆç‚¹ï¼ˆè®¡æ•°å™¨å€¼ä¸º0ï¼‰ï¼Œè£åˆ¤å°±å¯ä»¥å®£å¸ƒæ¯”èµ›ç»“æŸã€‚

**ä»£ç ç¤ºä¾‹ï¼š**

```java
import java.util.concurrent.CountDownLatch;

public class CountDownLatchExample {
    public static void main(String[] args) {
        int numberOfThreads = 5; // çº¿ç¨‹æ•°
        CountDownLatch latch = new CountDownLatch(numberOfThreads);

        // åˆ›å»º5ä¸ªå·¥ä½œçº¿ç¨‹
        for (int i = 0; i < numberOfThreads; i++) {
            new Thread(() -> {
                System.out.println(Thread.currentThread().getName() + " å¼€å§‹æ‰§è¡Œä»»åŠ¡");
                try {
                    Thread.sleep((long) (Math.random() * 2000)); // æ¨¡æ‹Ÿä»»åŠ¡æ‰§è¡Œæ—¶é—´
                } catch (InterruptedException e) {
                    e.printStackTrace();
                } finally {
                    //é˜²æ­¢çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡å¼‚å¸¸ï¼Œå¯¼è‡´æ— æ³•è¿›è¡Œè®¡æ•°å™¨é€’å‡
                    System.out.println(Thread.currentThread().getName() + " ä»»åŠ¡æ‰§è¡Œå®Œæ¯•");
                    latch.countDown(); // ä»»åŠ¡å®Œæˆåï¼Œé€’å‡CountDownLatchè®¡æ•°å™¨
                }
            }, "çº¿ç¨‹" + (i + 1)).start();
        }

        System.out.println("ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆä»»åŠ¡...");

        try {
            latch.await(); // ä¸»çº¿ç¨‹ç­‰å¾…æ‰€æœ‰å·¥ä½œçº¿ç¨‹å®Œæˆä»»åŠ¡
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        System.out.println("æ‰€æœ‰çº¿ç¨‹ä»»åŠ¡å·²å®Œæˆï¼Œä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ");
    }
}

```

> åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªCountDownLatchå®ä¾‹ï¼Œè®¡æ•°å™¨åˆå§‹åŒ–ä¸º5ï¼Œè¡¨ç¤ºæœ‰5ä¸ªçº¿ç¨‹éœ€è¦å®Œæˆä»»åŠ¡ã€‚æˆ‘ä»¬åˆ›å»ºå¹¶å¯åŠ¨äº†5ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨å®Œæˆä»»åŠ¡åè°ƒç”¨latch.countDown()é€’å‡è®¡æ•°å™¨ã€‚
> ä¸»çº¿ç¨‹ï¼ˆåœ¨æœ¬ä¾‹ä¸­æ˜¯mainçº¿ç¨‹ï¼‰è°ƒç”¨latch.await()æ–¹æ³•ç­‰å¾…æ‰€æœ‰å·¥ä½œçº¿ç¨‹å®Œæˆä»»åŠ¡ã€‚å½“æ‰€æœ‰å·¥ä½œçº¿ç¨‹å®Œæˆä»»åŠ¡åï¼Œè®¡æ•°å™¨é€’å‡åˆ°0ï¼Œawait()æ–¹æ³•è¿”å›ï¼Œä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚


ä½¿ç”¨CountDownLatchçš„ä¸€ä¸ª**å…¸å‹åœºæ™¯æ˜¯**ï¼šåœ¨ä¸€ä¸ªå¤æ‚çš„å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œä¸»çº¿ç¨‹éœ€è¦ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆä¸€ç³»åˆ—ä»»åŠ¡åï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œåç»­æ“ä½œã€‚

:::success
ğŸ“¢ï¼š**å½“ç»“åˆçº¿ç¨‹æ± ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœçº¿ç¨‹æ± ä¸­é…ç½®çš„æ‹’ç»ç­–ç•¥æ˜¯æŠ›å¼‚å¸¸ä¹‹ç±»çš„ï¼Œé‚£å¯èƒ½å°±ä¼šå¯¼è‡´ç¨‹CountDownLatchçš„æ•°é‡æ— æ³•é€’å‡ã€‚è¿›è€Œå¯¼è‡´ä¸»çº¿ç¨‹ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚**
:::

#### æ‰©å±•ï¼š çº¿ç¨‹æ± +CountDownLatch

**æ–¹æ¡ˆä¸€ï¼š ä½¿ç”¨ThreadPoolExecutorçš„submit()åœ¨è¿”å›å€¼ä¸­è¿›è¡Œå¼‚å¸¸æƒ…å†µæ•è·å¹¶è¿›è¡Œé‡Šæ”¾å¼‚å¸¸çº¿ç¨‹**
å½“ä½¿ç”¨çº¿ç¨‹æ± æ—¶ï¼Œå¼‚å¸¸å¤„ç†çš„æ–¹å¼ä¼šæœ‰æ‰€ä¸åŒã€‚çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡æ—¶é‡åˆ°å¼‚å¸¸ï¼Œé€šå¸¸ä¸ä¼šå½±å“çº¿ç¨‹æ± æœ¬èº«çš„è¿è¡Œã€‚ç„¶è€Œï¼Œä¸Šè¿°ä»£ç ä¸­çš„CountDownLatchè®¡æ•°å™¨ä»ç„¶å¯èƒ½å—åˆ°å½±å“ï¼Œå¯¼è‡´ä¸»çº¿ç¨‹ä¸€ç›´ç­‰å¾…ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ThreadPoolExecutorçš„submit()æ–¹æ³•å°†ä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± ï¼Œå¹¶å¤„ç†ä»»åŠ¡ä¸­çš„å¼‚å¸¸ã€‚
ä¸‹é¢æ˜¯ä¸€ä¸ªä¿®æ”¹åçš„ç¤ºä¾‹ï¼Œç»“åˆçº¿ç¨‹æ± å’ŒCountDownLatchï¼š

```java
import java.util.concurrent.CountDownLatch;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.Future;
import java.util.concurrent.TimeUnit;

public class CountDownLatchWithThreadPoolExample {
    public static void main(String[] args) {
        int numberOfThreads = 5; // çº¿ç¨‹æ•°
        CountDownLatch latch = new CountDownLatch(numberOfThreads);
        ExecutorService executorService = Executors.newFixedThreadPool(numberOfThreads);

        // åˆ›å»º5ä¸ªå·¥ä½œçº¿ç¨‹
        for (int i = 0; i < numberOfThreads; i++) {
            Future<?> future = executorService.submit(() -> {
                System.out.println(Thread.currentThread().getName() + " å¼€å§‹æ‰§è¡Œä»»åŠ¡");
                try {
                    TimeUnit.MILLISECONDS.sleep((long) (Math.random() * 2000)); // æ¨¡æ‹Ÿä»»åŠ¡æ‰§è¡Œæ—¶é—´
                } catch (InterruptedException e) {
                    e.printStackTrace();
                } finally {
                    System.out.println(Thread.currentThread().getName() + " ä»»åŠ¡æ‰§è¡Œå®Œæ¯•");
                    latch.countDown(); // ä»»åŠ¡å®Œæˆåï¼Œé€’å‡CountDownLatchè®¡æ•°å™¨
                }
            });

            // å¤„ç†ä»»åŠ¡å¼‚å¸¸
            try {
                future.get();
            } catch (Exception e) {
                System.out.println("ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼š" + e.getMessage());
                latch.countDown(); // å³ä½¿å‘ç”Ÿå¼‚å¸¸ï¼Œä¹Ÿè¦é€’å‡è®¡æ•°å™¨ï¼Œä»¥å…ä¸»çº¿ç¨‹ä¸€ç›´ç­‰å¾…
            }
        }

        System.out.println("ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆä»»åŠ¡...");

        try {
            latch.await(); // ä¸»çº¿ç¨‹ç­‰å¾…æ‰€æœ‰å·¥ä½œçº¿ç¨‹å®Œæˆä»»åŠ¡
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        System.out.println("æ‰€æœ‰çº¿ç¨‹ä»»åŠ¡å·²å®Œæˆï¼Œä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ");

        // å…³é—­çº¿ç¨‹æ± 
        executorService.shutdown();
    }
}

```

> åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± å¹¶è·å–ä¸€ä¸ªFutureå¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Future.get()æ–¹æ³•ç­‰å¾…ä»»åŠ¡å®Œæˆå¹¶è·å–ç»“æœã€‚å¦‚æœä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼ŒFuture.get()æ–¹æ³•ä¼šæŠ›å‡ºä¸€ä¸ªExecutionExceptionå¼‚å¸¸ã€‚æˆ‘ä»¬å¯ä»¥æ•è·è¿™ä¸ªå¼‚å¸¸å¹¶å¤„ç†ï¼Œç¡®ä¿latch.countDown()åœ¨å¼‚å¸¸æƒ…å†µä¸‹ä»ç„¶ä¼šè¢«è°ƒç”¨ã€‚
> **éœ€è¦æ³¨æ„çš„æ˜¯**ï¼Œåœ¨æ•è·å¼‚å¸¸æ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é€’å‡CountDownLatchè®¡æ•°å™¨ï¼Œä»¥é˜²ä¸»çº¿ç¨‹ä¸€ç›´ç­‰å¾…ã€‚è¿™æ ·ï¼Œå³ä½¿çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡å‘ç”Ÿå¼‚å¸¸ï¼Œä¸»çº¿ç¨‹ä»ç„¶å¯ä»¥åœ¨æ‰€æœ‰ä»»åŠ¡å®Œæˆåç»§ç»­æ‰§è¡Œã€‚

**æ–¹æ¡ˆäºŒï¼šä½¿ç”¨éé˜»å¡å¼**
æ–¹æ¡ˆä¸€ä¸­æˆ‘ä»¬ä½¿ç”¨äº†Future.get()æ–¹æ³•æ¥ç­‰å¾…ä»»åŠ¡å®Œæˆå¹¶è·å–ç»“æœï¼Œè¿™æ˜¯ä¸€ä¸ª**é˜»å¡å¼è°ƒç”¨**ã€‚å¦‚æœæœ‰å¤§é‡ä»»åŠ¡éœ€è¦æ‰§è¡Œï¼Œè¿™ç§æ–¹å¼å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºä¸»çº¿ç¨‹éœ€è¦ç­‰å¾…æ¯ä¸ªä»»åŠ¡å®Œæˆã€‚

ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯é‡‡ç”¨å¼‚æ­¥å›è°ƒçš„æ–¹å¼ã€‚**å¯ä»¥ä½¿ç”¨CompletableFuture**ï¼Œ**å®ƒæ˜¯Futureçš„ä¸€ä¸ªæ‰©å±•ï¼Œæ”¯æŒå¼‚æ­¥å›è°ƒå’Œéé˜»å¡æ“ä½œã€‚**è¿™æ ·ï¼Œä¸»çº¿ç¨‹ä¸å¿…ç­‰å¾…æ¯ä¸ªä»»åŠ¡çš„å®Œæˆï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–æ“ä½œï¼Œè€Œåœ¨ä»»åŠ¡å®Œæˆæ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘ç›¸åº”çš„å›è°ƒæ–¹æ³•ã€‚
ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨CompletableFutureå’ŒCountDownLatchçš„ç¤ºä¾‹ï¼š

```java
import java.util.concurrent.*;

public class CompletableFutureWithThreadPoolExample {
    public static void main(String[] args) {
        int numberOfThreads = 5; // çº¿ç¨‹æ•°
        CountDownLatch latch = new CountDownLatch(numberOfThreads);
        ExecutorService executorService = Executors.newFixedThreadPool(numberOfThreads);

        // åˆ›å»º5ä¸ªå·¥ä½œçº¿ç¨‹
        for (int i = 0; i < numberOfThreads; i++) {
            CompletableFuture.supplyAsync(() -> {
                System.out.println(Thread.currentThread().getName() + " å¼€å§‹æ‰§è¡Œä»»åŠ¡");
                try {
                    TimeUnit.MILLISECONDS.sleep((long) (Math.random() * 2000)); // æ¨¡æ‹Ÿä»»åŠ¡æ‰§è¡Œæ—¶é—´
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                System.out.println(Thread.currentThread().getName() + " ä»»åŠ¡æ‰§è¡Œå®Œæ¯•");
                return null;
            }, executorService).whenCompleteAsync((result, exception) -> {
                if (exception != null) {
                    System.out.println("ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼š" + exception.getMessage());
                }
                latch.countDown(); // ä»»åŠ¡å®Œæˆåï¼Œé€’å‡CountDownLatchè®¡æ•°å™¨
            }, executorService);
        }

        System.out.println("ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆä»»åŠ¡...");

        try {
            latch.await(); // ä¸»çº¿ç¨‹ç­‰å¾…æ‰€æœ‰å·¥ä½œçº¿ç¨‹å®Œæˆä»»åŠ¡
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        System.out.println("æ‰€æœ‰çº¿ç¨‹ä»»åŠ¡å·²å®Œæˆï¼Œä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ");

        // å…³é—­çº¿ç¨‹æ± 
        executorService.shutdown();
    }
}

```

> åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†CompletableFuture.supplyAsync()æ–¹æ³•å°†ä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± ã€‚ä¸Futureä¸åŒï¼ŒCompletableFutureå…è®¸æˆ‘ä»¬åœ¨ä»»åŠ¡å®Œæˆæ—¶è‡ªåŠ¨è§¦å‘ä¸€ä¸ªå›è°ƒæ–¹æ³•ï¼Œæ— éœ€ä¸»çº¿ç¨‹ç­‰å¾…ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†whenComplete()æ–¹æ³•æ·»åŠ äº†ä¸€ä¸ªå›è°ƒï¼Œåœ¨ä»»åŠ¡å®Œæˆæˆ–å‘ç”Ÿå¼‚å¸¸æ—¶é€’å‡CountDownLatchè®¡æ•°å™¨ã€‚
> è¿™ç§æ–¹å¼å¯ä»¥æœ‰æ•ˆæé«˜ç¨‹åºçš„æ€§èƒ½ï¼Œå› ä¸ºä¸»çº¿ç¨‹ä¸éœ€è¦ç­‰å¾…æ¯ä¸ªä»»åŠ¡çš„å®Œæˆï¼Œå¯ä»¥å¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚å½“ç„¶ï¼Œæ ¹æ®å®é™…æƒ…å†µï¼Œæ‚¨è¿˜å¯ä»¥è€ƒè™‘å…¶ä»–Javaå¹¶å‘æ¡†æ¶ï¼ˆå¦‚Reactoræˆ–RxJavaï¼‰æ¥å®ç°æ›´é«˜çº§çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ã€‚


## çº¿ç¨‹é—´é€šä¿¡

### wait()ã€notify()ã€notifyAll()æ–¹æ³•

> çº¿ç¨‹é€šä¿¡æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé€šè¿‡æŸç§æœºåˆ¶æ¥ååŒå·¥ä½œï¼Œç›¸äº’å‘é€ä¿¡å·ä»¥è¾¾åˆ°å…±åŒå®Œæˆä»»åŠ¡çš„ç›®çš„ã€‚åœ¨Javaä¸­ï¼Œå¯ä»¥ä½¿ç”¨wait()ã€notify()å’ŒnotifyAll()æ–¹æ³•å®ç°çº¿ç¨‹é—´çš„é€šä¿¡ã€‚è¿™äº›æ–¹æ³•æ˜¯java.lang.Objectç±»çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤æ‰€æœ‰Javaå¯¹è±¡éƒ½å¯ä»¥ä½¿ç”¨å®ƒä»¬ã€‚
> wait()ã€notify()å’ŒnotifyAll()æ–¹æ³•ä¸»è¦ç”¨äºåŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ä¸­ï¼Œé…åˆsynchronizedå…³é”®å­—ä½¿ç”¨ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè·å–è¯¥å¯¹è±¡çš„é”ã€‚å¦‚æœå¦ä¸€ä¸ªçº¿ç¨‹æƒ³è¦è¿›å…¥åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ï¼Œå®ƒéœ€è¦ç­‰å¾…é”è¢«é‡Šæ”¾ã€‚
> ä»¥ä¸‹æ˜¯è¿™äº›æ–¹æ³•çš„ç®€è¦è¯´æ˜ï¼š

:::warning

1. **wait():** å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨æŸä¸ªå¯¹è±¡çš„wait()æ–¹æ³•æ—¶ï¼Œå®ƒä¼šé‡Šæ”¾è¯¥å¯¹è±¡çš„é”å¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚è¿™ä½¿å¾—å…¶ä»–çº¿ç¨‹å¯ä»¥è·å–é”å¹¶æ‰§è¡ŒåŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•ã€‚çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è¢«notify()æˆ–notifyAll()æ–¹æ³•å”¤é†’æˆ–è€…è¢«ä¸­æ–­ã€‚
2. **notify()**: å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨æŸä¸ªå¯¹è±¡çš„notify()æ–¹æ³•æ—¶ï¼Œå®ƒä¼šä»ç­‰å¾…è¯¥å¯¹è±¡é”çš„çº¿ç¨‹ä¸­éšæœºå”¤é†’ä¸€ä¸ªã€‚è¢«å”¤é†’çš„çº¿ç¨‹å°†å°è¯•é‡æ–°è·å–é”å¹¶ç»§ç»­æ‰§è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œnotify()æ–¹æ³•å¹¶ä¸ä¼šç«‹å³é‡Šæ”¾é”ï¼Œè€Œæ˜¯åœ¨åŒæ­¥ä»£ç å—æˆ–åŒæ­¥æ–¹æ³•æ‰§è¡Œå®Œæ¯•åé‡Šæ”¾ã€‚
3. **notifyAll():** å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨æŸä¸ªå¯¹è±¡çš„notifyAll()æ–¹æ³•æ—¶ï¼Œå®ƒä¼šå”¤é†’æ‰€æœ‰ç­‰å¾…è¯¥å¯¹è±¡é”çš„çº¿ç¨‹ã€‚è¿™äº›çº¿ç¨‹å°†ç«äº‰è·å–é”ï¼Œå¹¶æŒ‰ç…§è·å–é”çš„é¡ºåºç»§ç»­æ‰§è¡Œã€‚
   :::
   **ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨wait()å’Œnotify()å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹çš„ç¤ºä¾‹ï¼š**

```java
package org.thread;

public class Buffer {
    private int data = -1; // ç¼“å†²åŒºä¸­çš„æ•°æ®
    private boolean empty = true; // æ ‡è¯†ç¼“å†²åŒºæ˜¯å¦ä¸ºç©º

    // ç”Ÿäº§æ•°æ®çš„æ–¹æ³•
    public synchronized void produce(int newData) {
        // å½“ç¼“å†²åŒºä¸ä¸ºç©ºæ—¶ï¼Œç”Ÿäº§è€…çº¿ç¨‹ç­‰å¾…
        while (!empty) {
            try {
                wait(); // ç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        // ç”Ÿäº§æ•°æ®
        data = newData;
        empty = false; // å°†ç¼“å†²åŒºæ ‡è¯†ä¸ºéç©º
        System.out.println("ç”Ÿäº§è€…ç”Ÿäº§äº†æ•°æ®ï¼š" + data);
        notify(); // å”¤é†’æ¶ˆè´¹è€…çº¿ç¨‹
    }

    // æ¶ˆè´¹æ•°æ®çš„æ–¹æ³•
    public synchronized int consume() {
        // å½“ç¼“å†²åŒºä¸ºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ç­‰å¾…
        while (empty) {
            try {
                wait(); // ç­‰å¾…ç”Ÿäº§è€…ç”Ÿäº§æ•°æ®
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        // æ¶ˆè´¹æ•°æ®
        empty = true; // å°†ç¼“å†²åŒºæ ‡è¯†ä¸ºå·²ç©º
        System.out.println("æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ•°æ®ï¼š" + data);
        notify(); // å”¤é†’ç”Ÿäº§è€…çº¿ç¨‹
        return data;
    }
}

class BufferTest {
    public static void main(String[] args) {
        Buffer buffer = new Buffer(); // åˆ›å»ºä¸€ä¸ªç¼“å†²åŒºå®ä¾‹

        // åˆ›å»ºç”Ÿäº§è€…çº¿ç¨‹
        Thread producerThread = new Thread(() -> {
            for (int i = 1; i <= 5; i++) {
                buffer.produce(i);
                try {
                    Thread.sleep((long) (Math.random() * 1000)); // éšæœºç­‰å¾…ä¸€æ®µæ—¶é—´
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }, "ç”Ÿäº§è€…");

        // åˆ›å»ºæ¶ˆè´¹è€…çº¿ç¨‹
        Thread consumerThread = new Thread(() -> {
            for (int i = 1; i <= 5; i++) {
                buffer.consume();
                try {
                    Thread.sleep((long) (Math.random() * 1000)); // éšæœºç­‰å¾…ä¸€æ®µæ—¶é—´
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }, "æ¶ˆè´¹è€…");

        // å¯åŠ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çº¿ç¨‹
        producerThread.start();
        consumerThread.start();

        // ä¸»çº¿ç¨‹Mainç­‰å¾…ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çº¿ç¨‹æ‰§è¡Œå®Œæ¯•
        try {
            producerThread.join();
            consumerThread.join();
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        // ç”±äºä¸Šè¿°ä½¿ç”¨äº†producerThread.join();æ‰€ä»¥ä¸»çº¿ç¨‹ä¼šé˜»å¡ç›´åˆ°ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…éƒ½æ‰§è¡Œå®Œæ¯•åï¼Œä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ
        System.out.println("ç”Ÿäº§è€…-æ¶ˆè´¹è€…æµ‹è¯•å®Œæˆ");
    }


}

```

> åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨producerThread.join();å’ŒconsumerThread.join();æ–¹æ³•æ¥ç¡®ä¿mainçº¿ç¨‹ç­‰å¾…ç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œç„¶åè¾“å‡º"ç”Ÿäº§è€…-æ¶ˆè´¹è€…æµ‹è¯•å®Œæˆ"çš„æ¶ˆæ¯ã€‚è¿™æ ·å¯ä»¥**ç¡®ä¿åœ¨æ‰€æœ‰çº¿ç¨‹éƒ½å®Œæˆä»»åŠ¡ä¹‹å‰ï¼Œç¨‹åºä¸ä¼šæå‰é€€å‡ºã€‚**

### BlockingQueueæ¥å£åŠå…¶å®ç°ç±»ï¼ˆå¦‚ArrayBlockingQueueã€LinkedBlockingQueueï¼‰

> BlockingQueueæ˜¯Javaå¹¶å‘åŒ…java.util.concurrentä¸­çš„ä¸€ä¸ªæ¥å£ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—ï¼Œå¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å®‰å…¨åœ°å…±äº«å’Œæ“ä½œæ•°æ®ã€‚BlockingQueueæä¾›äº†ä¸€ç»„é˜»å¡æ“ä½œ**ï¼ˆå¦‚put()å’Œtake()**ï¼‰ï¼Œå®ƒä»¬å¯ä»¥è®©çº¿ç¨‹åœ¨éœ€è¦ç­‰å¾…é˜Ÿåˆ—å˜å¾—å¯ç”¨æ—¶è‡ªåŠ¨é˜»å¡ã€‚è¿™åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ç‰¹åˆ«æœ‰ç”¨ï¼Œæ¯”å¦‚å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ã€‚
> BlockingQueueæœ‰å¤šä¸ªå®ç°ç±»ï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„ä¸¤ä¸ªæ˜¯ArrayBlockingQueueå’ŒLinkedBlockingQueueï¼š

1. **ArrayBlockingQueue**ï¼šåŸºäºæ•°ç»„å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚é˜Ÿåˆ—çš„å®¹é‡åœ¨åˆ›å»ºæ—¶æŒ‡å®šï¼Œå¹¶ä¸”åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä¿æŒä¸å˜ã€‚å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œä»»ä½•å°è¯•å‘é˜Ÿåˆ—æ·»åŠ å…ƒç´ çš„æ“ä½œéƒ½å°†é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰ç©ºé—²ç©ºé—´ï¼›å½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œå°è¯•ä»é˜Ÿåˆ—ä¸­å–å‡ºå…ƒç´ çš„æ“ä½œå°†é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰å…ƒç´ å¯ç”¨ã€‚
2. **LinkedBlockingQueue**ï¼šåŸºäºé“¾è¡¨å®ç°çš„å¯é€‰æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚å¦‚æœåœ¨åˆ›å»ºæ—¶æŒ‡å®šäº†å®¹é‡ï¼Œåˆ™é˜Ÿåˆ—æœ‰ç•Œï¼›å¦‚æœæ²¡æœ‰æŒ‡å®šå®¹é‡ï¼Œåˆ™é˜Ÿåˆ—çš„å®¹é‡é»˜è®¤ä¸ºInteger.MAX_VALUEï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ— ç•Œé˜Ÿåˆ—ã€‚å’ŒArrayBlockingQueueä¸€æ ·ï¼Œå½“é˜Ÿåˆ—æ»¡æˆ–ç©ºæ—¶ï¼Œå°è¯•æ·»åŠ æˆ–å–å‡ºå…ƒç´ çš„æ“ä½œä¼šé˜»å¡ã€‚

ä»¥ä¸‹æ˜¯ä½¿ç”¨BlockingQueueå®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹çš„ç¤ºä¾‹ï¼š

```java
package org.thread;

import java.util.concurrent.BlockingQueue;
import java.util.concurrent.LinkedBlockingQueue;

public class BlockingQueueExample {
    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º3çš„é˜Ÿåˆ—
        BlockingQueue<Integer> queue = new LinkedBlockingQueue<>(3); 
        // åˆ›å»ºä¸€ä¸ªåŸºäºæ•°ç»„å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼šArrayBlockingQueue
        // BlockingQueue<Integer> queue = new ArrayBlockingQueue<>(1); 


        // ç”Ÿäº§è€…çº¿ç¨‹
        Thread producer = new Thread(() -> {
            for (int i = 1; i <= 10; i++) {
                try {
                    queue.put(i);
                    System.out.println("ç”Ÿäº§è€…ç”Ÿäº§äº†æ•°æ®ï¼š" + i);
                    Thread.sleep((long) (Math.random() * 1000));
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }, "ç”Ÿäº§è€…");

        // æ¶ˆè´¹è€…çº¿ç¨‹
        Thread consumer = new Thread(() -> {
            for (int i = 1; i <= 10; i++) {
                try {
                    int data = queue.take();
                    System.out.println("æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ•°æ®ï¼š" + data);
                    Thread.sleep((long) (Math.random() * 1000));
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }, "æ¶ˆè´¹è€…");

        // å¯åŠ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çº¿ç¨‹
        producer.start();
        consumer.start();
    }
}

```

### Conditionæ¥å£åŠå…¶å®ç°ç±»ï¼ˆå¦‚ReentrantLockçš„Conditionï¼‰

**Condition(æ¡ä»¶)**æ¥å£æ˜¯Javaå¹¶å‘åŒ…java.util.concurrent.locksä¸­çš„ä¸€ä¸ªæ¥å£ï¼Œå®ƒç”¨äºä¸Lockæ¥å£ä¸€èµ·ä½¿ç”¨ï¼Œæä¾›äº†æ›´ç»†ç²’åº¦çš„çº¿ç¨‹åŒæ­¥æ§åˆ¶ã€‚ä½¿ç”¨Conditionå¯ä»¥è®©ä½ åœ¨ä¸€ä¸ªé”çš„å¤šä¸ªç­‰å¾…é›†ä¹‹é—´åˆ’åˆ†çº¿ç¨‹ï¼Œä½¿å¾—çº¿ç¨‹å¯ä»¥åœ¨ä¸åŒæ¡ä»¶ä¸‹ç­‰å¾…ã€‚
**ReentrantLock(å¯é‡å…¥é”)å®ç°äº†Lockæ¥å£ï¼Œ**å®ƒæä¾›äº†ä¸synchronizedå…³é”®å­—ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½†å…·æœ‰æ›´é«˜çš„çµæ´»æ€§ã€‚å½“ä½¿ç”¨ReentrantLockæ—¶ï¼Œä½ å¯ä»¥è°ƒç”¨newCondition()æ–¹æ³•åˆ›å»ºä¸€ä¸ªä¸è¯¥é”å…³è”çš„Conditionå®ä¾‹ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ReentrantLockå’ŒConditionå®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹çš„ç¤ºä¾‹ï¼š

```java
import java.util.LinkedList;
import java.util.Queue;
import java.util.concurrent.locks.Condition;
import java.util.concurrent.locks.ReentrantLock;

public class ConditionExample {
    public static void main(String[] args) {
        Queue<Integer> buffer = new LinkedList<>(); // ç”¨LinkedListä½œä¸ºç¼“å†²åŒº
        int capacity = 3; // ç¼“å†²åŒºå®¹é‡

        ReentrantLock lock = new ReentrantLock(); // åˆ›å»ºä¸€ä¸ªå¯é‡å…¥é”
        Condition notFull = lock.newCondition(); // åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºç¼“å†²åŒºæœªæ»¡çš„æ¡ä»¶
        Condition notEmpty = lock.newCondition(); // åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºç¼“å†²åŒºéç©ºçš„æ¡ä»¶

        // ç”Ÿäº§è€…çº¿ç¨‹
        Thread producer = new Thread(() -> {
            for (int i = 1; i <= 10; i++) {
                lock.lock();
                try {
                    while (buffer.size() == capacity) {
                        notFull.await(); // ç­‰å¾…ç¼“å†²åŒºæœªæ»¡
                    }
                    buffer.add(i);
                    System.out.println("ç”Ÿäº§è€…ç”Ÿäº§äº†æ•°æ®ï¼š" + i);
                    notEmpty.signal(); // é€šçŸ¥æ¶ˆè´¹è€…ç¼“å†²åŒºéç©º
                } catch (InterruptedException e) {
                    e.printStackTrace();
                } finally {
                    lock.unlock();
                }

                try {
                    Thread.sleep((long) (Math.random() * 1000));
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }, "ç”Ÿäº§è€…");

        // æ¶ˆè´¹è€…çº¿ç¨‹
        Thread consumer = new Thread(() -> {
            for (int i = 1; i <= 10; i++) {
                lock.lock();
                try {
                    while (buffer.isEmpty()) {
                        notEmpty.await(); // ç­‰å¾…ç¼“å†²åŒºéç©º
                    }
                    int data = buffer.remove();
                    System.out.println("æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ•°æ®ï¼š" + data);
                    notFull.signal(); // é€šçŸ¥ç”Ÿäº§è€…ç¼“å†²åŒºæœªæ»¡
                } catch (InterruptedException e) {
                    e.printStackTrace();
                } finally {
                    lock.unlock();
                }

                try {
                    Thread.sleep((long) (Math.random() * 1000));
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }, "æ¶ˆè´¹è€…");

        // å¯åŠ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çº¿ç¨‹
        producer.start();
        consumer.start();
    }
}

```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªLinkedListä½œä¸ºç¼“å†²åŒºï¼Œå®¹é‡ä¸º3ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªReentrantLockå®ä¾‹å’Œä¸¤ä¸ªä¸è¯¥é”å…³è”çš„Conditionå®ä¾‹ï¼šnotFullå’ŒnotEmptyã€‚notFullè¡¨ç¤ºç¼“å†²åŒºæœªæ»¡çš„æ¡ä»¶ï¼ŒnotEmptyè¡¨ç¤ºç¼“å†²åŒºéç©ºçš„æ¡ä»¶ã€‚
ç”Ÿäº§è€…çº¿ç¨‹åœ¨æ¯æ¬¡ç”Ÿäº§æ•°æ®ä¹‹å‰ï¼Œå…ˆè·å–é”ï¼Œç„¶åæ£€æŸ¥ç¼“å†²åŒºæ˜¯å¦å·²æ»¡ã€‚å¦‚æœç¼“å†²åŒºæ»¡äº†ï¼Œç”Ÿäº§è€…çº¿ç¨‹ä¼šè°ƒç”¨notFull.await()æ–¹æ³•ç­‰å¾…notFullæ¡ä»¶æ»¡è¶³ï¼ˆå³ç¼“å†²åŒºæœªæ»¡ï¼‰ã€‚å½“æ¶ˆè´¹è€…çº¿ç¨‹ä»ç¼“å†²åŒºä¸­æ¶ˆè´¹æ•°æ®åï¼Œå®ƒä¼šè°ƒç”¨notFull.signal()æ–¹æ³•é€šçŸ¥ç­‰å¾…notFullæ¡ä»¶çš„çº¿ç¨‹ï¼ˆå³ç”Ÿäº§è€…çº¿ç¨‹ï¼‰ç¼“å†²åŒºæœªæ»¡ã€‚

ç±»ä¼¼åœ°ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹åœ¨æ¯æ¬¡æ¶ˆè´¹æ•°æ®ä¹‹å‰ï¼Œå…ˆè·å–é”ï¼Œç„¶åæ£€æŸ¥ç¼“å†²åŒºæ˜¯å¦ä¸ºç©ºã€‚å¦‚æœç¼“å†²åŒºä¸ºç©ºï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ä¼šè°ƒç”¨notEmpty.await()æ–¹æ³•ç­‰å¾…notEmptyæ¡ä»¶æ»¡è¶³ï¼ˆå³ç¼“å†²åŒºéç©ºï¼‰ã€‚å½“ç”Ÿäº§è€…çº¿ç¨‹å‘ç¼“å†²åŒºä¸­æ·»åŠ æ•°æ®åï¼Œå®ƒä¼šè°ƒç”¨notEmpty.signal()æ–¹æ³•é€šçŸ¥ç­‰å¾…notEmptyæ¡ä»¶çš„çº¿ç¨‹ï¼ˆå³æ¶ˆè´¹è€…çº¿ç¨‹ï¼‰ç¼“å†²åŒºéç©ºã€‚

> æ³¨æ„ï¼Œåœ¨è°ƒç”¨await()å’Œsignal()æ–¹æ³•ä¹‹å‰ï¼Œçº¿ç¨‹å¿…é¡»è·å¾—ä¸Conditionå…³è”çš„é”ã€‚æ­¤å¤–ï¼Œåœ¨è°ƒç”¨await()æ–¹æ³•åï¼Œçº¿ç¨‹ä¼šé‡Šæ”¾é”ï¼Œå…è®¸å…¶ä»–çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚å½“çº¿ç¨‹ä»await()æ–¹æ³•è¿”å›æ—¶ï¼ˆé€šå¸¸æ˜¯å› ä¸ºå…¶ä»–çº¿ç¨‹è°ƒç”¨äº†signal()æ–¹æ³•ï¼‰ï¼Œå®ƒä¼šè‡ªåŠ¨é‡æ–°è·å–é”ã€‚
> æœ€åï¼Œæˆ‘ä»¬åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çº¿ç¨‹ä¹‹é—´æ·»åŠ äº†éšæœºç­‰å¾…æ—¶é—´ï¼Œä»¥æ¨¡æ‹ŸçœŸå®åœºæ™¯ä¸­çš„å¼‚æ­¥æ“ä½œã€‚

## çº¿ç¨‹çš„æœ¬åœ°å­˜å‚¨ ThreadLocal â­ï¸

### æ¦‚å¿µåŠåº•å±‚å®ç°åŸç†

> **ThreadLocalæ¦‚å¿µæè¿°ï¼š**
> å‡è®¾ThreadLocalæ˜¯ä¸€ä¸ªæˆ¿é—´é‡Œçš„ä¸€ä¸ªå¤§è¡£æŸœã€‚è¿™ä¸ªè¡£æŸœé‡Œæœ‰è®¸å¤šä¸ªå°æ ¼å­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½åˆ†é…äº†ä¸€ä¸ªå±äºè‡ªå·±çš„å°æ ¼å­ã€‚æ¯ä¸ªçº¿ç¨‹åªèƒ½è®¿é—®å’Œæ“ä½œå®ƒè‡ªå·±çš„æ ¼å­ï¼Œä¸èƒ½è®¿é—®åˆ«äººçš„æ ¼å­ã€‚è¿™æ ·ä¸€æ¥ï¼Œçº¿ç¨‹ä¹‹é—´çš„æ•°æ®å°±ä¸ä¼šç›¸äº’å¹²æ‰°ã€‚
> å½“çº¿ç¨‹æƒ³è¦å­˜å‚¨æˆ–è·å–æ•°æ®æ—¶ï¼Œå®ƒä»¬ä¼šæ‰¾åˆ°è‡ªå·±çš„æ ¼å­ï¼Œç„¶åå°†æ•°æ®æ”¾è¿›å»æˆ–å–å‡ºæ¥ã€‚å°½ç®¡è¿™äº›çº¿ç¨‹åœ¨æ“ä½œåŒä¸€ä¸ªè¡£æŸœï¼Œä½†å› ä¸ºå®ƒä»¬å„è‡ªæœ‰ç‹¬ç«‹çš„æ ¼å­ï¼Œæ‰€ä»¥å®ƒä»¬çš„æ•°æ®æ˜¯å½¼æ­¤éš”ç¦»çš„ã€‚
> ç®€å•æ¥è¯´ï¼ŒThreadLocalå°±æ˜¯ä¸€ä¸ªè®©çº¿ç¨‹å¯ä»¥å®‰å…¨åœ°å­˜å‚¨å’Œè®¿é—®è‡ªå·±æ•°æ®çš„å·¥å…·ã€‚å®ƒä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®å­˜å‚¨ç©ºé—´ï¼Œç¡®ä¿çº¿ç¨‹é—´çš„æ•°æ®äº’ä¸å¹²æ‰°ã€‚

> **åº•å±‚å®ç°åŸç†ï¼š**
> **ThreadLocalçš„åº•å±‚åŸç†ä¸»è¦ä¾èµ–äºThreadç±»ä¸­çš„ä¸€ä¸ªåä¸ºthreadLocalsçš„å®ä¾‹å˜é‡**ã€‚**è¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ªThreadLocalMapç±»å‹çš„å¯¹è±¡ï¼Œè´Ÿè´£å­˜å‚¨å½“å‰çº¿ç¨‹çš„æ‰€æœ‰ThreadLocalå˜é‡ã€‚**
> ThreadLocalMapæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å“ˆå¸Œæ˜ å°„ï¼Œå…¶é”®æ˜¯ThreadLocalå¯¹è±¡ï¼Œå€¼æ˜¯ä¸ä¹‹å…³è”çš„çº¿ç¨‹å±€éƒ¨å˜é‡ã€‚å½“ä½ åœ¨æŸä¸ªçº¿ç¨‹ä¸­è®¾ç½®ä¸€ä¸ªThreadLocalå˜é‡æ—¶ï¼Œè¯¥å˜é‡ä¼šè¢«å­˜å‚¨åˆ°è¯¥çº¿ç¨‹çš„threadLocalså¯¹è±¡ä¸­ã€‚å½“ä½ åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­è·å–ThreadLocalå˜é‡æ—¶ï¼Œå®é™…ä¸Šæ˜¯ä»è¿™ä¸ªçº¿ç¨‹çš„threadLocalså¯¹è±¡ä¸­æ£€ç´¢å¯¹åº”çš„å€¼ã€‚
> è¿™é‡Œæ˜¯ThreadLocalçš„ä¸»è¦æ–¹æ³•åŠå…¶åº•å±‚åŸç†ï¼š
>
> 1. **set(value)**ï¼šå°†ThreadLocalå˜é‡è®¾ç½®ä¸ºvalueã€‚æ­¤æ–¹æ³•ä¼šå°†å½“å‰**ThreadLocalå¯¹è±¡ä½œä¸ºé”®**ï¼Œvalueä½œä¸ºå€¼å­˜å‚¨åˆ°å½“å‰çº¿ç¨‹çš„threadLocalså¯¹è±¡ä¸­ã€‚
> 2. **get()ï¼š**è·å–å½“å‰çº¿ç¨‹çš„ThreadLocalå˜é‡å€¼ã€‚æ­¤æ–¹æ³•ä¼šä»å½“å‰çº¿ç¨‹çš„threadLocalså¯¹è±¡ä¸­æ ¹æ®ThreadLocalå¯¹è±¡ä½œä¸ºé”®æ¥æ£€ç´¢å¯¹åº”çš„å€¼ã€‚
> 3. **remove()**ï¼šåˆ é™¤å½“å‰çº¿ç¨‹çš„ThreadLocalå˜é‡ã€‚æ­¤æ–¹æ³•ä¼šä»å½“å‰çº¿ç¨‹çš„threadLocalså¯¹è±¡ä¸­ç§»é™¤ä¸å½“å‰ThreadLocalå¯¹è±¡å…³è”çš„é”®å€¼å¯¹ï¼Œä»¥é¿å…å†…å­˜æ³„æ¼ã€‚
>
> ç”±äºThreadLocalMapä¸­çš„é”®å€¼å¯¹æ˜¯ä»¥ThreadLocalå¯¹è±¡ä½œä¸ºé”®ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„threadLocalså¯¹è±¡ï¼Œå› æ­¤ä¸åŒçº¿ç¨‹è®¿é—®ç›¸åŒçš„ThreadLocalå¯¹è±¡æ—¶ï¼Œå®ƒä»¬å®é™…ä¸Šæ˜¯åœ¨æ“ä½œå„è‡ªthreadLocalsä¸­çš„ä¸åŒé”®å€¼å¯¹ã€‚è¿™å°±æ˜¯ThreadLocalå®ç°çº¿ç¨‹å±€éƒ¨å˜é‡çš„åº•å±‚åŸç†ã€‚
>
> éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒThreadLocalMapä½¿ç”¨å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰æ¥å­˜å‚¨é”®ï¼Œè¿™æ„å‘³ç€å½“ThreadLocalå¯¹è±¡ä¸å†è¢«å¼•ç”¨æ—¶ï¼Œåƒåœ¾å›æ”¶å™¨å¯èƒ½ä¼šå›æ”¶å®ƒã€‚ä¸ºäº†é¿å…å†…å­˜æ³„æ¼ï¼Œä½¿ç”¨ThreadLocalæ—¶éœ€è¦ç¡®ä¿åœ¨ä¸å†éœ€è¦çº¿ç¨‹å±€éƒ¨å˜é‡æ—¶è°ƒç”¨remove()æ–¹æ³•æ¥æ¸…ç†ã€‚


### ä½¿ç”¨ThreadLocal

å‡è®¾æˆ‘ä»¬è¦å¼€å‘ä¸€ä¸ªå¤šçº¿ç¨‹åº”ç”¨ï¼Œæ¯ä¸ªçº¿ç¨‹éœ€è¦ç”Ÿæˆä¸€ç³»åˆ—éšæœºæ•°ã€‚ä¸ºäº†é¿å…å¤šä¸ªçº¿ç¨‹å…±äº«ä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå™¨å¯¹è±¡è€Œå¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ThreadLocalä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ä¸€ä¸ªç‹¬ç«‹çš„éšæœºæ•°ç”Ÿæˆå™¨ã€‚
ä»£ç ç¤ºä¾‹ï¼š

```java
import java.util.Random;

public class RandomGeneratorExample {
    // åˆ›å»ºä¸€ä¸ªThreadLocalå˜é‡ï¼Œç”¨äºå­˜å‚¨æ¯ä¸ªçº¿ç¨‹çš„éšæœºæ•°ç”Ÿæˆå™¨
    private static final ThreadLocal<Random> randomThreadLocal = ThreadLocal.withInitial(() -> {
        // éšæœºæ•°ç”Ÿæˆå™¨çš„åˆå§‹åŒ–æ“ä½œ
        System.out.println("Initializing random generator for thread: " + Thread.currentThread().getName());
        return new Random();
    });

    public static void main(String[] args) {
        // åˆ›å»º5ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹ç”Ÿæˆ10ä¸ªéšæœºæ•°
        for (int i = 0; i < 5; i++) {
            new Thread(() -> {
                for (int j = 0; j < 10; j++) {
                    // è·å–å½“å‰çº¿ç¨‹çš„éšæœºæ•°ç”Ÿæˆå™¨ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªéšæœºæ•°
                    int randomInt = randomThreadLocal.get().nextInt(100);
                    System.out.println(Thread.currentThread().getName() + " - Random number: " + randomInt);
                }
                // ä»»åŠ¡å®Œæˆåï¼Œæ¸…ç†ThreadLocalå˜é‡ï¼Œé¿å…å†…å­˜æ³„æ¼
                randomThreadLocal.remove();
            }).start();
        }
    }
}

```

### ğŸ“¢ThreadLocalä½¿ç”¨æ³¨æ„äº‹é¡¹

:::warning
è¦é¿å…åœ¨ä½¿ç”¨ThreadLocalæ—¶å‡ºç°å†…å­˜æ³„æ¼å’Œæ•°æ®é”™ä¹±çš„é—®é¢˜ï¼Œå¯ä»¥éµå¾ªä»¥ä¸‹å‡ ç‚¹ï¼š

1. æ¸…ç†ThreadLocalå˜é‡ï¼šåœ¨çº¿ç¨‹ä»»åŠ¡å®Œæˆåï¼ŒåŠ¡å¿…è°ƒç”¨ThreadLocalçš„remove()æ–¹æ³•æ¥æ¸…é™¤å¯¹åº”çº¿ç¨‹çš„å±€éƒ¨å˜é‡ã€‚è¿™å¯ä»¥ç¡®ä¿åœ¨çº¿ç¨‹è¢«é‡ç”¨æ—¶ï¼Œä¸ä¼šä¿ç•™ä¸Šä¸€ä¸ªä»»åŠ¡çš„å±€éƒ¨å˜é‡ï¼Œä»è€Œé˜²æ­¢æ•°æ®é”™ä¹±å’Œå†…å­˜æ³„æ¼ã€‚
2. é¿å…å…±äº«ThreadLocalå˜é‡ï¼šç¡®ä¿å°†ThreadLocalå˜é‡é™åˆ¶åœ¨æ¯ä¸ªçº¿ç¨‹çš„èŒƒå›´å†…ã€‚ä¸è¦å°†ThreadLocalå˜é‡çš„å¼•ç”¨ä¼ é€’ç»™å…¶ä»–çº¿ç¨‹ï¼Œè¿™å¯èƒ½å¯¼è‡´æ•°æ®é”™ä¹±ã€‚
3. å¤„ç†é™æ€ThreadLocalå˜é‡ï¼šå¦‚æœéœ€è¦ä½¿ç”¨é™æ€ThreadLocalï¼Œè¯·ç¡®ä¿åœ¨æ¯ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡åè°ƒç”¨remove()æ–¹æ³•æ¥æ¸…ç†å±€éƒ¨å˜é‡ã€‚é¿å…é™æ€ThreadLocalå˜é‡çš„ç”Ÿå‘½å‘¨æœŸä¸ç±»ç›¸åŒï¼Œå› æ­¤å®ƒå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚
4. ä½¿ç”¨å¼±å¼•ç”¨ThreadLocalå˜é‡ï¼šå¯ä»¥è€ƒè™‘ä½¿ç”¨java.lang.ref.WeakReferenceåˆ›å»ºThreadLocalå˜é‡ï¼Œè¿™æ ·åœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œå¦‚æœThreadLocalå˜é‡ä¸å†è¢«ä½¿ç”¨ï¼Œåƒåœ¾å›æ”¶å™¨å¯ä»¥è‡ªåŠ¨æ¸…é™¤å®ƒã€‚
5. åœ¨çº¿ç¨‹æ± åœºæ™¯ä¸‹çš„å¤„ç†ï¼š**åœ¨çº¿ç¨‹æ± åœºæ™¯ä¸‹ï¼Œçº¿ç¨‹ä¼šè¢«é‡ç”¨**ã€‚**ä¸ºäº†é¿å…å†…å­˜æ³„æ¼å’Œæ•°æ®é”™ä¹±ï¼Œéœ€è¦ç¡®ä¿åœ¨çº¿ç¨‹å®Œæˆä»»åŠ¡åï¼Œè°ƒç”¨ThreadLocalçš„remove()æ–¹æ³•æ¸…ç†å±€éƒ¨å˜é‡ã€‚**è¿™æ ·ï¼Œåœ¨çº¿ç¨‹ä»çº¿ç¨‹æ± ä¸­è¢«é‡ç”¨æ—¶ï¼Œå¯ä»¥ç¡®ä¿æ²¡æœ‰ä¸Šä¸€ä¸ªä»»åŠ¡çš„å±€éƒ¨å˜é‡æ®‹ç•™ã€‚
   éµå¾ªä¸Šè¿°å‡ ç‚¹åŸåˆ™ï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢ThreadLocalåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹äº§ç”Ÿæ•°æ®é”™ä¹±å’Œå†…å­˜æ³„æ¼é—®é¢˜ï¼ŒåŒ…æ‹¬çº¿ç¨‹æ± åœºæ™¯ã€‚
   :::

## çº¿ç¨‹ä¼˜å…ˆçº§å’Œè°ƒåº¦ â­ï¸

> **æ¦‚å¿µæè¿°ï¼š**
> çº¿ç¨‹ä¼˜å…ˆçº§æ˜¯ä¸€ä¸ªç”¨äºæè¿°çº¿ç¨‹åœ¨è°ƒåº¦è¿‡ç¨‹ä¸­ç›¸å¯¹äºå…¶ä»–çº¿ç¨‹çš„é‡è¦æ€§çš„æ¦‚å¿µã€‚åœ¨Javaä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªä¼˜å…ˆçº§ï¼Œ**ä¼˜å…ˆçº§çš„å€¼èŒƒå›´ä»1ï¼ˆæœ€ä½ï¼‰åˆ°10ï¼ˆæœ€é«˜ï¼‰**ã€‚é»˜è®¤æƒ…å†µä¸‹**ï¼Œä¸»çº¿ç¨‹çš„ä¼˜å…ˆçº§ä¸º5**ï¼Œæ–°åˆ›å»ºçš„çº¿ç¨‹ä¼šç»§æ‰¿åˆ›å»ºå®ƒçš„çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚**å¯ä»¥é€šè¿‡Threadç±»çš„setPriority(int)æ–¹æ³•æ¥è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œé€šè¿‡getPriority()æ–¹æ³•æ¥è·å–çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚**
> çº¿ç¨‹è°ƒåº¦æ˜¯æ“ä½œç³»ç»Ÿä¸ºäº†ç¡®ä¿æ‰€æœ‰çº¿ç¨‹èƒ½å¤Ÿå…¬å¹³åœ°å…±äº«CPUèµ„æºè€Œè¿›è¡Œçš„ä¸€ç§ç®¡ç†æ´»åŠ¨ã€‚æ ¹æ®çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œæ“ä½œç³»ç»Ÿä¼šé€‰æ‹©ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€æ®µæ—¶é—´ï¼Œç„¶åå†é€‰æ‹©å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œä»¥æ­¤ç±»æ¨ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¼˜å…ˆçº§è¶Šé«˜çš„çº¿ç¨‹ä¼šè¢«æ“ä½œç³»ç»Ÿæ›´é¢‘ç¹åœ°é€‰ä¸­æ‰§è¡Œã€‚
> ä½†æ˜¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œçº¿ç¨‹ä¼˜å…ˆçº§å¹¶ä¸èƒ½ä¿è¯çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºã€‚å› ä¸ºçº¿ç¨‹è°ƒåº¦ä¾èµ–äºæ“ä½œç³»ç»Ÿå’ŒJVMçš„å®ç°ï¼Œä¸åŒçš„æ“ä½œç³»ç»Ÿå¯èƒ½æœ‰ä¸åŒçš„è°ƒåº¦ç­–ç•¥ã€‚æ­¤å¤–ï¼Œçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºè¿˜å¯èƒ½å—åˆ°å…¶ä»–å› ç´ çš„å½±å“ï¼Œä¾‹å¦‚CPUçš„å¯ç”¨æ€§ã€çº¿ç¨‹çŠ¶æ€ç­‰ã€‚
> é€šä¿—åœ°è¯´ï¼Œçº¿ç¨‹çš„ä¼˜å…ˆçº§å°±åƒæ˜¯ä¸€å®¶é¤å…é‡Œé¡¾å®¢çš„ç­‰å¾…ä¼˜å…ˆçº§ã€‚åœ¨ç­‰å¾…æ—¶é—´è¾ƒé•¿çš„é¡¾å®¢ï¼ˆé«˜ä¼˜å…ˆçº§çº¿ç¨‹ï¼‰å’Œç­‰å¾…æ—¶é—´è¾ƒçŸ­çš„é¡¾å®¢ï¼ˆä½ä¼˜å…ˆçº§çº¿ç¨‹ï¼‰ä¹‹é—´ï¼ŒæœåŠ¡å‘˜ï¼ˆæ“ä½œç³»ç»Ÿï¼‰ä¼šæ›´å€¾å‘äºä¼˜å…ˆä¸ºç­‰å¾…æ—¶é—´è¾ƒé•¿çš„é¡¾å®¢æä¾›æœåŠ¡ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€ç­‰å¾…æ—¶é—´è¾ƒçŸ­çš„é¡¾å®¢ä¸€å®šä¼šåœ¨ç­‰å¾…æ—¶é—´è¾ƒé•¿çš„é¡¾å®¢ä¹‹åå¾—åˆ°æœåŠ¡ï¼Œå› ä¸ºå®é™…çš„æœåŠ¡é¡ºåºå¯èƒ½å—åˆ°å…¶ä»–å› ç´ çš„å½±å“ï¼ˆä¾‹å¦‚çªç„¶æœ‰ä¸€ä½VIPé¡¾å®¢å‡ºç°ï¼‰ã€‚
> æ€»ä¹‹ï¼Œ**åœ¨ä½¿ç”¨çº¿ç¨‹ä¼˜å…ˆçº§æ—¶ï¼Œåº”è¯¥è°¨æ…ä¾èµ–å®ƒæ¥æ§åˆ¶çº¿ç¨‹çš„æ‰§è¡Œé¡ºåº**ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œæ›´æ¨èä½¿ç”¨å…¶ä»–åŒæ­¥æ§åˆ¶æœºåˆ¶ï¼Œä¾‹å¦‚é”ã€ä¿¡å·é‡ã€å€’è®¡æ—¶é—©ç­‰æ¥ç¡®ä¿çº¿ç¨‹ä¹‹é—´çš„æ­£ç¡®æ‰§è¡Œé¡ºåºã€‚

### ç†è§£çº¿ç¨‹çš„ä¼˜å…ˆçº§åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šçš„è¡¨ç°

| **æ“ä½œç³»ç»Ÿ** | **çº¿ç¨‹ä¼˜å…ˆçº§è¡¨ç°**                                           | **å»ºè®®**                                         |
| ------------ | ------------------------------------------------------------ | ------------------------------------------------ |
| Windows      | Javaçº¿ç¨‹ä¼˜å…ˆçº§è¾ƒå¥½åœ°æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçº¿ç¨‹ä¼˜å…ˆçº§ï¼Œçº¿ç¨‹æ‰§è¡Œé¡ºåºå—ä¼˜å…ˆçº§è¾ƒå¤§å½±å“ã€‚ | ä½¿ç”¨çº¿ç¨‹ä¼˜å…ˆçº§å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ§åˆ¶çº¿ç¨‹æ‰§è¡Œé¡ºåºã€‚ |
| Linux        | Javaçº¿ç¨‹ä¼˜å…ˆçº§è¡¨ç°ä¸æ˜æ˜¾ï¼Œçº¿ç¨‹è°ƒåº¦å—å¤šç§å› ç´ å½±å“ï¼Œä¼˜å…ˆçº§å½±å“è¾ƒå°ã€‚ | æ›´æ¨èä½¿ç”¨é”ã€ä¿¡å·é‡ã€å€’è®¡æ—¶é—©ç­‰åŒæ­¥æ§åˆ¶æœºåˆ¶ã€‚   |
| macOS        | ç±»ä¼¼äºLinuxï¼ŒJavaçº¿ç¨‹ä¼˜å…ˆçº§è¡¨ç°ä¸æ˜æ˜¾ï¼Œçº¿ç¨‹è°ƒåº¦å—å¤šç§å› ç´ å½±å“ï¼Œä¼˜å…ˆçº§å½±å“è¾ƒå°ã€‚ | æ›´æ¨èä½¿ç”¨é”ã€ä¿¡å·é‡ã€å€’è®¡æ—¶é—©ç­‰åŒæ­¥æ§åˆ¶æœºåˆ¶ã€‚   |

åœ¨è·¨å¹³å°çš„Javaç¨‹åºä¸­ï¼Œç”±äºçº¿ç¨‹ä¼˜å…ˆçº§åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸Šçš„è¡¨ç°å¯èƒ½æœ‰æ‰€å·®å¼‚ï¼Œå› æ­¤ä¸å»ºè®®å®Œå…¨ä¾èµ–çº¿ç¨‹ä¼˜å…ˆçº§æ¥æ§åˆ¶çº¿ç¨‹æ‰§è¡Œé¡ºåºã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œæ›´æ¨èä½¿ç”¨å…¶ä»–åŒæ­¥æ§åˆ¶æœºåˆ¶ï¼Œå¦‚é”ã€ä¿¡å·é‡ã€å€’è®¡æ—¶é—©ç­‰ï¼Œè¿™äº›åŒæ­¥æ§åˆ¶æœºåˆ¶åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸Šçš„è¡¨ç°æ›´åŠ ä¸€è‡´å’Œå¯é ã€‚

## å®šæ—¶å™¨å’Œå®šæ—¶ä»»åŠ¡ â­ï¸

### Timerç±»ä¸TimerTaskç±»

> **æ¦‚å¿µæè¿°ï¼š**
> åœ¨Javaä¸­ï¼Œå¯ä»¥ä½¿ç”¨Timerç±»å’ŒTimerTaskç±»å®ç°å®šæ—¶å™¨ä¸å®šæ—¶ä»»åŠ¡çš„åŠŸèƒ½ã€‚Timerç±»è´Ÿè´£ç®¡ç†å®šæ—¶ä»»åŠ¡çš„è°ƒåº¦ï¼ŒTimerTaskæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç”¨äºå®ç°å…·ä½“çš„å®šæ—¶ä»»åŠ¡ã€‚
>
> **ä»¥ä¸‹æ˜¯Javaå®šæ—¶å™¨ä¸å®šæ—¶ä»»åŠ¡çš„åŸºæœ¬æ¦‚å¿µåŠä½¿ç”¨æ–¹æ³•ï¼š**
>
> 1. **Timer**ï¼šTimerç±»ç”¨äºåˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå®ƒå¯ä»¥æŒ‰ç…§å›ºå®šçš„æ—¶é—´é—´éš”æˆ–è€…æŒ‡å®šçš„æ—¶é—´æ‰§è¡Œå®šæ—¶ä»»åŠ¡ã€‚å¯ä»¥ä½¿ç”¨schedule()æ–¹æ³•å°†å®šæ—¶ä»»åŠ¡æ·»åŠ åˆ°å®šæ—¶å™¨ä¸­ã€‚Timerç±»çš„å®ä¾‹å¯ä»¥ç®¡ç†å¤šä¸ªå®šæ—¶ä»»åŠ¡ï¼Œä½†æ‰€æœ‰ä»»åŠ¡éƒ½æ˜¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­é¡ºåºæ‰§è¡Œçš„ã€‚
> 2. **TimerTask**ï¼šTimerTaskæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒå®ç°äº†Runnableæ¥å£ã€‚è¦åˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œéœ€è¦ç»§æ‰¿TimerTaskç±»å¹¶å®ç°run()æ–¹æ³•ã€‚åœ¨run()æ–¹æ³•ä¸­ï¼Œå¯ä»¥æ·»åŠ éœ€è¦å®šæ—¶æ‰§è¡Œçš„ä»»åŠ¡é€»è¾‘ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨Timerå’ŒTimerTaskå®ç°å®šæ—¶å™¨ä¸å®šæ—¶ä»»åŠ¡ï¼š

```java
package org.Timer_TimerTask;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.Date;
import java.util.Timer;
import java.util.TimerTask;

public class TimerExample {
    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ªTimerå®ä¾‹
        Timer timer = new Timer();

        // åˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œç»§æ‰¿TimerTaskç±»å¹¶å®ç°run()æ–¹æ³•
        TimerTask task = new TimerTask() {
            @Override
            public void run() {
                System.out.println("å®šæ—¶ä»»åŠ¡æ‰§è¡Œï¼š" + LocalDateTime.now());
            }
        };

        // å°†å®šæ—¶ä»»åŠ¡æ·»åŠ åˆ°å®šæ—¶å™¨ä¸­ï¼Œè®¾ç½®é¦–æ¬¡æ‰§è¡Œæ—¶é—´ä¸º1ç§’åï¼Œä¹‹åæ¯éš”2ç§’æ‰§è¡Œä¸€æ¬¡
        timer.schedule(task, 1000, 2000);
    }
}

```

**ç–‘é—®â“**
**åœ¨å®é™…å¼€å‘ä¸­ï¼Œç›´æ¥ä½¿ç”¨Javaçš„Timerå’ŒTimerTaskè¿›è¡Œåˆ›å»ºå®šæ—¶å™¨å’Œå®šæ—¶ä»»åŠ¡çš„æƒ…å†µè¾ƒå°‘ï¼ŒåŸå› å¦‚ä¸‹ï¼š**

1. **åŠŸèƒ½æœ‰é™**ï¼šTimerå’ŒTimerTaskæä¾›äº†åŸºæœ¬çš„å®šæ—¶ä»»åŠ¡è°ƒåº¦åŠŸèƒ½ï¼Œä½†åœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½ä¸è¶³ä»¥æ»¡è¶³éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œå®ƒä»¬ä¸æ”¯æŒCRONè¡¨è¾¾å¼ï¼Œè¿™æ„å‘³ç€åœ¨è®¾ç½®å¤æ‚çš„æ‰§è¡Œè®¡åˆ’æ—¶å¯èƒ½ä¼šé‡åˆ°å›°éš¾ã€‚
2. **ç¼ºä¹çµæ´»æ€§**ï¼šTimeråªæ”¯æŒå•çº¿ç¨‹æ‰§è¡Œå®šæ—¶ä»»åŠ¡ã€‚å¦‚æœä¸€ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œä¼šå½±å“å…¶ä»–ä»»åŠ¡çš„æ‰§è¡Œã€‚è€Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œå®šæ—¶ä»»åŠ¡ä»¥æé«˜æ•ˆç‡ã€‚è™½ç„¶å¯ä»¥é€šè¿‡åˆ›å»ºå¤šä¸ªTimerå®ä¾‹æ¥å®ç°å¤šçº¿ç¨‹ï¼Œä½†è¿™æ ·åšä¼šå¯¼è‡´ä»£ç å†—ä½™ä¸”éš¾ä»¥ç®¡ç†ã€‚
3. **é”™è¯¯å¤„ç†ä¸è¶³**ï¼šTimerå¯¹äºä»»åŠ¡æ‰§è¡Œä¸­çš„é”™è¯¯å¤„ç†èƒ½åŠ›è¾ƒå¼±ã€‚å½“ä¸€ä¸ªTimerTaskæŠ›å‡ºæœªæ•è·çš„å¼‚å¸¸æ—¶ï¼Œæ•´ä¸ªTimerçº¿ç¨‹ä¼šç»ˆæ­¢ï¼Œå¯¼è‡´å…¶ä»–ä»»åŠ¡æ— æ³•ç»§ç»­æ‰§è¡Œã€‚è¿™åœ¨å®é™…å¼€å‘ä¸­æ˜¯ä¸å¯æ¥å—çš„ã€‚
4. **æ›´ä¼˜ç§€çš„æ›¿ä»£æ–¹æ¡ˆ**ï¼šæœ‰è®¸å¤šå…¶ä»–çš„å®šæ—¶ä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œå¦‚ScheduledExecutorServiceã€Quartzæˆ–Springçš„@Scheduledæ³¨è§£ç­‰ï¼Œå®ƒä»¬æä¾›äº†æ›´ä¸°å¯Œçš„åŠŸèƒ½ã€æ›´å¥½çš„çµæ´»æ€§å’Œæ›´å¥å£®çš„é”™è¯¯å¤„ç†ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¼€å‘è€…æ›´å€¾å‘äºé€‰æ‹©è¿™äº›æ›´å…ˆè¿›ã€åŠŸèƒ½æ›´å®Œå–„çš„æ¡†æ¶æ¥å®ç°å®šæ—¶ä»»åŠ¡ã€‚

**ç»¼ä¸Šæ‰€è¿°ï¼Œç”±äºTimerå’ŒTimerTaskåœ¨åŠŸèƒ½ã€çµæ´»æ€§å’Œé”™è¯¯å¤„ç†æ–¹é¢çš„å±€é™æ€§ï¼Œä»¥åŠæ›´ä¼˜ç§€çš„æ›¿ä»£æ–¹æ¡ˆçš„å­˜åœ¨ï¼Œå®é™…å¼€å‘è¿‡ç¨‹ä¸­ç›´æ¥ä½¿ç”¨Timerå’ŒTimerTaskçš„æƒ…å†µè¾ƒå°‘ã€‚**

### ScheduleExecutorServiceæ¥å£åŠå…¶å®ç°ç±»ï¼ˆScheduledThreadPoolExecutorï¼‰

> **ScheduledExecutorService**æ˜¯java.util.concurrentåŒ…ä¸­çš„ä¸€ä¸ªæ¥å£ï¼Œå®ƒç»§æ‰¿è‡ªExecutorServiceæ¥å£ï¼Œç”¨äºè¡¨ç¤ºå¯ä»¥åœ¨ç»™å®šçš„å»¶è¿Ÿåè¿è¡Œæˆ–å‘¨æœŸæ€§æ‰§è¡Œå‘½ä»¤çš„çº¿ç¨‹æ± ã€‚ScheduledExecutorServiceæ˜¯ä¸€ä¸ªæ›´ç°ä»£ã€çµæ´»çš„å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨ï¼Œæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½å’Œè‰¯å¥½çš„é”™è¯¯å¤„ç†ã€‚
> åœ¨java.util.concurrentåŒ…ä¸­ï¼Œæœ‰ä¸€ä¸ªå¸¸ç”¨çš„ScheduledExecutorServiceå®ç°ç±»ï¼Œå³**ScheduledThreadPoolExecutor**ã€‚**ScheduledThreadPoolExecutoræ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå®ƒå¯ä»¥åœ¨ç»™å®šçš„å»¶è¿Ÿåè¿è¡Œæˆ–å‘¨æœŸæ€§æ‰§è¡Œå‘½ä»¤ã€‚**

ä¸¾ä¾‹ï¼š 

```java
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

public class ScheduledExecutorServiceExample {

    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ªå…·æœ‰2ä¸ªæ ¸å¿ƒçº¿ç¨‹çš„ScheduledThreadPoolExecutorå®ä¾‹
        ScheduledExecutorService scheduledExecutorService = Executors.newScheduledThreadPool(2);

        // åˆ›å»ºä¸€ä¸ªRunnableä»»åŠ¡ï¼Œæ‰“å°å½“å‰çº¿ç¨‹åç§°å’Œå½“å‰æ—¶é—´
        Runnable task = () -> {
            System.out.println("Thread: " + Thread.currentThread().getName() + ", time: " + System.currentTimeMillis());
        };

        // å®‰æ’ä¸€ä¸ªRunnableä»»åŠ¡åœ¨3ç§’åæ‰§è¡Œ
        scheduledExecutorService.schedule(task, 3, TimeUnit.SECONDS);

        // å®‰æ’ä¸€ä¸ªRunnableä»»åŠ¡åœ¨åˆå§‹å»¶è¿Ÿ1ç§’åå¼€å§‹ï¼Œç„¶åæ¯2ç§’é‡å¤æ‰§è¡Œä¸€æ¬¡
        scheduledExecutorService.scheduleAtFixedRate(task, 1, 2, TimeUnit.SECONDS);

        // å®‰æ’ä¸€ä¸ªRunnableä»»åŠ¡åœ¨åˆå§‹å»¶è¿Ÿ2ç§’åå¼€å§‹ï¼Œç„¶ååœ¨æ¯æ¬¡æ‰§è¡Œå®Œæˆåç­‰å¾…1ç§’å†é‡å¤æ‰§è¡Œ
        scheduledExecutorService.scheduleWithFixedDelay(task, 2, 1, TimeUnit.SECONDS);

        // ä¸ºäº†è®©ç¤ºä¾‹æŒç»­è¿è¡Œä¸€æ®µæ—¶é—´ï¼Œè¿™é‡Œè®©ä¸»çº¿ç¨‹ç¡çœ 10ç§’
        try {
            Thread.sleep(10000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        // å…³é—­ScheduledExecutorServiceï¼Œåœæ­¢æ¥æ”¶æ–°çš„ä»»åŠ¡ï¼Œç­‰å¾…å·²æäº¤ä»»åŠ¡æ‰§è¡Œå®Œæˆåå…³é—­çº¿ç¨‹æ± 
        scheduledExecutorService.shutdown();
    }
}

```

```java
import java.lang.management.ManagementFactory;
import java.lang.management.MemoryMXBean;
import java.lang.management.MemoryUsage;
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

public class MemoryMonitorExample {

    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ªå…·æœ‰1ä¸ªæ ¸å¿ƒçº¿ç¨‹çš„ScheduledThreadPoolExecutorå®ä¾‹
        ScheduledExecutorService scheduledExecutorService = Executors.newScheduledThreadPool(1);

        // åˆ›å»ºä¸€ä¸ªRunnableä»»åŠ¡ï¼Œç”¨äºç›‘æ§ç³»ç»Ÿå†…å­˜ä½¿ç”¨æƒ…å†µ
        Runnable memoryMonitorTask = () -> {
            MemoryMXBean memoryMXBean = ManagementFactory.getMemoryMXBean();
            MemoryUsage heapMemoryUsage = memoryMXBean.getHeapMemoryUsage();
            MemoryUsage nonHeapMemoryUsage = memoryMXBean.getNonHeapMemoryUsage();

            System.out.println("Heap memory used: " + heapMemoryUsage.getUsed() + " bytes");
            System.out.println("Non-heap memory used: " + nonHeapMemoryUsage.getUsed() + " bytes");
        };

        // å®‰æ’å†…å­˜ç›‘æ§ä»»åŠ¡åœ¨åˆå§‹å»¶è¿Ÿ1ç§’åå¼€å§‹ï¼Œç„¶åæ¯5ç§’é‡å¤æ‰§è¡Œä¸€æ¬¡
        scheduledExecutorService.scheduleAtFixedRate(memoryMonitorTask, 1, 5, TimeUnit.SECONDS);

        // ä¸ºäº†è®©ç¤ºä¾‹æŒç»­è¿è¡Œä¸€æ®µæ—¶é—´ï¼Œè¿™é‡Œè®©ä¸»çº¿ç¨‹ç¡çœ 30ç§’
        try {
            Thread.sleep(30000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        // å…³é—­ScheduledExecutorServiceï¼Œåœæ­¢æ¥æ”¶æ–°çš„ä»»åŠ¡ï¼Œç­‰å¾…å·²æäº¤ä»»åŠ¡æ‰§è¡Œå®Œæˆåå…³é—­çº¿ç¨‹æ± 
        scheduledExecutorService.shutdown();
    }
}

```

ä»¥ä¸Šä¸¤ç§æ–¹å¼éƒ½é‡‡ç”¨äº†ä¸Šä¸»çº¿ç¨‹ç¡çœ çš„æ–¹å¼ï¼Œä½†æ˜¯åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¸èƒ½é‡‡ç”¨ç¡çœ æ–¹å¼ï¼Œåº”è¯¥é‡‡ç”¨ä½¿ç”¨CountDownLatchæ¥é˜»å¡ä¸»çº¿ç¨‹ã€‚åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œæˆ‘ä»¬å°†CountDownLatchçš„è®¡æ•°å™¨åˆå§‹åŒ–ä¸º1ï¼Œè¡¨ç¤ºä¸»çº¿ç¨‹éœ€è¦ç­‰å¾…è‡³å°‘ä¸€ä¸ªä»»åŠ¡å®Œæˆã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨CountDownLatchçš„awaitæ–¹æ³•æ¥é˜»å¡ä¸»çº¿ç¨‹ï¼Œç›´åˆ°è‡³å°‘ä¸€ä¸ªä»»åŠ¡å®Œæˆã€‚åœ¨ä»»åŠ¡å®Œæˆæ—¶ï¼Œæˆ‘ä»¬å°†CountDownLatchçš„è®¡æ•°å™¨å‡1ã€‚
**ä»¥ä¸‹æ˜¯ä½¿ç”¨CountDownLatch+ScheduledThreadPoolExecutorçš„ç¤ºä¾‹ï¼š**

```java
import java.util.concurrent.CountDownLatch;
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

public class ScheduledExecutorServiceExampleWithCountDownLatch {

    public static void main(String[] args) throws InterruptedException {
        // åˆ›å»ºä¸€ä¸ªå…·æœ‰2ä¸ªæ ¸å¿ƒçº¿ç¨‹çš„ScheduledThreadPoolExecutorå®ä¾‹
        ScheduledExecutorService scheduledExecutorService = Executors.newScheduledThreadPool(2);

        // åˆ›å»ºä¸€ä¸ªCountDownLatchï¼Œç”¨äºé˜»å¡ä¸»çº¿ç¨‹
        CountDownLatch countDownLatch = new CountDownLatch(1);

        // åˆ›å»ºä¸€ä¸ªRunnableä»»åŠ¡ï¼Œæ‰“å°å½“å‰çº¿ç¨‹åç§°å’Œå½“å‰æ—¶é—´
        Runnable task = () -> {
            System.out.println("Thread: " + Thread.currentThread().getName() + ", time: " + System.currentTimeMillis());
        };

        // å®‰æ’ä¸€ä¸ªRunnableä»»åŠ¡åœ¨3ç§’åæ‰§è¡Œ
        scheduledExecutorService.schedule(() -> {
            task.run();
            countDownLatch.countDown();
        }, 3, TimeUnit.SECONDS);

        // ç­‰å¾…è‡³å°‘ä¸€ä¸ªä»»åŠ¡å®Œæˆ
        countDownLatch.await();

        // å…³é—­ScheduledExecutorServiceï¼Œåœæ­¢æ¥æ”¶æ–°çš„ä»»åŠ¡ï¼Œç­‰å¾…å·²æäº¤ä»»åŠ¡æ‰§è¡Œå®Œæˆåå…³é—­çº¿ç¨‹æ± 
        scheduledExecutorService.shutdown();
    }
}

```

### åˆ†å¸ƒå¼å®šæ—¶ç®¡ç†è°ƒåº¦æ¡†æ¶å¯¹æ¯”

**ä»¥ä¸‹æ˜¯å¸¸è§çš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ¡†æ¶ä»¥åŠå®ƒä»¬çš„æ¯”è¾ƒï¼š**

| **è°ƒåº¦æ¡†æ¶** | **æè¿°**                                           | **ä¼˜ç‚¹**                    | **ç¼ºç‚¹** |
| ------------ | -------------------------------------------------- | --------------------------- | -------- |
| Quartz       | å¼ºå¤§ä¸”æˆç†Ÿçš„Javaå®šæ—¶ä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œæ”¯æŒåˆ†å¸ƒå¼ç¯å¢ƒã€‚ | 1. æˆç†Ÿç¨³å®šï¼Œå¤§é‡é¡¹ç›®ä½¿ç”¨ã€‚ |          |

2. ä¸Spring Bootæ— ç¼é›†æˆã€‚
3. æ”¯æŒCRONè¡¨è¾¾å¼ã€‚
4. æ”¯æŒæŒä¹…åŒ–å­˜å‚¨ã€‚ | 1. é…ç½®è¾ƒç¹çã€‚
5. è·¨è¯­è¨€æ”¯æŒè¾ƒå¼±ã€‚ |
   | Elastic-Job | é˜¿é‡Œå·´å·´å¼€æºçš„åˆ†å¸ƒå¼è°ƒåº¦è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒä»»åŠ¡åˆ†ç‰‡ã€è´Ÿè½½å‡è¡¡å’Œå®¹é”™ã€‚ | 1. æ”¯æŒåˆ†å¸ƒå¼ä»»åŠ¡åˆ†ç‰‡ã€‚
6. è´Ÿè½½å‡è¡¡å’Œå®¹é”™èƒ½åŠ›å¼ºã€‚
7. æ”¯æŒäº‹ä»¶è¿½è¸ªã€‚
8. æ”¯æŒå¤šç§ä½œä¸šç±»å‹ã€‚ | 1. ä¾èµ–ZooKeeperè¿›è¡Œåè°ƒå’Œç®¡ç†ã€‚
9. å­¦ä¹ æˆæœ¬ç›¸å¯¹è¾ƒé«˜ã€‚ |
   | XXL-JOB | åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œæ˜“äºæ‰©å±•ã€‚ | 1. éƒ¨ç½²ç®€å•ã€‚
10. æ”¯æŒä»»åŠ¡åˆ†ç‰‡ã€‚
11. æ”¯æŒåŠ¨æ€è°ƒåº¦ã€æ•…éšœè½¬ç§»ã€‚
12. ä¸°å¯Œçš„è°ƒåº¦ç­–ç•¥ã€‚
13. è·¨è¯­è¨€æ”¯æŒã€‚ | 1. ç›¸å¯¹è¾ƒæ–°ï¼Œç”Ÿæ€ä¸å¦‚Quartzæˆç†Ÿã€‚ |

ä»¥ä¸Šæ˜¯å¯¹Quartzã€Elastic-Jobå’ŒXXL-JOBçš„ç®€è¦æ¯”è¾ƒã€‚å®é™…ä¸Šï¼Œè¿™äº›æ¡†æ¶éƒ½èƒ½å¾ˆå¥½åœ°è§£å†³åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦çš„é—®é¢˜ã€‚åœ¨é€‰æ‹©åˆé€‚çš„æ¡†æ¶æ—¶ï¼Œå¯ä»¥æ ¹æ®é¡¹ç›®éœ€æ±‚ã€å›¢é˜ŸæŠ€æœ¯æ ˆã€å­¦ä¹ æˆæœ¬ç­‰å› ç´ è¿›è¡Œç»¼åˆè€ƒè™‘ã€‚

## åŸå­æ“ä½œç±»

Javaä¸­å¸¸è§çš„åŸå­ç±»åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªï¼š

1. AtomicIntegerï¼šå¯¹intç±»å‹è¿›è¡ŒåŸå­æ“ä½œï¼ŒåŒ…æ‹¬å¢å‡ã€æ¯”è¾ƒäº¤æ¢ç­‰æ“ä½œã€‚
2. AtomicLongï¼šå¯¹longç±»å‹è¿›è¡ŒåŸå­æ“ä½œï¼ŒåŒ…æ‹¬å¢å‡ã€æ¯”è¾ƒäº¤æ¢ç­‰æ“ä½œã€‚
3. AtomicBooleanï¼šå¯¹booleanç±»å‹è¿›è¡ŒåŸå­æ“ä½œï¼ŒåŒ…æ‹¬è®¾ç½®å’Œè·å–æ“ä½œã€‚
4. AtomicReferenceï¼šå¯¹å¼•ç”¨ç±»å‹è¿›è¡ŒåŸå­æ“ä½œï¼ŒåŒ…æ‹¬è®¾ç½®å’Œè·å–æ“ä½œã€‚
5. AtomicStampedReferenceï¼šå¯¹å¼•ç”¨ç±»å‹è¿›è¡ŒåŸå­æ“ä½œï¼ŒåŒæ—¶ä¿ç•™ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œç”¨äºè§£å†³ABAé—®é¢˜ã€‚
6. AtomicMarkableReferenceï¼šå¯¹å¼•ç”¨ç±»å‹è¿›è¡ŒåŸå­æ“ä½œï¼ŒåŒæ—¶ä¿ç•™ä¸€ä¸ªæ ‡è®°ï¼Œç”¨äºè§£å†³ABAé—®é¢˜ã€‚
7. AtomicIntegerArrayï¼šå¯¹intç±»å‹æ•°ç»„è¿›è¡ŒåŸå­æ“ä½œï¼ŒåŒ…æ‹¬å¢å‡ã€æ¯”è¾ƒäº¤æ¢ç­‰æ“ä½œã€‚
8. AtomicLongArrayï¼šå¯¹longç±»å‹æ•°ç»„è¿›è¡ŒåŸå­æ“ä½œï¼ŒåŒ…æ‹¬å¢å‡ã€æ¯”è¾ƒäº¤æ¢ç­‰æ“ä½œã€‚
9. AtomicReferenceArrayï¼šå¯¹å¼•ç”¨ç±»å‹æ•°ç»„è¿›è¡ŒåŸå­æ“ä½œï¼ŒåŒ…æ‹¬è®¾ç½®å’Œè·å–æ“ä½œã€‚

è¿™äº›åŸå­ç±»æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•æ¥ä¿è¯æ•°æ®çš„åŸå­æ€§ï¼Œå¦‚getã€setã€compareAndSetç­‰æ–¹æ³•ã€‚åœ¨ä½¿ç”¨æ—¶éœ€è¦æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©åˆé€‚çš„åŸå­ç±»ã€‚

## [çº¿ç¨‹å®‰å…¨é›†åˆç±»](#keRMN)

# çº¿ç¨‹æ± 

## çº¿ç¨‹æ± ä¸æ± åŒ–æ€æƒ³

> æˆ‘ä»¬çŸ¥é“ï¼Œçº¿ç¨‹æ˜¯ä¸€ç§éå¸¸å®è´µçš„è®¡ç®—æœºèµ„æºï¼Œä½†æ˜¯çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯æ˜¯éœ€è¦æ¶ˆè€—ä¸€å®šå¼€é”€çš„ã€‚å¦‚æœæˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­éœ€è¦æ‰§è¡Œè®¸å¤šä»»åŠ¡ï¼Œå¹¶ä¸”æ¯ä¸ªä»»åŠ¡åªéœ€è¦å¾ˆçŸ­çš„æ—¶é—´å°±èƒ½å®Œæˆï¼Œé‚£ä¹ˆé¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ä¼šå¯¼è‡´å¤§é‡çš„ç³»ç»Ÿå¼€é”€å’Œèµ„æºæµªè´¹ã€‚
> ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨çº¿ç¨‹æ± æŠ€æœ¯ã€‚çº¿ç¨‹æ± æ˜¯ä¸€ä¸ªé¢„å…ˆåˆ›å»ºä¸€å®šæ•°é‡çš„çº¿ç¨‹æ± ï¼Œå¹¶å°†è¿™äº›çº¿ç¨‹å­˜æ”¾åœ¨ä¸€ä¸ªæ± ä¸­ã€‚å½“åº”ç”¨ç¨‹åºéœ€è¦æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå®ƒå¯ä»¥ä»çº¿ç¨‹æ± ä¸­è·å–ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œå¤„ç†å®Œæˆåå†å°†è¯¥çº¿ç¨‹è¿˜å›çº¿ç¨‹æ± ã€‚è¿™æ ·ï¼Œçº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯å°±ä¸éœ€è¦é¢‘ç¹åœ°è¿›è¡Œï¼Œä»è€Œå‡å°‘äº†ç³»ç»Ÿçš„å¼€é”€å’Œèµ„æºæ¶ˆè€—ã€‚
>
> **javaä¸­çš„çº¿ç¨‹æ± å·¥å…·ç±»ï¼š**
> åœ¨Javaä¸­ï¼Œçº¿ç¨‹æ± å¯ä»¥é€šè¿‡java.util.concurrentåŒ…ä¸­çš„ThreadPoolExecutorç±»æ¥å®ç°ã€‚ä½¿ç”¨çº¿ç¨‹æ± çš„æ–¹å¼éå¸¸ç®€å•ï¼Œåªéœ€è¦å°†éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± ä¸­å³å¯ï¼Œçº¿ç¨‹æ± ä¼šè‡ªåŠ¨ä»æ± ä¸­è·å–ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚
>
> **åº”ç”¨åœºæ™¯ï¼š**
> çº¿ç¨‹æ± è¢«å¹¿æ³›åº”ç”¨äºå„ç§ç±»å‹çš„åº”ç”¨ç¨‹åºä¸­ï¼Œä¾‹å¦‚WebæœåŠ¡å™¨ã€æ•°æ®åº“è¿æ¥æ± ã€å¤šçº¿ç¨‹ç¼–ç¨‹ç­‰ã€‚


**æ± åŒ–æ€æƒ³ï¼š**

> **æ± åŒ–æ€æƒ³æ˜¯ä¸€ç§å°†èµ„æºé¢„å…ˆåˆ†é…å¹¶ç®¡ç†çš„æ€æƒ³**ï¼Œå®ƒå¯ä»¥æé«˜èµ„æºçš„åˆ©ç”¨æ•ˆç‡å’Œç³»ç»Ÿçš„æ€§èƒ½ï¼Œå‡å°‘èµ„æºçš„æµªè´¹å’Œæ¶ˆè€—ã€‚çº¿ç¨‹æ± å°±æ˜¯åˆ©ç”¨äº†æ± åŒ–æ€æƒ³æ¥ç®¡ç†çº¿ç¨‹çš„æŠ€æœ¯ã€‚

**æ€»ä¹‹ï¼Œçº¿ç¨‹æ± æ˜¯ä¸€ç§å¯ä»¥æé«˜çº¿ç¨‹é‡ç”¨æ€§å’Œåº”ç”¨ç¨‹åºæ€§èƒ½çš„æŠ€æœ¯ï¼Œå®ƒåˆ©ç”¨äº†æ± åŒ–æ€æƒ³æ¥ç®¡ç†çº¿ç¨‹ã€‚**

## å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªçº¿ç¨‹æ± ï¼Ÿ

å®ƒä½¿ç”¨Javaçš„**Executors**ç±»æ¥åˆ›å»ºçº¿ç¨‹æ± å¹¶æ‰§è¡Œä¸€äº›ä»»åŠ¡ï¼š

```java
package org.thread;

import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

public class ThreadPoolDemo {

    public static void main(String[] args) {
        // åˆ›å»ºçº¿ç¨‹æ± ï¼Œå¤§å°ä¸º2
        ExecutorService executor = Executors.newFixedThreadPool(2);

        // æäº¤10ä¸ªä»»åŠ¡ç»™çº¿ç¨‹æ± æ‰§è¡Œ
        for (int i = 1; i <= 10; i++) {
            executor.execute( new Task(i));
        }

        // å…³é—­çº¿ç¨‹æ± 
        executor.shutdown();
    }

    // ä»»åŠ¡ç±»
    static class Task implements Runnable {
        private int taskId;

        public Task(int taskId) {
            this.taskId = taskId;
        }

       static void print(){
           System.out.println("hello,çº¿ç¨‹ï¼š"+Thread.currentThread().getName());
       }

        @Override
        public void run() {
            try {
                Thread.sleep(1000L);
                print();
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
        }
    }
}

```

## Java8ä¸­æœ‰å“ªäº›çº¿ç¨‹æ± 

åœ¨Java 8ä¸­ï¼Œå¸¸ç”¨çš„çº¿ç¨‹æ± åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š

1. FixedThreadPoolï¼šå›ºå®šå¤§å°çº¿ç¨‹æ± ï¼Œåˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼Œä¸€æ—¦æœ‰ç©ºé—²çº¿ç¨‹å°±ä¼šç«‹å³ä½¿ç”¨ï¼Œå¦‚æœçº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½åœ¨å¿™ç¢Œï¼Œæ–°ä»»åŠ¡å°±ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œç›´åˆ°æœ‰çº¿ç¨‹ç©ºé—²å‡ºæ¥ã€‚
2. CachedThreadPoolï¼šå¯ç¼“å­˜çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸å›ºå®šï¼Œå¯ä»¥æ ¹æ®éœ€è¦è‡ªåŠ¨åˆ›å»ºæ–°çº¿ç¨‹ï¼Œå¦‚æœçº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½åœ¨å¿™ç¢Œï¼Œæ–°ä»»åŠ¡å°±ä¼šåˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œï¼Œå½“çº¿ç¨‹ç©ºé—²è¶…è¿‡æŒ‡å®šæ—¶é—´ï¼Œä¼šè¢«å›æ”¶ï¼Œçº¿ç¨‹æ± çš„å¤§å°æ²¡æœ‰é™åˆ¶ã€‚
3. SingleThreadExecutorï¼šå•çº¿ç¨‹æ± ï¼Œåˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œæ‰€æœ‰ä»»åŠ¡éƒ½åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œã€‚
4. ScheduledThreadPoolï¼šå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼Œå¯ä»¥åœ¨æŒ‡å®šæ—¶é—´æˆ–è€…å‘¨æœŸæ€§åœ°æ‰§è¡Œä»»åŠ¡ã€‚
5. ForkJoinPoolï¼šåˆ†æ²»çº¿ç¨‹æ± ï¼Œé€‚ç”¨äºä¸€äº›éœ€è¦å¯¹å¤§æ•°æ®é›†æˆ–è€…ä»»åŠ¡è¿›è¡Œå¹¶è¡Œå¤„ç†çš„åœºæ™¯ï¼Œé€šè¿‡å°†å¤§ä»»åŠ¡åˆ†å‰²æˆå°ä»»åŠ¡æ¥å®ç°é«˜å¹¶å‘å¤„ç†ã€‚
6. WorkStealingPoolï¼šå·¥ä½œçªƒå–çº¿ç¨‹æ± ï¼Œæ˜¯ä¸€ç§å¹¶è¡Œæ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ± ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œçº¿ç¨‹å¯ä»¥ä»å…¶ä»–çº¿ç¨‹çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­å·å–ä»»åŠ¡æ¥æ‰§è¡Œï¼Œå¯ä»¥æé«˜ä»»åŠ¡æ‰§è¡Œçš„æ•ˆç‡ã€‚
   è¿™äº›çº¿ç¨‹æ± åœ¨Java 8ä¸­çš„å®ç°å’Œä½¿ç”¨æ–¹æ³•åŸºæœ¬ä¸Šå’ŒJava 7ä¸­ç›¸åŒã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚å’Œæ€§èƒ½è¦æ±‚æ¥é€‰æ‹©åˆé€‚çš„çº¿ç¨‹æ± ç±»å‹å’Œå‚æ•°é…ç½®ã€‚

## javaä¸­å¸¸ç”¨çš„çº¿ç¨‹æ± æœ‰å“ªäº›ï¼Ÿ

## ThreadPoolTaskExecutorçº¿ç¨‹æ± 

**ThreadPoolTaskExecutor**æ˜¯Springæ¡†æ¶ä¸­æä¾›çš„ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå®ƒç»§æ‰¿è‡ªThreadPoolExecutorï¼Œå¹¶å¯¹å…¶è¿›è¡Œäº†ä¸€äº›æ‰©å±•å’Œå°è£…ã€‚å…¶**ä¸»è¦åŠŸèƒ½**æ˜¯ç®¡ç†çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Œå®ç°ä»»åŠ¡çš„å¼‚æ­¥æ‰§è¡Œï¼Œä»¥æé«˜ç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›å’Œå¤„ç†èƒ½åŠ›ã€‚
åŸç†ä¸åº•å±‚å®ç°
ThreadPoolTaskExecutorçš„åŸç†å’Œåº•å±‚å®ç°ä¸ThreadPoolExecutorç±»ä¼¼ï¼Œå®ƒä¹Ÿæ˜¯é€šè¿‡çº¿ç¨‹æ± çš„æ–¹å¼æ¥ç®¡ç†çº¿ç¨‹ï¼Œå®ç°ä»»åŠ¡çš„å¼‚æ­¥æ‰§è¡Œã€‚
ThreadPoolTaskExecutorå°è£…äº†ThreadPoolExecutorï¼Œæä¾›äº†æ›´åŠ ç®€å•æ˜“ç”¨çš„APIï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†ä¸€äº›Springç‰¹æœ‰çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š**ä½¿ç”¨@Asyncæ³¨è§£å°†æ–¹æ³•å£°æ˜ä¸ºå¼‚æ­¥æ‰§è¡Œ**ï¼Œ**ä½¿ç”¨@Scheduledæ³¨è§£å®ç°å®šæ—¶ä»»åŠ¡ç­‰ã€‚**
åœ¨åº•å±‚å®ç°ä¸Šï¼ŒThreadPoolTaskExecutoré€šè¿‡ThreadPoolExecutorç±»æä¾›çš„æ–¹æ³•æ¥å®ç°çº¿ç¨‹æ± çš„ç®¡ç†å’Œä»»åŠ¡çš„æ‰§è¡Œã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæä¾›äº†ä¸€äº›æ‰©å±•çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š**æ”¯æŒè®¾ç½®çº¿ç¨‹æ± çš„åç§°ã€ä½¿ç”¨é˜Ÿåˆ—æ¥ç¼“å­˜ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ã€æ”¯æŒæ‹’ç»ç­–ç•¥ç­‰ã€‚**

### ä½¿ç”¨åœºæ™¯

ThreadPoolTaskExecutoré€‚ç”¨äºéœ€è¦è¿›è¡Œå¹¶å‘å¤„ç†çš„åœºæ™¯ï¼Œä¾‹å¦‚ï¼š**é«˜å¹¶å‘è¯·æ±‚ã€å¼‚æ­¥å¤„ç†ä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡ç­‰ã€‚é€šè¿‡ä½¿ç”¨ThreadPoolTaskExecutorï¼Œå¯ä»¥æé«˜ç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›å’Œå¤„ç†èƒ½åŠ›ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚**

### åˆ›å»ºçº¿ç¨‹æ± ï¼š

```java
package com.haier.uhome.uplus.devp.integration.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.scheduling.annotation.EnableAsync;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;

import java.util.concurrent.ThreadPoolExecutor;

/**
 * ZQ Zhang 2022/5/26-1:58 PM
 * çº¿ç¨‹æ± é…ç½®ç±»
 * å¼€å¯åŒæ­¥æ³¨è§£  
 * å½“åœ¨é…ç½®ç±»ä¸Šä½¿ç”¨ @EnableAsync æ³¨è§£æ—¶ï¼ŒSpring ä¼šæŸ¥æ‰¾æ‰€æœ‰å¸¦æœ‰ @Async æ³¨è§£çš„æ–¹æ³•ï¼Œå¹¶åœ¨è°ƒç”¨ 
 * è¿™äº›æ–¹æ³•æ—¶ä½¿ç”¨å¼‚æ­¥æ‰§è¡Œã€‚è¿™æ„å‘³ç€è¿™äº›æ–¹æ³•çš„è°ƒç”¨å°†åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œè€Œä¸ä¼šé˜»å¡è°ƒç”¨çº¿ç¨‹ã€‚
 */
@Configuration
@EnableAsync
public class ThreadPoolConfig {

    // åˆ›å»ºThreadPoolTaskExecutorçº¿ç¨‹æ± å¯¹è±¡
    @Bean("myThread")
    public ThreadPoolTaskExecutor bugUpdateThreadExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        //æœ€å¤§çº¿ç¨‹æ•°
        executor.setMaxPoolSize(5);
        //æ ¸å¿ƒçº¿ç¨‹æ•°
        executor.setCorePoolSize(5);
        //ä»»åŠ¡é˜Ÿåˆ—å¤§å°
        executor.setQueueCapacity(2000);
        //çº¿ç¨‹å‰ç¼€å
        executor.setThreadNamePrefix("async-");
        //çº¿ç¨‹å­˜æ´»æ—¶é—´-é»˜è®¤60ç§’
        executor.setKeepAliveSeconds(30);
        //æ²¡æœ‰ä»»åŠ¡åˆ†é…çš„æ‰€æœ‰çº¿ç¨‹ï¼Œåœ¨ç­‰å¾… keepAliveTime æ—¶é—´åå…¨éƒ¨å›æ”¶æ‰ã€‚
        executor.setAllowCoreThreadTimeOut(true);
        /*
         * æ‹’ç»å¤„ç†ç­–ç•¥
         * CallerRunsPolicy()ï¼šäº¤ç”±è°ƒç”¨æ–¹çº¿ç¨‹è¿è¡Œï¼Œæ¯”å¦‚ main çº¿ç¨‹ã€‚
         * AbortPolicy()ï¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚
         * DiscardPolicy()ï¼šç›´æ¥ä¸¢å¼ƒã€‚
         * DiscardOldestPolicy()ï¼šä¸¢å¼ƒé˜Ÿåˆ—ä¸­æœ€è€çš„ä»»åŠ¡ã€‚
         */
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.DiscardOldestPolicy());
        executor.initialize();
        return executor;
    }
}

```

### ä½¿ç”¨çº¿ç¨‹æ± ï¼š

```java
import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import java.util.concurrent.ExecutionException;
import java.util.stream.Collectors;

/**
 * ZQ Zhang 2022/5/26-2:36 PM
 */
@Service
@Slf4j
public class UpdateBugsThreadService implements  {

    @Autowired
    private HdsAgentClient hdsAgentClient;

    /**
     * æ­¤æ–¹æ³•ä¼šè¢«ä¸¢è¿› bugUpdateThreadExecutor çº¿ç¨‹æ± è¿›è¡Œæ‰§è¡Œ
     */
    @Async("myThread")
    public void updateHdsBug(String xx, Long yy) {
        try {
           //todo: æ­¤å¤„ç¼–å†™ä¸šåŠ¡ä»£ç ï¼Œæ­¤ä»£ç ä¼šè¢«ä¸¢è¿›çº¿ç¨‹æ± æ‰§è¡Œ
        log.info("ã€ThreadId: {}ã€‘", Thread.currentThread().getName());
        } catch (Exception e) {
            e.printStackTrace();
            log.error("æ‰§è¡Œå¤±è´¥");
        }
    }


    /**
    * æ­¤æ–¹æ³•ä¼šè¢«ä¸¢è¿› bugUpdateThreadExecutor çº¿ç¨‹æ± è¿›è¡Œæ‰§è¡Œ
    */
    @Async("myThread")
    public void updateJiraBug(String bugKey, String releaseVersion, JiraClient jiraClient) {
        try {
           
         log.info("ã€ThreadId: {}ã€‘", Thread.currentThread().getName());
        } catch (Exception e) {
            e.printStackTrace();
            log.error("æ‰§è¡Œå¤±è´¥");
        }
    }

}

```

### ThreadPoolTaskExecutorè¿”å›å€¼ï¼š--é˜»å¡å¼ï¼ˆä¸æ¨ä»‹ä½¿ç”¨ï¼‰

ä½¿ç”¨ThreadPoolTaskExecutoræ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå¯ä»¥é€šè¿‡**Future**å¯¹è±¡æ¥è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚å…·ä½“åšæ³•æ˜¯ï¼Œåœ¨å¼‚æ­¥æ–¹æ³•ä¸­è¿”å›ä¸€ä¸ªFutureå¯¹è±¡ï¼ŒSpringæ¡†æ¶ä¼šå°†å…¶å°è£…æˆå¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªFutureå¯¹è±¡ç»™è°ƒç”¨è€…ï¼Œè°ƒç”¨è€…å¯ä»¥ä½¿ç”¨è¯¥å¯¹è±¡æ¥è·å–å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨å¼‚æ­¥æ–¹æ³•ä¸­è¿”å›Futureå¯¹è±¡ï¼Œå¹¶åœ¨è°ƒç”¨è¯¥æ–¹æ³•æ—¶è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœï¼š

```java
@Service
public class DemoService {

    @Autowired
    private ThreadPoolTaskExecutor threadPoolTaskExecutor;

    // 
    @Async("threadPoolTaskExecutor")
    public Future<String> asyncMethod() {
        // å¼‚æ­¥å¤„ç†é€»è¾‘
        return new AsyncResult<String>("hello world");
    }
}
```

```java
@RestController
public class DemoController {

    @Autowired
    private DemoService demoService;

    @GetMapping("/async")
    public String async() throws InterruptedException, ExecutionException {
        Future<String> future = demoService.asyncMethod();
        // ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆ
        while (!future.isDone()) {
            Thread.sleep(100);
        }
        // è·å–ä»»åŠ¡æ‰§è¡Œç»“æœ
        String result = future.get();
        return result;
    }
}

```

#### ç¼ºç‚¹ï¼š

> ä½¿ç”¨Futureå¯¹è±¡è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœæ˜¯é˜»å¡å¼çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´è¾ƒé•¿ï¼Œåˆ™è°ƒç”¨è€…å¯èƒ½éœ€è¦ç­‰å¾…è¾ƒé•¿çš„æ—¶é—´æ‰èƒ½è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚**å¦‚æœä¸å¸Œæœ›é˜»å¡è°ƒç”¨çº¿ç¨‹ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å›è°ƒå‡½æ•°æ¥è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚**

### çº¿ç¨‹æ± å¼‚æ­¥è°ƒç”¨è¿”å›å€¼ï¼š

1. é€šè¿‡å›è°ƒå‡½æ•°å®ç°å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œç»“æœè¿”å›ï¼š-**éé˜»å¡**

```java
package org.thread;

import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

public class CallbackExample {
    public static void main(String[] args) {
        ExecutorService executor = Executors.newSingleThreadExecutor();
        // åˆ›å»ºå›è°ƒå‡½æ•°å¯¹è±¡
        CallbackHandler handler = new CallbackHandler();
        // æäº¤å¼‚æ­¥ä»»åŠ¡å¹¶ä¼ é€’å›è°ƒå‡½æ•°
        executor.execute(new RunnableTask(handler));
        // å…³é—­çº¿ç¨‹æ± 
        executor.shutdown();
    }
}

// å›è°ƒå‡½æ•°æ¥å£
interface Callback {
    void onComplete(String result);
}

// å›è°ƒå‡½æ•°å®ç°ç±»
class CallbackHandler implements Callback {
    // å®ç°å›è°ƒå‡½æ•°
    public void onComplete(String result) {
        // å¤„ç†å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œç»“æœ
        System.out.println("CallbackHandler: " + result);
    }
}

// å¼‚æ­¥ä»»åŠ¡ç±»
class RunnableTask implements Runnable {
    private Callback callback;

    public RunnableTask(Callback callback) {
        this.callback = callback;
    }

    public void run() {
        // å¼‚æ­¥æ‰§è¡Œä»»åŠ¡
        String result = "hello world";
        // è°ƒç”¨å›è°ƒå‡½æ•°ä¼ é€’æ‰§è¡Œç»“æœ
        callback.onComplete(result);
    }
}

```

2. é€šè¿‡Futureå’ŒCallableå®ç°å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œå’Œç»“æœè·å–-**é˜»å¡**

```java
package org.thread;

import java.util.concurrent.Callable;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.Future;

public class FutureExample {
    public static void main(String[] args) throws Exception {
        ExecutorService executor = Executors.newSingleThreadExecutor();
        // æäº¤å¼‚æ­¥ä»»åŠ¡å¹¶è·å–Futureå¯¹è±¡
        Future<String> future = executor.submit(new CallableTask());
        // é˜»å¡ç­‰å¾…å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæˆå¹¶è·å–ç»“æœ
        String result = future.get();
        // å¤„ç†å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œç»“æœ
        System.out.println(result);
        // å…³é—­çº¿ç¨‹æ± 
        executor.shutdown();
    }
}

// å¼‚æ­¥ä»»åŠ¡ç±»
class CallableTask implements Callable<String> {
    @Override
    public String call() throws Exception {
        // å¼‚æ­¥æ‰§è¡Œä»»åŠ¡
        return "hello world";
    }
}

```

3. é€šè¿‡CompletableFutureå®ç°å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œå’Œç»“æœè·å–

```java
package org.thread;

import java.util.concurrent.CompletableFuture;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.function.Supplier;

public class CompletableFutureExample {
    public static void main(String[] args) {
        ExecutorService executor = Executors.newSingleThreadExecutor();
        // æäº¤å¼‚æ­¥ä»»åŠ¡å¹¶è·å–CompletableFutureå¯¹è±¡
        CompletableFuture<String> future = CompletableFuture.supplyAsync(new SupplierTask(), executor);
        // å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæˆåè°ƒç”¨å›è°ƒå‡½æ•°å¤„ç†ç»“æœ
        future.thenAccept(result -> {
            // å¤„ç†å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œç»“æœ
            System.out.println(result);
        });
        // å…³é—­çº¿ç¨‹æ± 
        executor.shutdown();
    }
}

// å¼‚æ­¥ä»»åŠ¡ç±»
class SupplierTask implements Supplier<String> {
    @Override
    public String get() {
        // å¼‚æ­¥æ‰§è¡Œä»»åŠ¡
        return "hello world";
    }
}

```

#### æ€»ç»“ï¼š

ä»¥ä¸‹æ˜¯ä¸‰ç§æ–¹å¼çš„æ¯”è¾ƒï¼š

| **æ–¹å¼**          | **ä¼˜ç‚¹**                             | **ç¼ºç‚¹**                                           | **ä½¿ç”¨åœºæ™¯**                                                 | æ˜¯å¦é˜»å¡ |
| ----------------- | ------------------------------------ | -------------------------------------------------- | ------------------------------------------------------------ | -------- |
| å›è°ƒå‡½æ•°          | å®ç°ç®€å•ï¼Œç›´è§‚æ˜“æ‡‚                   | éœ€è¦æ‰‹åŠ¨å®ç°å›è°ƒå‡½æ•°ï¼Œä»£ç é‡å¯èƒ½è¾ƒå¤š               | å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œ**æ—¶é—´è¾ƒçŸ­**ï¼Œå›è°ƒå‡½æ•°é€»è¾‘ç®€å•                   | ä¸é˜»å¡   |
| Future/Callable   | å®ç°ç®€å•ï¼Œå¯ä»¥è·å–å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œç»“æœ | éœ€è¦**æ‰‹åŠ¨é˜»å¡**ç­‰å¾…å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæˆ               | å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œ**æ—¶é—´è¾ƒé•¿**ï¼Œéœ€è¦è·å–å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œç»“æœ           | é˜»å¡     |
| CompletableFuture | å®ç°ç®€å•ï¼Œæ”¯æŒå‡½æ•°å¼ç¼–ç¨‹é£æ ¼         | ä»£ç å¯è¯»æ€§ç›¸å¯¹è¾ƒå·®ï¼Œéœ€è¦ç†Ÿæ‚‰Java 8çš„å‡½æ•°å¼ç¼–ç¨‹ç‰¹æ€§ | å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œ**æ—¶é—´è¾ƒé•¿**ï¼Œéœ€è¦è·å–å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œç»“æœï¼Œå¹¶ä¸”éœ€è¦æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹é£æ ¼ | ä¸é˜»å¡   |

æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹å¼ã€‚å¦‚æœå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œæ—¶é—´è¾ƒçŸ­ä¸”å›è°ƒå‡½æ•°é€»è¾‘ç®€å•ï¼Œå¯ä»¥ä½¿ç”¨å›è°ƒå‡½æ•°ï¼›å¦‚æœéœ€è¦è·å–å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œç»“æœï¼Œå¯ä»¥ä½¿ç”¨Future/Callableï¼›å¦‚æœéœ€è¦æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹é£æ ¼ï¼Œå¯ä»¥ä½¿ç”¨CompletableFutureã€‚

> æ³¨æ„ï¼šè™½ç„¶å›è°ƒå‡½æ•°ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œä½†å¦‚æœå›è°ƒå‡½æ•°æœ¬èº«æ‰§è¡Œçš„é€»è¾‘è¿‡äºå¤æ‚æˆ–è€…è€—æ—¶è¾ƒé•¿ï¼Œä»å¯èƒ½å½±å“åº”ç”¨çš„æ€§èƒ½

# [Javaè™šæ‹Ÿæœº](https://www.digitalocean.com/community/tutorials/java-jvm-memory-model-memory-management-in-java#java-jvm-memory-model)

## [JVMç±»åŠ è½½å™¨](https://www.baeldung.com/java-classloaders)  

è¿™ä¸ªé‡Œé¢ä»‹ç»çš„æ¯”è¾ƒè¯¦ç»†ï¼š ä¸»è¦æœ‰

1. å¼•å¯¼ç±»åŠ è½½å™¨ï¼š Bootstrapt Class Loader 
   1. æ˜¯æ‰€æœ‰ç±»åŠ è½½å™¨çš„çˆ¶ç±»ï¼›
   2. åŠ è½½çš„æ˜¯ï¼šä½äº $JAVA_HOME/jre/lib ç›®å½•ä¸‹çš„å…¶ä»–æ ¸å¿ƒåº“ã€‚
2. æ‰©å±•ç±»åŠ è½½å™¨ï¼šExtension Class Loader 
   1. æ˜¯ç³»ç»Ÿæˆ–ç¨‹åºç±»åŠ è½½å™¨çš„çˆ¶ç±»ï¼›
   2. åŠ è½½çš„æ˜¯ï¼šä½äº $JAVA_HOME/lib/ext  ç›®å½•ä¸‹çš„åº“
3. ç³»ç»Ÿ/ç¨‹åºåŠ è½½å™¨ï¼š System/Application Class Loader 
   1. å®ƒåŠ è½½åœ¨ç±»è·¯å¾„ç¯å¢ƒå˜é‡ã€-classpath æˆ– -cp å‘½ä»¤è¡Œé€‰é¡¹ä¸­æ‰¾åˆ°çš„æ–‡ä»¶ã€‚å®ƒä¹Ÿæ˜¯æ‰©å±•ç±»åŠ è½½å™¨çš„å­ç±»ã€‚
4. è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼š 
   1. å¯¹äºå¤§å¤šæ•°æ–‡ä»¶å·²ç»åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„æƒ…å†µï¼Œå†…ç½®ç±»åŠ è½½å™¨å°±è¶³å¤Ÿäº†ã€‚
   2. åœ¨æˆ‘ä»¬éœ€è¦ä»æœ¬åœ°ç¡¬ç›˜é©±åŠ¨å™¨æˆ–ç½‘ç»œåŠ è½½ç±»çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä½¿ç”¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨ã€‚
5. ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰ ç±»åŠ è½½å™¨:
   1. ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ä¸º J2SE ä¸­å¼•å…¥çš„ç±»åŠ è½½å§”æ‰˜æ–¹æ¡ˆæä¾›äº†ä¸€ç§æ›¿ä»£æ–¹æ³•ã€‚
   2. ä½†æ˜¯ï¼Œæœ‰æ—¶å½“ JVM æ ¸å¿ƒç±»éœ€è¦åŠ¨æ€åŠ è½½åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æä¾›çš„ç±»æˆ–èµ„æºæ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°é—®é¢˜ã€‚æ­¤æ—¶J2SE å§”æ‰˜åœ¨è¿™é‡Œä¸èµ·ä½œç”¨ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ç±»åŠ è½½çš„æ›¿ä»£æ–¹æ³•ã€‚è¿™å¯ä»¥ä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨æ¥å®ç°ã€‚

### ç±»åŠ è½½å™¨å·¥ä½œæµç¨‹ï¼š 

> **ç±»åŠ è½½å™¨éµå¾ªå§”æ‰˜æ¨¡å‹ï¼Œæ ¹æ®è¯·æ±‚æŸ¥æ‰¾ç±»æˆ–èµ„æºï¼ŒClassLoader å®ä¾‹ä¼šå°†ç±»æˆ–èµ„æºçš„æœç´¢å§”æ‰˜ç»™çˆ¶ç±»åŠ è½½å™¨ã€‚**

1. å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå°†åº”ç”¨ç¨‹åºç±»åŠ è½½åˆ° JVM ä¸­çš„è¯·æ±‚ã€‚ç³»ç»Ÿç±»åŠ è½½å™¨é¦–å…ˆå°†è¯¥ç±»çš„åŠ è½½å§”æ‰˜ç»™å®ƒçš„çˆ¶æ‰©å±•ç±»åŠ è½½å™¨ï¼Œåè€…åˆå°†å…¶å§”æ‰˜ç»™å¼•å¯¼ç±»åŠ è½½å™¨ã€‚
2. å¦‚æœçˆ¶ç±»åŠ è½½å™¨æ— æ³•æ‰¾åˆ°è¯¥ç±»ï¼Œåˆ™å½“å‰å®ä¾‹æ‰ä¼šå°è¯•è‡ªå·±æ‰¾åˆ°è¯¥ç±»ã€‚

```java
ClassLoader.loadClass(String name, boolean resolve)é»˜è®¤å®ç°æŒ‰ä»¥ä¸‹é¡ºåºæœç´¢ç±»ï¼š
1. è°ƒç”¨ findLoadedClass(String) æ–¹æ³•ä»¥æŸ¥çœ‹è¯¥ç±»æ˜¯å¦å·²åŠ è½½ã€‚
2. åœ¨çˆ¶ç±»åŠ è½½å™¨ä¸Šè°ƒç”¨ loadClass(String) æ–¹æ³•ã€‚
3. è°ƒç”¨ findClass(String) æ–¹æ³•æ¥æŸ¥æ‰¾ç±»ã€‚
```

## JVMå†…å­˜æ¨¡å‹

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22883638/1681742855532-eae50e4e-aba7-4358-96c6-c9034c4fb66d.png#averageHue=%23fdfefd&clientId=u5851ebb9-a338-4&from=paste&height=470&id=ua0048d4b&name=image.png&originHeight=940&originWidth=2254&originalType=binary&ratio=2&rotation=0&showTitle=false&size=376581&status=done&style=none&taskId=u5153e72f-99a3-4279-bca3-00eda01636f&title=&width=1127)

> ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22883638/1681744101976-5e38aa98-0a73-48d1-94f0-8d6db5cd2dca.png#averageHue=%23ede9c0&clientId=u5851ebb9-a338-4&from=paste&height=186&id=uedfdf636&name=image.png&originHeight=372&originWidth=1490&originalType=binary&ratio=2&rotation=0&showTitle=false&size=153905&status=done&style=none&taskId=uc7bda88e-6fe3-42a6-a69d-cc031d11423&title=&width=745)

ğŸ“¢ï¼š JDK1.8ä¹‹å‰åŠä¹‹åçš„åŒºåˆ«ï¼š
**1.8ä¹‹å‰ç§°ä¸ºæ°¸ä¹…ä»£ã€1.8åŠä¹‹åç§°ä¸ºå…ƒç©ºé—´**

> Permæ˜¯æ°¸ä¹…ä»£ã€‚
> åƒåœ¾å›æ”¶è¿‡ç¨‹ï¼š
>
> 1. å¤§å¤šæ•°æ–°åˆ›å»ºçš„å¯¹è±¡éƒ½ä½äº Eden å†…å­˜ç©ºé—´ä¸­ã€‚
> 2. å½“ Eden ç©ºé—´è¢«å¯¹è±¡å¡«æ»¡æ—¶ï¼Œä¼šæ‰§è¡Œ Minor GCï¼Œå¹¶å°†æ‰€æœ‰å¹¸å­˜è€…å¯¹è±¡ç§»åŠ¨åˆ°å…¶ä¸­ä¸€ä¸ªå¹¸å­˜è€…ç©ºé—´ï¼ˆS0æˆ–è€…S1ï¼‰ï¼ŒMinor GC è¿˜ä¼šæ£€æŸ¥å¹¸å­˜è€…å¯¹è±¡å¹¶å°†å®ƒä»¬ç§»åŠ¨åˆ°å…¶ä»–å¹¸å­˜è€…ç©ºé—´ã€‚æ‰€ä»¥åœ¨æŸä¸ªæ—¶å€™ï¼Œå…¶ä¸­ä¸€ä¸ªå¹¸å­˜è€…ç©ºé—´æ€»æ˜¯ç©ºçš„ã€‚ï¼ˆå…¶å®å°±æ˜¯Minor GCåä¼šå°†Edenä¸­å¹¸å­˜è€…ä»¥åŠS0æˆ–è€…S1ä¸­å¹¸å­˜è€…ç»Ÿä¸€è¿›è¡Œç§»åŠ¨åˆ°å…¶ä¸­ä¸€ä¸ªå¹¸å­˜è€…ç©ºé—´S1æˆ–è€…S2ï¼‰ï¼›
> 3. ç»è¿‡å¤šæ¬¡Minor GCï¼ˆä¹Ÿç§°Full GC-ä¸»è¦çœ‹åƒåœ¾æ”¶é›†ç®—æ³•çš„å…·ä½“å®ç°æ˜¯ä»€ä¹ˆï¼‰ å¾ªç¯åå¹¸å­˜ä¸‹æ¥çš„å¯¹è±¡å°†è¢«ç§»è‡³è€å¹´ä»£Old Memoryå†…å­˜ç©ºé—´ã€‚é€šå¸¸ï¼Œè¿™æ˜¯é€šè¿‡åœ¨å¹´è½»ä»£å¯¹è±¡æœ‰èµ„æ ¼æå‡åˆ°è€å¹´ä»£ä¹‹å‰è®¾ç½®å¹´é¾„é˜ˆå€¼æ¥å®Œæˆçš„ã€‚ã€é»˜è®¤å¹´é¾„é˜ˆå€¼æ˜¯15ï¼Œå¯ä»¥é€šè¿‡java -XX:MaxTenuringThreshold=10 MyAppæ¥è®¾ç½®ã€‘ï¼›
> 4. å½“è€å¹´ä»£Old Memoryå†…å­˜ä¸­åŒ…å«äº†ç»è¿‡å¤šè½® Minor GC ä¹‹åå­˜æ´»æ—¶é—´é•¿çš„å¯¹è±¡ã€‚å½“è€å¹´ä»£å†…å­˜æ»¡æ—¶ä¼šè¿›è¡ŒMajor GCï¼Œé€šå¸¸éœ€è¦æ›´é•¿çš„æ—¶é—´ã€‚
>
> æ€»ç»“ï¼š
> Minor GC : é€Ÿåº¦éå¸¸å¿«ï¼›
> Minor GCï¼šé€Ÿåº¦éå¸¸æ…¢ï¼›

## JVMæ§åˆ¶å†…å­˜çš„æ–¹å¼

Java æä¾›äº†å¾ˆå¤šå†…å­˜å¼€å…³ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥è®¾ç½®å†…å­˜å¤§å°åŠå…¶æ¯”ç‡ã€‚ä¸€äº›å¸¸ç”¨çš„å†…å­˜å¼€å…³æ˜¯

| VM Switch         | VM Switch Description                                        |
| ----------------- | ------------------------------------------------------------ |
| -Xms              | ç”¨äºè®¾ç½®JVMå¯åŠ¨æ—¶çš„åˆå§‹å †å¤§å°                                |
| -Xmx              | ç”¨äºè®¾ç½®æœ€å¤§å †å¤§å°                                           |
| -Xmn              | ä¸ºäº†è®¾ç½®å¹´è½»ä¸€ä»£çš„å¤§å°ï¼Œå…¶ä½™ç©ºé—´ç”¨äºè€å¹´ä»£                   |
| -XX:PermGen       | ç”¨äºè®¾ç½®æ°¸ä¹…ä»£å†…å­˜çš„åˆå§‹å¤§å°                                 |
| -XX:MaxPermGen    | ç”¨äºè®¾ç½® Perm Gen çš„æœ€å¤§å¤§å°                                 |
| -XX:SurvivorRatio | ä¸ºäº†æä¾› Eden ç©ºé—´å’Œ Survivor ç©ºé—´çš„æ¯”ä¾‹ï¼Œä¾‹å¦‚ï¼Œå¦‚æœ Young Generation å¤§å°ä¸º 10mï¼ŒVM å¼€å…³ä¸º -XX:SurvivorRatio=2ï¼Œåˆ™å°†ä¸º Eden ç©ºé—´ä¿ç•™ 5mï¼Œä¸ºä¸¤ä¸ª Survivor ç©ºé—´å„ä¿ç•™ 2.5mã€‚é»˜è®¤å€¼ä¸º 8ã€‚ |
| -XX:NewRatio      | ç”¨äºæä¾›æ—§/æ–°ä¸€ä»£å¤§å°çš„æ¯”ç‡ã€‚é»˜è®¤å€¼ä¸º 2ã€‚                    |

## **Java åƒåœ¾æ”¶é›†ç±»å‹ï¼ˆç”¨äºæŒ‡å®šåœ¨è¿›è¡ŒFull GCï¼ˆmajor GCï¼‰æ—¶ä½¿ç”¨ä»€ä¹ˆæ”¶é›†å™¨æ¥è¿›è¡Œåƒåœ¾å›æ”¶ï¼‰**

### Serial GC (-XX:+UseSerialGC)ï¼š-java1.3ä¹‹å‰ç‰ˆæœ¬é»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨-å•çº¿ç¨‹

> Serial GCæ˜¯ä¸€ç§ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨ï¼Œ**æ˜¯JDK 1.3ä¹‹å‰ç‰ˆæœ¬é»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨**ï¼Œå®ƒé€šè¿‡â€œæ ‡è®°-æ¸…é™¤â€ï¼ˆMark-Sweepï¼‰ç®—æ³•å®ç°åƒåœ¾å›æ”¶ã€‚å®ƒæ˜¯ä¸€ç§**å•çº¿ç¨‹çš„åƒåœ¾æ”¶é›†å™¨ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶ä¼šæš‚åœåº”ç”¨ç¨‹åºçº¿ç¨‹ï¼Œå› æ­¤åœé¡¿æ—¶é—´è¾ƒé•¿ï¼Œé€‚ç”¨äºå°å‹åº”ç”¨ç¨‹åºæˆ–è€…å¼€å‘é˜¶æ®µä½¿ç”¨ã€‚**
> Serial GCå°†Javaå †åˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸï¼Œåˆ†åˆ«æ˜¯æ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚åœ¨æ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶ç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œåœ¨è€å¹´ä»£ä½¿ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶ã€‚
> Serial GCçš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š
>
> 1. **æ–°ç”Ÿä»£**åƒåœ¾å›æ”¶ï¼šå°†æ–°ç”Ÿä»£åˆ†ä¸ºä¸€ä¸ªEdenç©ºé—´å’Œä¸¤ä¸ªSurvivorç©ºé—´ï¼Œé‡‡ç”¨**å¤åˆ¶ç®—æ³•**è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå°†å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°Survivorç©ºé—´ï¼ŒåŒæ—¶æ¸…ç©ºEdenç©ºé—´å’Œä¹‹å‰ä½¿ç”¨çš„Survivorç©ºé—´ã€‚
> 2. **è€å¹´ä»£**åƒåœ¾å›æ”¶ï¼šåœ¨è€å¹´ä»£ä½¿ç”¨**æ ‡è®°-æ¸…é™¤ç®—æ³•**è¿›è¡Œåƒåœ¾å›æ”¶ã€‚é¦–å…ˆå¯¹å­˜æ´»å¯¹è±¡è¿›è¡Œæ ‡è®°ï¼Œç„¶åæ¸…é™¤æœªæ ‡è®°çš„å¯¹è±¡ã€‚
>
> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºSerial GCæ˜¯å•çº¿ç¨‹çš„åƒåœ¾æ”¶é›†å™¨ï¼Œå› æ­¤åœ¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ä¼šæš‚åœåº”ç”¨ç¨‹åºçº¿ç¨‹ï¼Œåœé¡¿æ—¶é—´è¾ƒé•¿ï¼Œå¯èƒ½ä¼šå½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚æ­¤å¤–ï¼Œç”±äºä½¿ç”¨äº†æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œä¼šå¯¼è‡´å†…å­˜ç©ºé—´çš„ç¢ç‰‡åŒ–ï¼Œä»è€Œå¯èƒ½ä¼šå‡ºç°å†…å­˜åˆ†é…å¤±è´¥çš„æƒ…å†µã€‚
>
> æ€»ä¹‹ï¼Œ**Serial GCæ˜¯ä¸€ç§ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨ï¼Œé€‚ç”¨äºå°å‹åº”ç”¨ç¨‹åºæˆ–è€…å¼€å‘é˜¶æ®µä½¿ç”¨ï¼Œå®ƒé€šè¿‡å¤åˆ¶ç®—æ³•å’Œæ ‡è®°-æ¸…é™¤ç®—æ³•å®ç°åƒåœ¾å›æ”¶ï¼Œä½†æ˜¯ç”±äºæ˜¯å•çº¿ç¨‹çš„åƒåœ¾æ”¶é›†å™¨ï¼Œåœé¡¿æ—¶é—´è¾ƒé•¿ï¼Œå¯èƒ½ä¼šå½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚**

Serial GC ä½¿ç”¨ç®€å•çš„ mark-sweep-compact æ–¹æ³•æ¥è¿›è¡Œå¹´è½»ä»£å’Œè€å¹´ä»£çš„åƒåœ¾å›æ”¶ï¼Œå³ Minor å’Œ Major GCã€‚Serial GC åœ¨å®¢æˆ·ç«¯æœºå™¨ä¸­å¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚æˆ‘ä»¬ç®€å•çš„ç‹¬ç«‹åº”ç”¨ç¨‹åºå’ŒCPU è¾ƒå°çš„æœºå™¨ã€‚å®ƒé€‚ç”¨äºå†…å­˜å ç”¨å°‘çš„å°å‹åº”ç”¨ç¨‹åºã€‚

### Parallel GC (-XX:+UseParallelGC)ï¼š-java8åŠä¹‹å‰é»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨-å¤šçº¿ç¨‹

Parallel GC ä¸ Serial GC ç›¸åŒï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒä¸ºæ–°ç”Ÿä»£åƒåœ¾æ”¶é›†ç”Ÿæˆ N ä¸ªçº¿ç¨‹ï¼Œå…¶ä¸­ N æ˜¯ç³»ç»Ÿä¸­ CPU æ ¸å¿ƒçš„æ•°é‡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ -XX:ParallelGCThreads=n JVM é€‰é¡¹æ¥æ§åˆ¶çº¿ç¨‹æ•°ã€‚å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨ä¹Ÿç§°ä¸ºååé‡æ”¶é›†å™¨ï¼Œå› ä¸ºå®ƒä½¿ç”¨å¤šä¸ª CPU æ¥åŠ å¿« GC æ€§èƒ½ã€‚ Parallel GC ä½¿ç”¨å•çº¿ç¨‹è¿›è¡Œè€å¹´ä»£åƒåœ¾å›æ”¶ã€‚

> Parallel GCæ˜¯ä¸€ç§å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨ï¼Œ**æ˜¯Java 8ä¹‹å‰é»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨**ï¼Œå®ƒé€šè¿‡â€œæ ‡è®°-æ¸…é™¤â€ï¼ˆMark-Sweepï¼‰ç®—æ³•å®ç°åƒåœ¾å›æ”¶ã€‚Parallel GCä½¿ç”¨å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå¯ä»¥æé«˜åƒåœ¾å›æ”¶çš„æ•ˆç‡ï¼Œé€‚ç”¨äºå¯¹å“åº”æ—¶é—´æ²¡æœ‰ç‰¹åˆ«è¦æ±‚çš„ç³»ç»Ÿã€‚
> Parallel GCå°†Javaå †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œæ–°ç”Ÿä»£ä½¿ç”¨å¤åˆ¶ç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œè€å¹´ä»£ä½¿ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶ã€‚
> Parallel GCçš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š
>
> 1. **æ–°ç”Ÿä»£**åƒåœ¾å›æ”¶ï¼šå°†æ–°ç”Ÿä»£åˆ†ä¸º**ä¸€ä¸ªEden**ç©ºé—´å’Œ**ä¸¤ä¸ªSurvivor**ç©ºé—´ï¼Œä½¿ç”¨**å¤åˆ¶ç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶**ï¼Œå°†å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°Survivorç©ºé—´ï¼ŒåŒæ—¶æ¸…ç©ºEdenç©ºé—´å’Œä¹‹å‰ä½¿ç”¨çš„Survivorç©ºé—´ã€‚åœ¨æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æ—¶ï¼ŒParallel GCä¼šä½¿ç”¨å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œä»¥æé«˜æ•ˆç‡ã€‚
> 2. **è€å¹´ä»£**åƒåœ¾å›æ”¶ï¼šåœ¨è€å¹´ä»£ä½¿ç”¨**æ ‡è®°-æ¸…é™¤**ç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶ã€‚é¦–å…ˆå¯¹å­˜æ´»å¯¹è±¡è¿›è¡Œæ ‡è®°ï¼Œç„¶åæ¸…é™¤æœªæ ‡è®°çš„å¯¹è±¡ã€‚åœ¨è€å¹´ä»£åƒåœ¾å›æ”¶æ—¶ï¼ŒParallel GCä¹Ÿä¼šä½¿ç”¨å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œä»¥æé«˜æ•ˆç‡ã€‚
> 3. 

> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºParallel GCæ˜¯å¹¶è¡Œçš„åƒåœ¾æ”¶é›†å™¨ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªçº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå› æ­¤åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶è¡¨ç°å‡ºè‰²ï¼Œä½†æ˜¯åœ¨è¿›**è¡Œåƒåœ¾å›æ”¶æ—¶ä¼šå ç”¨ä¸€å®šçš„CPUèµ„æºï¼Œå¯èƒ½ä¼šå½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚**æ­¤å¤–ï¼Œç”±äºä½¿ç”¨äº†æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œä¼šå¯¼è‡´**å†…å­˜ç©ºé—´çš„ç¢ç‰‡åŒ–**ï¼Œä»è€Œå¯èƒ½ä¼šå‡ºç°å†…å­˜åˆ†é…å¤±è´¥çš„æƒ…å†µã€‚
> **æ€»ä¹‹ï¼ŒParallel GCæ˜¯ä¸€ç§å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨ï¼Œé€‚ç”¨äºå¯¹å“åº”æ—¶é—´æ²¡æœ‰ç‰¹åˆ«è¦æ±‚çš„ç³»ç»Ÿï¼Œå®ƒé€šè¿‡å¤åˆ¶ç®—æ³•å’Œæ ‡è®°-æ¸…é™¤ç®—æ³•å®ç°åƒåœ¾å›æ”¶ï¼ŒåŒæ—¶ä½¿ç”¨å¤šä¸ªçº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œä»¥æé«˜æ•ˆç‡ã€‚**

### Parallel Old GC (-XX:+UseParallelOldGC)ï¼š

è¿™ä¸ Parallel GC ç›¸åŒï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£åƒåœ¾å›æ”¶ã€‚

### Concurrent Mark Sweep (CMS) Collector (-XX:+UseConcMarkSweepGC)ï¼š-å¤šçº¿ç¨‹

> **CMS æ”¶é›†å™¨ä¹Ÿç§°ä¸ºå¹¶å‘ä½æš‚åœæ”¶é›†å™¨ã€‚**CMSï¼ˆConcurrent Mark Sweepï¼‰æ˜¯ä¸€ç§ä»¥å¹¶å‘æ–¹å¼æ”¶é›†åƒåœ¾çš„åƒåœ¾æ”¶é›†å™¨ï¼Œå®ƒæ˜¯åœ¨JDK 1.5ç‰ˆæœ¬ä¸­å¼•å…¥çš„ã€‚ä¸ä¼ ç»Ÿçš„åƒåœ¾æ”¶é›†å™¨ä¸åŒï¼ŒCMSæ”¶é›†å™¨é‡‡ç”¨äº†ä¸€ç§**â€œæ ‡è®°-æ¸…é™¤â€ï¼ˆMark-Sweepï¼‰**ç®—æ³•ï¼Œå®ƒé€šè¿‡å°†å †å†…å­˜åˆ†ä¸ºå¤šä¸ªä¸é‡å çš„åŒºåŸŸï¼ˆå¦‚æ–°ç”Ÿä»£ã€è€å¹´ä»£ç­‰ï¼‰æ¥å®ç°åƒåœ¾å›æ”¶ã€‚
>
> CMSæ”¶é›†å™¨çš„ä¸»è¦ç‰¹ç‚¹æ˜¯å¹¶å‘æ”¶é›†å’Œä½åœé¡¿ï¼Œå®ƒå¯ä»¥ä¸åº”ç”¨ç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œå¹¶åœ¨åº”ç”¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œä»è€Œå‡å°‘äº†åœé¡¿æ—¶é—´ã€‚åŒæ—¶ï¼ŒCMSæ”¶é›†å™¨ä¹Ÿä¼šå°½å¯èƒ½åœ°å‡å°‘ç©ºé—´çš„ç¢ç‰‡åŒ–ï¼Œæé«˜å†…å­˜ä½¿ç”¨ç‡ã€‚
> CMSæ”¶é›†å™¨çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š
>
> 1. åˆå§‹æ ‡è®°ï¼ˆInitial Markï¼‰ï¼šè¿™ä¸ªé˜¶æ®µ**éœ€è¦æš‚åœåº”ç”¨ç¨‹åº**ï¼Œ**æ ‡è®°å‡ºæ ¹å¯¹è±¡åŠå…¶ç›´æ¥å…³è”çš„å¯¹è±¡**ã€‚
> 2. å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markï¼‰ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œåº”ç”¨ç¨‹åºç»§ç»­è¿è¡Œï¼Œ**GCçº¿ç¨‹ä¸åº”ç”¨ç¨‹åºçº¿ç¨‹å¹¶å‘æ‰§è¡Œ**ï¼Œå¯¹å †ä¸­çš„å¯¹è±¡è¿›è¡Œæ ‡è®°ã€‚
> 3. é‡æ–°æ ‡è®°ï¼ˆRemarkï¼‰ï¼šåœ¨å¹¶å‘æ ‡è®°é˜¶æ®µç»“æŸåï¼Œ**GCçº¿ç¨‹å†æ¬¡æ‰«æå †ä¸­çš„å¯¹è±¡ï¼Œæ‰¾å‡ºå¹¶å‘æ ‡è®°é˜¶æ®µæœ‰ä¿®æ”¹çš„å¯¹è±¡ï¼Œå¹¶æ ‡è®°ä¸ºå­˜æ´»ã€‚**
> 4. å¹¶å‘æ¸…é™¤ï¼ˆConcurrent Sweepï¼‰ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œ**GCçº¿ç¨‹ä¸åº”ç”¨ç¨‹åºçº¿ç¨‹å¹¶å‘æ‰§è¡Œ**ï¼Œæ¸…é™¤æ ‡è®°ä¸ºåƒåœ¾çš„å¯¹è±¡ï¼Œé‡Šæ”¾ç©ºé—´ã€‚
>
> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ**ç”±äºCMSæ”¶é›†å™¨éœ€è¦ä¸åº”ç”¨ç¨‹åºçº¿ç¨‹å¹¶å‘æ‰§è¡Œ**ï¼Œ**å› æ­¤å®ƒéœ€è¦å ç”¨ä¸€éƒ¨åˆ†CPUèµ„æºï¼Œå¯èƒ½ä¼šå¯¹åº”ç”¨ç¨‹åºçš„ååé‡äº§ç”Ÿä¸€å®šçš„å½±å“ã€‚**æ­¤å¤–ï¼Œç”±äºCMSæ”¶é›†å™¨é‡‡ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œä¼š**å¯¼è‡´å†…å­˜ç©ºé—´çš„ç¢ç‰‡åŒ–**ï¼Œä»è€Œå¯èƒ½ä¼šå‡ºç°å†…å­˜åˆ†é…å¤±è´¥çš„æƒ…å†µã€‚


### G1 åƒåœ¾æ”¶é›†å™¨ (-XX:+UseG1GC)ï¼š-java9åŠä¹‹åçš„é»˜è®¤åƒåœ¾æ”¶é›†å™¨

åƒåœ¾ä¼˜å…ˆæˆ– G1 åƒåœ¾æ”¶é›†å™¨ä» Java 7 å¼€å§‹å¯ç”¨ï¼Œå…¶é•¿æœŸç›®æ ‡æ˜¯å–ä»£ CMS æ”¶é›†å™¨ã€‚ G1 æ”¶é›†å™¨æ˜¯ä¸€ä¸ªå¹¶è¡Œçš„ã€å¹¶å‘çš„ã€å¢é‡å‹ç¼©çš„ä½æš‚åœåƒåœ¾æ”¶é›†å™¨ã€‚åƒåœ¾ä¼˜å…ˆæ”¶é›†å™¨ä¸åƒå…¶ä»–æ”¶é›†å™¨é‚£æ ·å·¥ä½œï¼Œ**æ²¡æœ‰å¹´è½»ä»£å’Œè€å¹´ä»£ç©ºé—´çš„æ¦‚å¿µ**ã€‚å®ƒå°†å †ç©ºé—´åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„å †åŒºåŸŸã€‚å½“è°ƒç”¨åƒåœ¾æ”¶é›†æ—¶ï¼Œå®ƒé¦–å…ˆæ”¶é›†æ´»åŠ¨æ•°æ®è¾ƒå°‘çš„åŒºåŸŸï¼Œå› æ­¤æ˜¯â€œåƒåœ¾ä¼˜å…ˆâ€ã€‚

> **Regionï¼ˆåœ°åŒºï¼‰**æ˜¯G1æ”¶é›†å™¨ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå®ƒæ˜¯å°†Javaå †åˆ†å‰²æˆå¤§å°ç›¸ç­‰çš„å†…å­˜å—ï¼Œæ¯ä¸ªRegionçš„å¤§å°é€šå¸¸ä¸º1MBåˆ°32MBä¹‹é—´ã€‚
> **G1æ”¶é›†å™¨ä½¿ç”¨Regionä½œä¸ºæœ€å°çš„å›æ”¶å•å…ƒ**ï¼Œä¹Ÿæ˜¯å¹¶è¡Œå¤„ç†å’Œå‹ç¼©å†…å­˜çš„æœ€å°å•å…ƒã€‚
> åœ¨G1æ”¶é›†å™¨ä¸­ï¼Œå †å†…å­˜è¢«åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„Regionï¼Œ**å…¶ä¸­ä¸€éƒ¨åˆ†Regionç”¨ä½œæ–°ç”Ÿä»£ï¼Œä¸€éƒ¨åˆ†ç”¨ä½œè€å¹´ä»£ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†ç”¨äºHumongouså¯¹è±¡ï¼ˆå¤§å¯¹è±¡ï¼‰**ã€‚G1æ”¶é›†å™¨ä½¿ç”¨Regionçš„æ–¹å¼**èƒ½å¤Ÿé¿å…Full GCçš„åœé¡¿æ—¶é—´è¿‡é•¿**ï¼ŒåŒæ—¶ä¹Ÿèƒ½æ›´åŠ é«˜æ•ˆåœ°è¿›è¡Œå†…å­˜å›æ”¶ã€‚
> G1æ”¶é›†å™¨é€šè¿‡è¯„ä¼°å„ä¸ªRegionçš„åƒåœ¾æƒ…å†µæ¥é€‰æ‹©åƒåœ¾æœ€å¤šçš„Regionè¿›è¡Œå›æ”¶ï¼Œè¿™ç§æ–¹å¼å¯ä»¥æ›´å¥½åœ°æ§åˆ¶å›æ”¶çš„èŒƒå›´å’Œå›æ”¶æ—¶é—´ï¼Œå¹¶ä¸”å¯ä»¥æé«˜å›æ”¶æ•ˆç‡ã€‚åŒæ—¶ï¼Œ**G1æ”¶é›†å™¨è¿˜é€šè¿‡å¤šä¸ªçº¿ç¨‹å¹¶å‘åœ°æ¸…ç†Regionä¸­çš„åƒåœ¾å¯¹è±¡ï¼ŒåŠ é€Ÿäº†åƒåœ¾å›æ”¶çš„é€Ÿåº¦**ã€‚
> æ€»ä¹‹ï¼ŒRegionæ˜¯G1æ”¶é›†å™¨ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œé€šè¿‡å°†Javaå †åˆ†å‰²æˆå¤§å°ç›¸ç­‰çš„å†…å­˜å—ï¼Œå¯ä»¥æ›´å¥½åœ°æ§åˆ¶å†…å­˜å›æ”¶çš„èŒƒå›´å’Œå›æ”¶æ—¶é—´ï¼Œæé«˜åƒåœ¾å›æ”¶çš„æ•ˆç‡ã€‚

## JVMåƒåœ¾æ”¶é›†ç›‘æ§

### ä½¿ç”¨jstat

1. å¯åŠ¨æœ¬åœ°çš„éšä¾¿ä¸€ä¸ªSpringBooté¡¹ç›®ï¼› 

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22883638/1681745743389-2c207724-8193-4995-88c0-ff14d4addcbd.png#averageHue=%23252629&clientId=u5851ebb9-a338-4&from=paste&height=438&id=uc9dbb3b1&name=image.png&originHeight=1750&originWidth=2796&originalType=binary&ratio=2&rotation=0&showTitle=false&size=412469&status=done&style=none&taskId=u0129f263-3208-416c-9ac9-594ebbc029a&title=&width=699)

2. åœ¨ç»ˆç«¯å‘½ä»¤ä¸­è¾“å…¥ï¼š` jps `æŸ¥è¯¢å½“å‰ç¨‹åºçš„è¿›ç¨‹id 

```bash
âœ  ~ jps
2899
82363 Jps
81565 Launcher
81566 App   # è¿™ä¸ªæ˜¯æˆ‘çš„ç¨‹åº
âœ  ~
```

3. ç»ˆç«¯è¾“å…¥å‘½ä»¤jstat -gc 

```bash
âœ  ~ jps
2899
82363 Jps
81565 Launcher
81566 App

# 81566æ˜¯æˆ‘è¿è¡Œçš„Appç¨‹åºçš„è¿›ç¨‹, 1000: è¡¨ç¤ºæ¯æ¬¡è¾“å‡ºä¹‹é—´çš„æ—¶é—´é—´éš”ï¼Œå› æ­¤å®ƒä¼šæ¯ 1 ç§’æ‰“å°ä¸€æ¬¡å†…å­˜å’Œåƒåœ¾æ”¶é›†æ•°æ®
âœ  ~ jstat -gc 81566 1000 > /Users/zzq/blake/jstat.txt  # æ‰“å‡ºå †æ ˆä¿¡æ¯å¹¶è¾“å‡ºåˆ°æœ¬åœ°æ–‡ä»¶åŠ jstat.txtä¸­
```

```bash
 S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT
11264.0 10752.0  0.0   9670.9 89600.0   3161.9   116224.0    9747.1   34432.0 32221.7 4480.0 4077.9      5    0.022   1      0.018    0.040
11264.0 10752.0  0.0   9670.9 89600.0   3161.9   116224.0    9747.1   34432.0 32221.7 4480.0 4077.9      5    0.022   1      0.018    0.040
11264.0 10752.0  0.0   9670.9 89600.0   3161.9   116224.0    9747.1   34432.0 32221.7 4480.0 4077.9      5    0.022   1      0.018    0.040
11264.0 10752.0  0.0   9670.9 89600.0   3161.9   116224.0    9747.1   34432.0 32221.7 4480.0 4077.9      5    0.022   1      0.018    0.040
11264.0 10752.0  0.0   9670.9 89600.0   3161.9   116224.0    9747.1   34432.0 32221.7 4480.0 4077.9      5    0.022   1      0.018    0.040
11264.0 10752.0  0.0   9670.9 89600.0   3161.9   116224.0    9747.1   34432.0 32221.7 4480.0 4077.9      5    0.022   1      0.018    0.040
11264.0 10752.0  0.0   9670.9 89600.0   3161.9   116224.0    9747.1   34432.0 32221.7 4480.0 4077.9      5    0.022   1      0.018    0.040
11264.0 10752.0  0.0   9670.9 89600.0   3161.9   116224.0    9747.1   34432.0 32221.7 4480.0 4077.9      5    0.022   1      0.018    0.040
11264.0 10752.0  0.0   9670.9 89600.0   3161.9   116224.0    9747.1   34432.0 32221.7 4480.0 4077.9      5    0.022   1      0.018    0.040
11264.0 10752.0  0.0   9670.9 89600.0   3161.9   116224.0    9747.1   34432.0 32221.7 4480.0 4077.9      5    0.022   1      0.018    0.040
11264.0 10752.0  0.0   9670.9 89600.0   3161.9   116224.0    9747.1   34432.0 32221.7 4480.0 4077.9      5    0.022   1      0.018    0.040
~
###############
S0C å’Œ S1Cï¼šæ­¤åˆ—æ˜¾ç¤º Survivor0 å’Œ Survivor1 åŒºåŸŸçš„å½“å‰å¤§å°ï¼ˆä»¥ KB ä¸ºå•ä½ï¼‰ã€‚
S0U å’Œ S1Uï¼šæ­¤åˆ—ä»¥ KB ä¸ºå•ä½æ˜¾ç¤º Survivor0 å’Œ Survivor1 åŒºåŸŸçš„å½“å‰ä½¿ç”¨æƒ…å†µã€‚è¯·æ³¨æ„ï¼Œå…¶ä¸­ä¸€ä¸ªå¹¸å­˜è€…åŒºåŸŸä¸€ç›´éƒ½æ˜¯ç©ºçš„ã€‚
EC å’Œ EUï¼šè¿™äº›åˆ—ä»¥ KB ä¸ºå•ä½æ˜¾ç¤º Eden ç©ºé—´çš„å½“å‰å¤§å°å’Œä½¿ç”¨æƒ…å†µã€‚è¯·æ³¨æ„ï¼ŒEU å¤§å°æ­£åœ¨å¢åŠ ï¼Œä¸€æ—¦å®ƒç©¿è¿‡ ECï¼Œå°±ä¼šè°ƒç”¨ Minor GCï¼Œå¹¶ä¸” EU å¤§å°ä¼šå‡å°ã€‚
OC å’Œ OUï¼šè¿™äº›åˆ—ä»¥ KB ä¸ºå•ä½æ˜¾ç¤ºè€å¹´ä»£çš„å½“å‰å¤§å°å’Œå½“å‰ä½¿ç”¨æƒ…å†µã€‚
MC å’Œ MUï¼šè¿™äº›åˆ—ä»¥ KB ä¸ºå•ä½æ˜¾ç¤º å…ƒç©ºé—´(metaspace) çš„å½“å‰å¤§å°å’Œå½“å‰ä½¿ç”¨æƒ…å†µã€‚
YGC å’Œ YGCTï¼šYGC åˆ—æ˜¾ç¤ºå¹´è½»ä»£å‘ç”Ÿçš„ GC äº‹ä»¶çš„æ¬¡æ•°ã€‚ YGCT åˆ—æ˜¾ç¤ºäº†å¹´è½»ä»£ GC æ“ä½œçš„ç´¯è®¡æ—¶é—´ã€‚è¯·æ³¨æ„ï¼Œç”±äºæ¬¡è¦ GCï¼ŒEU å€¼åœ¨åŒä¸€è¡Œä¸­éƒ½å¢åŠ äº†ã€‚
FGC å’Œ FGCTï¼šFGC åˆ—æ˜¾ç¤º Full GC äº‹ä»¶å‘ç”Ÿçš„æ¬¡æ•°ã€‚ FGCT åˆ—æ˜¾ç¤º Full GC æ“ä½œçš„ç´¯è®¡æ—¶é—´ã€‚è¯·æ³¨æ„ï¼Œä¸å¹´è½»ä»£ GC æ—¶é—´ç›¸æ¯”ï¼ŒFull GC æ—¶é—´å¤ªé•¿äº†ã€‚
GCTï¼šæ­¤åˆ—æ˜¾ç¤ºGCæ“ä½œçš„æ€»ç´¯è®¡æ—¶é—´ã€‚è¯·æ³¨æ„ï¼Œå®ƒæ˜¯ YGCT å’Œ FGCT åˆ—å€¼çš„æ€»å’Œã€‚
```

## [JVMæ ˆç©ºé—´ä¸å †ç©ºé—´çš„å†…å­˜åˆ†é…](https://www.digitalocean.com/community/tutorials/java-heap-space-vs-stack-memory)

å¯ä»¥ç›´æ¥å‚è€ƒè¿™ç¯‡æ–‡ç« 
![image.png](https://cdn.nlark.com/yuque/0/2023/png/22883638/1681747047051-4edf0073-e41d-4b40-b8ed-2a10cdd846b4.png#averageHue=%230a1d4d&clientId=u5851ebb9-a338-4&from=paste&height=235&id=ua57ee475&name=image.png&originHeight=590&originWidth=1396&originalType=binary&ratio=2&rotation=0&showTitle=false&size=98550&status=done&style=none&taskId=u9b51547c-e87b-4b35-a0f1-ea00071bc48&title=&width=556)![image.png](https://cdn.nlark.com/yuque/0/2023/png/22883638/1681747053115-09d8ac52-d044-41a2-a482-b8fc9b22ff1e.png#averageHue=%23f7f7f6&clientId=u5851ebb9-a338-4&from=paste&height=235&id=u1310d4c9&name=image.png&originHeight=774&originWidth=1610&originalType=binary&ratio=2&rotation=0&showTitle=false&size=274185&status=done&style=none&taskId=u293aaa34-0335-48b6-9a57-d2d252f8eb1&title=&width=489)

## JVMè°ƒä¼˜å‘½ä»¤ï¼š

> Sun JDKç›‘æ§å’Œæ•…éšœå¤„ç†å‘½ä»¤æœ‰jps jstat jmap jhat jstack jinfo
> jpsï¼ŒJVM Process Status Tool,æ˜¾ç¤ºæŒ‡å®šç³»ç»Ÿå†…æ‰€æœ‰çš„HotSpotè™šæ‹Ÿæœºè¿›ç¨‹ã€‚
> **jstatï¼ŒJVM statistics Monitoringæ˜¯ç”¨äºç›‘è§†è™šæ‹Ÿæœºè¿è¡Œæ—¶çŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºå‡ºè™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JITç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ã€‚--java jstat javaè¿›ç¨‹**
> jmapï¼ŒJVM Memory Mapå‘½ä»¤ç”¨äºç”Ÿæˆheap dumpæ–‡ä»¶
> jhatï¼ŒJVM Heap Analysis Toolå‘½ä»¤æ˜¯ä¸jmapæ­é…ä½¿ç”¨ï¼Œç”¨æ¥åˆ†æjmapç”Ÿæˆçš„dumpï¼Œjhatå†…ç½®äº†ä¸€ä¸ªå¾®å‹çš„HTTP/HTMLæœåŠ¡å™¨ï¼Œç”Ÿæˆdumpçš„åˆ†æç»“æœåï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹
> jstackï¼Œç”¨äºç”Ÿæˆjavaè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ã€‚
> jinfoï¼ŒJVM Configuration info è¿™ä¸ªå‘½ä»¤ä½œç”¨æ˜¯å®æ—¶æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºè¿è¡Œå‚æ•°

#### JConsoleå·¥å…·æ€ä¹ˆä½¿ç”¨ï¼Œæ˜¯javaè‡ªå¸¦çš„å—ï¼Ÿ è¿˜æ˜¯éœ€è¦å•ç‹¬ä¸‹è½½ï¼Ÿ

:::info
JConsoleæ˜¯Javaè‡ªå¸¦çš„ä¸€ä¸ªå›¾å½¢åŒ–ç›‘è§†å·¥å…·ï¼Œç”¨äºç›‘æ§Javaè™šæ‹Ÿæœºå’Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚å®ƒéšJava Development Kit (JDK)ä¸€èµ·æä¾›ï¼Œä½äºJDKçš„**bin**ç›®å½•ä¸‹ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨å·²ç»å®‰è£…äº†JDKï¼Œé‚£ä¹ˆæ‚¨æ— éœ€å•ç‹¬ä¸‹è½½JConsoleã€‚

**è¦ä½¿ç”¨JConsoleï¼Œåªéœ€æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š**

1. **æ‰“å¼€å‘½ä»¤è¡Œæˆ–ç»ˆç«¯ã€‚ ï¼ˆå¯ä»¥ä½¿ç”¨which java æˆ–è€… where is java æŸ¥è¯¢javaå®‰è£…ç›®å½•**ï¼‰
2. å¯¼èˆªåˆ°JDKçš„**bin**ç›®å½•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœJDKå®‰è£…åœ¨**C:\Program Files\Java\jdk-ç‰ˆæœ¬å·**ï¼Œé‚£ä¹ˆè¯·å¯¼èˆªåˆ°**C:\Program Files\Java\jdk-ç‰ˆæœ¬å·\bin**ã€‚
3. è¾“å…¥**jconsole**å¹¶æŒ‰Enteré”®å¯åŠ¨JConsoleã€‚
4. JConsoleå°†æ‰“å¼€ä¸€ä¸ªå›¾å½¢ç•Œé¢ï¼Œåˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„Javaè¿›ç¨‹ã€‚é€‰æ‹©æ‚¨è¦ç›‘æ§çš„Javaåº”ç”¨ç¨‹åºè¿›ç¨‹ï¼Œç„¶åå•å‡»"Connect"æŒ‰é’®ã€‚
5. ä¸€æ—¦è¿æ¥æˆåŠŸï¼Œæ‚¨å°†çœ‹åˆ°JConsoleçš„ä¸»ç•Œé¢ï¼Œå®ƒåŒ…å«ä»¥ä¸‹å‡ ä¸ªé€‰é¡¹å¡ï¼š
   - æ¦‚è¿°ï¼ˆOverviewï¼‰ï¼šæ˜¾ç¤ºå…³äºJavaè™šæ‹Ÿæœºçš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚JVMç‰ˆæœ¬ã€å¯åŠ¨æ—¶é—´ç­‰ã€‚
   - å†…å­˜ï¼ˆMemoryï¼‰ï¼šæ˜¾ç¤ºå…³äºå †å†…å­˜å’Œéå †å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œä»¥åŠåƒåœ¾æ”¶é›†çš„ç»Ÿè®¡ä¿¡æ¯ã€‚
   - çº¿ç¨‹ï¼ˆThreadsï¼‰ï¼šæ˜¾ç¤ºå…³äºçº¿ç¨‹çš„ä¿¡æ¯ï¼Œå¦‚æ´»åŠ¨çº¿ç¨‹æ•°ã€å³°å€¼çº¿ç¨‹æ•°ç­‰ï¼Œä»¥åŠçº¿ç¨‹çš„çŠ¶æ€å’Œå †æ ˆè·Ÿè¸ªã€‚
   - ç±»ï¼ˆClassesï¼‰ï¼šæ˜¾ç¤ºå…³äºç±»çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œå¦‚å·²åŠ è½½ç±»çš„æ•°é‡ã€å·²å¸è½½ç±»çš„æ•°é‡ç­‰ã€‚
   - è™šæ‹Ÿæœºï¼ˆVM Summaryï¼‰ï¼šæä¾›æœ‰å…³JVMå’Œæ“ä½œç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯ã€‚
   - MBeansï¼šæ˜¾ç¤ºæ‰€æœ‰çš„MBeansï¼Œå¯ä»¥æŸ¥çœ‹å’Œä¿®æ”¹åº”ç”¨ç¨‹åºçš„å†…éƒ¨çŠ¶æ€ã€‚

é€šè¿‡è¿™äº›é€‰é¡¹å¡ï¼Œæ‚¨å¯ä»¥ç›‘æ§Javaåº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œä»¥ä¾¿ä¼˜åŒ–å’Œè°ƒè¯•ã€‚è¯·æ³¨æ„ï¼Œé•¿æ—¶é—´è¿è¡ŒJConsoleå¯èƒ½ä¼šå¯¹Javaåº”ç”¨ç¨‹åºçš„æ€§èƒ½äº§ç”Ÿå½±å“ï¼Œå› æ­¤è¯·è°¨æ…ä½¿ç”¨ã€‚
:::
![image.png](https://cdn.nlark.com/yuque/0/2023/png/22883638/1682126536370-dbd06546-8cef-4410-873c-221c46f9c454.png#averageHue=%2331363d&clientId=uea4f0fff-8063-4&from=paste&height=318&id=ue87b8f8a&name=image.png&originHeight=636&originWidth=1612&originalType=binary&ratio=2&rotation=0&showTitle=false&size=327465&status=done&style=none&taskId=u1fa6be2b-15b2-4295-af0b-c3a3ca36232&title=&width=806)![image.png](https://cdn.nlark.com/yuque/0/2023/png/22883638/1682126604910-66b35b69-8181-40b7-a399-a39fe56847c8.png#averageHue=%23645b4d&clientId=uea4f0fff-8063-4&from=paste&height=537&id=u49950fba&name=image.png&originHeight=1074&originWidth=1078&originalType=binary&ratio=2&rotation=0&showTitle=false&size=126035&status=done&style=none&taskId=u7ff1001a-368c-4e16-9100-db241d2cf3e&title=&width=539)
![image.png](https://cdn.nlark.com/yuque/0/2023/png/22883638/1682126667061-29802493-02fa-4ad7-b3e1-a0c098946e7a.png#averageHue=%23ebebeb&clientId=uea4f0fff-8063-4&from=paste&height=750&id=u60b604dd&name=image.png&originHeight=1500&originWidth=1800&originalType=binary&ratio=2&rotation=0&showTitle=false&size=161240&status=done&style=none&taskId=u641184e9-3967-4a0e-be5e-00497df7e62&title=&width=900)

## [å¸¸è§é¢è¯•é¢˜ï¼š](https://github.com/Homiss/Java-interview-questions/blob/master/JVM/JVM%E9%9D%A2%E8%AF%95%E9%A2%98.md)

# æ•°æ®å­˜å‚¨

## MongoDB

**å¸¸è§çš„æ•°æ®åº“**
ä»¥ä¸‹æ˜¯Javaä¸–ç•Œä¸­å¸¸ç”¨æ•°æ®åº“çš„è¡¨æ ¼æ¦‚è¿°ï¼š

| **æ•°æ®åº“**           | **ç±»å‹**                      | **æ˜¯å¦å…³ç³»å‹æ•°æ®åº“** | **ç‰¹ç‚¹**                                               | **ä½¿ç”¨åœºæ™¯**                                       |
| -------------------- | ----------------------------- | -------------------- | ------------------------------------------------------ | -------------------------------------------------- |
| **MySQL**            | å…³ç³»å‹æ•°æ®åº“ï¼ˆRDBMSï¼‰         | æ˜¯                   | å¼€æºã€æ˜“äºä½¿ç”¨ã€é«˜æ€§èƒ½ã€æˆç†Ÿçš„ç¤¾åŒºæ”¯æŒ                 | ç½‘ç«™ã€åº”ç”¨ç¨‹åºã€CMSç³»ç»Ÿã€æ•°æ®ä»“åº“ç­‰                |
| **PostgreSQL**       | å…³ç³»å‹æ•°æ®åº“ï¼ˆRDBMSï¼‰         | æ˜¯                   | å¼€æºã€å¯æ‰©å±•ã€å¼ºå¤§çš„æŸ¥è¯¢èƒ½åŠ›ã€æ”¯æŒå¤šç§æ•°æ®ç±»å‹         | ç½‘ç«™ã€ä¼ä¸šçº§åº”ç”¨ç¨‹åºã€GISæ•°æ®å­˜å‚¨ã€æ•°æ®ä»“åº“ç­‰      |
| Oracle               | å…³ç³»å‹æ•°æ®åº“ï¼ˆRDBMSï¼‰         | æ˜¯                   | ä¼ä¸šçº§ã€é«˜æ€§èƒ½ã€å®‰å…¨ã€å¯æ‰©å±•                           | ä¼ä¸šçº§åº”ç”¨ç¨‹åºã€æ•°æ®ä»“åº“ã€é«˜å¯ç”¨æ€§å’Œäº‹åŠ¡æ€§åº”ç”¨ç­‰   |
| Microsoft SQL Server | å…³ç³»å‹æ•°æ®åº“ï¼ˆRDBMSï¼‰         | æ˜¯                   | é«˜æ€§èƒ½ã€æ˜“äºç®¡ç†ã€å¤šç§ç‰ˆæœ¬ã€ä¼ä¸šçº§ç‰¹æ€§                 | ä¼ä¸šçº§åº”ç”¨ç¨‹åºã€æ•°æ®ä»“åº“ã€BIè§£å†³æ–¹æ¡ˆç­‰             |
| **Redis**            | é”®å€¼å­˜å‚¨ï¼ˆKey-Valueï¼‰         | å¦                   | é«˜æ€§èƒ½ã€å†…å­˜å­˜å‚¨ã€æ”¯æŒå¤šç§æ•°æ®ç»“æ„ã€å¯æŒä¹…åŒ–           | ç¼“å­˜ã€ä¼šè¯ç®¡ç†ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å®æ—¶åˆ†æç­‰               |
| Apache Cassandra     | åˆ—å¼å­˜å‚¨ï¼ˆColumnarï¼‰          | å¦                   | åˆ†å¸ƒå¼ã€é«˜å¯ç”¨æ€§ã€é«˜æ€§èƒ½ã€å¯æ‰©å±•                       | å¤§è§„æ¨¡æ•°æ®å­˜å‚¨ã€å®æ—¶åˆ†æã€IoTæ•°æ®ã€æ—¶åºæ•°æ®ç­‰      |
| **MongoDB**          | æ–‡æ¡£å‹æ•°æ®åº“ï¼ˆDocumentï¼‰      | å¦                   | é¢å‘æ–‡æ¡£ã€é«˜æ€§èƒ½ã€å¯æ‰©å±•ã€çµæ´»çš„æ•°æ®æ¨¡å‹               | Webåº”ç”¨ç¨‹åºã€å¤§æ•°æ®å¤„ç†ã€å®æ—¶åˆ†æã€CMSç³»ç»Ÿç­‰       |
| Neo4j                | å›¾å½¢æ•°æ®åº“ï¼ˆGraphï¼‰           | å¦                   | é«˜æ€§èƒ½ã€æ˜“äºæŸ¥è¯¢ã€é€‚åˆå›¾å½¢æ•°æ®å¤„ç†ã€å¯è§†åŒ–æŸ¥è¯¢è¯­è¨€æ”¯æŒ | ç¤¾äº¤ç½‘ç»œåˆ†æã€æ¨èç³»ç»Ÿã€è·¯å¾„è§„åˆ’ã€çŸ¥è¯†å›¾è°±ç­‰       |
| InfluxDB             | æ—¶é—´åºåˆ—æ•°æ®åº“ï¼ˆTime Seriesï¼‰ | å¦                   | é«˜æ€§èƒ½ã€æ˜“äºæŸ¥è¯¢ã€é€‚åˆæ—¶é—´åºåˆ—æ•°æ®å¤„ç†ã€æ•°æ®å‹ç¼©       | ç‰©è”ç½‘æ•°æ®å­˜å‚¨ã€ç›‘æ§ç³»ç»Ÿã€å®æ—¶åˆ†æã€é‡‘èæ•°æ®åˆ†æç­‰ |

### ç®€å•ä½¿ç”¨MongoDB

ä»¥ä¸‹æ˜¯ MongoDB çš„ç®€å•ä½¿ç”¨æ–¹å¼ï¼š

1.  å®‰è£… MongoDB
    é¦–å…ˆï¼Œæ‚¨éœ€è¦å®‰è£… MongoDB æ•°æ®åº“ã€‚MongoDB å¯ä»¥åœ¨å¤šä¸ªæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼Œæ‚¨å¯ä»¥åœ¨å®˜æ–¹ç½‘ç«™ä¸Šæ‰¾åˆ°ç›¸åº”çš„å®‰è£…åŒ…å’Œè¯´æ˜ã€‚ 
2.  å¯åŠ¨ MongoDB 

å®‰è£…å®Œ MongoDB åï¼Œæ‚¨éœ€è¦å¯åŠ¨ MongoDB æœåŠ¡å™¨ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨åªéœ€åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ "mongod" å‘½ä»¤å³å¯å¯åŠ¨ MongoDB æœåŠ¡å™¨ã€‚å¦‚æœæ‚¨éœ€è¦è‡ªå®šä¹‰é…ç½®ï¼Œè¯·å‚é˜…å®˜æ–¹æ–‡æ¡£ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚

3. è¿æ¥åˆ° MongoDB

å¯åŠ¨ MongoDB æœåŠ¡å™¨åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ MongoDB å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ mongo shellã€Compass ç­‰ï¼‰æˆ– MongoDB é©±åŠ¨ç¨‹åºåœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­è¿æ¥åˆ°æ•°æ®åº“ã€‚
**ä»¥ä¸‹æ˜¯ä½¿ç”¨ Java é©±åŠ¨ç¨‹åºè¿æ¥åˆ° MongoDB çš„ç®€å•ç¤ºä¾‹ï¼š**

```java
import com.mongodb.client.MongoClients;
import com.mongodb.client.MongoClient;
import com.mongodb.client.MongoDatabase;
//å¯ä»¥ç›´æ¥ä½¿ç”¨æ­¤ä»£ç 
public class MongoDBExample {
    public static void main(String[] args) {
        // è¿æ¥åˆ° MongoDB æœåŠ¡å™¨
        MongoClient mongoClient = MongoClients.create("mongodb://localhost:27017");

        // é€‰æ‹©æ•°æ®åº“å’Œé›†åˆ
        MongoDatabase database = mongoClient.getDatabase("test");
        MongoCollection<Document> collection = database.getCollection("myCollection");

        // æ’å…¥ä¸€æ¡æ–‡æ¡£
        Document document = new Document("name", "John Doe")
        .append("age", 30)
        .append("address", new Document("street", "123 Main St")
                .append("city", "Anytown")
                .append("state", "CA")
                .append("zip", "12345"));
        collection.insertOne(document);

        // æŸ¥è¯¢æ–‡æ¡£
        Document query = new Document("name", "John Doe");
        FindIterable<Document> results = collection.find(query);
        for (Document doc : results) {
            System.out.println(doc.toJson());
        }

        // å…³é—­è¿æ¥
        mongoClient.close();
    }
}
```

**mongodbæ•°æ®åº“ä¸­çš„æ•°æ®å­˜å‚¨ä¸ºï¼š**

```json
{
  "_id" : ObjectId("643a50da849bc574dbb49221"),
  "name" : "John Doe",
  "age" : NumberInt(30),
  "address" : {
    "street" : "123 Main St",
    "city" : "Anytown",
    "state" : "CA",
    "zip" : "12345"
  }
}
```

> æ­¤ç¤ºä¾‹å°†è¿æ¥åˆ°æœ¬åœ° MongoDB æœåŠ¡å™¨ï¼Œé€‰æ‹©åä¸º "test" çš„æ•°æ®åº“ï¼ˆå¦‚æœä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºï¼‰å’Œ "myCollection" é›†åˆï¼ˆå¦‚æœä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºï¼‰ã€‚ç„¶åï¼Œå®ƒæ’å…¥ä¸€æ¡æ–‡æ¡£å¹¶æŸ¥è¯¢æ‰€æœ‰ "name" å­—æ®µä¸º "John Doe" çš„æ–‡æ¡£ã€‚æœ€åï¼Œå®ƒå…³é—­äº†ä¸ MongoDB çš„è¿æ¥ã€‚


**ä¸Šè¿°ä»£ç å¦‚æœæ•°æ®åº“ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºå—ï¼Ÿ**

> æ˜¯çš„ï¼Œå¦‚æœæ•°æ®åº“ä¸å­˜åœ¨ï¼ŒMongoDB ä¼šè‡ªåŠ¨åˆ›å»ºå®ƒã€‚åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œå¦‚æœ "test" æ•°æ®åº“ä¸å­˜åœ¨ï¼ŒMongoDB å°†è‡ªåŠ¨åˆ›å»ºå®ƒï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»ºåä¸º "myCollection" çš„æ–°é›†åˆã€‚åœ¨æ’å…¥ç¬¬ä¸€æ¡æ–‡æ¡£æ—¶ï¼ŒMongoDB è¿˜å°†è‡ªåŠ¨ä¸º "myCollection" åˆ›å»ºç´¢å¼•ã€‚
> è¿™æ˜¯å› ä¸º MongoDB æ˜¯ä¸€ç§æ— æ¨¡å¼ï¼ˆSchemalessï¼‰çš„æ•°æ®åº“ï¼Œè¿™æ„å‘³ç€å®ƒå…è®¸æ‚¨åœ¨æ²¡æœ‰æ˜¾å¼å®šä¹‰æ¶æ„çš„æƒ…å†µä¸‹å­˜å‚¨æ•°æ®ã€‚å½“æ‚¨æ’å…¥ç¬¬ä¸€æ¡æ–‡æ¡£æ—¶ï¼ŒMongoDB å°†æ ¹æ®æ–‡æ¡£ä¸­åŒ…å«çš„å­—æ®µåŠ¨æ€åœ°åˆ›å»ºä¸€ä¸ªæ¶æ„ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚

### Spring Boot é›†æˆMongoDB æ“ä½œ

1. æ·»åŠ ä¾èµ–

åœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-data-mongodb</artifactId>
</dependency>
```

è¿™å°†ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæ·»åŠ  Spring Boot Data MongoDB Starter ä¾èµ–é¡¹ã€‚

2. é…ç½®æ•°æ®æº

åœ¨ application.properties æ–‡ä»¶ä¸­æ·»åŠ  MongoDB æ•°æ®æºçš„è¿æ¥ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š

```yaml
spring.data.mongodb.uri=mongodb://localhost:27017/test
```

è¿™å°†é…ç½® Spring Data MongoDB è¿æ¥åˆ°æœ¬åœ° MongoDB å®ä¾‹ä¸Šçš„ "test" æ•°æ®åº“ã€‚

3. åˆ›å»ºå®ä½“ç±»

åˆ›å»ºä¸€ä¸ªæ™®é€šçš„ Java ç±»ï¼Œå°†å…¶æ³¨é‡Šä¸ºå®ä½“ç±»ï¼Œå¹¶åœ¨ç±»ä¸­å®šä¹‰è¦æ˜ å°„åˆ° MongoDB é›†åˆçš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ "Person" å®ä½“ç±»ï¼š

```java
import org.springframework.data.annotation.Id;
import org.springframework.data.mongodb.core.mapping.Document;

@Document(collection = "people")
public class Person {

    @Id
    private String id;
    private String name;
    private int age;

    public Person() {}

    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    // getters and setters
}
```

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨** **[**@Document **](/Document )** **æ³¨é‡ŠæŒ‡å®šäº†è¦æ˜ å°„åˆ° "people" é›†åˆçš„å®ä½“ç±»ã€‚è¿˜å®šä¹‰äº† "id"ã€"name" å’Œ "age" å±æ€§ï¼Œå¹¶æ·»åŠ äº†ä¸€ä¸ªå¸¦å‚æ•°çš„æ„é€ å‡½æ•°ã€‚ 

4. åˆ›å»ºä»“åº“æ¥å£

åˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œå¹¶ç»§æ‰¿ MongoRepository æ¥å£ï¼Œä»¥ä½¿ç”¨ Spring Boot Data JPA è‡ªåŠ¨åˆ›å»º MongoDB ä»“åº“ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ "PersonRepository" æ¥å£ï¼š

```java
import org.springframework.data.mongodb.repository.MongoRepository;

public interface PersonRepository extends MongoRepository<Person, String> {

}
```

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ MongoRepository æ¥å£è‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ª "PersonRepository" ä»“åº“ï¼Œç”¨äºç®¡ç† "Person" å®ä½“ç±»ä¸ MongoDB ä¸­çš„ "people" é›†åˆä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚è¯¥æ¥å£ç»§æ‰¿ MongoRepository å¹¶æŒ‡å®šäº†å®ä½“ç±»å’Œ ID çš„ç±»å‹ã€‚

5. ä½¿ç”¨ä»“åº“æ“ä½œæ•°æ®

ç°åœ¨ï¼Œæ‚¨å¯ä»¥åœ¨æ‚¨çš„ä»£ç ä¸­æ³¨å…¥ PersonRepositoryï¼Œå¹¶ä½¿ç”¨å…¶å†…ç½®çš„æ–¹æ³•æ¥ä¿å­˜ã€æŸ¥è¯¢å’Œåˆ é™¤æ•°æ®ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ Spring Boot æ§åˆ¶å™¨ç±»ï¼Œç”¨äºä¿å­˜å’ŒæŸ¥è¯¢ "Person" å®ä½“ï¼š

```java
package org.example;

import org.example.springBootMonogo.Person;
import org.example.springBootMonogo.PersonRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

import javax.annotation.PostConstruct;

@SpringBootApplication
public class MyApplication {

    public static void main(String[] args) {
        SpringApplication.run(MyApplication.class, args);
    }

    @Autowired
    PersonRepository personRepository;

    @PostConstruct
    public void setDataToMongoDB(){
        personRepository.save(new Person("blake", 22));
    }

    @PostConstruct
    public void getDataFromMongoDB(){
        System.out.println(personRepository.findAll().toString());
    }

}
```

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ³¨å…¥äº† PersonRepositoryï¼Œå¹¶åœ¨ savePerson æ–¹æ³•ä¸­ä½¿ç”¨ personRepository.save() æ–¹æ³•ä¿å­˜ "Person" å®ä½“ã€‚åœ¨ getPerson æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ personRepository.findById() æ–¹æ³•æ ¹æ®ã€‚

### MongoDBçš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š

1. é¢å‘æ–‡æ¡£çš„æ•°æ®å­˜å‚¨ï¼šMongoDBä½¿ç”¨BSONæ ¼å¼å­˜å‚¨æ•°æ®ï¼Œå®ƒæ˜¯ä¸€ç§äºŒè¿›åˆ¶çš„JSONè¡¨ç¤ºå½¢å¼ï¼Œå¯ä»¥è½»æ¾è¡¨ç¤ºå¤æ‚çš„æ•°æ®ç»“æ„ã€‚
2. çµæ´»çš„æ•°æ®æ¨¡å‹ï¼šä¸éœ€è¦é¢„å…ˆå®šä¹‰è¡¨ç»“æ„ï¼Œå¯ä»¥éšç€åº”ç”¨ç¨‹åºéœ€æ±‚çš„å˜åŒ–è€Œè½»æ¾åœ°æ›´æ”¹æ•°æ®ç»“æ„ã€‚
3. é«˜æ€§èƒ½ï¼šMongoDBä¸ºè¯»å†™æ“ä½œæä¾›äº†é«˜æ€§èƒ½ï¼Œå…·æœ‰å†…ç½®çš„ç¼“å­˜å’Œç´¢å¼•æ”¯æŒã€‚
4. æ°´å¹³å¯æ‰©å±•æ€§ï¼šMongoDBå¯ä»¥é€šè¿‡åˆ†ç‰‡ï¼ˆshardingï¼‰å®ç°æ°´å¹³æ‰©å±•ï¼Œä»¥æ»¡è¶³å¤§è§„æ¨¡æ•°æ®é›†å’Œé«˜ååé‡çš„éœ€æ±‚ã€‚
5. é«˜å¯ç”¨æ€§ï¼šMongoDBæ”¯æŒå¤åˆ¶é›†ï¼ˆReplica Setsï¼‰ï¼Œä»¥ç¡®ä¿æ•°æ®çš„é«˜å¯ç”¨æ€§å’Œæ•…éšœè½¬ç§»èƒ½åŠ›ã€‚

MongoDBå¹¿æ³›åº”ç”¨äºå„ç§åœºæ™¯ï¼Œ

1. åŒ…æ‹¬Webåº”ç”¨ç¨‹åºã€å¤§æ•°æ®å¤„ç†ã€å®æ—¶åˆ†æã€å†…å®¹ç®¡ç†ç³»ç»Ÿç­‰ã€‚

å®ƒæ˜¯è®¸å¤šå…¬å¸å’Œå¼€å‘è€…çš„é¦–é€‰NoSQLæ•°æ®åº“ä¹‹ä¸€ã€‚

### MongoDBå¯¹äº‹ç‰©çš„æ”¯æŒï¼ˆæ”¯æŒï¼‰

> MongoDB ä»ç‰ˆæœ¬ 4.0 å¼€å§‹æ”¯æŒå¤šæ–‡æ¡£äº‹åŠ¡ï¼ˆMulti-Document Transactionsï¼‰åŠŸèƒ½ã€‚åœ¨ MongoDB ä¸­ï¼Œäº‹åŠ¡æ˜¯åŸºäºæ–‡æ¡£çº§åˆ«çš„ï¼Œå¯ä»¥è·¨è¶Šå¤šä¸ªé›†åˆå’Œæ–‡æ¡£è¿›è¡Œæ“ä½œï¼Œå¯ä»¥ä¿è¯ ACID ç‰¹æ€§ã€‚å…·ä½“åœ°ï¼Œäº‹åŠ¡å…è®¸å¤šä¸ªæ“ä½œä½œä¸ºä¸€ä¸ªå•å…ƒåŸå­åœ°æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨æäº¤æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šã€‚


### MongoDBæ˜¯å¦æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆä¸æ”¯æŒï¼‰

> MongoDB åœ¨ 4.2 ç‰ˆæœ¬ä¸­å¼•å…¥äº†åˆ†å¸ƒå¼äº‹åŠ¡çš„æ¦‚å¿µï¼Œå¯ä»¥æ”¯æŒè·¨å¤šä¸ªæ•°æ®åº“çš„ ACID äº‹åŠ¡ã€‚ä½†æ˜¯ï¼ŒMongoDB ç›®å‰è¿˜ä¸æ”¯æŒåˆ†æ­¥äº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯ä¸æ”¯æŒåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œéƒ¨åˆ†å†™æ“ä½œå¹¶æäº¤ï¼Œç„¶åå†æ‰§è¡Œå…¶ä»–å†™æ“ä½œå¹¶æäº¤ã€‚è¿™æ˜¯å› ä¸º MongoDB äº‹åŠ¡çš„ç²’åº¦æ˜¯æ•´ä¸ªäº‹åŠ¡ï¼Œè€Œä¸æ˜¯å•ä¸ªæ“ä½œã€‚
> åœ¨ MongoDB ä¸­ï¼Œäº‹åŠ¡æ˜¯ä»¥æ•°æ®åº“ä¸ºç²’åº¦è¿›è¡Œç®¡ç†çš„ã€‚æ¯ä¸ªæ•°æ®åº“éƒ½æœ‰ä¸€ä¸ªäº‹åŠ¡çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ startTransaction() æ–¹æ³•å¼€å§‹ä¸€ä¸ªäº‹åŠ¡ï¼Œä½¿ç”¨ commitTransaction() æ–¹æ³•æäº¤äº‹åŠ¡ï¼Œä½¿ç”¨ abortTransaction() æ–¹æ³•å›æ»šäº‹åŠ¡ã€‚åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¯ä»¥å¯¹å¤šä¸ªé›†åˆè¿›è¡Œè¯»å†™æ“ä½œï¼Œè€Œè¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨æäº¤ï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šã€‚å› æ­¤ï¼ŒMongoDB çš„äº‹åŠ¡æ¨¡å‹æ¯”è¾ƒç®€å•å’Œç›´è§‚ï¼Œä½†æ˜¯å¯¹äºæŸäº›å¤æ‚çš„åœºæ™¯å¯èƒ½ä¸å¤ªçµæ´»ã€‚
>
> æ€»ä¹‹ï¼Œ**MongoDB ç›®å‰è¿˜ä¸æ”¯æŒåˆ†æ­¥äº‹åŠ¡**ï¼Œä½†æ˜¯å¯ä»¥æ”¯æŒè·¨å¤šä¸ªæ•°æ®åº“çš„ ACID äº‹åŠ¡ã€‚å¦‚æœéœ€è¦åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œéƒ¨åˆ†å†™æ“ä½œå¹¶æäº¤ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å…¶ä»–æ•°æ®åº“æˆ–æŠ€æœ¯ï¼Œä¾‹å¦‚ MySQLã€Oracleã€PostgreSQL ç­‰ã€‚


## Redis

## [MySQL](https://www.yuque.com/blake-a5uo7/ypqb2i/dg2c8h)

### äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š

:::info

- è¯»æœªæäº¤ï¼ˆRead Uncommittedï¼‰ï¼š

åœ¨è¿™ä¸ªéš”ç¦»çº§åˆ«ä¸­ï¼Œä¸€ä¸ªäº‹åŠ¡å¯ä»¥çœ‹åˆ°å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®ã€‚è¿™ä¸ªçº§åˆ«å¾ˆå°‘ä½¿ç”¨ï¼Œå› ä¸ºå®ƒå¯èƒ½å¯¼è‡´è®¸å¤šé—®é¢˜ï¼Œå¦‚è„è¯»ï¼ˆDirty Readï¼Œè¯»åˆ°å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼‰ï¼Œä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚

- è¯»å·²æäº¤ï¼ˆRead Committedï¼‰ï¼š

è¿™æ˜¯å¤§å¤šæ•°æ•°æ®åº“ç³»ç»Ÿçš„é»˜è®¤éš”ç¦»çº§åˆ«ã€‚åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹åˆ°å…¶ä»–äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ã€‚è¿™ä¸ªçº§åˆ«é¿å…äº†è„è¯»çš„é—®é¢˜ï¼Œä½†ä»ç„¶å¯èƒ½å‘ç”Ÿä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚

- å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰ï¼š

åœ¨è¿™ä¸ªéš”ç¦»çº§åˆ«ä¸­ï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­å¯ä»¥å¤šæ¬¡è¯»å–ç›¸åŒçš„æ•°æ®è¡Œï¼Œå¹¶ä¸”æ¯æ¬¡è¯»å–çš„ç»“æœéƒ½ç›¸åŒã€‚è¿™ä¸ªçº§åˆ«é¿å…äº†è„è¯»å’Œä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼Œä½†ä»ç„¶å¯èƒ½å‘ç”Ÿå¹»è¯»ã€‚**åœ¨MySQLçš„InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œè¿™æ˜¯é»˜è®¤çš„éš”ç¦»çº§åˆ«ã€‚**

- ä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ï¼š

è¿™æ˜¯æœ€é«˜çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚åœ¨è¿™ä¸ªçº§åˆ«ä¸­ï¼Œäº‹åŠ¡è¢«å®Œå…¨ä¸²è¡ŒåŒ–æ‰§è¡Œï¼Œå³æ¯ä¸ªäº‹åŠ¡å¿…é¡»ç­‰å¾…å‰ä¸€ä¸ªäº‹åŠ¡å®Œæˆåæ‰èƒ½å¼€å§‹æ‰§è¡Œã€‚è¿™ä¸ªçº§åˆ«å¯ä»¥é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„é—®é¢˜ï¼Œä½†å®ƒå¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œå› ä¸ºå¹¶å‘åº¦é™ä½ã€‚
:::

### è„è¯»ã€å¹»è¯»ã€ä¸å¯é‡å¤è¯»

1. **è„è¯»ï¼ˆè¯»å–åˆ°äº†update+rollbackçš„æ•°æ®**ï¼‰ï¼š Aäº‹åŠ¡è¯»å–åˆ°äº†Bäº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼Œç„¶åBäº‹åŠ¡è¿›è¡Œäº†å›æ»šã€‚
2. **å¹»è¯»ï¼ˆadd /deleteï¼‰**ï¼šAäº‹åŠ¡å¤šæ¬¡è¯»å–ä¸€ä¸ªèŒƒå›´çš„æ•°æ®ï¼Œæ­¤æœŸé—´Bäº‹åŠ¡è¿›è¡Œäº†å¯¹è¿™ä¸ªèŒƒå›´å†…æ•°æ®çš„åˆ é™¤æˆ–æ–°å¢æ“ä½œï¼Œå¯¼è‡´Aäº‹åŠ¡è¯»å–åˆ°çš„æ•°æ®ä¸ä¸€è‡´ã€‚å°±åƒäº§ç”Ÿå¹»è§‰ä¸€æ ·ï¼›
3. **ä¸å¯é‡å¤è¯»ï¼ˆè¯»å–åˆ°äº†update+commitçš„æ•°æ®ï¼‰**: Aäº‹åŠ¡åœ¨å¤šæ¬¡è¯»å–ç›¸åŒæ•°æ®æ—¶ï¼ŒBäº‹åŠ¡åœ¨æ­¤æœŸé—´å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹å¹¶æäº¤ã€‚å¯¼è‡´Aå‰åè¯»å–çš„æ•°æ®ä¸ä¸€è‡´ã€‚

### MySQLå¦‚ä½•æ˜¯å¦‚ä½•è§£å†³å¹»è¯»çš„

:::info
MySQL ä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥è§£å†³å¹»è¯»é—®é¢˜ï¼šNext-Key Locking å’Œ Gap Lockingã€‚**è¿™ä¸¤ç§é”æœºåˆ¶éƒ½åŸºäºå¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰éš”ç¦»çº§åˆ«ã€‚**

**Next-Key Lockingï¼š**
Next-Key Locking æ˜¯ä¸€ç§**ç»„åˆé”**ï¼Œå®ƒåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼š**è®°å½•é”ï¼ˆRecord Lockï¼‰å’Œé—´éš™é”ï¼ˆGap Lockï¼‰**ã€‚**è®°å½•é”é”å®šæ•°æ®è¡Œ**ï¼Œè€Œ**é—´éš™é”é”å®šæ•°æ®è¡Œä¹‹é—´çš„é—´éš™**ã€‚å½“ä¸€ä¸ªäº‹åŠ¡è®¿é—®ä¸€ä¸ªèŒƒå›´å†…çš„æ•°æ®æ—¶ï¼Œå®ƒä¼šé”å®šè¿™ä¸ªèŒƒå›´å†…çš„æ‰€æœ‰æ•°æ®è¡Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„é—´éš™ã€‚è¿™æ ·ï¼Œå…¶ä»–äº‹åŠ¡å°±æ— æ³•åœ¨è¿™ä¸ªèŒƒå›´å†…æ’å…¥æ–°çš„æ•°æ®è¡Œï¼Œä»è€Œé¿å…äº†å¹»è¯»é—®é¢˜ã€‚
ä¾‹å¦‚ï¼Œäº‹åŠ¡AæŸ¥è¯¢èŒƒå›´[10, 20]å†…çš„æ•°æ®ï¼ŒNext-Key Locking ä¼šé”å®šè¿™ä¸ªèŒƒå›´å†…çš„æ‰€æœ‰æ•°æ®è¡Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„é—´éš™ã€‚å› æ­¤ï¼Œäº‹åŠ¡Bæ— æ³•åœ¨è¿™ä¸ªèŒƒå›´å†…æ’å…¥æ–°çš„æ•°æ®è¡Œï¼Œç›´åˆ°äº‹åŠ¡Aé‡Šæ”¾é”ã€‚

**Gap Locking é—´éš™é”ï¼š**
Gap Locking æ˜¯ä¸€ç§é”å®šæ•°æ®è¡Œä¹‹é—´é—´éš™çš„é”æœºåˆ¶ã€‚å®ƒä¸»è¦ç”¨äºé˜²æ­¢å¹»è¯»ï¼Œé€šè¿‡é”å®šæ•°æ®è¡Œä¹‹é—´çš„é—´éš™æ¥é˜»æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™äº›é—´éš™å†…æ’å…¥æ–°çš„æ•°æ®è¡Œã€‚**Gap Locking ä¸é”å®šæ•°æ®è¡Œæœ¬èº«ï¼Œå› æ­¤ï¼Œå®ƒå¯¹å¹¶å‘æ€§èƒ½çš„å½±å“è¾ƒå°ã€‚**
ä¾‹å¦‚ï¼Œäº‹åŠ¡AæŸ¥è¯¢èŒƒå›´[10, 20]å†…çš„æ•°æ®ï¼ŒGap Locking ä¼šé”å®šè¿™ä¸ªèŒƒå›´å†…çš„æ‰€æœ‰æ•°æ®è¡Œä¹‹é—´çš„é—´éš™ã€‚å› æ­¤ï¼Œäº‹åŠ¡Bæ— æ³•åœ¨è¿™ä¸ªèŒƒå›´å†…æ’å…¥æ–°çš„æ•°æ®è¡Œï¼Œç›´åˆ°äº‹åŠ¡Aé‡Šæ”¾é”ã€‚

åœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œé»˜è®¤çš„éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰ã€‚åœ¨è¿™ä¸ªéš”ç¦»çº§åˆ«ä¸‹ï¼ŒInnoDB ä½¿ç”¨ Next-Key Locking å’Œ Gap Locking æœºåˆ¶æ¥è§£å†³å¹»è¯»é—®é¢˜ã€‚ç„¶è€Œï¼Œè¿™ç§é”æœºåˆ¶å¯èƒ½ä¼šå¯¼è‡´é”ç«äº‰å’Œæ€§èƒ½ä¸‹é™ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚å’Œå¯¹å¹¶å‘æ€§èƒ½çš„è¦æ±‚æ¥é€‰æ‹©åˆé€‚çš„é”æœºåˆ¶å’Œéš”ç¦»çº§åˆ«ã€‚
:::

### MVCC,redolog,undolog,binlog

:::info
è¿™é‡Œç®€è¦ä»‹ç» MVCCã€redo logã€undo log å’Œ binlog è¿™å››ä¸ª MySQL ç›¸å…³çš„æ¦‚å¿µï¼š

1. **MVCCï¼ˆMulti-Version Concurrency Controlï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶**ï¼‰ï¼š MVCC æ˜¯ä¸€ç§ç”¨äºè§£å†³æ•°æ®åº“å¹¶å‘è®¿é—®é—®é¢˜çš„æŠ€æœ¯ã€‚åœ¨ MVCC æœºåˆ¶ä¸‹ï¼Œäº‹åŠ¡å¯¹æ•°æ®çš„è¯»å†™ä¸ä¼šç›´æ¥é”å®šæ•°æ®è¡Œï¼Œè€Œæ˜¯é€šè¿‡ä¿å­˜æ•°æ®è¡Œçš„å¤šä¸ªç‰ˆæœ¬æ¥å®ç°çš„ã€‚è¿™æ ·ï¼Œè¯»æ“ä½œå¯ä»¥è¯»å–åˆ°ä¸€ä¸ªåˆé€‚ç‰ˆæœ¬çš„æ•°æ®ï¼Œè€Œä¸ä¼šè¢«å…¶ä»–äº‹åŠ¡çš„å†™æ“ä½œé˜»å¡ã€‚MVCC æé«˜äº†æ•°æ®åº“çš„å¹¶å‘æ€§èƒ½ï¼Œé™ä½äº†é”ç«äº‰ã€‚MySQL çš„ InnoDB å­˜å‚¨å¼•æ“ä½¿ç”¨ MVCC æ¥å®ç°äº‹åŠ¡çš„éš”ç¦»ã€‚
2. **redo logï¼ˆé‡åšæ—¥å¿—ï¼‰**ï¼š redo log æ˜¯ä¸€ç§**ç‰©ç†æ—¥å¿—**ï¼Œç”¨äºè®°å½•æ•°æ®é¡µï¼ˆData Pageï¼‰çš„ä¿®æ”¹ã€‚å½“äº‹åŠ¡è¿›è¡Œæ•°æ®ä¿®æ”¹æ—¶ï¼Œå…ˆå°†ä¿®æ”¹å†™å…¥ redo logï¼Œç„¶åå†å°†æ•°æ®é¡µçš„ä¿®æ”¹æ›´æ–°åˆ°ç£ç›˜ã€‚redo log é‡‡ç”¨ Write-Ahead Loggingï¼ˆWALï¼‰æœºåˆ¶ï¼Œ**å³å…ˆå†™æ—¥å¿—ï¼Œåå†™æ•°æ®é¡µ**ã€‚è¿™æ ·åšå¯ä»¥æé«˜äº‹åŠ¡çš„å“åº”é€Ÿåº¦ï¼Œå¹¶åœ¨ç³»ç»Ÿå´©æºƒæ—¶ç”¨äºæ¢å¤æ•°æ®ã€‚**redo log ä¸»è¦å­˜åœ¨äº InnoDB å­˜å‚¨å¼•æ“ä¸­ã€‚**
3. **undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰**ï¼š undo log æ˜¯ä¸€ç§**é€»è¾‘æ—¥å¿—**ï¼Œç”¨äº**è®°å½•æ•°æ®ä¿®æ”¹å‰çš„çŠ¶æ€**ã€‚å½“äº‹åŠ¡æ‰§è¡Œå›æ»šæ—¶ï¼Œå¯ä»¥æ ¹æ® undo log æ¢å¤æ•°æ®åˆ°ä¿®æ”¹å‰çš„çŠ¶æ€ã€‚undo log è¿˜ç”¨äºå®ç° MVCCï¼Œå½“å…¶ä»–äº‹åŠ¡éœ€è¦è¯»å–æŸä¸ªæ•°æ®è¡Œçš„æ—§ç‰ˆæœ¬æ—¶ï¼Œå¯ä»¥é€šè¿‡åº”ç”¨ undo log æ¥è·å–ã€‚ä¸ redo log ä¸€æ ·ï¼Œ**undo log ä¸»è¦å­˜åœ¨äº InnoDB å­˜å‚¨å¼•æ“ä¸­ã€‚**
4. **binlogï¼ˆäºŒè¿›åˆ¶æ—¥å¿—ï¼‰**ï¼š binlog æ˜¯ MySQL æ•°æ®åº“ä¸­çš„ä¸€ç§**é€»è¾‘æ—¥å¿—**ï¼Œç”¨äºè®°å½•æ•°æ®åº“æ‰€æœ‰çš„ DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰å’Œ DMLï¼ˆæ•°æ®æ“ä½œè¯­è¨€ï¼‰æ“ä½œã€‚binlog çš„**ä¸»è¦ç”¨é€”**åŒ…æ‹¬æ•°æ®æ¢å¤ã€ä¸»ä»å¤åˆ¶å’Œå®¡è®¡ç­‰ã€‚å½“äº‹åŠ¡æäº¤æ—¶ï¼Œå…ˆå°†äº‹åŠ¡çš„æ“ä½œè®°å½•å†™å…¥ binlogï¼Œç„¶åå†æ‰§è¡Œå®é™…çš„æ•°æ®ä¿®æ”¹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ**binlog æ˜¯ MySQL å±‚çš„æ—¥å¿—ï¼Œä¸å­˜å‚¨å¼•æ“æ— å…³ã€‚**
   æ€»ç»“ä¸€ä¸‹ï¼ŒMVCC æ˜¯ç”¨äºè§£å†³å¹¶å‘è®¿é—®é—®é¢˜çš„æŠ€æœ¯ï¼Œredo log å’Œ undo log æ˜¯ InnoDB å­˜å‚¨å¼•æ“ä¸­ç”¨äºè®°å½•æ•°æ®ä¿®æ”¹çš„æ—¥å¿—ï¼Œè€Œ binlog æ˜¯ MySQL æ•°æ®åº“å±‚é¢çš„æ—¥å¿—ï¼Œç”¨äºè®°å½•æ‰€æœ‰çš„æ“ä½œå¹¶ç”¨äºæ•°æ®æ¢å¤ã€ä¸»ä»å¤åˆ¶ç­‰åŠŸèƒ½ã€‚
   :::

### ç´¢å¼•ï¼š

# åŠ¨æ€ä»£ç†åŠåå°„

> JDKåŠ¨æ€ä»£ç†ä¸Cglibä»£ç†çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ å…±åŒç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ
> JDK åŠ¨æ€ä»£ç†ä¸ Cglib ä»£ç†çš„åŒºåˆ«ä¸»è¦åœ¨äºä»£ç†æ–¹å¼å’Œä½¿ç”¨æ¡ä»¶ã€‚å®ƒä»¬çš„å…±åŒç‚¹æ˜¯éƒ½èƒ½åœ¨è¿è¡Œæ—¶åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œä»è€Œå®ç°å¯¹ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•æ‹¦æˆªã€‚

## JDK åŠ¨æ€ä»£ç†ï¼š

- åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»ï¼›
- ä½¿ç”¨ Java åå°„ APIï¼Œå…·ä½“ä¸º java.lang.reflect.Proxy ç±»ï¼›
- æ€§èƒ½ç›¸å¯¹è¾ƒä½ï¼Œå› ä¸ºå®ƒä½¿ç”¨åå°„è°ƒç”¨æ–¹æ³•ã€‚

ç¤ºä¾‹ä»£ç ï¼š

```java
import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Method;
import java.lang.reflect.Proxy;

interface UserService {
    void addUser();
}

class UserServiceImpl implements UserService {
    @Override
    public void addUser() {
        System.out.println("æ·»åŠ ç”¨æˆ·");
    }
}

class JDKProxy implements InvocationHandler {
    private Object target;

    public JDKProxy(Object target) {
        this.target = target;
    }

    public Object getProxyInstance() {
        // ä½¿ç”¨ Proxy.newProxyInstance() æ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡
        return Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(), this);
    }

    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        // åœ¨è°ƒç”¨æ–¹æ³•å‰ï¼Œæ·»åŠ è‡ªå®šä¹‰é€»è¾‘
        System.out.println("å¼€å§‹æ‰§è¡Œæ–¹æ³•: " + method.getName());

        // è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•
        Object result = method.invoke(target, args);

        // åœ¨è°ƒç”¨æ–¹æ³•åï¼Œæ·»åŠ è‡ªå®šä¹‰é€»è¾‘
        System.out.println("ç»“æŸæ‰§è¡Œæ–¹æ³•: " + method.getName());

        return result;
    }
}

public class JDKProxyExample {
    public static void main(String[] args) {
        UserService userService = new UserServiceImpl();
        JDKProxy jdkProxy = new JDKProxy(userService);
        UserService proxyInstance = (UserService) jdkProxy.getProxyInstance();
        proxyInstance.addUser();
    }
}
```

## Cglib ä»£ç†ï¼š

- å¯ä»¥ä»£ç†æ²¡æœ‰å®ç°æ¥å£çš„ç±»ï¼›
- ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ Cglibï¼ˆCode Generation Libraryï¼‰ï¼Œéœ€è¦å¼•å…¥ Cglib ä¾èµ–ï¼›
- æ€§èƒ½ç›¸å¯¹è¾ƒé«˜ï¼Œå› ä¸ºå®ƒä½¿ç”¨å­—èŠ‚ç æŠ€æœ¯ç”Ÿæˆå­ç±»ã€‚

ç¤ºä¾‹ä»£ç ï¼ˆéœ€è¦å¼•å…¥ Cglib ä¾èµ–ï¼‰ï¼š

```java
import net.sf.cglib.proxy.Enhancer;
import net.sf.cglib.proxy.MethodInterceptor;
import net.sf.cglib.proxy.MethodProxy;

class UserServiceCglib {
    public void addUser() {
        System.out.println("æ·»åŠ ç”¨æˆ·");
    }
}

class CglibProxy implements MethodInterceptor {
    private Object target;

    public CglibProxy(Object target) {
        this.target = target;
    }

    public Object getProxyInstance() {
        Enhancer enhancer = new Enhancer();
        enhancer.setSuperclass(target.getClass());
        enhancer.setCallback(this);
        // ä½¿ç”¨ Enhancer.create() æ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡
        return enhancer.create();
    }

    @Override
    public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {
        // åœ¨è°ƒç”¨æ–¹æ³•å‰ï¼Œæ·»åŠ è‡ªå®šä¹‰é€»è¾‘
        System.out.println("å¼€å§‹æ‰§è¡Œæ–¹æ³•: " + method.getName());

        // è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•
        Object result = proxy.invokeSuper(obj, args);

        // åœ¨è°ƒç”¨æ–¹æ³•åï¼Œæ·»åŠ è‡ªå®šä¹‰é€»è¾‘
        System.out.println("ç»“æŸæ‰§è¡Œæ–¹æ³•: " + method.getName());

        return result;
    }
}


public class CglibProxyExample {
    public static void main(String[] args) {
        UserServiceCglib userService = new UserServiceCglib();
        CglibProxy cglibProxy = new CglibProxy(userService);
        UserServiceCglib proxyInstance = (UserServiceCglib) cglibProxy.getProxyInstance();
        proxyInstance.addUser();
    }
}
```

> **æ€»ç»“ï¼š**
>
> - JDK åŠ¨æ€ä»£ç†ï¼šåªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»ï¼Œä½¿ç”¨ Java åå°„ APIï¼Œæ€§èƒ½è¾ƒä½ï¼›
> - Cglib ä»£ç†ï¼šå¯ä»¥ä»£ç†æ²¡æœ‰å®ç°æ¥å£çš„ç±»ï¼Œä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ Cglibï¼Œæ€§èƒ½è¾ƒé«˜ï¼›
> - å…±åŒç‚¹ï¼šéƒ½èƒ½åœ¨è¿è¡Œæ—¶åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå®ç°å¯¹ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•æ‹¦æˆªã€‚

## åå°„

### åå°„æ¦‚å¿µåŠæ¡ˆä¾‹ï¼š

åå°„ï¼ˆReflectionï¼‰æ˜¯ Java ç¼–ç¨‹è¯­è¨€çš„ä¸€ç§å¼ºå¤§ç‰¹æ€§ï¼Œå®ƒå…è®¸åœ¨è¿è¡Œæ—¶æ£€æŸ¥å’Œæ“ä½œç±»ã€å¯¹è±¡ã€æ–¹æ³•å’Œå±æ€§ã€‚é€šè¿‡åå°„ï¼Œæ‚¨å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶åˆ›å»ºå¯¹è±¡ã€è°ƒç”¨æ–¹æ³•ä»¥åŠè·å–å’Œè®¾ç½®å±æ€§å€¼ï¼Œè€Œæ— éœ€åœ¨ç¼–è¯‘æ—¶äº†è§£ç±»çš„å…·ä½“å®ç°ã€‚è¿™ä½¿å¾— Java ä»£ç å…·æœ‰æ›´å¼ºçš„çµæ´»æ€§å’Œæ‰©å±•æ€§ã€‚
ä»¥ä¸‹æ˜¯ Java åå°„çš„ä¸€äº›å…³é”®æ¦‚å¿µï¼š

1. **ç±»å¯¹è±¡ï¼ˆClass Objectï¼‰**ï¼šåœ¨ Java ä¸­ï¼Œæ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„ Class å¯¹è±¡ï¼Œå®ƒåŒ…å«äº†ç±»çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚ç±»åã€æ„é€ å‡½æ•°ã€æ–¹æ³•å’Œå±æ€§ã€‚æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨ç±»çš„ getClass() æ–¹æ³•æˆ–ä½¿ç”¨ç±»å­—é¢å¸¸é‡ï¼ˆå¦‚ MyClass.classï¼‰è·å– Class å¯¹è±¡ã€‚
2. **æ„é€ å‡½æ•°ï¼ˆConstructorï¼‰**ï¼šé€šè¿‡åå°„ï¼Œæ‚¨å¯ä»¥åœ¨è¿è¡Œæ—¶è·å–ç±»çš„æ„é€ å‡½æ•°ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ„é€ å‡½æ•°çš„å‚æ•°ç±»å‹ã€ä¿®é¥°ç¬¦ç­‰ã€‚è¿™ä½¿å¾—æ‚¨å¯ä»¥åœ¨è¿è¡Œæ—¶åˆ›å»ºç±»çš„å®ä¾‹ï¼Œè€Œæ— éœ€åœ¨ç¼–è¯‘æ—¶çŸ¥é“å…·ä½“çš„æ„é€ å‡½æ•°ã€‚
3. **æ–¹æ³•ï¼ˆMethodï¼‰**ï¼šåå°„å…è®¸æ‚¨åœ¨è¿è¡Œæ—¶è·å–ç±»çš„æ–¹æ³•ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–¹æ³•åã€å‚æ•°ç±»å‹ã€è¿”å›ç±»å‹å’Œä¿®é¥°ç¬¦ã€‚æ‚¨å¯ä»¥ä½¿ç”¨åå°„è°ƒç”¨è¿™äº›æ–¹æ³•ï¼Œå³ä½¿å®ƒä»¬æ˜¯ç§æœ‰çš„ã€‚
4. **å±æ€§ï¼ˆFieldï¼‰**ï¼šé€šè¿‡åå°„ï¼Œæ‚¨å¯ä»¥åœ¨è¿è¡Œæ—¶è·å–ç±»çš„å±æ€§ä¿¡æ¯ï¼ŒåŒ…æ‹¬å±æ€§åã€ç±»å‹ã€ä¿®é¥°ç¬¦ç­‰ã€‚æ‚¨è¿˜å¯ä»¥è·å–å’Œè®¾ç½®å±æ€§å€¼ï¼Œå³ä½¿å®ƒä»¬æ˜¯ç§æœ‰çš„ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ Java åå°„ç¤ºä¾‹ï¼š

```java
javaCopy code
import java.lang.reflect.Method;

public class ReflectionExample {
    public static void main(String[] args) {
        try {
            // è·å– String ç±»çš„ Class å¯¹è±¡
            Class<?> stringClass = Class.forName("java.lang.String");

            // è·å– String ç±»çš„ toUpperCase æ–¹æ³•
            Method toUpperCaseMethod = stringClass.getMethod("toUpperCase");

            // åˆ›å»ºä¸€ä¸ª String å®ä¾‹
            String myString = "hello world";

            // é€šè¿‡åå°„è°ƒç”¨ toUpperCase æ–¹æ³•
            String upperCaseString = (String) toUpperCaseMethod.invoke(myString);

            // è¾“å‡ºç»“æœ
            System.out.println(upperCaseString); // è¾“å‡ºï¼šHELLO WORLD
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

:::warning
ğŸ“¢ï¼šéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿‡åº¦ä½¿ç”¨åå°„å¯èƒ½ä¼šå¯¼è‡´ä»£ç çš„å¯è¯»æ€§ã€æ€§èƒ½å’Œå®‰å…¨æ€§é™ä½ã€‚å› æ­¤ï¼Œåœ¨éœ€è¦åŠ¨æ€è®¿é—®å’Œæ“ä½œç±»ã€æ–¹æ³•å’Œå±æ€§æ—¶ï¼Œæ‰å»ºè®®ä½¿ç”¨åå°„ã€‚
:::

### åå°„çš„åº”ç”¨åœºæ™¯ï¼š

> åå°„åœ¨ Java ç¼–ç¨‹ä¸­æœ‰å¾ˆå¤šå®é™…åº”ç”¨åœºæ™¯ã€‚ä»¥ä¸‹åˆ—ä¸¾äº†ä¸€äº›å¸¸è§çš„åå°„åº”ç”¨åœºæ™¯ï¼š
>
> 1. æ’ä»¶å’Œæ¡†æ¶ï¼šè®¸å¤š Java æ¡†æ¶å’Œæ’ä»¶ç³»ç»Ÿä½¿ç”¨åå°„æ¥åŠ¨æ€åŠ è½½å’Œæ‰§è¡Œç”¨æˆ·æä¾›çš„ä»£ç ã€‚ä¾‹å¦‚ï¼ŒSpring æ¡†æ¶é€šè¿‡åå°„æ¥åˆ›å»ºå’Œç®¡ç† Bean å®ä¾‹ï¼Œä»è€Œå®ç°ä¾èµ–æ³¨å…¥å’Œé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚
> 2. æµ‹è¯•æ¡†æ¶ï¼šæµ‹è¯•æ¡†æ¶å¦‚ JUnit ä½¿ç”¨åå°„æ¥æ‰«ææµ‹è¯•ç±»ï¼Œè‡ªåŠ¨è¯†åˆ«å¹¶æ‰§è¡Œå¸¦æœ‰ç‰¹å®šæ³¨è§£ï¼ˆå¦‚ @Testï¼‰çš„æµ‹è¯•æ–¹æ³•ï¼Œæ— éœ€æ˜¾å¼è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚
> 3. åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼šJava åºåˆ—åŒ–åº“ï¼ˆå¦‚ JSON è§£æåº“ï¼‰ä½¿ç”¨åå°„æ¥æ£€æŸ¥å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ï¼Œä»¥å®ç°å¯¹è±¡ä¸ JSON å­—ç¬¦ä¸²ä¹‹é—´çš„ç›¸äº’è½¬æ¢ã€‚
> 4. æ•°æ®åº“ ORMï¼šå¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰æ¡†æ¶å¦‚ Hibernate å’Œ MyBatis ä½¿ç”¨åå°„æ¥å®ç° Java å¯¹è±¡ä¸æ•°æ®åº“è¡¨ä¹‹é—´çš„æ˜ å°„ï¼Œè‡ªåŠ¨å°†æ•°æ®åº“è®°å½•è½¬æ¢ä¸º Java å¯¹è±¡ï¼Œåä¹‹äº¦ç„¶ã€‚
> 5. åŠ¨æ€ä»£ç†ï¼šåå°„å¯ä»¥ç”¨äºå®ç°åŠ¨æ€ä»£ç†ï¼Œå³åœ¨è¿è¡Œæ—¶ç”Ÿæˆä»£ç†ç±»ï¼Œç”¨äºæ‹¦æˆªå’Œå¤„ç†å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ã€‚è¿™åœ¨å®ç°æŸäº›è®¾è®¡æ¨¡å¼ï¼ˆå¦‚ä»£ç†æ¨¡å¼ï¼‰å’Œ AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æ—¶éå¸¸æœ‰ç”¨ã€‚
> 6. é…ç½®æ–‡ä»¶è§£æï¼šåå°„å¯ä»¥ç”¨äºè§£æé…ç½®æ–‡ä»¶ï¼ˆå¦‚ XML æˆ– Properties æ–‡ä»¶ï¼‰ï¼Œå°†é…ç½®ä¿¡æ¯åŠ¨æ€åœ°æ˜ å°„åˆ° Java å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ä¸Šã€‚
> 7. GUI æ„å»ºï¼šä¸€äº› GUI æ„å»ºå·¥å…·ï¼ˆå¦‚ JavaFX Scene Builderï¼‰ä½¿ç”¨åå°„æ¥æ£€æŸ¥ç”¨æˆ·å®šä¹‰çš„æ§åˆ¶å™¨ç±»ï¼Œä»¥ä¾¿åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ›å»ºç•Œé¢å…ƒç´ å¹¶å°†äº‹ä»¶å¤„ç†å™¨ç»‘å®šåˆ°ç›¸åº”çš„æ–¹æ³•ä¸Šã€‚
>
> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶åå°„åœ¨å¾ˆå¤šåœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œä½†æ˜¯è¿‡åº¦ä½¿ç”¨åå°„å¯èƒ½ä¼šå¯¼è‡´ä»£ç éš¾ä»¥ç†è§£å’Œç»´æŠ¤ï¼ŒåŒæ—¶å½±å“ç¨‹åºæ€§èƒ½ã€‚å› æ­¤ï¼Œåœ¨ç¡®å®éœ€è¦åŠ¨æ€è®¿é—®å’Œæ“ä½œç±»ã€æ–¹æ³•å’Œå±æ€§æ—¶ï¼Œæ‰æ¨èä½¿ç”¨åå°„ã€‚

### åå°„å®ç°çš„ä¸‰ç§æ–¹å¼

1. ä½¿ç”¨ Class.forName() æ–¹æ³•ï¼šé€šè¿‡ä¼ é€’ç±»çš„å®Œå…¨é™å®šåï¼ˆåŒ…æ‹¬åŒ…åå’Œç±»åï¼‰ä½œä¸ºå‚æ•°ï¼Œæ­¤æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª Class å¯¹è±¡ã€‚è¿™æ˜¯åœ¨çŸ¥é“ç±»åä½†ä¸çŸ¥é“å…¶å…·ä½“ç±»å‹æ—¶è·å– Class å¯¹è±¡çš„å¸¸ç”¨æ–¹æ³•ã€‚

```java
// è·å– String ç±»çš„ Class å¯¹è±¡
Class<?> stringClass = Class.forName("java.lang.String");
```

2. ä½¿ç”¨ .class è¯­æ³•ï¼šå¯¹äºå·²çŸ¥çš„ç±»å‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ .class è¯­æ³•è·å–å…¶å¯¹åº”çš„ Class å¯¹è±¡ã€‚è¿™ç§æ–¹æ³•ä¸éœ€è¦æ•è·å¼‚å¸¸ï¼Œå› ä¸ºåœ¨ç¼–è¯‘æ—¶å°±å·²ç»çŸ¥é“ç±»çš„ç±»å‹ã€‚

```java
// è·å– String ç±»çš„ Class å¯¹è±¡
Class<String> stringClass = String.class;
```

3. ä½¿ç”¨å¯¹è±¡çš„ getClass() æ–¹æ³•ï¼šå¦‚æœä½ å·²ç»æœ‰ä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œå¯ä»¥è°ƒç”¨è¯¥å®ä¾‹çš„ getClass() æ–¹æ³•æ¥è·å–å…¶å¯¹åº”çš„ Class å¯¹è±¡ã€‚è¿™å¯¹äºåœ¨è¿è¡Œæ—¶æ£€æŸ¥å¯¹è±¡çš„å®é™…ç±»å‹éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†ç»§æ‰¿æˆ–æ¥å£å®ç°æ—¶ã€‚

```java
// åˆ›å»ºä¸€ä¸ª String å¯¹è±¡
String myString = "hello world";

// è·å– String å¯¹è±¡çš„ Class å¯¹è±¡
Class<?> stringClass = myString.getClass();
```

é€šè¿‡ä¸Šè¿°ä¸‰ç§æ–¹å¼ï¼Œä½ å¯ä»¥è·å–åˆ° Java ç±»çš„ Class å¯¹è±¡ã€‚ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨ Class å¯¹è±¡æä¾›çš„æ–¹æ³•æ¥è·å–ç±»çš„æ„é€ å‡½æ•°ã€æ–¹æ³•å’Œå±æ€§ï¼Œä»¥åŠå®ä¾‹åŒ–å¯¹è±¡ã€è°ƒç”¨æ–¹æ³•å’Œæ“ä½œå±æ€§ã€‚

### åå°„çš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ

> åå°„çš„åº•å±‚åŸç†ä¸»è¦åŸºäº Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰å¯¹ç±»çš„å…ƒæ•°æ®ï¼ˆmetadataï¼‰çš„ç®¡ç†å’Œæ“ä½œã€‚å…ƒæ•°æ®æ˜¯å…³äºç±»ã€æ¥å£ã€æ–¹æ³•ã€å±æ€§ç­‰ç¼–ç¨‹å…ƒç´ çš„æ•°æ®ï¼Œä¾‹å¦‚åç§°ã€ä¿®é¥°ç¬¦ã€å‚æ•°ç±»å‹ç­‰ã€‚å½“ä½ ç¼–è¯‘ Java æºä»£ç æ—¶ï¼Œè¿™äº›å…ƒæ•°æ®ä¼šè¢«å­˜å‚¨åœ¨ç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶ï¼ˆ.class æ–‡ä»¶ï¼‰ä¸­ã€‚å½“ JVM åŠ è½½ç±»æ—¶ï¼Œå®ƒä¼šè§£æå­—èŠ‚ç æ–‡ä»¶ï¼Œæå–å…ƒæ•°æ®å¹¶åˆ›å»ºç›¸åº”çš„å†…éƒ¨æ•°æ®ç»“æ„ã€‚
>
> åœ¨ Java ä¸­ï¼ŒClass ç±»æ˜¯åå°„çš„æ ¸å¿ƒã€‚æ¯ä¸ª Java ç±»åœ¨ JVM ä¸­éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„ Class å®ä¾‹ï¼Œç”¨äºå­˜å‚¨å’Œæ“ä½œè¯¥ç±»çš„å…ƒæ•°æ®ã€‚ä½ å¯ä»¥é€šè¿‡ä¸Šé¢æåˆ°çš„ä¸‰ç§æ–¹å¼ï¼ˆClass.forName()ã€.class è¯­æ³•å’Œå¯¹è±¡çš„ getClass() æ–¹æ³•ï¼‰æ¥è·å– Class å®ä¾‹ã€‚ä¸€æ—¦ä½ è·å¾—äº† Class å®ä¾‹ï¼Œå°±å¯ä»¥ä½¿ç”¨å®ƒæä¾›çš„æ–¹æ³•æ¥æŸ¥è¯¢å’Œæ“ä½œå…ƒæ•°æ®ï¼Œä¾‹å¦‚è·å–æ„é€ å‡½æ•°ã€æ–¹æ³•å’Œå±æ€§ï¼Œåˆ›å»ºå¯¹è±¡å®ä¾‹ç­‰ã€‚
> Java åå°„çš„åº•å±‚å®ç°ä¾èµ–äº JVM å’Œ Java ç±»åº“ã€‚JVM æä¾›äº†å¯¹å…ƒæ•°æ®çš„åº•å±‚æ”¯æŒï¼Œè€Œ Java ç±»åº“ï¼ˆå¦‚ java.lang.reflect åŒ…ï¼‰ä¸ºå¼€å‘è€…æä¾›äº†æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡å’Œå°è£…ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥æ›´æ–¹ä¾¿åœ°ä½¿ç”¨åå°„åŠŸèƒ½ã€‚å…·ä½“å®ç°å¯èƒ½å› ä¸åŒçš„ JVM å’Œ Java ç‰ˆæœ¬è€Œå¼‚ï¼Œä½†åŸºæœ¬åŸç†æ˜¯ç›¸åŒçš„ã€‚
>
> **æ€»ä¹‹ï¼Œåå°„çš„åº•å±‚åŸç†æ˜¯åŸºäº Java è™šæ‹Ÿæœºå¯¹ç±»çš„å…ƒæ•°æ®çš„ç®¡ç†å’Œæ“ä½œ**ã€‚é€šè¿‡ä½¿ç”¨ Class ç±»å’Œ java.lang.reflect åŒ…ä¸­çš„å…¶ä»–ç±»ï¼Œå¼€å‘è€…å¯ä»¥åœ¨è¿è¡Œæ—¶æŸ¥è¯¢å’Œæ“ä½œ Java ç±»çš„å…ƒæ•°æ®ï¼Œä»è€Œå®ç°åŠ¨æ€åœ°åˆ›å»ºå¯¹è±¡ã€è°ƒç”¨æ–¹æ³•å’Œæ“ä½œå±æ€§ç­‰åŠŸèƒ½ã€‚

# çƒ­é—¨æ¡†æ¶

## [Spring Cloud Alibaba](https://spring.io/projects/spring-cloud)

## Nacos

**ä¸‹é¢æ˜¯Eurekaå’ŒNacosçš„å¯¹æ¯”æ€»ç»“ï¼š**

| **ç‰¹æ€§**     | **Eureka**               | **Nacos**                                              |
| ------------ | ------------------------ | ------------------------------------------------------ |
| å¼€å‘å…¬å¸     | Netflix                  | é˜¿é‡Œå·´å·´                                               |
| åŠŸèƒ½ç‰¹æ€§     | åªæ”¯æŒæœåŠ¡æ³¨å†Œå’Œå‘ç°     | æ”¯æŒæœåŠ¡æ³¨å†Œå’Œå‘ç°ã€é…ç½®ç®¡ç†ã€æµé‡ç®¡ç†ç­‰å¤šä¸ªæ–¹é¢çš„åŠŸèƒ½ |
| æœåŠ¡å¥åº·æ£€æŸ¥ | åªæ”¯æŒHTTPæ–¹å¼çš„å¥åº·æ£€æŸ¥ | æ”¯æŒTCPã€HTTPã€MySQLç­‰å¤šç§æ–¹å¼çš„å¥åº·æ£€æŸ¥               |
| æœåŠ¡å‘ç°æœºåˆ¶ | åªæ”¯æŒRPCæ–¹å¼çš„æœåŠ¡å‘ç°  | æ”¯æŒDNSå’ŒRPCä¸¤ç§æœåŠ¡å‘ç°æœºåˆ¶                           |
| é…ç½®ç®¡ç†     | ä¸æ”¯æŒé…ç½®ç®¡ç†           | **æ”¯æŒåŠ¨æ€é…ç½®ç®¡ç†å’Œé…ç½®æ¨é€ç­‰åŠŸèƒ½**                   |
| å¼€æºåè®®     | Apache 2.0               | Apache 2.0å’ŒGPLv2åè®®çš„åŒåè®®                          |

æ€»ä½“æ¥è¯´ï¼ŒNacosåœ¨åŠŸèƒ½ç‰¹æ€§ä¸Šæ›´åŠ å…¨é¢ï¼Œæ”¯æŒå¤šä¸ªæ–¹é¢çš„æœåŠ¡æ²»ç†åŠŸèƒ½ï¼Œè€ŒEurekaåˆ™æ›´åŠ è½»é‡çº§ï¼Œåªå…³æ³¨äºæœåŠ¡æ³¨å†Œå’Œå‘ç°çš„åŠŸèƒ½ã€‚æ­¤å¤–ï¼ŒNacosè¿˜æ”¯æŒå¤šç§å¥åº·æ£€æŸ¥æ–¹å¼å’ŒæœåŠ¡å‘ç°æœºåˆ¶ï¼Œä»¥åŠé…ç½®ç®¡ç†ç­‰å…¶ä»–åŠŸèƒ½ã€‚é€‰æ‹©ä½¿ç”¨å“ªç§æœåŠ¡æ³¨å†Œå’Œå‘ç°ä¸­å¿ƒï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„åº”ç”¨éœ€æ±‚å’Œå®é™…æƒ…å†µæ¥é€‰æ‹©ã€‚

## [Spring Cloud Stream](https://spring.io/projects/spring-cloud-stream)

**Spring Cloud Streamæ˜¯ä¸€ä¸ªç”¨äºæ„å»ºæ¶ˆæ¯é©±åŠ¨å¾®æœåŠ¡çš„æ¡†æ¶**ï¼Œæä¾›äº†ä¸€ç»„ç»Ÿä¸€çš„ç¼–ç¨‹æ¨¡å‹å’Œå¯æ‰©å±•çš„ç»„ä»¶ï¼Œä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥æ›´åŠ ä¾¿æ·åœ°æ„å»ºé«˜å¯é æ€§ã€é«˜æ€§èƒ½å’Œé«˜æ‰©å±•æ€§çš„æ¶ˆæ¯é©±åŠ¨å¾®æœåŠ¡åº”ç”¨ç¨‹åºã€‚é€šè¿‡ä½¿ç”¨Spring Cloud Streamï¼Œå¼€å‘äººå‘˜å¯ä»¥å¿«é€Ÿåœ°æ„å»ºä¸€ä¸ªåˆ†å¸ƒå¼çš„æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼Œä¸ç”¨è¿‡å¤šå…³æ³¨åº•å±‚çš„æ¶ˆæ¯ä¼ è¾“ç»†èŠ‚ã€‚
ä½¿ç”¨Spring Cloud Streamå¯ä»¥æ–¹ä¾¿åœ°é›†æˆå¤šç§æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå¦‚Kafkaã€RabbitMQç­‰ã€‚é€šè¿‡é…ç½®æ–‡ä»¶æ¥æŒ‡å®šä½¿ç”¨çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå³å¯åœ¨ä¸åŒçš„å¾®æœåŠ¡ä¹‹é—´å®ç°æ¶ˆæ¯çš„ä¼ é€’å’Œå¤„ç†ã€‚
Spring Cloud Streamè¿˜æä¾›äº†ä¸°å¯Œçš„å¯æ‰©å±•æ€§å’Œå®šåˆ¶åŒ–é€‰é¡¹ï¼Œä¾‹å¦‚è‡ªå®šä¹‰æ¶ˆæ¯è½¬æ¢å™¨ã€æ¶ˆæ¯é€šé“ã€ç»‘å®šå™¨å’Œæ¶ˆæ¯è·¯ç”±ç­‰ç»„ä»¶ï¼Œä»¥æ»¡è¶³ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ã€‚åŒæ—¶ï¼Œå®ƒè¿˜æä¾›äº†ç›‘æ§å’Œç®¡ç†å·¥å…·ï¼Œæ–¹ä¾¿å¼€å‘è€…è¿›è¡Œæ€§èƒ½è°ƒä¼˜å’Œæ•…éšœæ’æŸ¥ã€‚

### ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼š Binder å’Œ Binding

1. **Binder: **

ç”¨äºä¸å¤–éƒ¨æ¶ˆæ¯ä¸­é—´ä»¶é›†æˆçš„ç»„ä»¶ï¼Œç”¨äºåˆ›å»ºç»‘å®šã€‚ä¸åŒçš„æ¶ˆæ¯ä¸­é—´ä»¶äº§å“éƒ½æœ‰è‡ªå·±çš„Binderå®ç°ã€‚ä¾‹å¦‚ï¼šKafka ä½¿ç”¨ KafkaMessageChannelBinder ï¼Œ RabbitMQ ä½¿ç”¨ RabbitMessageChannelBinder ï¼Œè€Œ RocketMQ ä½¿ç”¨ RocketMQMessageChannelBinder
![image.png](https://cdn.nlark.com/yuque/0/2023/png/22883638/1682215008799-c2a336ab-156f-4957-809d-596b36f52f53.png#averageHue=%23f1f1f1&clientId=u452f7e6b-2e58-4&from=paste&height=687&id=uc4023621&name=image.png&originHeight=1374&originWidth=1984&originalType=binary&ratio=2&rotation=0&showTitle=false&size=258706&status=done&style=none&taskId=u4a478ea8-6977-4559-8bcf-341b08e7e1a&title=&width=992)

2. **Binding:  **

åŒ…æ‹¬è¾“å…¥ç»‘å®šå’Œè¾“å‡ºç»‘å®šã€‚ç»‘å®šå……å½“æ¶ˆæ¯ä¸­é—´ä»¶ä¸åº”ç”¨ç¨‹åºçš„æä¾›è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„æ¡¥æ¢ã€‚å¼€å‘è€…åªéœ€è¦ä½¿ç”¨ Provider æˆ– Consumer æ¥ç”Ÿäº§æˆ–æ¶ˆè´¹æ•°æ®ï¼Œæ— éœ€æ‹…å¿ƒä¸æ¶ˆæ¯ä¸­é—´ä»¶çš„äº¤äº’ã€‚
ä¾‹ï¼š ä½¿ç”¨ Spring Cloud Stream ç¼–å†™ä¸€ä¸ªç®€å•çš„æ¶ˆæ¯å‘é€å’Œæ¥æ”¶ä»£ç 

```java
// æ‰€æœ‰çš„æ‰©å±•éƒ½æ˜¯åŸºäºæ­¤æ®µä»£ç 
MessageChannel messageChannel = new DirectChannel();  //æ¶ˆæ¯é€šé“-ç”¨äºå‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚ DirectChannelç‚¹å¯¹ç‚¹

// Message subscription  æ¶ˆæ¯messageChannelæ¶ˆæ¯é€šé“
((SubscribableChannel) messageChannel).subscribe(new MessageHandler() {
    @Override
    public void handleMessage(Message<? > message) throws MessagingException {
        System.out.println("receive msg: " + message.getPayload());
    }
});

// Message sending
messageChannel.send(MessageBuilder.withPayload("simple msg").build());

//  æ­¤ä»£ç ä¸­çš„æ‰€æœ‰æ¶ˆæ¯ç±»å‹å‡ç”± spring-messaging æ¨¡å—æä¾›ã€‚å®ƒå±è”½äº†æ¶ˆæ¯ä¸­é—´ä»¶çš„åº•å±‚å®ç°ã€‚
// ä¼˜ç‚¹ï¼šå¦‚æœè¦æ›´æ”¹æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œåªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ç›¸å…³çš„æ¶ˆæ¯ä¸­é—´ä»¶ä¿¡æ¯ï¼Œä¿®æ”¹binderä¾èµ–å³å¯
```

> è¿™æ®µä»£ç ä¸»è¦æ¼”ç¤ºäº† Spring Integration ä¸­åŸºäºæ¶ˆæ¯é€šé“çš„æ¶ˆæ¯å‘é€å’Œè®¢é˜…è¿‡ç¨‹ã€‚
> **é¦–å…ˆï¼Œ**æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª  `DirectChannel`  å¯¹è±¡ä½œä¸ºæ¶ˆæ¯é€šé“ï¼Œç”¨äºå‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚ `DirectChannel`  æ˜¯ **Spring Integration **ä¸­æœ€ç®€å•çš„æ¶ˆæ¯é€šé“ç±»å‹ä¹‹ä¸€ï¼Œå®ƒæ˜¯**ä¸€ç§ç‚¹å¯¹ç‚¹é€šä¿¡**æ–¹å¼ï¼Œ**æ¶ˆæ¯ä¼šè¢«ç›´æ¥å‘é€ç»™å¯¹åº”çš„è®¢é˜…è€…**ã€‚
> **æ¥ç€ï¼Œ**æˆ‘ä»¬é€šè¿‡å¼ºåˆ¶ç±»å‹è½¬æ¢å°†  `messageChannel`  è½¬æ¢æˆ  `SubscribableChannel` ï¼Œå¹¶è°ƒç”¨  `subscribe`  æ–¹æ³•è®¢é˜…è¯¥æ¶ˆæ¯é€šé“ã€‚ `subscribe`  æ–¹æ³•æ¥æ”¶ä¸€ä¸ª ** `MessageHandler`  å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå®ƒç”¨äºå¤„ç†è®¢é˜…åˆ°çš„æ¶ˆæ¯**ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç›´æ¥å®ç°äº†  `MessageHandler`  æ¥å£ï¼Œå¹¶é‡å†™äº†  `handleMessage`  æ–¹æ³•æ¥è¾“å‡ºæ¥æ”¶åˆ°çš„æ¶ˆæ¯å†…å®¹ã€‚
> 
> **æœ€å**ï¼Œæˆ‘ä»¬ä½¿ç”¨  `MessageBuilder`  ç±»åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯å¯¹è±¡ï¼Œå¹¶å°†å…¶å‘é€åˆ°æ¶ˆæ¯é€šé“ä¸­ã€‚ `MessageBuilder`  ç±»æä¾›äº†è®¸å¤šé™æ€æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºä¸åŒç±»å‹çš„æ¶ˆæ¯å¯¹è±¡ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†  `withPayload`  æ–¹æ³•æ¥è®¾ç½®æ¶ˆæ¯å†…å®¹ã€‚
> ç»¼ä¸Šæ‰€è¿°ï¼Œè¿™æ®µä»£ç çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯é€šé“å¹¶è®¢é˜…è¯¥é€šé“ï¼Œç„¶åå‘è¯¥é€šé“å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚åœ¨è®¢é˜…åˆ°è¯¥é€šé“çš„æ¶ˆæ¯å¤„ç†å™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¥æ”¶åˆ°çš„æ¶ˆæ¯è¿›è¡Œä¸€äº›å¤„ç†ï¼Œä¾‹å¦‚è¾“å‡ºæ¶ˆæ¯å†…å®¹ç­‰ã€‚

### RocketMQå®ç°æ¶ˆæ¯é€šä¿¡-ï¼ˆéœ€è¦æ‰‹åŠ¨ç»´æŠ¤æ¶ˆæ¯ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…çš„å®ä¾‹çš„å¯åŠ¨åŠæ³¨é”€ï¼‰

1. é¦–å…ˆï¼Œéœ€è¦åœ¨è®¢å•ç³»ç»Ÿå’Œåº“å­˜ç³»ç»Ÿä¸­åˆ†åˆ«å¼•å…¥RocketMQçš„Javaå®¢æˆ·ç«¯SDKï¼Œå¯ä»¥åœ¨Mavenä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š

```xml
<dependency>
  <groupId>org.apache.rocketmq</groupId>
  <artifactId>rocketmq-client</artifactId>
  <version>4.9.1</version>
</dependency>

```

2. ç„¶åï¼Œåœ¨è®¢å•ç³»ç»Ÿä¸­ç¼–å†™ä¸€ä¸ªç”Ÿäº§è€…ç±»ï¼Œç”¨äºå°†è®¢å•ä¿¡æ¯å‘é€åˆ°RocketMQï¼š

```java
// è®¢å•ç”Ÿäº§è€…
public class OrderProducer {
    
    //é»˜è®¤çš„MQç”Ÿäº§è€…
    private DefaultMQProducer producer;

    public OrderProducer() throws MQClientException {
        // åˆ›å»ºä¸€ä¸ªç”Ÿäº§è€…å®ä¾‹
        producer = new DefaultMQProducer("OrderProducerGroup");
        // æŒ‡å®šNameServerçš„åœ°å€
        producer.setNamesrvAddr("localhost:9876");
        // å¯åŠ¨ç”Ÿäº§è€…å®ä¾‹
        producer.start();
    }

    // ç”Ÿäº§è€…å‘é€æ¶ˆæ¯
    public void sendOrderMessage(String message) throws Exception {
        // åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯å®ä¾‹ï¼ŒæŒ‡å®šæ¶ˆæ¯ä¸»é¢˜å’Œæ ‡ç­¾
        Message msg = new Message("OrderTopic", "OrderTag", message.getBytes(RemotingHelper.DEFAULT_CHARSET));
        // å‘é€æ¶ˆæ¯åˆ°RocketMQ
        SendResult result = producer.send(msg);
        // è¾“å‡ºå‘é€ç»“æœ
        System.out.println("å‘é€ç»“æœï¼š" + result);
    }

    public void shutdown() {
        // å…³é—­ç”Ÿäº§è€…å®ä¾‹
        producer.shutdown();
    }
}

```

3. æ¥ä¸‹æ¥ï¼Œåœ¨åº“å­˜ç³»ç»Ÿä¸­ç¼–å†™ä¸€ä¸ªæ¶ˆè´¹è€…ç±»ï¼Œç”¨äºä»RocketMQä¸­æ¥æ”¶è®¢å•ä¿¡æ¯å¹¶è¿›è¡Œå¤„ç†ï¼š

```java
// æ¶ˆè´¹è€…
public class StockConsumer {

    //é»˜è®¤æ¶ˆè´¹è€…
    private DefaultMQPushConsumer consumer;

    //æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯
    public StockConsumer() throws MQClientException {
        // åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹
        consumer = new DefaultMQPushConsumer("StockConsumerGroup");
        // æŒ‡å®šNameServerçš„åœ°å€
        consumer.setNamesrvAddr("localhost:9876");
        // è®¢é˜…æ¶ˆæ¯ä¸»é¢˜å’Œæ ‡ç­¾
        consumer.subscribe("OrderTopic", "OrderTag");
        
        // æ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨
        consumer.registerMessageListener(new MessageListenerConcurrently() {
            @Override
            public ConsumeConcurrentlyStatus consumeMessage(List<MessageExt> msgs, ConsumeConcurrentlyContext context) {
                // å¤„ç†æ¥æ”¶åˆ°çš„è®¢å•ä¿¡æ¯
                for (MessageExt msg : msgs) {
                    System.out.println("æ¥æ”¶åˆ°è®¢å•æ¶ˆæ¯ï¼š" + new String(msg.getBody()));
                }
                // è¿”å›æ¶ˆæ¯æ¶ˆè´¹çŠ¶æ€
                return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;
            }
        });
        // å¯åŠ¨æ¶ˆè´¹è€…å®ä¾‹
        consumer.start();
    }

    public void shutdown() {
        // å…³é—­æ¶ˆè´¹è€…å®ä¾‹
        consumer.shutdown();
    }
}

```

4. æœ€åï¼Œåœ¨è®¢å•ç³»ç»Ÿä¸­å®ä¾‹åŒ–ç”Ÿäº§è€…ç±»ï¼Œå‘é€è®¢å•ä¿¡æ¯ï¼›åœ¨åº“å­˜ç³»ç»Ÿä¸­å®ä¾‹åŒ–æ¶ˆè´¹è€…ç±»ï¼Œæ¥æ”¶å¹¶å¤„ç†è®¢å•ä¿¡æ¯ã€‚

```java
public static void main(String[] args) throws Exception {
    // è®¢å•ç³»ç»Ÿå‘é€è®¢å•ä¿¡æ¯
    OrderProducer producer = new OrderProducer();
    producer.sendOrderMessage("è®¢å•ç¼–å·ï¼š123456");  //è®¢å•å‘é€æ¶ˆæ¯
    producer.shutdown(); //å…³é—­ç”Ÿäº§è€…å®ä¾‹

    //
    // åº“å­˜ç³»ç»Ÿæ¥æ”¶è®¢å•ä¿¡æ¯å¹¶å¤„ç†
    StockConsumer consumer = new StockConsumer();  //åˆ›å»ºæ¶ˆè´¹è€…--ç›´æ¥æ¶ˆè´¹æ¶ˆæ¯
    Thread.sleep(5000); // ç­‰å¾…5ç§’é’Ÿï¼Œç¡®ä¿æ¶ˆæ¯èƒ½å¤Ÿè¢«æ¶ˆè´¹
    consumer.shutdown();  //å…³é—­æ¶ˆè´¹è€…å®ä¾‹
}
```

é€šè¿‡ä»¥ä¸Šçš„æ­¥éª¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨RocketMQæ¥å®ç°è®¢å•ç³»ç»Ÿå’Œåº“å­˜ç³»ç»Ÿä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’å’Œå¤„ç†äº†ã€‚å…¶ä¸­ï¼Œ**ç”Ÿäº§è€…é€šè¿‡æŒ‡å®šNameServeråœ°å€ï¼Œåˆ›å»ºæ¶ˆæ¯å®ä¾‹å¹¶å‘é€åˆ°RocketMQï¼›æ¶ˆè´¹è€…é€šè¿‡è®¢é˜…æ¶ˆæ¯ä¸»é¢˜å’Œæ ‡ç­¾ï¼Œæ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨æ¥æ¥æ”¶å¹¶å¤„ç†ä»RocketMQä¸­ä¼ é€’è¿‡æ¥çš„æ¶ˆæ¯ã€‚**

å¦‚æœä¸ä½¿ç”¨Spring Cloud Streamï¼Œç›´æ¥ä½¿ç”¨RocketMQï¼Œä¼šç›¸å¯¹å¤æ‚ä¸€äº›ã€‚**å¼€å‘äººå‘˜éœ€è¦æ‰‹åŠ¨ç¼–å†™æ¶ˆæ¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„ç›¸å…³ä»£ç **ï¼Œ**å¤„ç†æ¶ˆæ¯è·¯ç”±ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç­‰ç»†èŠ‚ã€‚åŒæ—¶ï¼Œè¿˜éœ€è¦å…³æ³¨æ¶ˆæ¯çš„å¯é æ€§å’Œé¡ºåºæ€§ç­‰é—®é¢˜ï¼Œç¡®ä¿æ¶ˆæ¯èƒ½å¤Ÿè¢«å‡†ç¡®åœ°ä¼ é€’å’Œå¤„ç†**ã€‚è€Œä½¿ç”¨Spring Cloud Streamï¼Œå¯ä»¥æ›´åŠ ç®€åŒ–æ¶ˆæ¯ä¼ é€’çš„è¿‡ç¨‹ï¼Œæé«˜å¼€å‘æ•ˆç‡å’Œä»£ç å¯è¯»æ€§ã€‚

### Spring Cloud Stream + RocketMQ å®ç°ä¸Šè¿°åŠŸèƒ½

1. åœ¨è®¢å•ç³»ç»Ÿå’Œåº“å­˜ç³»ç»Ÿä¸­æ·»åŠ Spring Cloud Streamä¾èµ–ï¼Œä¾‹å¦‚ï¼š

```xml
<!-- å¦‚æœæƒ³ä½¿ç”¨rabbitmqçš„è¯ï¼Œåªéœ€è¦ä¿®æ”¹æ­¤å¤„binderä¾èµ–å³å¯ -->
<dependency>
  <groupId>org.springframework.cloud</groupId>
  <artifactId>spring-cloud-stream-binder-rocketmq</artifactId>
  <version>3.1.4</version>
</dependency>

```

2. é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ä¸­é—´ä»¶ï¼Œé…ç½®ç»‘å®šè¾“å…¥åŠè¾“å‡ºé€šé“ï¼š

```yaml
spring:
  cloud:
    stream:
      rocketmq:
        binder:   # ç”¨äºæŒ‡å®šä½¿ç”¨RocketMQä½œä¸ºæ¶ˆæ¯ä¸­é—´ä»¶çš„Binderï¼Œå¹¶é…ç½®äº†RocketMQçš„NameServeråœ°å€ï¼›
          name-server: localhost:9876  # RocketMQ NameServerçš„åœ°å€
      bindings:  # spring.cloud.stream.bindingsç”¨äºå®šä¹‰äº†è¾“å…¥é€šé“å’Œè¾“å‡ºé€šé“çš„ç›¸å…³å±æ€§ï¼Œå¦‚æ¶ˆæ¯ä¸»é¢˜ã€æ¶ˆæ¯ç±»å‹ã€æ¶ˆè´¹è€…ç»„ç­‰ï¼›
        order-output:  # è¾“å‡ºé€šé“çš„åç§°
          destination: OrderTopic  # æ¶ˆæ¯ä¸»é¢˜--åŒ¹é…æ¶ˆè´¹è€…çš„topic
          content-type: application/json  # æ¶ˆæ¯çš„ç±»å‹ï¼Œå¦‚JSONã€XMLã€Textç­‰ï¼›
          producer:   # producerç”¨äºæŒ‡å®šæ¶ˆæ¯çš„ç”Ÿäº§è€…ç›¸å…³å±æ€§ï¼Œå¦‚æ¶ˆæ¯è·¯ç”±ã€åºåˆ—åŒ–æ–¹å¼ç­‰ï¼›
            message-key-expression: payload.orderId  # æ¶ˆæ¯è·¯ç”±è¡¨è¾¾å¼ï¼Œç”¨äºå°†æ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„é˜Ÿåˆ—
        order-input:  # è¾“å…¥é€šé“çš„åç§°
          destination: OrderTopic  # æ¶ˆæ¯ä¸»é¢˜--ä»OrderTopicä¸»é¢˜ä¸­çš„è·å–æ¶ˆæ¯å¹¶æ¶ˆè´¹
          content-type: application/json  # æ¶ˆæ¯ç±»å‹
          group: StockConsumerGroup  # æ¶ˆè´¹è€…ç»„çš„åç§°
          consumer:   # consumerç”¨äºæŒ‡å®šæ¶ˆæ¯çš„æ¶ˆè´¹è€…ç›¸å…³å±æ€§ï¼Œå¦‚æ¶ˆè´¹è€…ç»„ã€æœ€å¤§é‡è¯•æ¬¡æ•°ç­‰
            max-attempts: 3  # æ¶ˆæ¯é‡è¯•çš„æœ€å¤§æ¬¡æ•°

```

3. åœ¨è®¢å•ç³»ç»Ÿä¸­å®šä¹‰ä¸€ä¸ªè¾“å‡ºé€šé“ï¼Œç”¨äºå°†è®¢å•ä¿¡æ¯å‘é€åˆ°RocketMQï¼š

```java
public interface OrderSource {
    @Output("order-output")  // å®šä¹‰è¾“å‡ºé€šé“çš„åç§°ä¸ºorder-output
    MessageChannel output();  // è·å–è¾“å‡ºé€šé“çš„å®ä¾‹
    // MessageChannelæ˜¯Spring Cloud Streamçš„ä¸€ä¸ªæ ¸å¿ƒæ¥å£ï¼Œç”¨äºå®šä¹‰æ¶ˆæ¯é€šé“çš„åŸºæœ¬æ“ä½œï¼Œå¦‚æ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶ï¼›
}
```

4. åœ¨è®¢å•ç³»ç»Ÿä¸­ç¼–å†™ä¸€ä¸ªç”Ÿäº§è€…ç±»ï¼Œç”¨äºå°†è®¢å•ä¿¡æ¯å‘é€åˆ°RocketMQï¼š

```java
@EnableBinding(OrderSource.class)  // å¯åŠ¨ç»‘å®šï¼Œå°†OrderSourceæ¥å£ä¸æ¶ˆæ¯ä¸­é—´ä»¶è¿›è¡Œç»‘å®š
public class OrderProducer {

    @Autowired
    private OrderSource orderSource;  // æ³¨å…¥OrderSourceæ¥å£å®ä¾‹ï¼Œç”¨äºå‘é€æ¶ˆæ¯

    // MessageBuilder.withPayload(message).build()ç”¨äºæ„å»ºä¸€ä¸ªæ¶ˆæ¯å®ä¾‹ï¼›
    public void sendOrderMessage(String message) {
        // ä½¿ç”¨OrderSourceå®ä¾‹çš„output()æ–¹æ³•è·å–è¾“å‡ºé€šé“ï¼Œå¹¶å‘é€æ¶ˆæ¯
        orderSource.output().send(MessageBuilder.withPayload(message).build());  
        System.out.println("å‘é€è®¢å•æ¶ˆæ¯ï¼š" + message);
    }
}

```

5. åœ¨åº“å­˜ç³»ç»Ÿä¸­å®šä¹‰ä¸€ä¸ªè¾“å…¥é€šé“ï¼Œç”¨äºä»RocketMQä¸­æ¥æ”¶è®¢å•ä¿¡æ¯ï¼š

```java
public interface OrderSink {
    @Input("order-input")  // å®šä¹‰è¾“å…¥é€šé“çš„åç§°ä¸ºorder-input
    SubscribableChannel input();  // input()ç”¨äºè·å–è¾“å…¥é€šé“çš„å®ä¾‹ï¼Œç”¨äºä»RocketMQä¸­æ¥æ”¶æ¶ˆæ¯ã€‚
}
// SubscribableChannelæ˜¯Spring Cloud Streamçš„ä¸€ä¸ªæ ¸å¿ƒæ¥å£ï¼Œç”¨äºå®šä¹‰æ¶ˆæ¯è®¢é˜…é€šé“çš„åŸºæœ¬æ“ä½œï¼Œå¦‚è®¢é˜…æ¶ˆæ¯å’Œå–æ¶ˆè®¢é˜…ï¼›
```

6. åœ¨åº“å­˜ç³»ç»Ÿä¸­ç¼–å†™ä¸€ä¸ªæ¶ˆè´¹è€…ç±»ï¼Œç”¨äºä»RocketMQä¸­æ¥æ”¶è®¢å•ä¿¡æ¯å¹¶è¿›è¡Œå¤„ç†ï¼š

```java
@EnableBinding(OrderSink.class)  // å¯ç”¨ç»‘å®šåŠŸèƒ½ï¼Œå°†OrderSinkæ¥å£ä¸æ¶ˆæ¯ä¸­é—´ä»¶è¿›è¡Œç»‘å®š
public class StockConsumer {

    //å½“æœ‰æ¶ˆæ¯åˆ°è¾¾æ—¶ï¼ŒSpring Cloud Streamä¼šè‡ªåŠ¨è°ƒç”¨receiveOrderMessage()æ–¹æ³•ï¼Œå°†æ¶ˆæ¯ä½œä¸ºæ–¹æ³•çš„å‚æ•°ä¼ å…¥ï¼›
    @StreamListener("order-input")  // ç›‘å¬è¾“å…¥é€šé“order-input ï¼Œç”¨äºç›‘å¬è¾“å…¥é€šé“order-inputï¼Œ
    public void receiveOrderMessage(String message) {
        System.out.println("æ¥æ”¶åˆ°è®¢å•æ¶ˆæ¯ï¼š" + message);
    }
}

```

7. æœ€åï¼Œåœ¨è®¢å•ç³»ç»Ÿä¸­å®ä¾‹åŒ–ç”Ÿäº§è€…ç±»ï¼Œå‘é€è®¢å•ä¿¡æ¯ï¼›åœ¨åº“å­˜ç³»ç»Ÿä¸­å®ä¾‹åŒ–æ¶ˆè´¹è€…ç±»ï¼Œæ¥æ”¶å¹¶å¤„ç†è®¢å•ä¿¡æ¯ã€‚

```java
public static void main(String[] args) throws Exception {
    // è®¢å•ç³»ç»Ÿå‘é€è®¢å•ä¿¡æ¯
    OrderProducer producer = new OrderProducer();
    producer.sendOrderMessage("è®¢å•ç¼–å·ï¼š123456");

    // åº“å­˜ç³»ç»Ÿæ¥æ”¶è®¢å•ä¿¡æ¯å¹¶å¤„ç†
    SpringApplication.run(StockConsumer.class, args);
}

```

## Spring Cloud Netflix 

### OpenFeign


## Zookeper

# ä¸­é—´ä»¶

## MQ

### RabbitMQ

å®˜ç½‘: https://www.rabbitmq.com/tutorials/tutorial-three-java

![image-20240407212738561](/Users/blakeya/IdeaProjects/BlakeYa.github.io/readme.assets/image-20240407212738561.png)

![image-20240407212824415](/Users/blakeya/IdeaProjects/BlakeYa.github.io/readme.assets/image-20240407212824415.png)

![image-20240407213611628](/Users/blakeya/IdeaProjects/BlakeYa.github.io/readme.assets/image-20240407213611628.png)

**äº¤æ¢æœºç±»å‹:**

RabbitMQ æ”¯æŒä»¥ä¸‹å‡ ç§ç±»å‹çš„äº¤æ¢æœºï¼š

1. Direct Exchangeï¼ˆç›´è¿äº¤æ¢æœºï¼‰ï¼šå°†æ¶ˆæ¯é€šè¿‡è·¯ç”±é”®ï¼ˆRouting Keyï¼‰ä¸ç»‘å®šåˆ°äº¤æ¢æœºä¸Šçš„é˜Ÿåˆ—çš„ç»‘å®šé”®ï¼ˆBinding Keyï¼‰è¿›è¡Œç²¾ç¡®åŒ¹é…ï¼Œåªæœ‰å®Œå…¨åŒ¹é…çš„ç»‘å®šé”®å’Œè·¯ç”±é”®çš„æ¶ˆæ¯æ‰ä¼šè¢«æŠ•é€’åˆ°å¯¹åº”çš„é˜Ÿåˆ—ä¸­ã€‚
2. Fanout Exchangeï¼ˆæ‰‡å½¢äº¤æ¢æœºï¼‰ï¼šå°†æ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šåˆ°è¯¥äº¤æ¢æœºä¸Šçš„é˜Ÿåˆ—ï¼Œå¿½ç•¥ç»‘å®šé”®ã€‚å³ä½¿æ¶ˆæ¯çš„è·¯ç”±é”®ä¸ç»‘å®šé”®ä¸åŒ¹é…ï¼Œæ¶ˆæ¯ä¹Ÿä¼šè¢«å‘é€åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ä¸­ã€‚
3. Topic Exchangeï¼ˆä¸»é¢˜äº¤æ¢æœºï¼‰ï¼šå°†æ¶ˆæ¯é€šè¿‡æ¨¡å¼åŒ¹é…çš„æ–¹å¼è¿›è¡Œè·¯ç”±ï¼Œå°†è·¯ç”±é”®å’Œç»‘å®šé”®è¿›è¡ŒåŒ¹é…ï¼Œæ”¯æŒé€šé…ç¬¦ `*` å’Œ `#`ã€‚å…¶ä¸­ `*` åŒ¹é…ä¸€ä¸ªå•è¯ï¼Œ`#` åŒ¹é…å¤šä¸ªå•è¯ï¼ˆåŒ…æ‹¬é›¶ä¸ªå•è¯ï¼‰ã€‚æ ¹æ®è·¯ç”±é”®å’Œç»‘å®šé”®çš„åŒ¹é…ç¨‹åº¦ï¼Œæ¶ˆæ¯ä¼šè¢«æŠ•é€’åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªåŒ¹é…çš„é˜Ÿåˆ—ä¸­ã€‚
4. Headers Exchangeï¼ˆå¤´éƒ¨äº¤æ¢æœºï¼‰ï¼šæ ¹æ®æ¶ˆæ¯å¤´éƒ¨çš„å±æ€§è¿›è¡Œè·¯ç”±ï¼Œä¸è€ƒè™‘è·¯ç”±é”®ï¼Œè€Œæ˜¯æ ¹æ®æ¶ˆæ¯å¤´éƒ¨çš„é”®å€¼å¯¹è¿›è¡ŒåŒ¹é…ã€‚åœ¨ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœºæ—¶ï¼Œéœ€è¦æŒ‡å®šä¸€ç»„é”®å€¼å¯¹ï¼ˆheaderï¼‰ï¼Œå½“æ¶ˆæ¯çš„å¤´éƒ¨å±æ€§ä¸æŒ‡å®šçš„é”®å€¼å¯¹å®Œå…¨åŒ¹é…æ—¶ï¼Œæ¶ˆæ¯æ‰ä¼šè¢«æŠ•é€’åˆ°å¯¹åº”çš„é˜Ÿåˆ—ä¸­ã€‚

æ¯ç§ç±»å‹çš„äº¤æ¢æœºåœ¨ä¸åŒåœºæ™¯ä¸‹æœ‰ä¸åŒçš„åº”ç”¨ï¼Œå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„äº¤æ¢æœºç±»å‹.

**å¦‚ä½•é˜²æ­¢æ¶ˆæ¯è¢«é‡å¤æ¶ˆè´¹å‘¢?**

é˜²æ­¢æ¶ˆæ¯è¢«é‡å¤æ¶ˆè´¹æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥è§£å†³ï¼š

1. æ¶ˆè´¹è€…åº”ç­”æœºåˆ¶ï¼šåœ¨æ¶ˆè´¹è€…æˆåŠŸå¤„ç†ä¸€æ¡æ¶ˆæ¯åï¼Œå‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€ç¡®è®¤ï¼ˆacknowledgementï¼‰ï¼Œå‘ŠçŸ¥é˜Ÿåˆ—å¯ä»¥å®‰å…¨åœ°åˆ é™¤æˆ–æ ‡è®°è¯¥æ¶ˆæ¯ä¸ºå·²æ¶ˆè´¹ã€‚æ¶ˆæ¯é˜Ÿåˆ—æ ¹æ®æ”¶åˆ°çš„ç¡®è®¤æ¥å†³å®šæ˜¯å¦å°†æ¶ˆæ¯ä»é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚å¦‚æœæ¶ˆè´¹è€…åœ¨å¤„ç†æ¶ˆæ¯æœŸé—´å‘ç”Ÿå¼‚å¸¸æˆ–å¤±è´¥ï¼Œå¯ä»¥é€‰æ‹©ä¸å‘é€ç¡®è®¤ï¼Œè®©æ¶ˆæ¯é‡æ–°è¿›å…¥é˜Ÿåˆ—ï¼Œç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ã€‚
2. æ¶ˆæ¯å»é‡ï¼šåœ¨æ¶ˆè´¹è€…ç«¯ç»´æŠ¤ä¸€ä¸ªæ¶ˆæ¯å¤„ç†è®°å½•æˆ–è€…ç¼“å­˜ï¼Œè®°å½•å·²ç»å¤„ç†è¿‡çš„æ¶ˆæ¯çš„å”¯ä¸€æ ‡è¯†ã€‚åœ¨å¤„ç†æ–°æ¶ˆæ¯ä¹‹å‰ï¼Œå…ˆæ£€æŸ¥è¯¥æ¶ˆæ¯æ˜¯å¦å·²ç»å¤„ç†è¿‡ï¼Œå¦‚æœæ˜¯åˆ™ç›´æ¥ä¸¢å¼ƒæˆ–è€…å¿½ç•¥ï¼Œé¿å…é‡å¤å¤„ç†ã€‚
3. å¹‚ç­‰æ€§å¤„ç†ï¼šè®¾è®¡æ¶ˆè´¹è€…çš„ä¸šåŠ¡é€»è¾‘å…·æœ‰å¹‚ç­‰æ€§ï¼Œå³å¯¹åŒä¸€æ¡æ¶ˆæ¯çš„å¤šæ¬¡å¤„ç†ç»“æœä¸å•æ¬¡å¤„ç†ç»“æœç›¸åŒã€‚è¿™æ ·å³ä½¿åŒä¸€æ¡æ¶ˆæ¯è¢«å¤šæ¬¡æ¶ˆè´¹ï¼Œæœ€ç»ˆçš„å¤„ç†ç»“æœä¹Ÿæ˜¯ä¸€è‡´çš„ï¼Œä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨æˆ–è€…é”™è¯¯ã€‚å¸¸è§çš„åšæ³•æ˜¯ç»™æ¯æ¡æ¶ˆæ¯åˆ†é…ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ï¼Œå¹¶åœ¨å¤„ç†æ¶ˆæ¯æ—¶æ ¹æ®è¯¥æ ‡è¯†è¿›è¡Œå¹‚ç­‰æ€§æ ¡éªŒã€‚
4. ä¿è¯æ¶ˆæ¯ä¼ é€’çš„é¡ºåºæ€§ï¼šåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæ¶ˆæ¯çš„é¡ºåºæ€§æ˜¯å¾ˆé‡è¦çš„ï¼Œä¸èƒ½è¢«æ‰“ä¹±ã€‚å¯ä»¥é€šè¿‡æ§åˆ¶æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹è€…æ•°é‡ï¼Œä¿è¯åŒä¸€ä¸ªæ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œä»è€Œä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ã€‚

**rabbitmq å¦‚ä½•ä¿è¯é«˜å¯ç”¨**

RabbitMQ æä¾›äº†å‡ ç§æ–¹å¼æ¥ä¿è¯é«˜å¯ç”¨æ€§ï¼š

1. é•œåƒé˜Ÿåˆ—ï¼ˆMirrored Queuesï¼‰ï¼šRabbitMQ å…è®¸åœ¨é›†ç¾¤ä¸­åˆ›å»ºé•œåƒé˜Ÿåˆ—ï¼Œè¿™æ ·é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šè¢«å¤åˆ¶åˆ°é›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œå½¢æˆé˜Ÿåˆ—çš„é•œåƒã€‚è¿™æ ·å³ä½¿æŸä¸ªèŠ‚ç‚¹æ•…éšœï¼Œå…¶ä»–èŠ‚ç‚¹ä¸Šçš„é•œåƒé˜Ÿåˆ—ä»ç„¶å¯ä»¥æä¾›æœåŠ¡ï¼Œç¡®ä¿æ¶ˆæ¯çš„å¯ç”¨æ€§å’ŒæŒä¹…æ€§ã€‚
2. é•œåƒç­–ç•¥ï¼ˆMirrored Policyï¼‰ï¼šé€šè¿‡è®¾ç½®é•œåƒç­–ç•¥ï¼Œå¯ä»¥è‡ªåŠ¨å°†æ–°åˆ›å»ºçš„é˜Ÿåˆ—è½¬æ¢ä¸ºé•œåƒé˜Ÿåˆ—ï¼Œå¹¶æŒ‡å®šé•œåƒé˜Ÿåˆ—çš„æ•°é‡å’Œä½ç½®ã€‚å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚å’Œæ€§èƒ½è¦æ±‚æ¥é…ç½®é•œåƒç­–ç•¥ï¼Œç¡®ä¿æ•°æ®çš„å¤‡ä»½å’Œå®¹é”™èƒ½åŠ›ã€‚
3. é«˜å¯ç”¨é›†ç¾¤ï¼ˆHighly Available Clusterï¼‰ï¼šåœ¨ RabbitMQ ä¸­ï¼Œå¯ä»¥å°†å¤šä¸ªèŠ‚ç‚¹ç»„æˆä¸€ä¸ªé«˜å¯ç”¨æ€§é›†ç¾¤ï¼Œé€šè¿‡ä½¿ç”¨é•œåƒé˜Ÿåˆ—å’Œæ•°æ®å¤åˆ¶æœºåˆ¶ï¼Œåœ¨é›†ç¾¤ä¸­çš„ä»»ä½•èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶éƒ½èƒ½ä¿è¯æ¶ˆæ¯çš„å¯ç”¨æ€§å’Œæ•°æ®çš„å®Œæ•´æ€§ã€‚é›†ç¾¤ä¸­çš„å„ä¸ªèŠ‚ç‚¹å¯ä»¥ç›¸äº’å¤‡ä»½å’Œæ¢å¤ï¼Œæä¾›æ›´é«˜çš„å¯é æ€§å’Œå®¹é”™èƒ½åŠ›ã€‚
4. è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆAutomatic Failoverï¼‰ï¼šRabbitMQ é›†ç¾¤æ”¯æŒè‡ªåŠ¨æ•…éšœè½¬ç§»åŠŸèƒ½ï¼Œå½“é›†ç¾¤ä¸­çš„æŸä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œé›†ç¾¤ä¼šè‡ªåŠ¨å°†è¯¥èŠ‚ç‚¹ä¸Šçš„è§’è‰²å’Œæ•°æ®è½¬ç§»åˆ°å…¶ä»–å¥åº·çš„èŠ‚ç‚¹ä¸Šï¼Œç¡®ä¿æœåŠ¡çš„æŒç»­æ€§å’Œå¯ç”¨æ€§ã€‚
5. å¿ƒè·³æ£€æµ‹ï¼ˆHeartbeat Monitoringï¼‰ï¼šRabbitMQ é›†ç¾¤ä¼šå®šæœŸå‘é€å¿ƒè·³æ¶ˆæ¯æ¥ç›‘æµ‹é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹çš„å¥åº·çŠ¶æ€ï¼Œä¸€æ—¦å‘ç°èŠ‚ç‚¹æ•…éšœæˆ–è€…ç½‘ç»œå¼‚å¸¸ï¼Œé›†ç¾¤ä¼šç«‹å³è¿›è¡Œæ•…éšœå¤„ç†å’Œæ¢å¤ï¼Œç¡®ä¿é›†ç¾¤çš„ç¨³å®šè¿è¡Œã€‚

é€šè¿‡ä»¥ä¸Šè¿™äº›æœºåˆ¶ï¼ŒRabbitMQ èƒ½å¤Ÿæœ‰æ•ˆåœ°ä¿è¯æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜å¯ç”¨æ€§å’Œå®¹é”™èƒ½åŠ›ï¼Œç¡®ä¿ä¸šåŠ¡ç³»ç»Ÿçš„ç¨³å®šè¿è¡Œã€‚



**å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§:**

1. å°†æœ‰åºçš„æ¶ˆæ¯ç›´æ¥æ”¾åœ¨åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­, è¿™æ ·é€šè¿‡é˜Ÿåˆ—å°±èƒ½ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§;
2. 



### RocketMQ 


## Nginx



# åˆ†å¸ƒå¼

**å¸¸ç”¨çš„è§£å†³å¹¶å‘æ‰§è¡Œé—®é¢˜çš„æŠ€æœ¯åŒ…æ‹¬é”ã€åŸå­æ“ä½œã€äº‹åŠ¡ç­‰ã€‚**

## çº¿ç¨‹åŒæ­¥æ–¹æ¡ˆï¼š

ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®çš„åˆ†å¸ƒå¼åŒæ­¥æ–¹æ¡ˆï¼š

1. åˆ†å¸ƒå¼é”ï¼š åˆ†å¸ƒå¼é”æ˜¯ä¸€ç§å¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼Œç”¨äºåœ¨é›†ç¾¤ç¯å¢ƒä¸­å®ç°äº’æ–¥è®¿é—®å…±äº«èµ„æºã€‚å¸¸è§çš„åˆ†å¸ƒå¼é”å®ç°æ–¹å¼åŒ…æ‹¬åŸºäºæ•°æ®åº“ã€åŸºäºRedisã€åŸºäºZooKeeperç­‰ã€‚ä¾‹å¦‚ï¼ŒRedisçš„RedLockç®—æ³•æä¾›äº†ä¸€ç§å®ç°åˆ†å¸ƒå¼é”çš„æœ‰æ•ˆæ–¹æ³•ã€‚
2. ä¹è§‚é”ï¼š ä¹è§‚é”æ˜¯ä¸€ç§åŸºäºæ•°æ®ç‰ˆæœ¬å·ï¼ˆversionï¼‰çš„é”å®šæœºåˆ¶ã€‚å½“éœ€è¦æ›´æ–°æ•°æ®æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥æ•°æ®çš„ç‰ˆæœ¬å·æ˜¯å¦ä¸é¢„æœŸä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™æ‰§è¡Œæ›´æ–°æ“ä½œå¹¶å¢åŠ ç‰ˆæœ¬å·ï¼›å¦åˆ™ï¼Œè¡¨ç¤ºæ•°æ®å·²è¢«å…¶ä»–èŠ‚ç‚¹ä¿®æ”¹ï¼Œéœ€è¦é‡æ–°è·å–æ•°æ®å¹¶é‡è¯•ã€‚ä¹è§‚é”é€‚ç”¨äºæ•°æ®ç«äº‰ä¸æ¿€çƒˆçš„åœºæ™¯ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘é”çš„å¼€é”€ã€‚
3. æ¶ˆæ¯é˜Ÿåˆ—ï¼š æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥ç”¨äºè§£å†³åˆ†å¸ƒå¼ç¯å¢ƒä¸­çš„æ•°æ®åŒæ­¥é—®é¢˜ã€‚å½“éœ€è¦å¯¹å…±äº«èµ„æºè¿›è¡Œæ“ä½œæ—¶ï¼Œå¯ä»¥å°†æ“ä½œä»»åŠ¡å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚ç„¶åï¼Œä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡å¹¶æ‰§è¡Œã€‚é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¯ä»¥ç¡®ä¿ä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œï¼Œä»è€Œå®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„åŒæ­¥ã€‚
4. åˆ†å¸ƒå¼äº‹åŠ¡ï¼š å¯¹äºæ¶‰åŠåˆ°å¤šä¸ªæ•°æ®æºæˆ–æœåŠ¡çš„æ“ä½œï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ä¸€ç§è·¨å¤šä¸ªç‹¬ç«‹èŠ‚ç‚¹çš„äº‹åŠ¡å¤„ç†æœºåˆ¶ï¼Œå¸¸è§çš„å®ç°æ–¹å¼åŒ…æ‹¬ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰å’Œä¸‰é˜¶æ®µæäº¤ï¼ˆ3PCï¼‰ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€äº›åŸºäºæ¶ˆæ¯é˜Ÿåˆ—ã€äº‹ä»¶é©±åŠ¨ç­‰çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œå¦‚Sagaæ¨¡å¼ã€‚
   éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„åŒæ­¥é€šå¸¸æ¯”å•æœºç¯å¢ƒæ›´å¤æ‚ï¼Œä¸”å¯èƒ½ä¼šå¸¦æ¥æ›´é«˜çš„æ€§èƒ½å¼€é”€ã€‚å› æ­¤ï¼Œåœ¨è®¾è®¡åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œéœ€è¦æ ¹æ®å®é™…éœ€æ±‚å’Œåœºæ™¯æ¥é€‰æ‹©åˆé€‚çš„åŒæ­¥æ–¹æ¡ˆã€‚



